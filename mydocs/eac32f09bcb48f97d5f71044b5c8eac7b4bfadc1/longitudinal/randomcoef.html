<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.203">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Michael Liou">
<meta name="dcterms.date" content="2022-12-19">

<title>Personal Documentation - 14&nbsp; Random Coefficient Models (CALS)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../longitudinal/within_between.html" rel="next">
<link href="../longitudinal/longitudinal.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script src="../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Random Coefficient Models (CALS)</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Personal Documentation</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Front Page</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../advanced/advanced.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Advanced R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../approximation/approximation.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Approximation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../bayesian/bayesian.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Bayesian</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../categorical/categorical.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Categorical Data Analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../changepoint/changepoint.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Changepoint Analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../crossover/crossover.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Crossover Designs</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../diffeq/diffeq.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Differential Equations</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../epidemiology/epidemiology.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Epidemiology</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../experimentaldesign/experimentaldesign.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Experimental Design</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../exponential/exponential.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Exponential Modeling</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../gam/gam.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Generalized Additive Models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../longitudinal/longitudinal.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Longitudinal Data Analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../longitudinal/randomcoef.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Random Coefficient Models (CALS)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../longitudinal/within_between.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">The Within-Between Model</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../matrix/matrix.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Matrix Math</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../meta/meta.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Meta Analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../mixed/mixed.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Mixed Models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../mixed/mixed_variance.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Mixed Models (Variance)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../network/network_centrality.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Network Centrality</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../network/network_gnar.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">GNAR</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../next_gen_sequencing/next_gen_sequencing.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Next Generation Sequencing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../observable/observable.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Observable Testing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../optimization/optimization.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Optimization</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ordination/ordination.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Ordination</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallel/parallel.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Parallel Computing in R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plant_breeding/plant_breeding.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Plant Breeding</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../social_network/social_network.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Social Network Analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../spatial/carbayes.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">CARBayes</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../spatial/spatial.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Spatial Statistics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stochastic/stochastic.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">Stochastic</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../timeseries/timeseries.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Time Series</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Draft</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../bootstrap/bootstrap.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Bootstrap</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../causal/causal.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">Causal Statistics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../sensitivity/sensitivity.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Sensitivity Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../signal/signal.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Signal Processing</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Appendices</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../color/color.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Colors in R</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#modeling-heterogeneity-fixed-effect-models-vs-random-coefficient-models" id="toc-modeling-heterogeneity-fixed-effect-models-vs-random-coefficient-models" class="nav-link active" data-scroll-target="#modeling-heterogeneity-fixed-effect-models-vs-random-coefficient-models"><span class="toc-section-number">15</span>  Modeling Heterogeneity: Fixed Effect models vs Random Coefficient Models</a></li>
  <li><a href="#introducing-autism-data-part-b" id="toc-introducing-autism-data-part-b" class="nav-link" data-scroll-target="#introducing-autism-data-part-b"><span class="toc-section-number">16</span>  Introducing Autism Data (part b)</a></li>
  <li><a href="#fixed-effect-modeling-part-c" id="toc-fixed-effect-modeling-part-c" class="nav-link" data-scroll-target="#fixed-effect-modeling-part-c"><span class="toc-section-number">17</span>  Fixed Effect Modeling (part c)</a>
  <ul class="collapse">
  <li><a href="#modeling-the-mean" id="toc-modeling-the-mean" class="nav-link" data-scroll-target="#modeling-the-mean"><span class="toc-section-number">17.1</span>  Modeling the Mean</a>
  <ul class="collapse">
  <li><a href="#diagnostics" id="toc-diagnostics" class="nav-link" data-scroll-target="#diagnostics"><span class="toc-section-number">17.1.1</span>  Diagnostics</a></li>
  </ul></li>
  <li><a href="#modeling-the-variance" id="toc-modeling-the-variance" class="nav-link" data-scroll-target="#modeling-the-variance"><span class="toc-section-number">17.2</span>  Modeling the variance</a>
  <ul class="collapse">
  <li><a href="#line-graph-of-matrix-entries-grouped-by-row" id="toc-line-graph-of-matrix-entries-grouped-by-row" class="nav-link" data-scroll-target="#line-graph-of-matrix-entries-grouped-by-row"><span class="toc-section-number">17.2.1</span>  1. Line Graph of matrix entries, grouped by row</a></li>
  <li><a href="#semi-variogram" id="toc-semi-variogram" class="nav-link" data-scroll-target="#semi-variogram"><span class="toc-section-number">17.2.2</span>  2. Semi-(Variogram)</a></li>
  <li><a href="#auto-correlation-functions" id="toc-auto-correlation-functions" class="nav-link" data-scroll-target="#auto-correlation-functions"><span class="toc-section-number">17.2.3</span>  3. Auto Correlation Functions</a></li>
  <li><a href="#fitting-variance-models" id="toc-fitting-variance-models" class="nav-link" data-scroll-target="#fitting-variance-models"><span class="toc-section-number">17.2.4</span>  Fitting variance models</a></li>
  </ul></li>
  <li><a href="#final-model" id="toc-final-model" class="nav-link" data-scroll-target="#final-model"><span class="toc-section-number">17.3</span>  Final Model</a></li>
  <li><a href="#weighted-least-squares" id="toc-weighted-least-squares" class="nav-link" data-scroll-target="#weighted-least-squares"><span class="toc-section-number">17.4</span>  Weighted Least Squares</a></li>
  </ul></li>
  <li><a href="#mixed-effect-modeling-part-d" id="toc-mixed-effect-modeling-part-d" class="nav-link" data-scroll-target="#mixed-effect-modeling-part-d"><span class="toc-section-number">18</span>  Mixed Effect Modeling (part d)</a>
  <ul class="collapse">
  <li><a href="#fitting-models" id="toc-fitting-models" class="nav-link" data-scroll-target="#fitting-models"><span class="toc-section-number">18.1</span>  Fitting Models</a></li>
  <li><a href="#diagnostics-1" id="toc-diagnostics-1" class="nav-link" data-scroll-target="#diagnostics-1"><span class="toc-section-number">18.2</span>  Diagnostics</a>
  <ul class="collapse">
  <li><a href="#quad" id="toc-quad" class="nav-link" data-scroll-target="#quad"><span class="toc-section-number">18.2.1</span>  Quad</a></li>
  <li><a href="#quad-simplified-no-intercept" id="toc-quad-simplified-no-intercept" class="nav-link" data-scroll-target="#quad-simplified-no-intercept"><span class="toc-section-number">18.2.2</span>  Quad simplified, no intercept</a></li>
  </ul></li>
  <li><a href="#further-covariance-adjustments" id="toc-further-covariance-adjustments" class="nav-link" data-scroll-target="#further-covariance-adjustments"><span class="toc-section-number">18.3</span>  Further covariance adjustments</a></li>
  <li><a href="#final-model-1" id="toc-final-model-1" class="nav-link" data-scroll-target="#final-model-1"><span class="toc-section-number">18.4</span>  Final Model</a></li>
  </ul></li>
  <li><a href="#sas-modeling" id="toc-sas-modeling" class="nav-link" data-scroll-target="#sas-modeling"><span class="toc-section-number">19</span>  SAS Modeling</a></li>
  <li><a href="#other-thoughts-mixed-modeling-is-smart-averaging-to-the-pooled-model." id="toc-other-thoughts-mixed-modeling-is-smart-averaging-to-the-pooled-model." class="nav-link" data-scroll-target="#other-thoughts-mixed-modeling-is-smart-averaging-to-the-pooled-model."><span class="toc-section-number">20</span>  Other thoughts: Mixed modeling is smart averaging to the pooled model.</a>
  <ul class="collapse">
  <li><a href="#g-effect-on-blups" id="toc-g-effect-on-blups" class="nav-link" data-scroll-target="#g-effect-on-blups"><span class="toc-section-number">20.1</span>  G effect on BLUPs</a></li>
  <li><a href="#r-effect-on-blups" id="toc-r-effect-on-blups" class="nav-link" data-scroll-target="#r-effect-on-blups"><span class="toc-section-number">20.2</span>  R effect on BLUPs</a></li>
  </ul></li>
  <li><a href="#other-thoughts-fixed-vs-random" id="toc-other-thoughts-fixed-vs-random" class="nav-link" data-scroll-target="#other-thoughts-fixed-vs-random"><span class="toc-section-number">21</span>  Other thoughts: Fixed vs Random</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Random Coefficient Models (CALS)</span></h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Michael Liou </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">December 19, 2022</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="modeling-heterogeneity-fixed-effect-models-vs-random-coefficient-models" class="level1" data-number="15">
<h1 data-number="15"><span class="header-section-number">15</span> Modeling Heterogeneity: Fixed Effect models vs Random Coefficient Models</h1>
<p>In continuation of looking at heterogenous variance modeling, random coefficient models are a specific type of mixed effect model that allow richness in modeling the variance through random effects. This is adding to the toolbox that we’ve built upon from last week in we looked at modeling the covariance matrix directly. Since we are introducing two “angles” of attack and giving structure to the variance <span class="math inline">Var(Y)</span>, SAS commonly refers to this method of covariance modeling through random effects as “G”-side. Modeling the covariance directly as we did last week is referred to as “R”-side for “residuals”. The terminology becomes more clear with the framework:</p>
<p><span class="math display">
\begin{aligned}
Y = X\beta + Zu + e
\end{aligned}
</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">u\sim N(0,G)</span></li>
<li><span class="math inline">\varepsilon \sim N(0, R)</span></li>
</ul>
<p><span class="math display">
\begin{aligned}
Var(Y) &amp;= Z\underbrace{\operatorname{Var}(u)}_GZ' + \underbrace{\operatorname{Var}(e)}_{R} \\
&amp;= \Sigma
\end{aligned}
</span> Note we can also define the following variances when additional random effects are present, such that:</p>
<ul>
<li><span class="math inline">\operatorname{Var}(Y | u) = R</span> “conditional variance”</li>
<li><span class="math inline">\operatorname{Var}(Y) = ZGZ' + R</span> “marginal (individual) variance”</li>
<li><span class="math inline">\operatorname{Var}(u) = G</span> “random effect variance”</li>
</ul>
<p>These are directly extractable through <code>lme</code> with <code>getVarCov(obj, type = c("random.effects", "conditional", "marginal"))</code>.</p>
<p>In the fixed effects models, we have</p>
<p><span class="math display">
\begin{aligned}
Y = X\beta + \varepsilon
\end{aligned}
</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\varepsilon \sim N(0,\Sigma)</span></li>
</ul>
<p>Again, we have that <span class="math inline">\operatorname{Var}(Y) = \Sigma</span>. This is exclusively “R”-side modeling when the <span class="math inline">ZGZ'</span> matrix is 0, which is the case when we don’t have any random effects.</p>
</section>
<section id="introducing-autism-data-part-b" class="level1" data-number="16">
<h1 data-number="16"><span class="header-section-number">16</span> Introducing Autism Data (part b)</h1>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-1_67e03147ab7b1e1c3d1d662ae31ed83e">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>autism <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/autism.csv"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sicdegp =</span> <span class="fu">factor</span>(sicdegp),</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">childid =</span> <span class="fu">factor</span>(childid),</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">agef =</span> <span class="fu">factor</span>(age)) <span class="co"># if we choose to model age as a factor </span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>autism_complete <span class="ot">&lt;-</span> autism[<span class="fu">complete.cases</span>(autism),]</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>autism <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, vsae, <span class="at">group =</span> childid, <span class="at">color =</span> sicdegp)) <span class="sc">+</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="fu">as.numeric</span>(autism<span class="sc">$</span>childid)<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> <span class="dv">30000</span>) <span class="sc">+</span> <span class="co"># hack to emphasize just a few response curves</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>sicdegp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 row(s) containing missing values (geom_path).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="randomcoef_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="1248"></p>
</div>
</div>
<p>In context of this dataset, we note some research questions in particular that we are interested in modeling:</p>
<ul>
<li>The age trend seems different among <code>sicdegp</code> levels.
<ul>
<li>I’d like to quantify the differences in these trends, and pick models that make this comparison easier to interpret.</li>
</ul></li>
<li>The age trend itself seems mostly increasing linear, but each child seems to have their own linear trajectory.
<ul>
<li>There is perhaps an sharper inflection upwards around age 9. It would be worthwhile testing models that inflect upward as age increases.</li>
</ul></li>
<li>There seem to be a greater variability in the <em>slope</em> for <code>sicdegp = 2,3</code> than in <code>sicdegp = 1</code>.
<ul>
<li>There is fanning present from variability in slopes for each child, but the diversity among those slopes seem to differ as well.</li>
<li>We should make another plot that more directly shows/quantifies the extent of this. This also helps inform whether or not trying heterogenous models would be empirically necessary.</li>
</ul></li>
<li>There are a non-trivial number of individuals that show “drop out” before the end of the study.
<ul>
<li>since the data doesn’t show the incompleteness, we should make the missingness “explicit” and try to quantify the extent that this missingness may bias our results.</li>
</ul></li>
</ul>
</section>
<section id="fixed-effect-modeling-part-c" class="level1" data-number="17">
<h1 data-number="17"><span class="header-section-number">17</span> Fixed Effect Modeling (part c)</h1>
<p>In this section, we try to “push” fixed effects as far as we can by modeling the mean and covariance (R-side) and see how good of a model we can get. We’ll first focus on modeling the mean.</p>
<section id="modeling-the-mean" class="level2" data-number="17.1">
<h2 data-number="17.1" class="anchored" data-anchor-id="modeling-the-mean"><span class="header-section-number">17.1</span> Modeling the Mean</h2>
<p>From the exploratory plots, we loosely fit linear/quadratic/stick models to the data.</p>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-2_f0446679ce94fa12ae55e9a00a94f6fa">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># without child id</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>autism_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(vsae <span class="sc">~</span> age<span class="sc">*</span>sicdegp, <span class="at">data =</span> autism_complete) </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># with child id, varying intercept</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>autism_lm_id <span class="ot">&lt;-</span> <span class="fu">lm</span>(vsae <span class="sc">~</span> age<span class="sc">*</span>sicdegp <span class="sc">+</span> childid, <span class="at">data =</span> autism_complete)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="co"># with child id varying slope and intercept</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: these estimates are the same as if we subset dataset to just the single child and ran lm. </span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># sum(coef(autism_lm_id_slope)[c("(Intercept)", "childid10")])</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># sum(coef(autism_lm_id_slope)[c("age", "age:childid10")])</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># coef(lm(vsae~age, data = subset(autism, childid == 10)))</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>autism_lm_id_slope <span class="ot">&lt;-</span> <span class="fu">lm</span>(vsae <span class="sc">~</span> age <span class="sc">+</span> childid <span class="sc">+</span> childid<span class="sc">:</span>age, <span class="at">data =</span> autism_complete)</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co"># stick models</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>autism_stick <span class="ot">&lt;-</span> autism_complete <span class="sc">%&gt;%</span> </span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">age_gt_9 =</span> <span class="fu">as.numeric</span>(age <span class="sc">&gt;</span> <span class="dv">9</span>), <span class="co"># create indicator for stick models</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">age_relu_9 =</span> age_gt_9 <span class="sc">*</span> (age <span class="sc">-</span> <span class="dv">9</span>)) <span class="co"># ReLu function for adding slope above 9</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>autism_lm_stick <span class="ot">&lt;-</span> <span class="fu">lm</span>(vsae <span class="sc">~</span> age<span class="sc">*</span>sicdegp <span class="sc">+</span> age_relu_9<span class="sc">:</span>sicdegp, <span class="at">data =</span> autism_stick) <span class="co"># without child id, "pooled"</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>autism_lm_stick_id <span class="ot">&lt;-</span> <span class="fu">lm</span>(vsae <span class="sc">~</span> age<span class="sc">*</span>sicdegp <span class="sc">+</span> age_relu_9<span class="sc">:</span>sicdegp <span class="sc">+</span> childid, <span class="at">data =</span> autism_stick) <span class="co"># without child id, "pooled"</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>autism_lm_stick_id_slope <span class="ot">&lt;-</span> <span class="fu">lm</span>(vsae <span class="sc">~</span> age <span class="sc">+</span> childid <span class="sc">+</span> age<span class="sc">:</span>childid <span class="sc">+</span> age_relu_9<span class="sc">:</span>childid, <span class="at">data =</span> autism_stick) <span class="co"># individual stick model</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a><span class="co"># quadratic trend</span></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>autism_lm_quad <span class="ot">&lt;-</span> <span class="fu">lm</span>(vsae <span class="sc">~</span> age<span class="sc">*</span>sicdegp <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">:</span>sicdegp, <span class="at">data =</span> autism_complete)</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>autism_lm_quad_id <span class="ot">&lt;-</span> <span class="fu">lm</span>(vsae <span class="sc">~</span> age<span class="sc">*</span>sicdegp <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">:</span>sicdegp <span class="sc">+</span> childid, <span class="at">data =</span> autism_complete) <span class="co"># id specific intercept</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>autism_lm_quad_id_slope1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(vsae <span class="sc">~</span> age<span class="sc">*</span>childid <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">:</span>sicdegp, <span class="at">data =</span> autism_complete) <span class="co"># id specific intercept and linear terms</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>autism_lm_quad_id_slope2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(vsae <span class="sc">~</span> age<span class="sc">*</span>childid <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">*</span>childid, <span class="at">data =</span> autism_complete) <span class="co"># id specific intercept, linear and quadratic</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="co"># using poly macro</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="co"># autism_lm_poly2 &lt;- lm(vsae ~ poly(age, degree = 2) * sicdegp, data = autism)</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a><span class="co"># autism_lm_poly2 &lt;- lm(vsae ~ poly(age, degree = 2) * child_id, data = autism)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-3_ba37255e4d15615abe7313af3e23d467">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions, plotted raw</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>autism_predict <span class="ot">&lt;-</span> autism <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">complete.cases</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_column</span>(</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">yhat_lm =</span> <span class="fu">predict</span>(autism_lm),</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">yhat_lm_id =</span> <span class="fu">predict</span>(autism_lm_id),</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">yhat_lm_id_slope =</span> <span class="fu">predict</span>(autism_lm_id_slope),</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">yhat_lm_stick =</span> <span class="fu">predict</span>(autism_lm_stick),</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">yhat_lm_stick_id_slope =</span> <span class="fu">predict</span>(autism_lm_stick_id_slope),</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">yhat_lm_quad =</span> <span class="fu">predict</span>(autism_lm_quad),</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">yhat_lm_quad_id =</span> <span class="fu">predict</span>(autism_lm_quad_id),</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">yhat_lm_quad_id_slope1 =</span> <span class="fu">predict</span>(autism_lm_quad_id_slope1),</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">yhat_lm_quad_id_slope2 =</span> <span class="fu">predict</span>(autism_lm_quad_id_slope2),</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>autism_predict <span class="sc">%&gt;%</span> </span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(vsae, <span class="fu">starts_with</span>(<span class="st">"yhat"</span>)),</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>                                <span class="at">names_to =</span> <span class="st">"type"</span>,</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>                                <span class="at">values_to =</span> <span class="st">"y"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(childid, age) <span class="sc">%&gt;%</span> </span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, y, <span class="at">group =</span> childid, <span class="at">color =</span> type)) <span class="sc">+</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(type<span class="sc">~</span>sicdegp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="randomcoef_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="1152"></p>
</div>
</div>
<ul>
<li>The stick model estimates look a little funky because there are some individuals with only observations at age = 2, 13, thus a stick model would be degenerate in those individuals and the plotting is simply showing the direct line instead of the stick estimates. I think the same thing is happening in the id quad estimates.</li>
</ul>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-4_a816c22e51f5084645384731a0dcc23c">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r fold-hide code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>autism_fixed_ic <span class="ot">&lt;-</span> <span class="fu">AIC</span>(autism_lm,</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    autism_lm_id,</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>    autism_lm_id_slope,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    autism_lm_stick,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    autism_lm_stick_id_slope,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    autism_lm_quad,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    autism_lm_quad_id,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    autism_lm_quad_id_slope1,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    autism_lm_quad_id_slope2) <span class="sc">%&gt;%</span> </span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_column</span>(</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">BIC =</span> <span class="fu">BIC</span>(autism_lm,</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>              autism_lm_id,</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>              autism_lm_id_slope,</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>              autism_lm_stick,</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>              autism_lm_stick_id_slope,</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>              autism_lm_quad,</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>              autism_lm_quad_id,</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>              autism_lm_quad_id_slope1,</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>              autism_lm_quad_id_slope2)<span class="sc">$</span>BIC)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>autism_fixed_ic <span class="sc">%&gt;%</span> </span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">format =</span> <span class="st">"html"</span>,</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Fixed Model Mean Information Criteria"</span>,</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">table.attr =</span> <span class="st">"style='width:50%;'"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_classic</span>(<span class="at">full_width =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">3</span>, <span class="at">color =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"red"</span>)[<span class="fu">as.numeric</span>(autism_fixed_ic<span class="sc">$</span>AIC <span class="sc">==</span> <span class="fu">min</span>(autism_fixed_ic<span class="sc">$</span>AIC)) <span class="sc">+</span> <span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">4</span>, <span class="at">color =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"red"</span>)[<span class="fu">as.numeric</span>(autism_fixed_ic<span class="sc">$</span>BIC <span class="sc">==</span> <span class="fu">min</span>(autism_fixed_ic<span class="sc">$</span>BIC)) <span class="sc">+</span> <span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<table style="width:50%; font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; margin-left: auto; margin-right: auto;" class=" lightable-classic">
<caption>Fixed Model Mean Information Criteria</caption>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> df </th>
   <th style="text-align:right;"> AIC </th>
   <th style="text-align:right;"> BIC </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> autism_lm </td>
   <td style="text-align:right;"> 7 </td>
   <td style="text-align:right;color: black !important;"> 5538.140 </td>
   <td style="text-align:right;color: red !important;"> 5569.035 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> autism_lm_id </td>
   <td style="text-align:right;"> 162 </td>
   <td style="text-align:right;color: black !important;"> 5440.346 </td>
   <td style="text-align:right;color: black !important;"> 6155.327 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> autism_lm_id_slope </td>
   <td style="text-align:right;"> 315 </td>
   <td style="text-align:right;color: black !important;"> 4553.386 </td>
   <td style="text-align:right;color: black !important;"> 5943.626 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> autism_lm_stick </td>
   <td style="text-align:right;"> 10 </td>
   <td style="text-align:right;color: black !important;"> 5538.678 </td>
   <td style="text-align:right;color: black !important;"> 5582.813 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> autism_lm_stick_id_slope </td>
   <td style="text-align:right;"> 408 </td>
   <td style="text-align:right;color: red !important;"> 4153.635 </td>
   <td style="text-align:right;color: black !important;"> 5954.326 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> autism_lm_quad </td>
   <td style="text-align:right;"> 10 </td>
   <td style="text-align:right;color: black !important;"> 5539.403 </td>
   <td style="text-align:right;color: black !important;"> 5583.538 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> autism_lm_quad_id </td>
   <td style="text-align:right;"> 165 </td>
   <td style="text-align:right;color: black !important;"> 5440.750 </td>
   <td style="text-align:right;color: black !important;"> 6168.970 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> autism_lm_quad_id_slope1 </td>
   <td style="text-align:right;"> 318 </td>
   <td style="text-align:right;color: black !important;"> 4542.668 </td>
   <td style="text-align:right;color: black !important;"> 5946.148 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> autism_lm_quad_id_slope2 </td>
   <td style="text-align:right;"> 457 </td>
   <td style="text-align:right;color: black !important;"> 4237.499 </td>
   <td style="text-align:right;color: black !important;"> 6254.450 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>The information criteria here show something very interesting! AIC chooses one of the most complex models, with 408 parameters, while BIC chooses the model with 7 parameters! How you go about model selection is very much a philosophical decision, and the information criteria tend to reflect those camps of thinking. I’ll be moving forward with <code>autism_lm</code>.</p>
<section id="diagnostics" class="level3 tabset" data-number="17.1.1">
<h3 class="tabset anchored" data-number="17.1.1" data-anchor-id="diagnostics"><span class="header-section-number">17.1.1</span> Diagnostics</h3>
<p>We can use the diagnostic plots to examine missing trends and start to get a sense of the variance modeling we will need.</p>
<section id="simple-linear-model" class="level4">
<h4 class="anchored" data-anchor-id="simple-linear-model">Simple Linear Model</h4>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-5_302e6f9bc911642845ddcc7efd9b7c9b">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r fold-hide code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(autism_lm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="randomcoef_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="individual-stick-model" class="level4">
<h4 class="anchored" data-anchor-id="individual-stick-model">Individual Stick Model</h4>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-6_23db4956b09312da9f8aa89b6dbb8af0">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r fold-hide code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(autism_lm_stick_id_slope) <span class="co"># danger with this model is that there are a number of points with leverage one.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="randomcoef_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="section" class="level3 unnumbered unlisted">
<h3 class="unnumbered unlisted anchored" data-anchor-id="section"></h3>
<p>Based on these plots, we see that when we choose the super parameterized models, we are risking overfitting with a number of values with leverage 1.</p>
<p>I would ultimately base modeling decisions on specific research questions the scientist had. If there was greater interest in ages 10 - 13, I may be more hesitant to choose the stick model because it’s quite overfit in this domain. If they wanted to summarize “rules of thumb” for presentation or big picture of this trait, I’d likely choose the simple linear model. If they were hoping for prediction applications based on younger children and valued accuracy of predictions, I may opt for the over-parameterized models like quadratic or stick model.</p>
</section>
</section>
<section id="modeling-the-variance" class="level2" data-number="17.2">
<h2 data-number="17.2" class="anchored" data-anchor-id="modeling-the-variance"><span class="header-section-number">17.2</span> Modeling the variance</h2>
<p>For simplicity, we’ll chose the linear functional form, as it is quite simple, and performs reasonably well for the number of parameters that it uses. Note, obviously the variance modeling will depend on your chosen mean model.</p>
<p>Similar to how we modeled the mean, we start with trying to visualize the covariance matrix with as few restrictions as possible, so we fit an unstructured covariance matrix with <code>gls</code>.</p>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-7_b45230132395f817286ec325feb1632b">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># start with unstructured covariance matrix, and let the optimizer tell us the best estimate with no restrictions.</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>autism_gls_un <span class="ot">&lt;-</span> <span class="fu">gls</span>(vsae<span class="sc">~</span>age<span class="sc">*</span>sicdegp,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">correlation =</span> <span class="fu">corSymm</span>(<span class="at">form =</span> <span class="sc">~</span><span class="dv">1</span> <span class="sc">|</span> childid), <span class="co"># unstructured correlation</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">weights =</span> <span class="fu">varIdent</span>(<span class="at">form =</span> <span class="sc">~</span><span class="dv">1</span> <span class="sc">|</span> agef), <span class="co"># parameter for each entry along diagonal</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> autism_complete)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="fu">getVarCov</span>(autism_gls_un)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Marginal variance covariance matrix
        [,1]     [,2]     [,3]    [,4]     [,5]
[1,] 10.8500   8.9204   9.4352   25.49   48.503
[2,]  8.9204  55.6110  45.2460  108.23  203.970
[3,]  9.4352  45.2460 135.6600  223.11  404.000
[4,] 25.4900 108.2300 223.1100  765.99 1206.800
[5,] 48.5030 203.9700 404.0000 1206.80 2319.400
  Standard Deviations: 3.2939 7.4573 11.647 27.677 48.16 </code></pre>
</div>
</div>
<p>There are some visual guides that we can use to help us model the covariance:</p>
<ol type="1">
<li>line graph of matrix entries, grouped by row</li>
<li>Variogram</li>
<li>Autocorrelation Function</li>
</ol>
<section id="line-graph-of-matrix-entries-grouped-by-row" class="level3" data-number="17.2.1">
<h3 data-number="17.2.1" class="anchored" data-anchor-id="line-graph-of-matrix-entries-grouped-by-row"><span class="header-section-number">17.2.1</span> 1. Line Graph of matrix entries, grouped by row</h3>
<p>I picked up this visualization from Generalized Linear Mixed Models by Walter Stroup, one of the authors of the SAS for Mixed Models book. I like this visualization better than a heat map because instead of using a color channel for the variance, it uses y-position which is much more clear.</p>
<center>
<figure class="figure">
<img src="img/cov_line_plot.png" style="width:50%" class="figure-img">
<figcaption class="figure-caption">
</figcaption>
</figure>
</center>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-8_eaaea149123fe3bc71ffb6c55371c981">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r fold-hide code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>sigmahat <span class="ot">&lt;-</span> <span class="fu">getVarCov</span>(autism_gls_un)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>sigmahat_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">row =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">each =</span> <span class="dv">5</span>),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">col =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="dv">5</span>),</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">age =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">9</span>, <span class="dv">13</span>), <span class="dv">5</span>), <span class="co"># un</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">cov =</span> <span class="fu">c</span>(sigmahat)) <span class="sc">%&gt;%</span> </span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(row <span class="sc">&lt;=</span> col) <span class="co"># pull upper triangle w/ diagonal entries</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>sigmahat_df <span class="sc">%&gt;%</span> </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(col, cov, <span class="at">color =</span> <span class="fu">factor</span>(row), <span class="at">group =</span> <span class="fu">factor</span>(row))) <span class="sc">+</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="randomcoef_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This graphic is confusing at first, but I think it’s one of the more intuitive visualizations once you’re used to it. each point in the graph is the estimated covariance/variance. The lines show the trend that is happening in each row, as you move away from the main diagonal. For example, the red line is the first row of <span class="math inline">\hat \Sigma</span>. There are 5 dots because the first row starts in column 1. The main diagonal (all the variances) are the left most point in each of the trend lines.</p>
<p>We see a similar pattern of the estimated covariances increasing as the age increases. column 5 represents age 13, and we can see the estimated variance is ~2500.</p>
<p>Since age has a meaning on a continuous scale, it would be slightly more helpful to visualize the appropriate distances in the x axis when looking at the estimated covariances.</p>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-9_b0934430846e669c6c688522787e53f3">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>sigmahat_age_plot <span class="ot">&lt;-</span> sigmahat_df <span class="sc">%&gt;%</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diag =</span> col <span class="sc">-</span> row) <span class="sc">%&gt;%</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, cov, <span class="at">color =</span> <span class="fu">factor</span>(row), <span class="at">group =</span> <span class="fu">factor</span>(row))) <span class="sc">+</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>sigmahat_age_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="randomcoef_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can see some resemblance of a power relationship for the main diagonal, and there is a pretty clean pattern in the covariance here, so it’s likely we can capture most of the trends with just a few extra parameters. I would like to graphically test what i’m thinking, so i’ll add a smoothed parametric fit to the left most points of each colored trend (main diagonal).</p>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-10_a01d082a131af695c907ad24ce9bbf28">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># hackish way to checking how a power relationship on age might fit for the heterogenous variance function</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>sigmahat_age_plot <span class="sc">+</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">stat =</span> <span class="st">"smooth"</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">method =</span> <span class="st">"lm"</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">group =</span> diag),</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">formula =</span> (y<span class="sc">~</span> <span class="fu">I</span>(x<span class="sc">^</span><span class="dv">3</span>)), <span class="co"># can play with this form to visualize how the variance estimates might look. Try exponential here, doesn't fit well! (so AR covariance models probably inappropriate)</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">se =</span> <span class="cn">FALSE</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> .<span class="dv">2</span>,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="dv">2</span>,</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>              <span class="at">alpha =</span> .<span class="dv">4</span>,</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">"black"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="randomcoef_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The main diagonal band here seems like a pretty decent fit, which is primarily what I’m interested in here. The fact that the off-diagonal bands also fit this power relationship pretty well implies that I can probably get away with a fairly simple covariance matrix structure (few parameters for off diagonals, like compound symmetry) and still describe this covariance matrix quite well.</p>
</section>
<section id="semi-variogram" class="level3" data-number="17.2.2">
<h3 data-number="17.2.2" class="anchored" data-anchor-id="semi-variogram"><span class="header-section-number">17.2.2</span> 2. Semi-(Variogram)</h3>
<p>This is another method of visualizing covariances that is popular in spatial statistics. This is more useful when one (or more) of your datapoints have a continuous/spatial interpretation. In this case, we are interested in how the correlation of observations between ages as the distance in age increases.</p>
<p>The semi-variogram is defined as: (for isotropic and stationary processes)</p>
<p><span class="math display">
\begin{aligned}
\gamma(h) &amp;= \frac{1}{2}Var(\epsilon_{age} - \epsilon_{age+h}) \\
&amp;= \frac{1}{2}E(\epsilon_{age} - \epsilon_{age+h})^2
\end{aligned}
</span></p>
<p>Empirically to estimate this, we take pairs of observations certain distances apart, and average the squared distances of the estimated residuals.</p>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-11_fae4f66ba7a9faa3bbcae84ddc3a9913">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>vario_autism <span class="ot">&lt;-</span> <span class="fu">Variogram</span>(autism_gls_un, <span class="at">form =</span> <span class="sc">~</span> age <span class="sc">|</span> childid, <span class="at">resType =</span> <span class="st">"response"</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>vario_autism</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     variog dist n.pairs
1  22.25863    1     147
2  41.44491    2      86
3  53.94080    3      91
4 303.74329    4     153
5 275.86605    6     115
6 382.44231    7     118
7 707.25001    8      49
8 841.57324   10      91
9 927.39613   11      93</code></pre>
</div>
</div>
<p>We have oddly spaced age observations, <code>age = c(2, 3, 5, 9, 13)</code>, so in this case, it’s pretty distinctive that our estimate of <span class="math inline">dist = 1</span> come from <span class="math inline">age = 2,3</span>, and <span class="math inline">dist = 8</span> comes from <span class="math inline">age = 5, 13</span>.</p>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-12_84fce463da8b11f56b595d445e2e60eb">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(vario_autism)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="randomcoef_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<center>
<figure class="figure">
<img src="img/variogram_formulas.png" style="width:47%" class="figure-img"> <img src="img/variogram_graphs.png" style="width:47%" class="figure-img">
<figcaption class="figure-caption">
Figures from Mixed Effects Models
</figcaption>
</figure>
</center>
</section>
<section id="auto-correlation-functions" class="level3" data-number="17.2.3">
<h3 data-number="17.2.3" class="anchored" data-anchor-id="auto-correlation-functions"><span class="header-section-number">17.2.3</span> 3. Auto Correlation Functions</h3>
<p>(sample) auto correlation functions show the correlation with lagged versions of itself.</p>
<p><span class="math display">
\begin{aligned}
ACF(k) = \frac{\operatorname{Cov}(\varepsilon, \varepsilon_{lag(k)})}{\operatorname{Var}(\varepsilon)}
\end{aligned}
</span></p>
<p>The ACF is most useful when we have data that is more time series like, with many measured timepoints and somewhat equally spaced measurements because we’re calculating correlation with itself.</p>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-13_e514852b5a254bc9c47b4f00a146e4f2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ACF</span>(autism_gls_un, <span class="at">form =</span> <span class="sc">~</span> age <span class="sc">|</span> childid, <span class="at">resType =</span> <span class="st">"response"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  lag        ACF
1   0 1.00000000
2   1 0.46705931
3   2 0.19978821
4   3 0.11193700
5   4 0.09748354</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">ACF</span>(autism_gls_un, <span class="at">form =</span> <span class="sc">~</span> age <span class="sc">|</span> childid, <span class="at">resType =</span> <span class="st">"response"</span>), <span class="at">alpha =</span> .<span class="dv">01</span>) <span class="co"># observed - fitted, not accounting for covariance estimates</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="randomcoef_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We can ignore the first bar, but we’re looking at the trend made by the top of the bars. An AR1 model would have the tops of the bars decrease exponentially quickly. The fact that the bars poke out from the dotted alpha = .01 curve means that there’s likely some sequential correlation happening in our data that we haven’t accounted for.</p>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-14_462997eeae7583ae0716e56f557ef128">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r fold-hide code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">ACF</span>(autism_gls_un, <span class="at">form =</span> <span class="sc">~</span> age <span class="sc">|</span> childid, <span class="at">resType =</span> <span class="st">"normalized"</span>), <span class="at">alpha =</span> .<span class="dv">01</span>) <span class="co"># accounting for our estimated covariance matrix</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="randomcoef_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>If we plot the ACF of residuals that account for our unstructured covariance matrix, we can see the sequential correlations drop out of significance.</p>
</section>
<section id="fitting-variance-models" class="level3" data-number="17.2.4">
<h3 data-number="17.2.4" class="anchored" data-anchor-id="fitting-variance-models"><span class="header-section-number">17.2.4</span> Fitting variance models</h3>
<p>There are many covariance shapes we can try here, and SAS has even more! See <a href="https://documentation.sas.com/doc/en/pgmsascdc/9.4_3.3/statug/statug_mixed_syntax14.htm">SAS Repeated Statement</a>.</p>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-15_c9373cd10cb1edc843e9f276fa8304b2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># heterogeneous, diagonal</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>autism_gls_het <span class="ot">&lt;-</span> <span class="fu">gls</span>(vsae<span class="sc">~</span>age<span class="sc">*</span>sicdegp,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                      <span class="at">weights =</span> <span class="fu">varIdent</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> agef),</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> autism_complete)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co"># should be a bad fit since we already know there is strong heterogeneity</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>autism_gls_cs <span class="ot">&lt;-</span> <span class="fu">gls</span>(vsae<span class="sc">~</span>age<span class="sc">*</span>sicdegp,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">correlation =</span> <span class="fu">corCompSymm</span>(<span class="at">form =</span> <span class="sc">~</span><span class="dv">1</span> <span class="sc">|</span> childid),</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> autism_complete)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co"># heterogeneous, compound symmetry</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>autism_gls_csh <span class="ot">&lt;-</span> <span class="fu">gls</span>(vsae<span class="sc">~</span>age<span class="sc">*</span>sicdegp,</span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>                     <span class="at">correlation =</span> <span class="fu">corCompSymm</span>(<span class="at">form =</span> <span class="sc">~</span><span class="dv">1</span> <span class="sc">|</span> childid),</span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>                     <span class="at">weights =</span> <span class="fu">varIdent</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> agef),</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> autism_complete)</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a><span class="co"># continuous autoregressive</span></span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a><span class="co"># correlation = \phi^distance</span></span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>autism_gls_carh <span class="ot">&lt;-</span> <span class="fu">gls</span>(vsae<span class="sc">~</span>age<span class="sc">*</span>sicdegp,</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>                      <span class="at">correlation =</span> <span class="fu">corCAR1</span>(<span class="at">form =</span> <span class="sc">~</span> age <span class="sc">|</span> childid), <span class="co"># i.e. exponential decay with distance</span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>                      <span class="at">weights =</span> <span class="fu">varIdent</span>(<span class="at">form =</span> <span class="sc">~</span><span class="dv">1</span> <span class="sc">|</span> agef),</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> autism_complete)</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a><span class="co"># based on the visualizations, should be decent</span></span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a><span class="co"># variance = age^\theta</span></span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>autism_gls_pow <span class="ot">&lt;-</span> <span class="fu">gls</span>(vsae<span class="sc">~</span>age<span class="sc">*</span>sicdegp,</span>
<span id="cb20-27"><a href="#cb20-27" aria-hidden="true" tabindex="-1"></a>                      <span class="at">correlation =</span> <span class="fu">corCompSymm</span>(<span class="at">form=</span> <span class="sc">~</span><span class="dv">1</span> <span class="sc">|</span> childid),</span>
<span id="cb20-28"><a href="#cb20-28" aria-hidden="true" tabindex="-1"></a>                      <span class="at">weights =</span> <span class="fu">varPower</span>(<span class="at">form =</span> <span class="sc">~</span>age), <span class="co"># fit heterogeneous variance function</span></span>
<span id="cb20-29"><a href="#cb20-29" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> autism_complete)</span>
<span id="cb20-30"><a href="#cb20-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-31"><a href="#cb20-31" aria-hidden="true" tabindex="-1"></a>autism_gls_cpow <span class="ot">&lt;-</span> <span class="fu">gls</span>(vsae<span class="sc">~</span>age<span class="sc">*</span>sicdegp,</span>
<span id="cb20-32"><a href="#cb20-32" aria-hidden="true" tabindex="-1"></a>                      <span class="at">correlation =</span> <span class="fu">corCompSymm</span>(<span class="at">form=</span> <span class="sc">~</span><span class="dv">1</span> <span class="sc">|</span> childid),</span>
<span id="cb20-33"><a href="#cb20-33" aria-hidden="true" tabindex="-1"></a>                      <span class="at">weights =</span> <span class="fu">varConstPower</span>(<span class="at">form =</span> <span class="sc">~</span>age), <span class="co"># additional constant variable to power relationship</span></span>
<span id="cb20-34"><a href="#cb20-34" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> autism_complete)</span>
<span id="cb20-35"><a href="#cb20-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-36"><a href="#cb20-36" aria-hidden="true" tabindex="-1"></a><span class="co"># with linear paramterization of corstruct</span></span>
<span id="cb20-37"><a href="#cb20-37" aria-hidden="true" tabindex="-1"></a>autism_gls_powlin <span class="ot">&lt;-</span> <span class="fu">gls</span>(vsae<span class="sc">~</span>age<span class="sc">*</span>sicdegp,</span>
<span id="cb20-38"><a href="#cb20-38" aria-hidden="true" tabindex="-1"></a>                      <span class="at">correlation =</span> <span class="fu">corLin</span>(<span class="at">form=</span> <span class="sc">~</span>age <span class="sc">|</span> childid),</span>
<span id="cb20-39"><a href="#cb20-39" aria-hidden="true" tabindex="-1"></a>                      <span class="at">weights =</span> <span class="fu">varPower</span>(<span class="at">form =</span> <span class="sc">~</span>age), <span class="co"># fit heterogeneous variance function</span></span>
<span id="cb20-40"><a href="#cb20-40" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> autism_complete)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-16_1db97b4ef9face2d304b8af0f0e2f574">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r fold-hide code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>autism_gls_ic <span class="ot">&lt;-</span> <span class="fu">AIC</span>(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    autism_gls_het,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    autism_gls_cs,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    autism_gls_csh,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    autism_gls_carh,</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    autism_gls_un,</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    autism_gls_pow,</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    autism_gls_cpow,</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    autism_gls_powlin) <span class="sc">%&gt;%</span> </span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_column</span>(</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">BIC =</span> <span class="fu">BIC</span>(autism_gls_het,</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>              autism_gls_cs,</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>              autism_gls_csh,</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>              autism_gls_carh,</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>              autism_gls_un,</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>              autism_gls_pow,</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>              autism_gls_cpow,</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>              autism_gls_powlin)<span class="sc">$</span>BIC)</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>autism_gls_ic <span class="sc">%&gt;%</span> <span class="fu">kbl</span>(<span class="at">caption =</span> <span class="st">"Information Criteria for "</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_classic</span>(<span class="at">full_width =</span> F) <span class="sc">%&gt;%</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">3</span>, <span class="at">color =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"red"</span>)[<span class="fu">as.numeric</span>(autism_gls_ic<span class="sc">$</span>AIC <span class="sc">==</span> <span class="fu">min</span>(autism_gls_ic<span class="sc">$</span>AIC)) <span class="sc">+</span> <span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">4</span>, <span class="at">color =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"red"</span>)[<span class="fu">as.numeric</span>(autism_gls_ic<span class="sc">$</span>BIC <span class="sc">==</span> <span class="fu">min</span>(autism_gls_ic<span class="sc">$</span>BIC)) <span class="sc">+</span> <span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<table class=" lightable-classic" style="font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;">
<caption>Information Criteria for </caption>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> df </th>
   <th style="text-align:right;"> AIC </th>
   <th style="text-align:right;"> BIC </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> autism_gls_het </td>
   <td style="text-align:right;"> 11 </td>
   <td style="text-align:right;color: black !important;"> 4661.843 </td>
   <td style="text-align:right;color: black !important;"> 4710.282 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> autism_gls_cs </td>
   <td style="text-align:right;"> 8 </td>
   <td style="text-align:right;color: black !important;"> 5461.844 </td>
   <td style="text-align:right;color: black !important;"> 5497.072 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> autism_gls_csh </td>
   <td style="text-align:right;"> 12 </td>
   <td style="text-align:right;color: black !important;"> 4529.853 </td>
   <td style="text-align:right;color: black !important;"> 4582.696 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> autism_gls_carh </td>
   <td style="text-align:right;"> 12 </td>
   <td style="text-align:right;color: black !important;"> 4604.352 </td>
   <td style="text-align:right;color: black !important;"> 4657.195 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> autism_gls_un </td>
   <td style="text-align:right;"> 21 </td>
   <td style="text-align:right;color: red !important;"> 4482.384 </td>
   <td style="text-align:right;color: red !important;"> 4574.859 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> autism_gls_pow </td>
   <td style="text-align:right;"> 9 </td>
   <td style="text-align:right;color: black !important;"> 4536.168 </td>
   <td style="text-align:right;color: black !important;"> 4575.800 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> autism_gls_cpow </td>
   <td style="text-align:right;"> 10 </td>
   <td style="text-align:right;color: black !important;"> 4538.168 </td>
   <td style="text-align:right;color: black !important;"> 4582.203 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> autism_gls_powlin </td>
   <td style="text-align:right;"> 9 </td>
   <td style="text-align:right;color: black !important;"> 4654.410 </td>
   <td style="text-align:right;color: black !important;"> 4694.043 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>At this stage, it seems the unstructured covariance matrix would fit the best if we follow either AIC or BIC, though notably the power variance structure has a very comparable BIC with only 9 parameters vs 21 parameters total. Since I’ve already abided by principles of parsimony in choosing to use the very simple linear model, I’d probably elect to use the <code>autism_gls_pow</code> as my final model for fixed effects modeling for the same reasons. The model is also very appealing for explaining variance as simply a power function of age (respecting the continuous scale) and similar performance in information criteria.</p>
</section>
</section>
<section id="final-model" class="level2" data-number="17.3">
<h2 data-number="17.3" class="anchored" data-anchor-id="final-model"><span class="header-section-number">17.3</span> Final Model</h2>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-17_3caf7f504cab8a08f88d52f1bf529d7d">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(autism_gls_pow)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="randomcoef_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>spread among the residuals looks much better against the fitted values.</p>
<p>Some basic inference from the fixed effect model…</p>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-18_6e232c63453ba5d0ee84a24c92604e7f">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">intervals</span>(autism_gls_pow) <span class="co"># asymptotic normal approximation, based on inverse hessian</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Approximate 95% confidence intervals

 Coefficients:
                  lower       est.      upper
(Intercept)  -0.5248735  1.2011843  2.9272421
age           2.2896001  3.1507950  4.0119900
sicdegp2     -1.9420685  0.3411552  2.6243789
sicdegp3     -5.7898786 -3.2664553 -0.7430321
age:sicdegp2 -0.5218454  0.6171416  1.7561285
age:sicdegp3  3.0205486  4.2837888  5.5470290

 Correlation structure:
        lower      est.     upper
Rho 0.3682194 0.4549824 0.5387205

 Variance function:
         lower     est.    upper
power 1.217197 1.291734 1.366271

 Residual standard error:
   lower     est.    upper 
1.372947 1.575796 1.808615 </code></pre>
</div>
</div>
</section>
<section id="weighted-least-squares" class="level2" data-number="17.4">
<h2 data-number="17.4" class="anchored" data-anchor-id="weighted-least-squares"><span class="header-section-number">17.4</span> Weighted Least Squares</h2>
<p>I mentioned weighted least squares as a very simple quick fix that give similar qualities of inference as you’d get with more sophisticated fitting procedures (increased variance for larger ages). You can see here that it works decently, but the fact that we’re not accounting for measurements from individuals (correlation) means that we can do much better.</p>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-19_b528b7cef9a509b255fd1052ce4d9aea">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>gls_un_var <span class="ot">&lt;-</span> <span class="fu">getVarCov</span>(autism_gls_un, <span class="at">individual =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> <span class="fu">diag</span>()</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>autism_wls <span class="ot">&lt;-</span> <span class="fu">lm</span>(vsae<span class="sc">~</span>age<span class="sc">*</span>sicdegp, <span class="at">weights =</span> <span class="dv">1</span><span class="sc">/</span>(gls_un_var[autism<span class="sc">$</span>agef]), <span class="at">data =</span> autism)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(autism_wls)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4655.256</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">BIC</span>(autism_wls)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4686.151</code></pre>
</div>
</div>
<p>I believe comparing the information criteria in WLS to GLS is legitimate? but I’m not certain… the former situation we’re assuming variance parameters are known which makes this comparison weird.</p>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-20_32215382f0a26daff7219466527c9ad1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>autism_new <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">age =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">13</span>, <span class="at">sicdegp =</span> <span class="fu">factor</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>))</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co"># from direct lm</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>autism_new <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(<span class="fu">predict</span>(autism_lm, <span class="at">newdata =</span> autism_new, <span class="at">interval =</span> <span class="st">"confidence"</span>)) <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="at">cols =</span> fit<span class="sc">:</span>upr, <span class="at">names_to =</span> <span class="st">"type"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, value, <span class="at">linetype =</span> type, <span class="at">group =</span> type)) <span class="sc">+</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>sicdegp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="randomcoef_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># from weighted least squares</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>autism_new <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(<span class="fu">predict</span>(autism_wls, <span class="at">newdata =</span> autism_new, <span class="at">interval =</span> <span class="st">"confidence"</span>)) <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="at">cols =</span> fit<span class="sc">:</span>upr, <span class="at">names_to =</span> <span class="st">"type"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, value, <span class="at">linetype =</span> type, <span class="at">group =</span> type)) <span class="sc">+</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>sicdegp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="randomcoef_files/figure-html/unnamed-chunk-20-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="mixed-effect-modeling-part-d" class="level1" data-number="18">
<h1 data-number="18"><span class="header-section-number">18</span> Mixed Effect Modeling (part d)</h1>
<p>We’re working with a different toolbox now, as far as covariance modeling goes. We can now control the covariance matrix directly (R-side) as we did above or implicitly through the use of random effects/coefficients (G-side).</p>
<p>The advantages:</p>
<ol type="1">
<li>aligns parameter interpretation with the random design matrix <span class="math inline">Z</span>, which is more intuitive.</li>
<li>Allows for rather complex covariance structures with very few parameters</li>
<li>implicit averaging of individual models, and we can pull out the individually fit</li>
</ol>
<p>The disadvantages:</p>
<ol type="1">
<li>Harder to visualize what’s happening with G-matrix, and effect on final covariance matrix of Y.</li>
<li>More computationally intensive, will probably be slower for larger datasets.</li>
</ol>
<p>The reason I recommend <code>lme</code> over <code>lmer</code> is that you have more control over the structure of “G” and “R” matrices in <code>lme</code>. <code>lmer</code> is only capable of fitting diagonal and unstructured covariances for G, and homogenous diagonal matrix for “R”. (And i recommend <code>SAS</code> over <code>lme</code> because the syntax is much easier!)</p>
<section id="fitting-models" class="level2" data-number="18.1">
<h2 data-number="18.1" class="anchored" data-anchor-id="fitting-models"><span class="header-section-number">18.1</span> Fitting Models</h2>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-21_223a73c3ae334d27f7efc88e28ab0b04">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># random intercept</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>autism_lme_id <span class="ot">&lt;-</span> <span class="fu">lme</span>(<span class="at">fixed =</span> vsae<span class="sc">~</span>sicdegp<span class="sc">*</span>age,</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">random =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> childid,</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> autism_complete)</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co"># random slopes model</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co"># doesn't converge!!</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>autism_lme_id_slope <span class="ot">&lt;-</span> <span class="fu">lme</span>(<span class="at">fixed =</span> vsae<span class="sc">~</span>sicdegp<span class="sc">*</span>age,</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">random =</span> <span class="sc">~</span> age <span class="sc">|</span> childid,</span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> autism_complete)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-error">
<pre><code>Error in lme.formula(fixed = vsae ~ sicdegp * age, random = ~age | childid, : nlminb problem, convergence error code = 1
  message = iteration limit reached without convergence (10)</code></pre>
</div>
</div>
<p>We hit some optimizer problems trying to fit the random slopes model. By default, <code>lme</code> uses the outdated <code>nlminb</code> optimizer, which is similar to “BFGS”, a quasi-newton optimization routine. <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>. It’s mostly used for compatibility reasons, and <code>optim</code> is the general optimizer that is now preferred. <code>lmeControl</code> has the option <code>opt = "optim"</code>, which switches the optimizer, and now looks for <code>optimMethod = "BFGS"</code> which says to run BFGS algorithm in <code>optim</code>.</p>
<p>We can also switch the function call to lmer, because this is a model that can be handled in that library as well. The default callback is <code>lmer</code> -&gt; <code>nloptwrap</code> (wrapper function) -&gt; <code>nloptr</code> (R interface into NLopt) -&gt; <code>NLopt</code> (<a href="https://nlopt.readthedocs.io/en/latest/">Free/Open Source library for Nonlinear optimization</a>) -&gt; <code>NLOPT_LN_BOBYQA</code> (BOBYQA routine written in C). BOBYQA is a derivative free optimization program.</p>
<p>I try to avoid diving down the optimizer rabbit hole as much as possible… Fix 2 is normally the route I take, if you’re curious, in which I fit successively simpler models until boundary issues don’t exist.</p>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-22_a03c79f605ed3d3fef73f6bfa8165ea0">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fix 1: change the optimizer to "optim" (BFGW) in lme</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>autism_lme_id_slope <span class="ot">&lt;-</span> <span class="fu">lme</span>(<span class="at">fixed =</span> vsae<span class="sc">~</span>sicdegp<span class="sc">*</span>age,</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">random =</span> <span class="sc">~</span> age <span class="sc">|</span> childid,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> autism_complete,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">control =</span> <span class="fu">lmeControl</span>(<span class="at">opt =</span> <span class="st">"optim"</span>))</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(autism_lme_id_slope) # note correlation of random effects is _very_ close to boundary -1 (even though fits with no complaints)</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Fix 2: change optimizer to use ------------------</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="co"># lmer fits, but warns about boundary...</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>autism_lmer_id_slope <span class="ot">&lt;-</span> <span class="fu">lmer</span>(vsae<span class="sc">~</span>sicdegp<span class="sc">*</span>age <span class="sc">+</span> (age <span class="sc">|</span> childid), <span class="at">data =</span> autism_complete)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="do">## boundary (singular) fit: see help('isSingular')</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="co"># looking at summary, we see that correlation of random effects is -1 (boundary)</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(autism_lmer_id_slope)</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a><span class="co"># A useful function is "allFit", which tries to fit the model with "all" appropriate optimizers.</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a><span class="co"># they all have boundary warnings.</span></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a><span class="co"># allFit(autism_lmer_id_slope)</span></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a><span class="co"># try the uncorrelated model, still boundary w/ intercept variance estimated as 0.</span></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>autism_lmer_id_slope_nocor <span class="ot">&lt;-</span> <span class="fu">lmer</span>(vsae<span class="sc">~</span>sicdegp<span class="sc">*</span>age <span class="sc">+</span> (age <span class="sc">||</span> childid), <span class="at">data =</span> autism_complete)</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a><span class="do">## boundary (singular) fit: see help('isSingular')</span></span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(autism_lmer_id_slope_nocor)</span></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a><span class="co"># take out random intercept, finally no boundary estimates, and no warnings!</span></span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>autism_lmer_id_slope_noint <span class="ot">&lt;-</span> <span class="fu">lmer</span>(vsae<span class="sc">~</span>sicdegp<span class="sc">*</span>age <span class="sc">+</span> (<span class="dv">0</span> <span class="sc">+</span> age <span class="sc">|</span> childid), <span class="at">data =</span> autism_complete)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Based on these issues, I’m skeptical the optimizer will be able to handle more complicated random coefficient models reliably. But we’ll try! We’ll try to fit the same gamut of linear/quadratic/stick models that we had fit in the fixed case. Since <code>lmer</code> is likely more familiar, I show these fits in <code>lmer</code> first, and the <code>lme</code> equivalent underneath.</p>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-23_8a801aa899ba515335a20bb343ad028d">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="do">### Fitting in lmer ---------------------------------------------------------------------</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Quadratic Models</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>autism_lmer_quad_id <span class="ot">&lt;-</span> <span class="fu">lmer</span>(vsae <span class="sc">~</span> age<span class="sc">*</span>sicdegp <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">:</span>sicdegp <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> childid), <span class="co"># random intercept</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">data =</span> autism_complete) <span class="co"># no warnings</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a><span class="co"># quadratic, with random linear term.</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>autism_lmer_quad_id_slope1 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(vsae<span class="sc">~</span>age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">:</span>sicdegp <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> age <span class="sc">|</span> childid), <span class="co"># random intercept, linear</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">data =</span> autism_complete) <span class="co"># boundary warning</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a><span class="do">## boundary (singular) fit: see help('isSingular')</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>autism_lmer_quad_id_slope1_nocor <span class="ot">&lt;-</span> <span class="fu">lmer</span>(vsae<span class="sc">~</span>age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">:</span>sicdegp <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> age <span class="sc">||</span> childid), <span class="co"># random intercept, linear, uncorrelated</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">data =</span> autism_complete) <span class="co"># boundary warning</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a><span class="do">## boundary (singular) fit: see help('isSingular')</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>autism_lmer_quad_id_slope1_noint <span class="ot">&lt;-</span> <span class="fu">lmer</span>(vsae<span class="sc">~</span>age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">:</span>sicdegp <span class="sc">+</span> (<span class="dv">0</span>  <span class="sc">+</span> age <span class="sc">|</span> childid), <span class="co"># random linear, no intercept</span></span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">data =</span> autism_complete) <span class="co"># no warnings</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Quadratic: unstructured, heterogenous G matrix, diagonal, homogenous R</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>autism_lmer_quad_id_slope2 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(vsae <span class="sc">~</span> age<span class="sc">*</span>sicdegp <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">:</span>sicdegp <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>) <span class="sc">|</span> childid), <span class="at">data =</span> autism_complete) <span class="co"># singular, corr = -1</span></span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a><span class="do">## boundary (singular) fit: see help('isSingular')</span></span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Quadratic: diagonal, heterogenous G matrix, diagonal, homogenous R</span></span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>autism_lmer_quad_id_slope2_nocor <span class="ot">&lt;-</span> <span class="fu">lmer</span>(vsae <span class="sc">~</span> age<span class="sc">*</span>sicdegp <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">:</span>sicdegp <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>) <span class="sc">||</span> childid), <span class="at">data =</span> autism_complete) <span class="co"># singular, intercept ≈ 0</span></span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a><span class="do">## boundary (singular) fit: see help('isSingular')</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Quadratic, no intercept: unstructured, heterogenous G matrix, diagonal, homogenous R</span></span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>autism_lmer_quad_id_slope2_noint <span class="ot">&lt;-</span> <span class="fu">lmer</span>(vsae <span class="sc">~</span> age<span class="sc">*</span>sicdegp <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">:</span>sicdegp <span class="sc">+</span> (<span class="dv">0</span> <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>) <span class="sc">|</span> childid), <span class="at">data =</span> autism_complete, </span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">control =</span> <span class="fu">lmerControl</span>(<span class="at">optimizer =</span> <span class="st">"Nelder_Mead"</span>)) <span class="co"># no warnings</span></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-29"><a href="#cb34-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Quadratic, no intercept: diagonal, heterogenous G matrix, diagonal, homogenous R</span></span>
<span id="cb34-30"><a href="#cb34-30" aria-hidden="true" tabindex="-1"></a><span class="co"># autism_lmer_quad_id_slope2_noint_nocor &lt;- lmer(vsae ~ age*sicdegp + I(age^2):sicdegp + (0 + age + I(age^2) || childid), data = autism_complete) # fail to converge</span></span>
<span id="cb34-31"><a href="#cb34-31" aria-hidden="true" tabindex="-1"></a>autism_lmer_quad_id_slope2_noint_nocor <span class="ot">&lt;-</span> <span class="fu">lmer</span>(vsae <span class="sc">~</span> age<span class="sc">*</span>sicdegp <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">:</span>sicdegp <span class="sc">+</span> (<span class="dv">0</span> <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>) <span class="sc">||</span> childid), <span class="at">data =</span> autism_complete, </span>
<span id="cb34-32"><a href="#cb34-32" aria-hidden="true" tabindex="-1"></a>                                         <span class="at">control =</span> <span class="fu">lmerControl</span>(<span class="at">optimizer =</span> <span class="st">"Nelder_Mead"</span>)) <span class="co"># no warnings</span></span>
<span id="cb34-33"><a href="#cb34-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-34"><a href="#cb34-34" aria-hidden="true" tabindex="-1"></a><span class="do">## Stick Models</span></span>
<span id="cb34-35"><a href="#cb34-35" aria-hidden="true" tabindex="-1"></a>autism_lmer_stick_id <span class="ot">&lt;-</span> <span class="fu">lmer</span>(vsae <span class="sc">~</span> age<span class="sc">*</span>sicdegp <span class="sc">+</span> age_relu_9<span class="sc">:</span>sicdegp <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> childid), <span class="at">data =</span> autism_stick) </span>
<span id="cb34-36"><a href="#cb34-36" aria-hidden="true" tabindex="-1"></a>autism_lmer_stick_id_slope <span class="ot">&lt;-</span> <span class="fu">lmer</span>(vsae <span class="sc">~</span> age<span class="sc">*</span>sicdegp <span class="sc">+</span> age_relu_9<span class="sc">:</span>sicdegp <span class="sc">+</span> (<span class="dv">0</span> <span class="sc">+</span> age <span class="sc">+</span> age_relu_9 <span class="sc">|</span> childid), <span class="at">data =</span> autism_stick)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-24_6560594b33a58f4d622c1dc9db481ec9">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fitting in lme ---------------------------------------------------------------------</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Quadratic, random intercept: diagonal, homogenous R</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>autism_lme_quad_id <span class="ot">&lt;-</span> <span class="fu">lme</span>(vsae <span class="sc">~</span> age<span class="sc">*</span>sicdegp <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">:</span>sicdegp, <span class="co"># quadratic </span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">random =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> childid, <span class="co"># random intercept</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> autism_complete,</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">control =</span> <span class="fu">lmeControl</span>(<span class="at">opt =</span> <span class="st">"optim"</span>))</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Quadratic, random linear: unstructured, heterogenous G matrix, diagonal, homogenous R</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>autism_lme_quad_id_slope1 <span class="ot">&lt;-</span> <span class="fu">lme</span>(vsae <span class="sc">~</span> age<span class="sc">*</span>sicdegp <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">:</span>sicdegp,</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">random =</span> <span class="sc">~</span> age <span class="sc">|</span> childid, <span class="co"># random intercept and linear term</span></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> autism_complete,</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">control =</span> <span class="fu">lmeControl</span>(<span class="at">opt =</span> <span class="st">"optim"</span>))</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Quadratic, random linear: diagonal, heterogenous G matrix:  diagonal, homogenous R</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>autism_lme_quad_id_slope1_nocor <span class="ot">&lt;-</span> <span class="fu">lme</span>(vsae <span class="sc">~</span> age<span class="sc">*</span>sicdegp <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">:</span>sicdegp,</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>                       <span class="at">random =</span> <span class="fu">list</span>(<span class="at">childid =</span> <span class="fu">pdDiag</span>(<span class="at">form =</span> <span class="sc">~</span> age)), <span class="co"># random intercept and linear term, no correlation</span></span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> autism_complete,</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>                       <span class="at">control =</span> <span class="fu">lmeControl</span>(<span class="at">opt =</span> <span class="st">"optim"</span>))</span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>autism_lme_quad_id_slope1_noint <span class="ot">&lt;-</span> <span class="fu">lme</span>(vsae <span class="sc">~</span> age<span class="sc">*</span>sicdegp <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">:</span>sicdegp,</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a>                       <span class="at">random =</span> <span class="fu">list</span>(<span class="at">childid =</span> <span class="fu">pdDiag</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> age)), <span class="co"># random intercept and linear term, no intercept</span></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> autism_complete,</span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>                       <span class="at">control =</span> <span class="fu">lmeControl</span>(<span class="at">opt =</span> <span class="st">"optim"</span>))</span>
<span id="cb35-25"><a href="#cb35-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-26"><a href="#cb35-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-27"><a href="#cb35-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Quadratic, random quadratic: unstructured, heterogenous G matrix:  diagonal, homogenous R</span></span>
<span id="cb35-28"><a href="#cb35-28" aria-hidden="true" tabindex="-1"></a>autism_lme_quad_id_slope2 <span class="ot">&lt;-</span> <span class="fu">lme</span>(vsae <span class="sc">~</span> age<span class="sc">*</span>sicdegp <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">:</span>sicdegp,</span>
<span id="cb35-29"><a href="#cb35-29" aria-hidden="true" tabindex="-1"></a>                       <span class="at">random =</span> <span class="sc">~</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>) <span class="sc">|</span> childid, <span class="co"># random intercept, linear and quadratic term</span></span>
<span id="cb35-30"><a href="#cb35-30" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> autism_complete,</span>
<span id="cb35-31"><a href="#cb35-31" aria-hidden="true" tabindex="-1"></a>                       <span class="at">control =</span> <span class="fu">lmeControl</span>(<span class="at">opt =</span> <span class="st">"optim"</span>))</span>
<span id="cb35-32"><a href="#cb35-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-33"><a href="#cb35-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Quadratic, random quadratic: diagonal, heterogenous G matrix:  diagonal, homogenous R</span></span>
<span id="cb35-34"><a href="#cb35-34" aria-hidden="true" tabindex="-1"></a>autism_lme_quad_id_slope2_nocor <span class="ot">&lt;-</span> <span class="fu">lme</span>(vsae <span class="sc">~</span> age<span class="sc">*</span>sicdegp <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">:</span>sicdegp,</span>
<span id="cb35-35"><a href="#cb35-35" aria-hidden="true" tabindex="-1"></a>                       <span class="at">random =</span> <span class="fu">list</span>(<span class="at">childid=</span><span class="fu">pdDiag</span>(<span class="at">form =</span> <span class="sc">~</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>))), <span class="co"># random intercept, linear and quadratic term, no correlation</span></span>
<span id="cb35-36"><a href="#cb35-36" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> autism_complete,</span>
<span id="cb35-37"><a href="#cb35-37" aria-hidden="true" tabindex="-1"></a>                       <span class="at">control =</span> <span class="fu">lmeControl</span>(<span class="at">opt =</span> <span class="st">"optim"</span>))</span>
<span id="cb35-38"><a href="#cb35-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-39"><a href="#cb35-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Quadratic, random quadratic (no int): unstructured, heterogenous G matrix:  diagonal, homogenous R</span></span>
<span id="cb35-40"><a href="#cb35-40" aria-hidden="true" tabindex="-1"></a>autism_lme_quad_id_slope2_noint <span class="ot">&lt;-</span> <span class="fu">lme</span>(vsae <span class="sc">~</span> age<span class="sc">*</span>sicdegp <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">:</span>sicdegp,</span>
<span id="cb35-41"><a href="#cb35-41" aria-hidden="true" tabindex="-1"></a>                       <span class="at">random =</span> <span class="fu">list</span>(<span class="at">childid=</span><span class="fu">pdSymm</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>))), <span class="co"># Unstructured G</span></span>
<span id="cb35-42"><a href="#cb35-42" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> autism_complete,</span>
<span id="cb35-43"><a href="#cb35-43" aria-hidden="true" tabindex="-1"></a>                       <span class="at">control =</span> <span class="fu">lmeControl</span>(<span class="at">opt =</span> <span class="st">"optim"</span>))</span>
<span id="cb35-44"><a href="#cb35-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-45"><a href="#cb35-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Quadratic, random quadratic (no int): diagonal, heterogenous G matrix:  diagonal, homogenous R</span></span>
<span id="cb35-46"><a href="#cb35-46" aria-hidden="true" tabindex="-1"></a>autism_lme_quad_id_slope2_noint_nocor <span class="ot">&lt;-</span> <span class="fu">lme</span>(vsae <span class="sc">~</span> age<span class="sc">*</span>sicdegp <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">:</span>sicdegp,</span>
<span id="cb35-47"><a href="#cb35-47" aria-hidden="true" tabindex="-1"></a>                       <span class="at">random =</span> <span class="fu">list</span>(<span class="at">childid=</span><span class="fu">pdDiag</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>))),</span>
<span id="cb35-48"><a href="#cb35-48" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> autism_complete,</span>
<span id="cb35-49"><a href="#cb35-49" aria-hidden="true" tabindex="-1"></a>                       <span class="at">control =</span> <span class="fu">lmeControl</span>(<span class="at">opt =</span> <span class="st">"optim"</span>))</span>
<span id="cb35-50"><a href="#cb35-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-51"><a href="#cb35-51" aria-hidden="true" tabindex="-1"></a><span class="do">## Stick models</span></span>
<span id="cb35-52"><a href="#cb35-52" aria-hidden="true" tabindex="-1"></a>autism_lme_stick_id <span class="ot">&lt;-</span> <span class="fu">lme</span>(vsae <span class="sc">~</span> age<span class="sc">*</span>sicdegp <span class="sc">+</span> age_relu_9<span class="sc">:</span>sicdegp,</span>
<span id="cb35-53"><a href="#cb35-53" aria-hidden="true" tabindex="-1"></a>                       <span class="at">random =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> childid, <span class="co"># random intercept</span></span>
<span id="cb35-54"><a href="#cb35-54" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> autism_stick,</span>
<span id="cb35-55"><a href="#cb35-55" aria-hidden="true" tabindex="-1"></a>                       <span class="at">control =</span> <span class="fu">lmeControl</span>(<span class="at">opt =</span> <span class="st">"optim"</span>))</span>
<span id="cb35-56"><a href="#cb35-56" aria-hidden="true" tabindex="-1"></a>autism_lme_stick_id_slope <span class="ot">&lt;-</span> <span class="fu">lme</span>(vsae <span class="sc">~</span> age<span class="sc">*</span>sicdegp <span class="sc">+</span> age_relu_9<span class="sc">:</span>sicdegp,</span>
<span id="cb35-57"><a href="#cb35-57" aria-hidden="true" tabindex="-1"></a>                       <span class="at">random =</span> <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> age <span class="sc">+</span> age_relu_9 <span class="sc">|</span> childid, <span class="co"># random linear and quadratic term, no intercept</span></span>
<span id="cb35-58"><a href="#cb35-58" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> autism_stick,</span>
<span id="cb35-59"><a href="#cb35-59" aria-hidden="true" tabindex="-1"></a>                       <span class="at">control =</span> <span class="fu">lmeControl</span>(<span class="at">opt =</span> <span class="st">"optim"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-25_9c5374725d65698823fbd3ae52807b1e">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># see predicted values from some random effect models</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>autism_random_predict <span class="ot">&lt;-</span> autism_complete <span class="sc">%&gt;%</span> <span class="fu">add_column</span>(<span class="at">yhat_lme_id =</span> <span class="fu">predict</span>(autism_lme_id),</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">yhat_lme_id_slope =</span> <span class="fu">predict</span>(autism_lme_id_slope),</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">yhat_lme_quad_id =</span> <span class="fu">predict</span>(autism_lme_quad_id),</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">yhat_lme_quad_id_slope1 =</span> <span class="fu">predict</span>(autism_lme_quad_id_slope1),</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">yhat_lme_quad_id_slope2 =</span> <span class="fu">predict</span>(autism_lme_quad_id_slope2),</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">yhat_lme_stick_id =</span> <span class="fu">predict</span>(autism_lme_stick_id),</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">yhat_lme_stick_id_slope =</span> <span class="fu">predict</span>(autism_lme_stick_id_slope),</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">yhat_lmer_quad_id_slope2_noint =</span> <span class="fu">predict</span>(autism_lmer_quad_id_slope2_noint),</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">yhat_lmer_stick_id =</span> <span class="fu">predict</span>(autism_lmer_stick_id),</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">yhat_lmer_stick_id_slope =</span> <span class="fu">predict</span>(autism_lmer_stick_id_slope))</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>autism_random_predict <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(vsae, <span class="fu">starts_with</span>(<span class="st">"yhat"</span>)),</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>                                <span class="at">names_to =</span> <span class="st">"type"</span>,</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>                                <span class="at">values_to =</span> <span class="st">"y"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(childid, age) <span class="sc">%&gt;%</span> </span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, y, <span class="at">group =</span> childid, <span class="at">color =</span> type)) <span class="sc">+</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">alpha =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(type<span class="sc">~</span>sicdegp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="randomcoef_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid" width="1152"></p>
</div>
</div>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-26_e96045f0006d261a696090e8ee65c380">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r fold-hide code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>autism_lme_ic <span class="ot">&lt;-</span> <span class="fu">AIC</span>(</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  autism_lme_id,</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  autism_lme_id_slope, <span class="co"># warning here too, probably because includes individuals that </span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  autism_lme_quad_id,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  autism_lme_quad_id_slope1,</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  autism_lme_quad_id_slope2,</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  autism_lmer_quad_id_slope2, <span class="co"># lmer version, get warning when included, not quite sure why, maybe refit as ML? but very close to lme counterpart</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>  autism_lme_quad_id_slope2_nocor,</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  autism_lmer_quad_id_slope2_nocor, <span class="co"># lmer version</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  autism_lme_quad_id_slope2_noint,</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  autism_lmer_quad_id_slope2_noint, <span class="co"># lmer version</span></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>  autism_lme_quad_id_slope2_noint_nocor,</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>  autism_lme_stick_id,</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>  autism_lme_stick_id_slope</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_column</span>(</span>
<span id="cb37-17"><a href="#cb37-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">BIC =</span> <span class="fu">BIC</span>(</span>
<span id="cb37-18"><a href="#cb37-18" aria-hidden="true" tabindex="-1"></a>      autism_lme_id,</span>
<span id="cb37-19"><a href="#cb37-19" aria-hidden="true" tabindex="-1"></a>    autism_lme_id_slope,</span>
<span id="cb37-20"><a href="#cb37-20" aria-hidden="true" tabindex="-1"></a>    autism_lme_quad_id,</span>
<span id="cb37-21"><a href="#cb37-21" aria-hidden="true" tabindex="-1"></a>    autism_lme_quad_id_slope1,</span>
<span id="cb37-22"><a href="#cb37-22" aria-hidden="true" tabindex="-1"></a>    autism_lme_quad_id_slope2,</span>
<span id="cb37-23"><a href="#cb37-23" aria-hidden="true" tabindex="-1"></a>    autism_lmer_quad_id_slope2, <span class="co"># lmer version</span></span>
<span id="cb37-24"><a href="#cb37-24" aria-hidden="true" tabindex="-1"></a>    autism_lme_quad_id_slope2_nocor,</span>
<span id="cb37-25"><a href="#cb37-25" aria-hidden="true" tabindex="-1"></a>    autism_lmer_quad_id_slope2_nocor, <span class="co"># lmer version</span></span>
<span id="cb37-26"><a href="#cb37-26" aria-hidden="true" tabindex="-1"></a>    autism_lme_quad_id_slope2_noint,</span>
<span id="cb37-27"><a href="#cb37-27" aria-hidden="true" tabindex="-1"></a>    autism_lmer_quad_id_slope2_noint, <span class="co"># lmer version</span></span>
<span id="cb37-28"><a href="#cb37-28" aria-hidden="true" tabindex="-1"></a>    autism_lme_quad_id_slope2_noint_nocor,</span>
<span id="cb37-29"><a href="#cb37-29" aria-hidden="true" tabindex="-1"></a>    autism_lme_stick_id,</span>
<span id="cb37-30"><a href="#cb37-30" aria-hidden="true" tabindex="-1"></a>    autism_lme_stick_id_slope)<span class="sc">$</span>BIC)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in AIC.default(autism_lme_id, autism_lme_id_slope, autism_lme_quad_id, :
models are not all fitted to the same number of observations</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in BIC.default(autism_lme_id, autism_lme_id_slope, autism_lme_quad_id, :
models are not all fitted to the same number of observations</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r fold-hide code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>autism_lme_ic <span class="sc">%&gt;%</span> <span class="fu">kbl</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_classic</span>(<span class="at">full_width =</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">3</span>, <span class="at">color =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"red"</span>)[<span class="fu">as.numeric</span>(autism_lme_ic<span class="sc">$</span>AIC <span class="sc">==</span> <span class="fu">min</span>(autism_lme_ic<span class="sc">$</span>AIC)) <span class="sc">+</span> <span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">4</span>, <span class="at">color =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"red"</span>)[<span class="fu">as.numeric</span>(autism_lme_ic<span class="sc">$</span>BIC <span class="sc">==</span> <span class="fu">min</span>(autism_lme_ic<span class="sc">$</span>BIC)) <span class="sc">+</span> <span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<table class=" lightable-classic" style="font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> df </th>
   <th style="text-align:right;"> AIC </th>
   <th style="text-align:right;"> BIC </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> autism_lme_id </td>
   <td style="text-align:right;"> 8 </td>
   <td style="text-align:right;color: black !important;"> 5461.844 </td>
   <td style="text-align:right;color: black !important;"> 5497.072 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> autism_lme_id_slope </td>
   <td style="text-align:right;"> 10 </td>
   <td style="text-align:right;color: black !important;"> 4716.130 </td>
   <td style="text-align:right;color: black !important;"> 4760.166 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> autism_lme_quad_id </td>
   <td style="text-align:right;"> 11 </td>
   <td style="text-align:right;color: black !important;"> 5470.017 </td>
   <td style="text-align:right;color: black !important;"> 5518.402 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> autism_lme_quad_id_slope1 </td>
   <td style="text-align:right;"> 13 </td>
   <td style="text-align:right;color: black !important;"> 4724.230 </td>
   <td style="text-align:right;color: black !important;"> 4781.412 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> autism_lme_quad_id_slope2 </td>
   <td style="text-align:right;"> 16 </td>
   <td style="text-align:right;color: black !important;"> 4640.705 </td>
   <td style="text-align:right;color: black !important;"> 4711.083 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> autism_lmer_quad_id_slope2 </td>
   <td style="text-align:right;"> 16 </td>
   <td style="text-align:right;color: red !important;"> 4639.983 </td>
   <td style="text-align:right;color: red !important;"> 4710.598 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> autism_lme_quad_id_slope2_nocor </td>
   <td style="text-align:right;"> 13 </td>
   <td style="text-align:right;color: black !important;"> 4680.454 </td>
   <td style="text-align:right;color: black !important;"> 4737.636 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> autism_lmer_quad_id_slope2_nocor </td>
   <td style="text-align:right;"> 13 </td>
   <td style="text-align:right;color: black !important;"> 4680.391 </td>
   <td style="text-align:right;color: black !important;"> 4737.766 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> autism_lme_quad_id_slope2_noint </td>
   <td style="text-align:right;"> 13 </td>
   <td style="text-align:right;color: black !important;"> 4680.009 </td>
   <td style="text-align:right;color: black !important;"> 4737.191 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> autism_lmer_quad_id_slope2_noint </td>
   <td style="text-align:right;"> 13 </td>
   <td style="text-align:right;color: black !important;"> 4680.009 </td>
   <td style="text-align:right;color: black !important;"> 4737.384 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> autism_lme_quad_id_slope2_noint_nocor </td>
   <td style="text-align:right;"> 12 </td>
   <td style="text-align:right;color: black !important;"> 4678.391 </td>
   <td style="text-align:right;color: black !important;"> 4731.174 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> autism_lme_stick_id </td>
   <td style="text-align:right;"> 11 </td>
   <td style="text-align:right;color: black !important;"> 5454.106 </td>
   <td style="text-align:right;color: black !important;"> 5502.490 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> autism_lme_stick_id_slope </td>
   <td style="text-align:right;"> 13 </td>
   <td style="text-align:right;color: black !important;"> 4748.713 </td>
   <td style="text-align:right;color: black !important;"> 4805.895 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>We’ve fit all these “intuitive” models, and we can see most of them give pretty intuitive predicted values for our dataset. They capture the main trends we’re after pretty well. Given that we’re using random coefficient models, we’ll probably rule out the models that only vary the intercept. It seems from these predictive plots that we at the very least need to be modeling complexity at the linear or quadratic level (or splines). We’ll look further into these models in the diagnostics, as well as the variance modeling in the diagnostics.</p>
<p>The information criteria seems to pick out the “autism_lme_quad_id_slope2”, which is the random effect model with random coefficients up to quadratic order, and unstructured correlation matrix in G. thought we remember there were some boundary warnings with that model, so removing the intercept for a model that is not near the boundary may be desired.</p>
</section>
<section id="diagnostics-1" class="level2 tabset" data-number="18.2">
<h2 class="tabset anchored" data-number="18.2" data-anchor-id="diagnostics-1"><span class="header-section-number">18.2</span> Diagnostics</h2>
<p>Let’s look at the mean structure with standard residual plots first. We’ll just pick out a few plots to look at.</p>
<section id="quad" class="level3" data-number="18.2.1">
<h3 data-number="18.2.1" class="anchored" data-anchor-id="quad"><span class="header-section-number">18.2.1</span> Quad</h3>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-27_a1a82ff9d3ae770ed36d1e3e2f735597">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(autism_lme_quad_id_slope2, <span class="at">form =</span> <span class="fu">resid</span>(.,<span class="at">type =</span> <span class="st">"normalized"</span>) <span class="sc">~</span> age <span class="sc">|</span> sicdegp) <span class="co"># normalized</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="randomcoef_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In order to study the variance covariance pattern of this, I’ll examine how closely it matches up with the unstructured estimate of the covariance. we can also look at the sample covariance for some direction.</p>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-28_cb73d43f03d63e2aa77a98b4107e9c76">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>autism_gls_quad_un <span class="ot">&lt;-</span> <span class="fu">gls</span>(vsae <span class="sc">~</span> age<span class="sc">*</span>sicdegp <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">:</span>sicdegp,</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">correlation =</span> <span class="fu">corSymm</span>(<span class="at">form =</span> <span class="sc">~</span><span class="dv">1</span> <span class="sc">|</span> childid),</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">weights =</span> <span class="fu">varIdent</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> age),</span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> autism_complete)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="fu">getVarCov</span>(autism_gls_quad_un)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Marginal variance covariance matrix
        [,1]     [,2]     [,3]     [,4]     [,5]
[1,] 10.8700   9.0082   9.3212   25.916   48.667
[2,]  9.0082  55.7270  45.7570  110.010  201.300
[3,]  9.3212  45.7570 135.7700  222.120  397.840
[4,] 25.9160 110.0100 222.1200  771.040 1197.400
[5,] 48.6670 201.3000 397.8400 1197.400 2287.700
  Standard Deviations: 3.297 7.4651 11.652 27.768 47.83 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getVarCov</span>(autism_lme_quad_id_slope2, <span class="at">type =</span> <span class="st">"marginal"</span>) <span class="co"># ZGZ + R</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>childid 1 
Marginal variance covariance matrix
        1        2        3        4        5
1 39.0350   2.0468   5.4054   21.354   49.612
2  2.0468  53.4340  43.3380   96.860  148.630
3  5.4054  43.3380 156.7100  270.900  422.580
4 21.3540  96.8600 270.9000  748.630 1274.200
5 49.6120 148.6300 422.5800 1274.200 2568.100
  Standard Deviations: 6.2478 7.3098 12.518 27.361 50.677 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we can also look at the sample covariance to get a rough sense for how the variances and covariances should be behaving</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>It seems the variance pattern in the random effect model is severely overestimating the variance at age 2. There is also an interesting pattern in which it seems to underestimate the covariance between age 2 and 3. Other than that, the covariance looks to be within reason of capturing the overall trends. there are likely some optimizations in parameterization that can be made, but it’s difficult to know exactly how…</p>
</section>
<section id="quad-simplified-no-intercept" class="level3" data-number="18.2.2">
<h3 data-number="18.2.2" class="anchored" data-anchor-id="quad-simplified-no-intercept"><span class="header-section-number">18.2.2</span> Quad simplified, no intercept</h3>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-29_cf4a239f129368a63f25b27f539ba0e1">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(autism_lme_quad_id_slope2_noint_nocor, <span class="at">form =</span> <span class="fu">resid</span>(.,<span class="at">type =</span> <span class="st">"normalized"</span>) <span class="sc">~</span> age <span class="sc">|</span> sicdegp) <span class="co"># normalized</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="randomcoef_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-30_41f52cd6c669d88fbab639881752a173">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getVarCov</span>(autism_gls_quad_un)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Marginal variance covariance matrix
        [,1]     [,2]     [,3]     [,4]     [,5]
[1,] 10.8700   9.0082   9.3212   25.916   48.667
[2,]  9.0082  55.7270  45.7570  110.010  201.300
[3,]  9.3212  45.7570 135.7700  222.120  397.840
[4,] 25.9160 110.0100 222.1200  771.040 1197.400
[5,] 48.6670 201.3000 397.8400 1197.400 2287.700
  Standard Deviations: 3.297 7.4651 11.652 27.768 47.83 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getVarCov</span>(autism_lme_quad_id_slope2_noint_nocor, <span class="at">type =</span> <span class="st">"marginal"</span>) <span class="co"># ZGZ + R</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>childid 1 
Marginal variance covariance matrix
       1       2       3        4        5
1 55.373  11.014  21.709   51.146   91.311
2 11.014  67.485  38.850   97.086  179.460
3 21.709  38.850 134.400  229.700  440.750
4 51.146  97.086 229.700  706.560 1303.300
5 91.311 179.460 440.750 1303.300 2667.700
  Standard Deviations: 7.4413 8.2149 11.593 26.581 51.65 </code></pre>
</div>
</div>
<p>The model with the simplified G structure is also lacking in the earlier ages, and also the covariances with age2 seems to be increasing too quickly. The second diagonal band is also both over and underestimated sometimes.</p>
</section>
</section>
<section id="further-covariance-adjustments" class="level2" data-number="18.3">
<h2 data-number="18.3" class="anchored" data-anchor-id="further-covariance-adjustments"><span class="header-section-number">18.3</span> Further covariance adjustments</h2>
<p>The mixed effects model already has some complexity in the variance that is modeled, but it’s missing some parts of the covariance that we can try to adjust for on the R side of things. I find that there aren’t many guardrails when modeling things in this manner, so likelihood is generally my guide. You can try to create plots to clue you in on certain patterns but often it’s just faster to fit a bunch of parameterizations and check the results.</p>
<p>For the diagonal of the R matrix, it’s useful to know how some of the variance classes can be combined and to know what your options are, you can do this by exploring <code>?varClasses</code>.</p>
<ul>
<li><code>varIdent</code> allows for a different level for each variance on the diagonal.</li>
<li><code>varExp</code> is a (fitted) exponential relationship to covariate</li>
<li><code>varPower</code> is an (fitted) power relationship</li>
<li><code>varFixed</code> allows for a constant (fixed) covariate value</li>
<li><code>varComb</code> allows combinations of any of the above</li>
</ul>
<p>For the structure of the R matrix, you can see <code>?corStructs</code></p>
<ul>
<li><code>corAR1</code> allows for exponential decay in rows, as measured from distance from diagonal</li>
<li><code>corCAR1</code> allows for exponential decay in rows, as measured from distance in continuous covariate</li>
<li><code>corARMA</code> allows for exponential decay in rows, as distance from diagonal, AND first q diagonal bands</li>
<li><code>corCompSymm</code> constant off diagonals</li>
</ul>
<p>For the structure of the G matrix, there are also a number of spatial related matrices, which have a functional form of how correlation drops off in relation to distance.</p>
<ul>
<li><code>pdDiag</code> is useful for specifying that you only want a <em>diagonal</em> matrix for G. This is the <code>(1 + age || childid)</code> double bar option in <code>lmer</code></li>
<li><code>pdSymm</code> specifies that you want to esetimate an <em>unstructured</em> matrix for G. This is <code>(1 + age | childid)</code> default option in <code>lmer</code>.</li>
<li><code>pdBlocked</code> is useful for composing matrix structures for nested effects in the G matrix.</li>
<li><code>pdCompSymm</code> <em>compound symmetry</em> in G matrix. Only possible with <code>flexLambda</code> branch in <code>lmer</code>.</li>
</ul>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-31_ef3a256152f9ad23dcf2c848e1687882">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This first model tries to add a parameter to adjust the variance of age=2, since the diagnostics above were close except for this term.</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>autism_lme_quad_id_slope2_het2 <span class="ot">&lt;-</span> <span class="fu">lme</span>(vsae <span class="sc">~</span> age<span class="sc">*</span>sicdegp <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">:</span>sicdegp,</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">random =</span> <span class="fu">list</span>(<span class="at">childid =</span> <span class="fu">pdSymm</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>))), <span class="co"># random linear and quadratic term, no intercept</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> autism_complete,</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">weights =</span> <span class="fu">varIdent</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> <span class="fu">I</span>(age <span class="sc">==</span> <span class="dv">2</span>)),</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">control =</span> <span class="fu">lmeControl</span>(<span class="at">opt =</span> <span class="st">"optim"</span>, <span class="at">maxIter =</span> <span class="dv">1000</span>, <span class="at">msMaxIter =</span> <span class="dv">1000</span>, <span class="at">msVerbose =</span> <span class="cn">TRUE</span>)) <span class="co"># unfortunately it's a fight with the optimizer, so we need to simplify.</span></span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a><span class="do">## initial  value 3387.370642</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning in logLik.reStruct(object, conLin): Singular precision matrix in level</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a><span class="do">## -1, block 1</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a><span class="do">## Error in logLik.reStruct(object, conLin): NA/NaN/Inf in foreign function call (arg 3)</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a><span class="co"># try removing the intercept, and fit simple model</span></span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>autism_lme_quad_id_slope2_noint_het2 <span class="ot">&lt;-</span> <span class="fu">lme</span>(vsae <span class="sc">~</span> age<span class="sc">*</span>sicdegp <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">:</span>sicdegp,</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">random =</span> <span class="fu">list</span>(<span class="at">childid =</span> <span class="fu">pdSymm</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>))), <span class="co"># random linear and quadratic term, no intercept</span></span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> autism_complete,</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>                       <span class="at">weights =</span> <span class="fu">varIdent</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> <span class="fu">I</span>(age <span class="sc">==</span> <span class="dv">2</span>)),</span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>                       <span class="at">control =</span> <span class="fu">lmeControl</span>(<span class="at">opt =</span> <span class="st">"optim"</span>, <span class="at">maxIter =</span> <span class="dv">1000</span>, <span class="at">msMaxIter =</span> <span class="dv">1000</span>, <span class="at">msVerbose =</span> <span class="cn">TRUE</span>)) <span class="co"># converged w/ warnings</span></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a><span class="do">## initial  value 3397.116545</span></span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning in logLik.reStruct(object, conLin): Singular precision matrix in level</span></span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a><span class="do">## -1, block 1</span></span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning in logLik.reStruct(object, conLin): Singular precision matrix in level</span></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a><span class="do">## -1, block 47</span></span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a><span class="do">## iter  10 value 3324.372416</span></span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a><span class="do">## final  value 3324.349202 </span></span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a><span class="do">## converged</span></span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a><span class="co"># the more flexible diagonal values</span></span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>autism_lme_quad_id_slope2_noint_het <span class="ot">&lt;-</span> <span class="fu">lme</span>(vsae <span class="sc">~</span> age<span class="sc">*</span>sicdegp <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">:</span>sicdegp,</span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">random =</span> <span class="fu">list</span>(<span class="at">childid =</span> <span class="fu">pdSymm</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>))), <span class="co"># random linear and quadratic term, no intercept</span></span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> autism_complete,</span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>                       <span class="at">weights =</span> <span class="fu">varIdent</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> age),</span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>                       <span class="at">control =</span> <span class="fu">lmeControl</span>(<span class="at">opt =</span> <span class="st">"optim"</span>)) <span class="co"># converged w/ warnings</span></span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning in logLik.reStruct(object, conLin): Singular precision matrix in level</span></span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a><span class="do">## -1, block 1</span></span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning in logLik.reStruct(object, conLin): Singular precision matrix in level</span></span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a><span class="do">## -1, block 47</span></span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning in logLik.reStruct(object, conLin): Singular precision matrix in level</span></span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true" tabindex="-1"></a><span class="do">## -1, block 47</span></span>
<span id="cb52-41"><a href="#cb52-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-42"><a href="#cb52-42" aria-hidden="true" tabindex="-1"></a><span class="co"># we'll try more heterogenous matrices, but with the simplified G matrix and without intercept to avoid optimizer issues</span></span>
<span id="cb52-43"><a href="#cb52-43" aria-hidden="true" tabindex="-1"></a>autism_lme_quad_id_slope2_noint_nocor_het <span class="ot">&lt;-</span> <span class="fu">lme</span>(vsae <span class="sc">~</span> age<span class="sc">*</span>sicdegp <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">:</span>sicdegp,</span>
<span id="cb52-44"><a href="#cb52-44" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">random =</span> <span class="fu">list</span>(<span class="at">childid =</span> <span class="fu">pdDiag</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>))), <span class="co"># random linear and quadratic term, no intercept</span></span>
<span id="cb52-45"><a href="#cb52-45" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> autism_complete,</span>
<span id="cb52-46"><a href="#cb52-46" aria-hidden="true" tabindex="-1"></a>                       <span class="at">weights =</span> <span class="fu">varIdent</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> age),</span>
<span id="cb52-47"><a href="#cb52-47" aria-hidden="true" tabindex="-1"></a>                       <span class="at">control =</span> <span class="fu">lmeControl</span>(<span class="at">opt =</span> <span class="st">"optim"</span>))</span>
<span id="cb52-48"><a href="#cb52-48" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning in logLik.reStruct(object, conLin): Singular precision matrix in level</span></span>
<span id="cb52-49"><a href="#cb52-49" aria-hidden="true" tabindex="-1"></a><span class="do">## -1, block 1</span></span>
<span id="cb52-50"><a href="#cb52-50" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning in logLik.reStruct(object, conLin): Singular precision matrix in level</span></span>
<span id="cb52-51"><a href="#cb52-51" aria-hidden="true" tabindex="-1"></a><span class="do">## -1, block 4</span></span>
<span id="cb52-52"><a href="#cb52-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-53"><a href="#cb52-53" aria-hidden="true" tabindex="-1"></a>autism_lme_quad_id_slope2_noint_nocor_het2 <span class="ot">&lt;-</span> <span class="fu">lme</span>(vsae <span class="sc">~</span> age<span class="sc">*</span>sicdegp <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">:</span>sicdegp,</span>
<span id="cb52-54"><a href="#cb52-54" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">random =</span> <span class="fu">list</span>(<span class="at">childid =</span> <span class="fu">pdDiag</span>(<span class="at">form =</span> <span class="sc">~</span><span class="dv">0</span> <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>))), <span class="co"># random linear and quadratic term, no intercept</span></span>
<span id="cb52-55"><a href="#cb52-55" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> autism_complete,</span>
<span id="cb52-56"><a href="#cb52-56" aria-hidden="true" tabindex="-1"></a>                       <span class="at">weights =</span> <span class="fu">varIdent</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> <span class="fu">I</span>(age <span class="sc">==</span> <span class="dv">2</span>)),</span>
<span id="cb52-57"><a href="#cb52-57" aria-hidden="true" tabindex="-1"></a>                       <span class="at">control =</span> <span class="fu">lmeControl</span>(<span class="at">opt =</span> <span class="st">"optim"</span>))</span>
<span id="cb52-58"><a href="#cb52-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-59"><a href="#cb52-59" aria-hidden="true" tabindex="-1"></a><span class="co"># sincethe model onl</span></span>
<span id="cb52-60"><a href="#cb52-60" aria-hidden="true" tabindex="-1"></a>autism_lme_quad_id_slope2_noint_nocor_het2 <span class="ot">&lt;-</span> <span class="fu">lme</span>(vsae <span class="sc">~</span> age<span class="sc">*</span>sicdegp <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">:</span>sicdegp,</span>
<span id="cb52-61"><a href="#cb52-61" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">random =</span> <span class="fu">list</span>(<span class="at">childid =</span> <span class="fu">pdDiag</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>))), <span class="co"># random linear and quadratic term, no intercept</span></span>
<span id="cb52-62"><a href="#cb52-62" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> autism_complete,</span>
<span id="cb52-63"><a href="#cb52-63" aria-hidden="true" tabindex="-1"></a>                       <span class="at">weights =</span> <span class="fu">varIdent</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> age),</span>
<span id="cb52-64"><a href="#cb52-64" aria-hidden="true" tabindex="-1"></a>                       <span class="at">control =</span> <span class="fu">lmeControl</span>(<span class="at">opt =</span> <span class="st">"optim"</span>))</span>
<span id="cb52-65"><a href="#cb52-65" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning in logLik.reStruct(object, conLin): Singular precision matrix in level</span></span>
<span id="cb52-66"><a href="#cb52-66" aria-hidden="true" tabindex="-1"></a><span class="do">## -1, block 1</span></span>
<span id="cb52-67"><a href="#cb52-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-68"><a href="#cb52-68" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning in logLik.reStruct(object, conLin): Singular precision matrix in level</span></span>
<span id="cb52-69"><a href="#cb52-69" aria-hidden="true" tabindex="-1"></a><span class="do">## -1, block 4</span></span>
<span id="cb52-70"><a href="#cb52-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-71"><a href="#cb52-71" aria-hidden="true" tabindex="-1"></a>autism_lme_quad_id_slope2_noint_nocor_ar1 <span class="ot">&lt;-</span> <span class="fu">lme</span>(vsae <span class="sc">~</span> age<span class="sc">*</span>sicdegp <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">:</span>sicdegp,</span>
<span id="cb52-72"><a href="#cb52-72" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">random =</span> <span class="fu">list</span>(<span class="at">childid =</span> <span class="fu">pdDiag</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>))), <span class="co"># random linear and quadratic term, no intercept</span></span>
<span id="cb52-73"><a href="#cb52-73" aria-hidden="true" tabindex="-1"></a>                       <span class="at">correlation =</span> <span class="fu">corAR1</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> childid),</span>
<span id="cb52-74"><a href="#cb52-74" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> autism_complete,</span>
<span id="cb52-75"><a href="#cb52-75" aria-hidden="true" tabindex="-1"></a>                       <span class="at">weights =</span> <span class="fu">varIdent</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> age),</span>
<span id="cb52-76"><a href="#cb52-76" aria-hidden="true" tabindex="-1"></a>                       <span class="at">control =</span> <span class="fu">lmeControl</span>(<span class="at">opt =</span> <span class="st">"optim"</span>))</span>
<span id="cb52-77"><a href="#cb52-77" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning in logLik.reStruct(object, conLin): Singular precision matrix in level</span></span>
<span id="cb52-78"><a href="#cb52-78" aria-hidden="true" tabindex="-1"></a><span class="do">## -1, block 1</span></span>
<span id="cb52-79"><a href="#cb52-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-80"><a href="#cb52-80" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning in logLik.reStruct(object, conLin): Singular precision matrix in level</span></span>
<span id="cb52-81"><a href="#cb52-81" aria-hidden="true" tabindex="-1"></a><span class="do">## -1, block 4</span></span>
<span id="cb52-82"><a href="#cb52-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-83"><a href="#cb52-83" aria-hidden="true" tabindex="-1"></a>autism_lme_quad_id_slope2_noint_nocor_ma1 <span class="ot">&lt;-</span> <span class="fu">lme</span>(vsae <span class="sc">~</span> age<span class="sc">*</span>sicdegp <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">:</span>sicdegp,</span>
<span id="cb52-84"><a href="#cb52-84" aria-hidden="true" tabindex="-1"></a>                       <span class="at">random =</span> <span class="fu">list</span>(<span class="at">childid =</span> <span class="fu">pdDiag</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>))), <span class="co"># random linear and quadratic term, no intercept</span></span>
<span id="cb52-85"><a href="#cb52-85" aria-hidden="true" tabindex="-1"></a>                       <span class="at">correlation =</span> <span class="fu">corARMA</span>(<span class="at">p =</span> <span class="dv">0</span>, <span class="at">q =</span> <span class="dv">1</span>),</span>
<span id="cb52-86"><a href="#cb52-86" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> autism_complete,</span>
<span id="cb52-87"><a href="#cb52-87" aria-hidden="true" tabindex="-1"></a>                       <span class="at">weights =</span> <span class="fu">varIdent</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> age))</span>
<span id="cb52-88"><a href="#cb52-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-89"><a href="#cb52-89" aria-hidden="true" tabindex="-1"></a>autism_lme_quad_id_slope2_noint_nocor_ma2 <span class="ot">&lt;-</span> <span class="fu">lme</span>(vsae <span class="sc">~</span> age<span class="sc">*</span>sicdegp <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">:</span>sicdegp,</span>
<span id="cb52-90"><a href="#cb52-90" aria-hidden="true" tabindex="-1"></a>                       <span class="at">random =</span> <span class="fu">list</span>(<span class="at">childid =</span> <span class="fu">pdDiag</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>))), <span class="co"># random linear and quadratic term, no intercept</span></span>
<span id="cb52-91"><a href="#cb52-91" aria-hidden="true" tabindex="-1"></a>                       <span class="at">correlation =</span> <span class="fu">corARMA</span>(<span class="at">p =</span> <span class="dv">0</span>, <span class="at">q =</span> <span class="dv">2</span>),</span>
<span id="cb52-92"><a href="#cb52-92" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> autism_complete,</span>
<span id="cb52-93"><a href="#cb52-93" aria-hidden="true" tabindex="-1"></a>                       <span class="at">weights =</span> <span class="fu">varIdent</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> age))</span>
<span id="cb52-94"><a href="#cb52-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-95"><a href="#cb52-95" aria-hidden="true" tabindex="-1"></a>autism_lme_quad_id_slope2_noint_nocor_ar1ma2 <span class="ot">&lt;-</span> <span class="fu">lme</span>(vsae <span class="sc">~</span> age<span class="sc">*</span>sicdegp <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">:</span>sicdegp,</span>
<span id="cb52-96"><a href="#cb52-96" aria-hidden="true" tabindex="-1"></a>                       <span class="at">random =</span> <span class="fu">list</span>(<span class="at">childid =</span> <span class="fu">pdDiag</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>))), <span class="co"># random linear and quadratic term, no intercept</span></span>
<span id="cb52-97"><a href="#cb52-97" aria-hidden="true" tabindex="-1"></a>                       <span class="at">correlation =</span> <span class="fu">corARMA</span>(<span class="at">p =</span> <span class="dv">1</span>, <span class="at">q =</span> <span class="dv">2</span>),</span>
<span id="cb52-98"><a href="#cb52-98" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> autism_complete,</span>
<span id="cb52-99"><a href="#cb52-99" aria-hidden="true" tabindex="-1"></a>                       <span class="at">weights =</span> <span class="fu">varIdent</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> age))</span>
<span id="cb52-100"><a href="#cb52-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-101"><a href="#cb52-101" aria-hidden="true" tabindex="-1"></a>autism_lme_quad_id_slope2_noint_nocor_car1 <span class="ot">&lt;-</span> <span class="fu">lme</span>(vsae <span class="sc">~</span> age<span class="sc">*</span>sicdegp <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">:</span>sicdegp,</span>
<span id="cb52-102"><a href="#cb52-102" aria-hidden="true" tabindex="-1"></a>                       <span class="at">random =</span> <span class="fu">list</span>(<span class="at">childid =</span> <span class="fu">pdDiag</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">0</span> <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>))), <span class="co"># random linear and quadratic term, no intercept</span></span>
<span id="cb52-103"><a href="#cb52-103" aria-hidden="true" tabindex="-1"></a>                       <span class="at">correlation =</span> <span class="fu">corCAR1</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> childid),</span>
<span id="cb52-104"><a href="#cb52-104" aria-hidden="true" tabindex="-1"></a>                       <span class="at">data =</span> autism_complete,</span>
<span id="cb52-105"><a href="#cb52-105" aria-hidden="true" tabindex="-1"></a>                       <span class="at">weights =</span> <span class="fu">varIdent</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> age))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-32_0ebfaf3d05294545db42020f0a2c643b">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r fold-hide code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>autism_lme_cor_ic <span class="ot">&lt;-</span> <span class="fu">AIC</span>(</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  autism_lmer_quad_id_slope2,</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  autism_lme_quad_id_slope2_noint_het,</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  autism_lme_quad_id_slope2_noint_het2,</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  autism_lme_quad_id_slope2_noint_nocor,</span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  autism_lme_quad_id_slope2_noint_nocor_het,</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  autism_lme_quad_id_slope2_noint_nocor_het2,</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>     autism_lme_quad_id_slope2_noint_nocor_ma1,</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>     autism_lme_quad_id_slope2_noint_nocor_ma2,</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>     autism_lme_quad_id_slope2_noint_nocor_ar1,</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>  autism_lme_quad_id_slope2_noint_nocor_ar1ma2,</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>     autism_lme_quad_id_slope2_noint_nocor_car1) <span class="sc">%&gt;%</span> </span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_column</span>(<span class="at">BIC =</span> <span class="fu">BIC</span>(</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>  autism_lmer_quad_id_slope2,</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>  autism_lme_quad_id_slope2_noint_het,</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>  autism_lme_quad_id_slope2_noint_het2,</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>    autism_lme_quad_id_slope2_noint_nocor,</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>    autism_lme_quad_id_slope2_noint_nocor_het,</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>  autism_lme_quad_id_slope2_noint_nocor_het2,</span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>    autism_lme_quad_id_slope2_noint_nocor_ma1,</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>    autism_lme_quad_id_slope2_noint_nocor_ma2,</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>    autism_lme_quad_id_slope2_noint_nocor_ar1,</span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>    autism_lme_quad_id_slope2_noint_nocor_ar1ma2,</span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>    autism_lme_quad_id_slope2_noint_nocor_car1)<span class="sc">$</span>BIC)</span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning in AIC.default(autism_lmer_quad_id_slope2,</span></span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a><span class="do">## autism_lme_quad_id_slope2_noint_het, : models are not all fitted to the same</span></span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a><span class="do">## number of observations</span></span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning in BIC.default(autism_lmer_quad_id_slope2,</span></span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a><span class="do">## autism_lme_quad_id_slope2_noint_het, : models are not all fitted to the same</span></span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a><span class="do">## number of observations</span></span>
<span id="cb53-31"><a href="#cb53-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-32"><a href="#cb53-32" aria-hidden="true" tabindex="-1"></a>autism_lme_cor_ic <span class="sc">%&gt;%</span> <span class="fu">kbl</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb53-33"><a href="#cb53-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_classic</span>(<span class="at">full_width=</span>F) <span class="sc">%&gt;%</span> </span>
<span id="cb53-34"><a href="#cb53-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">3</span>, <span class="at">color =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"red"</span>)[<span class="fu">as.numeric</span>(autism_lme_cor_ic<span class="sc">$</span>AIC <span class="sc">==</span> <span class="fu">min</span>(autism_lme_cor_ic<span class="sc">$</span>AIC)) <span class="sc">+</span> <span class="dv">1</span>]) <span class="sc">%&gt;%</span></span>
<span id="cb53-35"><a href="#cb53-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">column_spec</span>(<span class="dv">4</span>, <span class="at">color =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"red"</span>)[<span class="fu">as.numeric</span>(autism_lme_cor_ic<span class="sc">$</span>BIC <span class="sc">==</span> <span class="fu">min</span>(autism_lme_cor_ic<span class="sc">$</span>BIC)) <span class="sc">+</span> <span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<table class=" lightable-classic" style="font-family: &quot;Arial Narrow&quot;, &quot;Source Sans Pro&quot;, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> df </th>
   <th style="text-align:right;"> AIC </th>
   <th style="text-align:right;"> BIC </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> autism_lmer_quad_id_slope2 </td>
   <td style="text-align:right;"> 16 </td>
   <td style="text-align:right;color: black !important;"> 4639.983 </td>
   <td style="text-align:right;color: black !important;"> 4710.598 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> autism_lme_quad_id_slope2_noint_het </td>
   <td style="text-align:right;"> 17 </td>
   <td style="text-align:right;color: black !important;"> 4484.389 </td>
   <td style="text-align:right;color: black !important;"> 4559.165 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> autism_lme_quad_id_slope2_noint_het2 </td>
   <td style="text-align:right;"> 14 </td>
   <td style="text-align:right;color: black !important;"> 4536.707 </td>
   <td style="text-align:right;color: black !important;"> 4598.287 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> autism_lme_quad_id_slope2_noint_nocor </td>
   <td style="text-align:right;"> 12 </td>
   <td style="text-align:right;color: black !important;"> 4678.391 </td>
   <td style="text-align:right;color: black !important;"> 4731.174 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> autism_lme_quad_id_slope2_noint_nocor_het </td>
   <td style="text-align:right;"> 16 </td>
   <td style="text-align:right;color: red !important;"> 4482.832 </td>
   <td style="text-align:right;color: red !important;"> 4553.209 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> autism_lme_quad_id_slope2_noint_nocor_het2 </td>
   <td style="text-align:right;"> 16 </td>
   <td style="text-align:right;color: red !important;"> 4482.832 </td>
   <td style="text-align:right;color: red !important;"> 4553.209 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> autism_lme_quad_id_slope2_noint_nocor_ma1 </td>
   <td style="text-align:right;"> 17 </td>
   <td style="text-align:right;color: black !important;"> 4483.408 </td>
   <td style="text-align:right;color: black !important;"> 4558.184 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> autism_lme_quad_id_slope2_noint_nocor_ma2 </td>
   <td style="text-align:right;"> 18 </td>
   <td style="text-align:right;color: black !important;"> 4484.452 </td>
   <td style="text-align:right;color: black !important;"> 4563.627 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> autism_lme_quad_id_slope2_noint_nocor_ar1 </td>
   <td style="text-align:right;"> 17 </td>
   <td style="text-align:right;color: black !important;"> 4483.537 </td>
   <td style="text-align:right;color: black !important;"> 4558.313 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> autism_lme_quad_id_slope2_noint_nocor_ar1ma2 </td>
   <td style="text-align:right;"> 19 </td>
   <td style="text-align:right;color: black !important;"> 4486.409 </td>
   <td style="text-align:right;color: black !important;"> 4569.982 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> autism_lme_quad_id_slope2_noint_nocor_car1 </td>
   <td style="text-align:right;"> 17 </td>
   <td style="text-align:right;color: black !important;"> 4483.531 </td>
   <td style="text-align:right;color: black !important;"> 4558.307 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>It seems like our efforts paid off by improving the model, but some of the parameterizations did not improve the fit as much as we may have been hoping. Many are quite close, so I honestly believe we’ve done most of the corrections appropriate for this model and we’re fighting for scraps now, at least with these modeling techniques. The best fit by both AIC and BIC (among what we tried) is the simplified G model with heterogeneous structure in R.</p>
<p>If you want more formal quantification of model comparisons, use the likelihood ratio test.</p>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-33_90f62e81319c0f17cb65236ae3160ce7">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(autism_lme_quad_id_slope2_noint_nocor, autism_lme_quad_id_slope2_noint_nocor_het)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                                          Model df      AIC      BIC    logLik
autism_lme_quad_id_slope2_noint_nocor         1 12 4678.391 4731.174 -2327.196
autism_lme_quad_id_slope2_noint_nocor_het     2 16 4482.832 4553.209 -2225.416
                                            Test  L.Ratio p-value
autism_lme_quad_id_slope2_noint_nocor                            
autism_lme_quad_id_slope2_noint_nocor_het 1 vs 2 203.5595  &lt;.0001</code></pre>
</div>
</div>
</section>
<section id="final-model-1" class="level2" data-number="18.4">
<h2 data-number="18.4" class="anchored" data-anchor-id="final-model-1"><span class="header-section-number">18.4</span> Final Model</h2>
<p>We have probably done enough modeling to come up with a final model, we’ll use the best fit from the last iteration of improvements, though our final model that was selected from AIC/BIC still has some singularity issues and troubles with the optimizer. We’ll have to spend some extra effort to track down why that’s happening.</p>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-34_77fb292805fa5bf01fa3bb5ac7b530e7">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getVarCov</span>(autism_gls_quad_un)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Marginal variance covariance matrix
        [,1]     [,2]     [,3]     [,4]     [,5]
[1,] 10.8700   9.0082   9.3212   25.916   48.667
[2,]  9.0082  55.7270  45.7570  110.010  201.300
[3,]  9.3212  45.7570 135.7700  222.120  397.840
[4,] 25.9160 110.0100 222.1200  771.040 1197.400
[5,] 48.6670 201.3000 397.8400 1197.400 2287.700
  Standard Deviations: 3.297 7.4651 11.652 27.768 47.83 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">getVarCov</span>(autism_lme_quad_id_slope2_noint_nocor_het, <span class="at">type =</span> <span class="st">"marginal"</span>) <span class="co"># seems to reflect the pattern in covariance quite well.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>childid 1 
Marginal variance covariance matrix
        1        2       3        4        5
1 12.1870   6.9707  14.602   37.024   68.995
2  6.9707  47.3600  27.497   73.663  141.310
3 14.6020  27.4970 128.690  183.190  361.580
4 37.0240  73.6630 183.190  752.910 1104.700
5 68.9950 141.3100 361.580 1104.700 2252.800
  Standard Deviations: 3.4909 6.8819 11.344 27.439 47.464 </code></pre>
</div>
</div>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-35_d83e28c36f9bd9ef8e5055aff2a9ab7e">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(autism_lme_quad_id_slope2_noint_nocor_het, <span class="at">form =</span> <span class="fu">resid</span>(., <span class="at">type =</span> <span class="st">"normalized"</span>)<span class="sc">~</span><span class="fu">fitted</span>(.) <span class="sc">|</span> sicdegp, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">8</span>, <span class="dv">8</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="randomcoef_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-36_b2bb5edce28595f5741c134eae6a0791">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">intervals</span>(autism_lme_quad_id_slope2_noint_nocor_het)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Approximate 95% confidence intervals

 Fixed effects:
                        lower        est.     upper
(Intercept)       -2.25946345  0.77647542 3.8124143
age                1.68325878  3.26560911 4.8479594
sicdegp2          -2.31980385  1.70808682 5.7359775
sicdegp3          -7.07004509 -2.63431483 1.8014154
age:sicdegp2      -2.17606966 -0.09458308 1.9869035
age:sicdegp3       1.65369494  3.93648717 6.2192794
sicdegp1:I(age^2) -0.15892339 -0.01247629 0.1339708
sicdegp2:I(age^2) -0.08121223  0.04156100 0.1643342
sicdegp3:I(age^2) -0.13239419  0.01868912 0.1697724

 Random Effects:
  Level: childid 
                 lower      est.     upper
sd(age)      0.5372926 0.8451180 1.3293025
sd(I(age^2)) 0.2364546 0.2731189 0.3154684

 Variance function:
         lower      est.       upper
3  1.713870157 2.0708134    2.502096
5  2.243430178 2.8094052    3.518165
9  4.001851151 5.0275041    6.316026
13 0.000146793 0.4443621 1345.144133

 Within-group standard error:
   lower     est.    upper 
2.460852 2.852393 3.306230 </code></pre>
</div>
</div>
<p>it seems like the variance function confidence interval for age is quite wide, which hints to where the singularity the optimizer was warning about.</p>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-39_31482202cc4c6d05944db45804642111">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># try this model instead</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>alt_mod <span class="ot">&lt;-</span> <span class="fu">lmer</span>(vsae <span class="sc">~</span> age<span class="sc">*</span>sicdegp <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>)<span class="sc">:</span>sicdegp <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">+</span> age <span class="sc">+</span> <span class="fu">I</span>(age<span class="sc">^</span><span class="dv">2</span>) <span class="sc">|</span> sicdegp<span class="sc">/</span>childid), <span class="at">data =</span> autism_complete) <span class="co"># singular, corr = -1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>boundary (singular) fit: see help('isSingular')</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_redres</span>(alt_mod, <span class="at">type =</span> <span class="st">"raw_mar"</span>, <span class="at">xvar =</span> <span class="st">"age"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required namespace: testthat</code></pre>
</div>
<div class="cell-output-display">
<p><img src="randomcoef_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_redres</span>(alt_mod, <span class="at">type =</span> <span class="st">"raw_mar"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="randomcoef_files/figure-html/unnamed-chunk-39-2.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>high_idx <span class="ot">&lt;-</span> <span class="fu">fitted</span>(alt_mod) <span class="sc">&gt;</span> <span class="dv">100</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>autism_complete <span class="sc">%&gt;%</span> <span class="fu">filter</span>(high_idx)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   age vsae sicdegp childid agef
1    9  114       3       4    9
2   13  107       3      19   13
3   13  124       3      42   13
4   13  153       3      49   13
5   13  104       3      95   13
6    9  135       3     100    9
7    9  171       3     105    9
8   13  107       3     106   13
9   13  135       3     115   13
10   9  116       3     136    9
11  13  192       3     136   13
12  13  165       3     151   13
13  13  165       3     180   13
14  13  130       3     190   13
15   9  110       2      91    9
16  13  198       2      91   13
17  13  124       2      96   13
18  13  107       2     101   13
19  13  144       2     107   13
20  13  171       2     139   13
21  13  104       2     150   13
22  13  165       2     193   13
23  13  147       2     212   13
24  13  120       1      80   13
25  13  110       1     124   13
26  13  126       1     187   13
27   9  130       1     210    9</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>alt_df <span class="ot">&lt;-</span> autism_complete <span class="sc">%&gt;%</span> </span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_column</span>(<span class="at">xb =</span> <span class="fu">predict</span>(alt_mod, <span class="at">re.form =</span> <span class="cn">NA</span>),</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">xb_zb =</span> <span class="fu">predict</span>(alt_mod))</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>alt_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(high_idx) <span class="sc">%&gt;%</span> </span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(age, xb)) <span class="sc">+</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(age, vsae), <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span> </span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(age, xb_zb), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>sicdegp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="randomcoef_files/figure-html/unnamed-chunk-39-3.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">compute_redres</span>(alt_mod, <span class="at">type =</span> <span class="st">"raw_mar"</span>)[high_idx]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> [1]  51.014254   6.922364  23.922364  52.922364   3.922364  72.014254
 [7] 108.014254   6.922364  34.922364  53.014254  91.922364  64.922364
[13]  64.922364  29.922364  76.881986 148.440308  74.440308  57.440308
[19]  94.440308 121.440308  54.440308 115.440308  97.440308  78.275818
[25]  68.275818  84.275818 102.239244</code></pre>
</div>
</div>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-40_7791562ac0520a1253d848d31b65c575">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>autism_complete</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>    age vsae sicdegp childid agef
1     2    6       3       1    2
2     3    7       3       1    3
3     5   18       3       1    5
4     9   25       3       1    9
5    13   27       3       1   13
6     2   17       3       3    2
7     3   18       3       3    3
8     5   12       3       3    5
9     9   18       3       3    9
10   13   24       3       3   13
11    2   12       3       4    2
12    3   14       3       4    3
13    5   38       3       4    5
14    9  114       3       4    9
15    2   17       3      19    2
16    3   27       3      19    3
17    9   75       3      19    9
18   13  107       3      19   13
19    2   11       3      21    2
20    3   21       3      21    3
21    9   50       3      21    9
22   13   69       3      21   13
23    2    8       3      27    2
24    3   17       3      27    3
25    5   24       3      27    5
26    9   31       3      27    9
27   13   29       3      27   13
28    2   11       3      36    2
29    3   17       3      36    3
30    9   15       3      36    9
31    2   10       3      42    2
32    3   27       3      42    3
33    9   77       3      42    9
34   13  124       3      42   13
35    2   13       3      46    2
36    3   26       3      46    3
37    5   71       3      46    5
38    9   31       3      46    9
39   13   77       3      46   13
40    2   19       3      48    2
41    3   22       3      48    3
42    5   26       3      48    5
43    9   52       3      48    9
44    2    9       3      49    2
45    3   26       3      49    3
46    5   77       3      49    5
47    9   81       3      49    9
48   13  153       3      49   13
49    2   10       3      51    2
50    3   20       3      51    3
51    5   21       3      51    5
52    3   16       3      60    3
53    9   34       3      60    9
54   13   66       3      60   13
55    2   16       3      61    2
56    5   33       3      61    5
57    2   10       3      62    2
58    3   19       3      62    3
59    5   25       3      62    5
60    9   67       3      62    9
61   13   88       3      62   13
62    2   11       3      78    2
63    3   12       3      78    3
64    5   15       3      78    5
65    2   12       3      95    2
66    3   18       3      95    3
67    5   38       3      95    5
68    9   73       3      95    9
69   13  104       3      95   13
70    2   14       3      97    2
71    3   11       3      97    3
72    5   25       3      97    5
73    9   67       3      97    9
74   13   50       3      97   13
75    2   15       3     100    2
76    3   24       3     100    3
77    5   37       3     100    5
78    9  135       3     100    9
79    2   17       3     105    2
80    5   65       3     105    5
81    9  171       3     105    9
82    2   10       3     106    2
83    3   39       3     106    3
84    9   63       3     106    9
85   13  107       3     106   13
86    2   15       3     115    2
87    3   24       3     115    3
88    9   71       3     115    9
89   13  135       3     115   13
90    2   20       3     122    2
91    3   21       3     122    3
92    5   34       3     122    5
93    9   65       3     122    9
94   13   81       3     122   13
95    2    9       3     123    2
96    3   13       3     123    3
97    9   27       3     123    9
98   13   66       3     123   13
99    2   13       3     131    2
100   3   31       3     131    3
101   5   22       3     131    5
102   9   50       3     131    9
103  13   71       3     131   13
104   2   12       3     133    2
105   3   18       3     133    3
106   5   22       3     133    5
107   2    9       3     136    2
108   3   33       3     136    3
109   9  116       3     136    9
110  13  192       3     136   13
111   2   12       3     141    2
112   3   15       3     141    3
113   5   26       3     141    5
114   9   53       3     141    9
115  13   72       3     141   13
116   2   18       3     151    2
117   3   20       3     151    3
118   5   33       3     151    5
119   9  101       3     151    9
120  13  165       3     151   13
121   2   15       3     154    2
122   3   20       3     154    3
123   5   36       3     154    5
124   2   13       3     158    2
125   3   24       3     158    3
126   5   37       3     158    5
127   9   57       3     158    9
128   2   12       3     174    2
129   3   20       3     174    3
130   5   39       3     174    5
131   9   90       3     174    9
132   2   15       3     180    2
133   3   63       3     180    3
134   9   68       3     180    9
135  13  165       3     180   13
136   2   11       3     182    2
137   3   19       3     182    3
138   9   26       3     182    9
139  13   39       3     182   13
140   2   15       3     183    2
141   3   22       3     183    3
142   5   35       3     183    5
143   9   65       3     183    9
144  13   62       3     183   13
145   2    8       3     190    2
146   3   22       3     190    3
147   5   35       3     190    5
148   9   69       3     190    9
149  13  130       3     190   13
150   2    8       3     195    2
151   3   19       3     195    3
152   9   59       3     195    9
153   2    8       3     198    2
154   3   14       3     198    3
155   9   34       3     198    9
156  13   55       3     198   13
157   2   12       3     201    2
158   3   14       3     201    3
159   5   38       3     201    5
160   9   93       3     201    9
161   2    8       3     207    2
162   3   14       3     207    3
163   9   22       3     207    9
164  13   48       3     207   13
165   2   15       3     211    2
166   2   12       2       9    2
167   3   21       2       9    3
168   9   66       2       9    9
169  13   68       2       9   13
170   2    7       2      12    2
171   3   10       2      12    3
172   5    8       2      12    5
173   2   12       2      14    2
174   3   19       2      14    3
175   5   14       2      14    5
176   9   28       2      14    9
177  13   68       2      14   13
178   2   13       2      15    2
179   3    8       2      15    3
180   5   29       2      15    5
181   9   24       2      15    9
182  13   44       2      15   13
183   2    7       2      16    2
184   3    6       2      16    3
185   9   39       2      16    9
186  13   24       2      16   13
187   2    5       2      17    2
188   3   10       2      17    3
189   5   29       2      17    5
190   9   32       2      17    9
191  13   67       2      17   13
192   2   10       2      18    2
193   3    6       2      18    3
194   2   11       2      24    2
195   3   13       2      24    3
196   5   20       2      24    5
197   9   33       2      24    9
198   2    3       2      28    2
199   3   10       2      28    3
200   5   17       2      28    5
201  13   42       2      28   13
202   2   10       2      30    2
203   3   15       2      30    3
204   9   40       2      30    9
205  13  101       2      30   13
206   2    7       2      33    2
207   3   10       2      33    3
208   5   12       2      33    5
209   9   15       2      33    9
210  13   10       2      33   13
211   2    7       2      35    2
212   3   10       2      35    3
213   2    6       2      37    2
214  13   15       2      37   13
215   2    7       2      39    2
216   3   12       2      39    3
217   5    9       2      39    5
218   9    6       2      39    9
219   2    8       2      40    2
220   3   22       2      40    3
221   5   24       2      40    5
222   9   54       2      40    9
223  13   54       2      40   13
224   2   17       2      44    2
225   3   18       2      44    3
226   9   21       2      44    9
227   2    8       2      47    2
228   3    9       2      47    3
229   5   19       2      47    5
230   2    7       2      55    2
231   3    9       2      55    3
232   5   13       2      55    5
233   9   29       2      55    9
234  13   36       2      55   13
235   2   10       2      58    2
236   3   19       2      58    3
237   9   53       2      58    9
238  13   95       2      58   13
239   2    6       2      63    2
240   3    7       2      63    3
241   5   14       2      63    5
242   9   32       2      63    9
243   2    7       2      64    2
244   3   14       2      64    3
245   5    9       2      64    5
246  13   40       2      64   13
247   2    6       2      65    2
248   3   10       2      65    3
249   5   11       2      65    5
250   9   15       2      65    9
251   2    3       2      67    2
252   3   11       2      67    3
253   9   15       2      67    9
254  13   17       2      67   13
255   2   14       2      76    2
256   3   21       2      76    3
257   5   22       2      76    5
258   2    9       2      81    2
259   3   13       2      81    3
260   9   22       2      81    9
261  13   44       2      81   13
262   2   10       2      85    2
263   5   22       2      85    5
264   2   12       2      87    2
265   3   27       2      87    3
266   5   18       2      87    5
267   9    8       2      87    9
268  13    9       2      87   13
269   2   10       2      91    2
270   3   25       2      91    3
271   9  110       2      91    9
272  13  198       2      91   13
273   2    6       2      92    2
274   5    4       2      92    5
275   9   15       2      92    9
276  13   18       2      92   13
277   2   17       2      96    2
278   3   18       2      96    3
279   5   27       2      96    5
280   9   66       2      96    9
281  13  124       2      96   13
282   2    8       2     101    2
283   3   24       2     101    3
284   9   75       2     101    9
285  13  107       2     101   13
286   2   12       2     107    2
287   3   15       2     107    3
288   5   31       2     107    5
289  13  144       2     107   13
290   2   10       2     108    2
291   3   20       2     108    3
292   9   40       2     108    9
293  13   73       2     108   13
294   2   12       2     110    2
295   3   22       2     110    3
296   9   63       2     110    9
297  13   44       2     110   13
298   2   11       2     113    2
299   3   13       2     113    3
300   5   10       2     113    5
301   9   18       2     113    9
302  13   24       2     113   13
303   2    1       2     116    2
304   3    9       2     116    3
305   9   15       2     116    9
306  13   14       2     116   13
307   2    4       2     119    2
308   3    6       2     119    3
309   5   12       2     119    5
310   2   12       2     120    2
311   3    9       2     120    3
312   5    8       2     120    5
313   2    9       2     126    2
314   3    8       2     126    3
315   5   18       2     126    5
316   9   12       2     126    9
317   2    9       2     128    2
318   3   14       2     128    3
319   9   14       2     128    9
320   2    4       2     129    2
321   3   14       2     129    3
322   2   13       2     139    2
323   3   18       2     139    3
324   5   30       2     139    5
325   9   73       2     139    9
326  13  171       2     139   13
327   2    3       2     142    2
328   3   13       2     142    3
329   9   12       2     142    9
330  13   17       2     142   13
331   2    7       2     145    2
332   3    8       2     145    3
333   5   12       2     145    5
334   9   21       2     145    9
335  13   28       2     145   13
336   2   11       2     146    2
337   3   18       2     146    3
338   9   21       2     146    9
339  13   32       2     146   13
340   2    9       2     147    2
341   3   12       2     147    3
342   5   11       2     147    5
343   9   13       2     147    9
344   2    6       2     148    2
345   3    9       2     148    3
346   5    9       2     148    5
347   9   21       2     148    9
348  13   15       2     148   13
349   2   18       2     150    2
350   3   21       2     150    3
351   5   35       2     150    5
352   9   66       2     150    9
353  13  104       2     150   13
354   2    7       2     152    2
355   3   18       2     152    3
356   9   10       2     152    9
357  13   24       2     152   13
358   2   10       2     155    2
359   3   25       2     155    3
360   9   59       2     155    9
361  13   40       2     155   13
362   2   10       2     159    2
363   3   11       2     159    3
364   5   16       2     159    5
365   2    8       2     165    2
366   3   13       2     165    3
367   9   18       2     165    9
368   2    6       2     169    2
369   3    9       2     169    3
370   5   17       2     169    5
371   9   13       2     169    9
372  13   14       2     169   13
373   2    7       2     170    2
374   3   14       2     170    3
375   2    9       2     173    2
376   3   11       2     173    3
377   2    4       2     175    2
378   3   10       2     175    3
379   5   24       2     175    5
380   9   33       2     175    9
381  13   54       2     175   13
382   2   15       2     178    2
383   3   15       2     178    3
384   9   54       2     178    9
385   2   11       2     181    2
386   3   11       2     181    3
387   5   26       2     181    5
388   9   13       2     181    9
389   2    8       2     191    2
390   3   11       2     191    3
391   5   11       2     191    5
392   9   12       2     191    9
393  13   14       2     191   13
394   3   39       2     193    3
395  13  165       2     193   13
396   2    5       2     194    2
397   3   13       2     194    3
398   2    7       2     196    2
399   3   12       2     196    3
400   9   15       2     196    9
401  13    9       2     196   13
402   2    9       2     204    2
403   3   10       2     204    3
404   5   17       2     204    5
405   9   26       2     204    9
406   2   11       2     205    2
407   3   15       2     205    3
408   9   18       2     205    9
409  13   66       2     205   13
410   2   10       2     208    2
411   3   13       2     208    3
412   2    2       2     209    2
413   3    4       2     209    3
414   9   12       2     209    9
415  13   32       2     209   13
416   2    7       2     212    2
417   3   21       2     212    3
418   5   29       2     212    5
419   9   72       2     212    9
420  13  147       2     212   13
421   2    6       1       2    2
422   3    7       1       2    3
423   5    7       1       2    5
424   9    8       1       2    9
425  13   14       1       2   13
426   2    6       1       6    2
427   3   12       1       6    3
428   9   12       1       6    9
429  13   45       1       6   13
430   2    9       1       8    2
431   3   12       1       8    3
432   5   14       1       8    5
433   2    9       1      10    2
434   3   11       1      10    3
435   9   18       1      10    9
436  13   39       1      10   13
437   2    6       1      13    2
438   3   10       1      13    3
439   5   12       1      13    5
440   2   11       1      22    2
441   3   14       1      22    3
442   5   22       1      22    5
443   2    6       1      31    2
444   3   13       1      31    3
445   5   15       1      31    5
446   9   54       1      31    9
447   2    5       1      32    2
448   3   11       1      32    3
449   5   12       1      32    5
450   2   10       1      38    2
451   3    6       1      38    3
452   5   11       1      38    5
453   9    3       1      38    9
454  13    8       1      38   13
455   2    8       1      41    2
456   3   23       1      41    3
457   5   28       1      41    5
458   2    6       1      43    2
459   3    9       1      43    3
460   5   10       1      43    5
461   9   10       1      43    9
462  13   15       1      43   13
463   2    5       1      45    2
464   3   10       1      45    3
465   9   13       1      45    9
466  13   16       1      45   13
467   2    9       1      50    2
468   3   14       1      50    3
469   9   15       1      50    9
470  13   54       1      50   13
471   2    7       1      57    2
472   3   11       1      57    3
473   5   15       1      57    5
474   9   26       1      57    9
475   2    7       1      59    2
476   3    8       1      59    3
477   5   26       1      59    5
478   9   11       1      59    9
479  13   12       1      59   13
480   2    6       1      66    2
481   3    9       1      66    3
482   5   12       1      66    5
483   9   11       1      66    9
484  13   13       1      66   13
485   2    7       1      70    2
486   3   11       1      70    3
487   9    7       1      70    9
488   2    5       1      71    2
489   3   11       1      71    3
490   9   42       1      71    9
491   2   10       1      77    2
492   3   12       1      77    3
493   5   13       1      77    5
494   9   16       1      77    9
495  13   83       1      77   13
496   2   13       1      80    2
497   3   45       1      80    3
498   9   73       1      80    9
499  13  120       1      80   13
500   2   10       1      82    2
501   3    8       1      82    3
502   5   12       1      82    5
503   9   14       1      82    9
504   2    5       1      86    2
505   3   10       1      86    3
506   5   13       1      86    5
508   2    4       1      88    2
509   3   12       1      88    3
510   2    9       1      99    2
511   3   13       1      99    3
512   5   10       1      99    5
513   9   12       1      99    9
514   2   12       1     104    2
515   3   14       1     104    3
516   5   13       1     104    5
517   9   21       1     104    9
518   2    6       1     109    2
519   3    5       1     109    3
520   5    6       1     109    5
521   9    7       1     109    9
522  13    8       1     109   13
523   2   10       1     111    2
524   3   10       1     111    3
525   5   12       1     111    5
526   9   13       1     111    9
527  13   12       1     111   13
528   2    7       1     112    2
529   3    7       1     112    3
530   5   11       1     112    5
531   9   16       1     112    9
532   2    6       1     114    2
533   2    9       1     117    2
534   3   12       1     117    3
535   9   12       1     117    9
536  13   12       1     117   13
537   2    5       1     124    2
538   9  114       1     124    9
539  13  110       1     124   13
540   2    4       1     134    2
541   3   12       1     134    3
542   9   23       1     134    9
543  13   21       1     134   13
544   2    4       1     135    2
545   3   10       1     135    3
546   9   13       1     135    9
547  13   35       1     135   13
548   2    5       1     143    2
549   3   11       1     143    3
550   9   20       1     143    9
551  13   45       1     143   13
552   2    8       1     153    2
554   5   17       1     153    5
555   9   22       1     153    9
556  13   29       1     153   13
557   2    8       1     156    2
558   3   16       1     156    3
559   5   42       1     156    5
560   2   13       1     161    2
561   3   15       1     161    3
562   5   30       1     161    5
563  13   79       1     161   13
564   2    4       1     167    2
565   3    8       1     167    3
566   2    1       1     168    2
567   3    6       1     168    3
568   5   12       1     168    5
569   9   11       1     168    9
570  13   10       1     168   13
571   2    4       1     171    2
572   3    8       1     171    3
573   5   16       1     171    5
574   9   33       1     171    9
575  13   49       1     171   13
576   2    7       1     172    2
577   3   11       1     172    3
578   9   10       1     172    9
579  13   15       1     172   13
580   2    1       1     179    2
581   3    6       1     179    3
582   5    7       1     179    5
583  13    7       1     179   13
584   2    4       1     184    2
585   3   12       1     184    3
586   5   13       1     184    5
587   9   15       1     184    9
588   2    6       1     185    2
589   3   15       1     185    3
590   9   18       1     185    9
591  13   42       1     185   13
592   2    9       1     186    2
593   3   18       1     186    3
594   5   19       1     186    5
595   9   20       1     186    9
596   2    6       1     187    2
597   3   13       1     187    3
598   9   65       1     187    9
599  13  126       1     187   13
600   2    9       1     197    2
601   3   12       1     197    3
602   9   12       1     197    9
603  13    8       1     197   13
604   2   11       1     200    2
605   3    8       1     200    3
606   2    8       1     202    2
607   3    9       1     202    3
608   5    6       1     202    5
609  13   12       1     202   13
610   2    4       1     210    2
611   3   25       1     210    3
612   9  130       1     210    9</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="fu">fitted</span>(autism_lmer_quad_id_slope2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         1          2          3          4          5          6          7 
 12.313226  14.430375  18.241976  24.174403  27.852459  12.395592  13.304193 
         8          9         10         11         12         13         14 
 15.222047  19.460365  24.235497  16.170573  24.152411  45.161463 107.361071 
        15         16         17         18         19         20         21 
 13.629456  21.967135  73.091758 108.221079  12.989889  18.398589  49.778019 
        22         23         24         25         26         27         28 
 69.675951  12.069754  16.235883  23.062853  30.695639  30.300220  12.094076 
        29         30         31         32         33         34         35 
 13.545404  17.829659  14.166637  21.833236  77.436628 123.652032  12.602822 
        36         37         38         39         40         41         42 
 20.702286  35.199620  57.387903  70.501009  13.542575  17.920102  27.875873 
        43         44         45         46         47         48         49 
 52.590288  14.241925  25.942024  49.626245  98.130782 148.150113  13.262949 
        50         51         52         53         54         55         56 
 16.697904  24.529874  15.235062  38.083033  64.518021  13.878495  32.947150 
        57         58         59         60         61         62         63 
 13.466873  19.571263  32.311947  59.920928  90.366726  12.991207  14.447106 
        64         65         66         67         68         69         70 
 18.413099  13.640252  21.354394  37.150001  70.210506 105.230066  12.242385 
        71         72         73         74         75         76         77 
 20.135835  33.605942  51.278979  56.595781  17.139047  26.143664  50.708238 
        78         79         80         81         82         83         84 
126.058748  17.628913  69.290723 164.001448  13.789259  20.580422  67.830205 
        85         86         87         88         89         90         91 
105.523210  14.782266  20.111561  74.784843 132.850376  13.068419  20.505418 
        92         93         94         95         96         97         98 
 34.755578  60.760541  83.438364  13.600581  13.822077  33.188316  63.277493 
        99        100        101        102        103        104        105 
 13.136834  17.959221  27.905883  49.006763  71.717714  13.339514  16.786846 
       106        107        108        109        110        111        112 
 24.783822  15.485703  27.020928 114.949508 191.394498  13.165329  18.099080 
       113        114        115        116        117        118        119 
 28.288123  49.952377  73.331519  15.382148  22.903610  41.649184  93.950938 
       120        121        122        123        124        125        126 
166.000169  13.956704  20.546750  35.032095  13.207279  19.921226  33.206897 
       127        128        129        130        131        132        133 
 59.209347  14.826611  22.645858  40.851234  87.529510  15.479535  20.898888 
       134        135        136        137        138        139        140 
 85.101530 158.080933  12.584575  14.908647  29.025613  38.601241  12.372833 
       141        142        143        144        145        146        147 
 21.172602  36.424444  57.537339  66.129185  14.619951  20.064712  33.856215 
       148        149        150        151        152        153        154 
 73.047142 127.715298  13.561293  19.199636  58.990763  12.995255  15.557264 
       155        156        157        158        159        160        161 
 36.001681  54.462111  15.119631  22.468128  40.426692  89.390102  13.070192 
       162        163        164        165        166        167        168 
 13.597671  27.163064  46.111915  13.832097   9.426625  18.542731  58.677894 
       169        170        171        172        173        174        175 
 71.566596   9.245111   9.627182  10.632153  10.530568  11.251127  15.247897 
       176        177        178        179        180        181        182 
 33.464048  65.310348   9.534244  12.550592  18.564961  30.520388  42.378067 
       183        184        185        186        187        188        189 
  8.736631  14.254922  31.395095  27.612759  10.153066  13.160093  20.322694 
       190        191        192        193        194        195        196 
 39.242083  64.287056   9.493371  10.689731   9.712336  12.791451  19.247219 
       197        198        199        200        201        202        203 
 33.348907   9.614452  12.003108  17.104312  41.827684  11.398791  12.298342 
       204        205        206        207        208        209        210 
 46.635458  97.088592   8.863234  10.452103  12.784462  14.067662  10.842172 
       211        212        213        214        215        216        217 
  9.546941  11.762262   8.973412  15.439253   8.788553   9.241661   9.508242 
       218        219        220        221        222        223        224 
  7.482875   9.363647  16.219079  28.420411  46.784940  57.098625   9.309624 
       225        226        227        228        229        230        231 
 11.380442  22.737046   9.658775  12.327023  17.985555   9.510663  11.673792 
       232        233        234        235        236        237        238 
 16.197459  26.034428  36.924243  10.777448  15.131933  54.644818  93.735290 
       239        240        241        242        243        244        245 
  9.946879  11.738965  16.454198  30.408907   9.784800  10.634290  13.446794 
       246        247        248        249        250        251        252 
 39.543782   9.173339  10.138338  11.996459  15.425196   9.066062  10.446956 
       253        254        255        256        257        258        259 
 15.929162  16.914295  10.088128  14.269057  23.299460   9.848249  10.850226 
       260        261        262        263        264        265        266 
 25.166817  42.620479   9.879266  21.267206   8.679327  10.938629  14.061540 
       267        268        269        270        271        272        273 
 14.724598   7.943970  12.874612  22.403533 109.535512 196.155360   9.319229 
       274        275        276        277        278        279        280 
  9.846023  12.850566  18.486140  11.557316  16.120018  28.561203  66.706694 
       281        282        283        284        285        286        287 
122.536347  10.542735  19.081239  71.679521 108.047192  11.987365  17.383216 
       288        289        290        291        292        293        294 
 32.045666 142.305417  10.324534  13.566102  42.812639  71.640924   8.627624 
       295        296        297        298        299        300        301 
 18.879554  52.885235  49.359591   9.323848  10.358239  12.617105  17.895176 
       302        303        304        305        306        307        308 
 24.187033   8.974839  10.452840  15.109307  14.202632   9.249247  10.233207 
       309        310        311        312        313        314        315 
 12.266257   9.391514   9.589576  10.558014   8.801750  10.643243  13.288186 
       316        317        318        319        320        321        322 
 14.425899   9.024984  10.423305  15.432000   9.600511  12.834794  12.976064 
       323        324        325        326        327        328        329 
 16.228751  29.117984  80.431878 165.793013   9.124003  10.018363  14.382501 
       330        331        332        333        334        335        336 
 16.337619   9.398701  10.691067  13.528045  20.210982  28.239226   9.387462 
       337        338        339        340        341        342        343 
 11.359653  23.359869  31.519122   9.082187  10.024664  11.673147  14.024218 
       344        345        346        347        348        349        350 
  9.008839  10.724108  13.544624  16.745577  16.693090  10.670133  17.637212 
       351        352        353        354        355        356        357 
 32.485366  65.837659 104.064600   9.385313   9.666184  15.099252  22.290668 
       358        359        360        361        362        363        364 
  8.549260  18.490214  50.261778  44.896004   9.636706  11.776664  16.498147 
       365        366        367        368        369        370        371 
  9.175527  10.869210  19.002063   8.927391  10.628135  13.270822  15.520996 
       372        373        374        375        376        377        378 
 13.724235   9.707307  12.955068   9.658230  12.140647   9.799907  13.052686 
       379        380        381        382        383        384        385 
 19.967567  35.434621  53.084734  10.526255  15.286603  53.061066   8.490054 
       386        387        388        389        390        391        392 
 11.855571  16.497665  17.426083   9.066235   9.890038  11.307342  13.220742 
       393        394        395        396        397        398        399 
 13.905866  22.580534 164.298198   9.596018  12.576684   8.777818  10.734808 
       400        401        402        403        404        405        406 
 14.648869   9.803123   9.511384  11.735515  16.363946  26.341487  10.736915 
       407        408        409        410        411        412        413 
  9.456753  26.651682  61.806303   9.774011  12.777141   9.772482   8.967104 
       414        415        416        417        418        419        420 
 15.298580  30.151702  12.150547  16.758810  30.393123  75.332905 143.834228 
       421        422        423        424        425        426        427 
  7.950103   7.743019   7.753710   9.474538  13.461292   8.878659   7.835014 
       428        429        430        431        432        433        434 
 18.558896  41.885056   8.319251  10.380780  14.931520   8.519414   9.044830 
       435        436        437        438        439        440        441 
 21.104604  37.627575   8.131068   9.655584  12.942021   8.690439  12.612237 
       442        443        444        445        446        447        448 
 21.014656   9.631713  12.873242  21.893077  50.079863   8.110661   9.737559 
       449        450        451        452        453        454        455 
 13.159163   7.756369   7.626380   7.403338   7.104996   7.003642   8.910275 
       456        457        458        459        460        461        462 
 14.933917  27.312822   7.867558   8.398595   9.505249  11.896877  14.526264 
       463        464        465        466        467        468        469 
  7.822006   8.907238  13.948313  15.908728   9.108414   8.160644  22.280460 
       470        471        472        473        474        475        476 
 50.556945   8.278063  10.513856  15.282527  26.008208   7.402012  10.358043 
       477        478        479        480        481        482        483 
 14.699736  17.101654  11.128277   7.737870   8.802123  10.568715  12.654241 
       484        485        486        487        488        489        490 
 12.809556   7.583098   8.221749   8.390500   8.796311  12.593755  40.949588 
       491        492        493        494        495        496        497 
 10.018678   7.920314   8.616073  29.577545  76.632290   9.549987  18.360377 
       498        499        500        501        502        503        504 
 76.020802 119.030685   7.897566   8.973225  11.059548  14.972210   8.135320 
       505        506        508        509        510        511        512 
  9.897384  13.594502   8.248076  10.935928   7.784617   8.816855  10.617110 
       513        514        515        516        517        518        519 
 13.160734   8.133265   9.919524  13.653791  21.769312   7.800100   7.565070 
       520        521        522        523        524        525        526 
  7.246226   7.213400   7.987058   7.672886   9.091652  11.336963  13.458702 
       527        528        529        530        531        532        533 
 12.421929   8.014459   9.007845  11.174583  16.227927   8.263066   7.693886 
       534        535        536        537        538        539        540 
  8.934786  12.890696  12.204648   8.279086  97.049843 117.339002   7.701847 
       541        542        543        544        545        546        547 
 10.702548  21.566891  22.009918   8.506604   8.265251  17.191919  33.023782 
       548        549        550        551        552        554        555 
  8.668426   9.253363  23.505340  43.237478   7.987193  14.988224  22.869013 
       556        557        558        559        560        561        562 
 29.088181   9.333139  17.822941  35.177812   8.896548  14.622649  26.471353 
       563        564        565        566        567        568        569 
 79.152863   8.087710   9.743122   7.647100   8.791028  10.521940  11.755987 
       570        571        572        573        574        575        576 
 10.019664   8.524305  11.157592  17.063273  31.431060  49.207413   7.862572 
       577        578        579        580        581        582        583 
  8.428136  11.994262  14.536197   7.704075   7.924851   8.198044   7.046037 
       584        585        586        587        588        589        590 
  7.753380   9.475242  12.385761  16.073983   8.569591   9.220894  22.428053 
       591        592        593        594        595        596        597 
 40.089343   7.719017  10.848544  16.080643  22.437024  10.349085  14.826560 
       598        599        600        601        602        603        604 
 66.257393 123.940789   7.549049   9.072484  12.213593   8.593856   8.336900 
       605        606        607        608        609        610        611 
 10.023762   7.862503   7.979278   8.374183  12.105195  11.566102  24.507304 
       612 
124.684849 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(autism_lmer_quad_id_slope2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         1          2          3          4          5          6          7 
 12.313226  14.430375  18.241976  24.174403  27.852459  12.395592  13.304193 
         8          9         10         11         12         13         14 
 15.222047  19.460365  24.235497  16.170573  24.152411  45.161463 107.361071 
        15         16         17         18         19         20         21 
 13.629456  21.967135  73.091758 108.221079  12.989889  18.398589  49.778019 
        22         23         24         25         26         27         28 
 69.675951  12.069754  16.235883  23.062853  30.695639  30.300220  12.094076 
        29         30         31         32         33         34         35 
 13.545404  17.829659  14.166637  21.833236  77.436628 123.652032  12.602822 
        36         37         38         39         40         41         42 
 20.702286  35.199620  57.387903  70.501009  13.542575  17.920102  27.875873 
        43         44         45         46         47         48         49 
 52.590288  14.241925  25.942024  49.626245  98.130782 148.150113  13.262949 
        50         51         52         53         54         55         56 
 16.697904  24.529874  15.235062  38.083033  64.518021  13.878495  32.947150 
        57         58         59         60         61         62         63 
 13.466873  19.571263  32.311947  59.920928  90.366726  12.991207  14.447106 
        64         65         66         67         68         69         70 
 18.413099  13.640252  21.354394  37.150001  70.210506 105.230066  12.242385 
        71         72         73         74         75         76         77 
 20.135835  33.605942  51.278979  56.595781  17.139047  26.143664  50.708238 
        78         79         80         81         82         83         84 
126.058748  17.628913  69.290723 164.001448  13.789259  20.580422  67.830205 
        85         86         87         88         89         90         91 
105.523210  14.782266  20.111561  74.784843 132.850376  13.068419  20.505418 
        92         93         94         95         96         97         98 
 34.755578  60.760541  83.438364  13.600581  13.822077  33.188316  63.277493 
        99        100        101        102        103        104        105 
 13.136834  17.959221  27.905883  49.006763  71.717714  13.339514  16.786846 
       106        107        108        109        110        111        112 
 24.783822  15.485703  27.020928 114.949508 191.394498  13.165329  18.099080 
       113        114        115        116        117        118        119 
 28.288123  49.952377  73.331519  15.382148  22.903610  41.649184  93.950938 
       120        121        122        123        124        125        126 
166.000169  13.956704  20.546750  35.032095  13.207279  19.921226  33.206897 
       127        128        129        130        131        132        133 
 59.209347  14.826611  22.645858  40.851234  87.529510  15.479535  20.898888 
       134        135        136        137        138        139        140 
 85.101530 158.080933  12.584575  14.908647  29.025613  38.601241  12.372833 
       141        142        143        144        145        146        147 
 21.172602  36.424444  57.537339  66.129185  14.619951  20.064712  33.856215 
       148        149        150        151        152        153        154 
 73.047142 127.715298  13.561293  19.199636  58.990763  12.995255  15.557264 
       155        156        157        158        159        160        161 
 36.001681  54.462111  15.119631  22.468128  40.426692  89.390102  13.070192 
       162        163        164        165        166        167        168 
 13.597671  27.163064  46.111915  13.832097   9.426625  18.542731  58.677894 
       169        170        171        172        173        174        175 
 71.566596   9.245111   9.627182  10.632153  10.530568  11.251127  15.247897 
       176        177        178        179        180        181        182 
 33.464048  65.310348   9.534244  12.550592  18.564961  30.520388  42.378067 
       183        184        185        186        187        188        189 
  8.736631  14.254922  31.395095  27.612759  10.153066  13.160093  20.322694 
       190        191        192        193        194        195        196 
 39.242083  64.287056   9.493371  10.689731   9.712336  12.791451  19.247219 
       197        198        199        200        201        202        203 
 33.348907   9.614452  12.003108  17.104312  41.827684  11.398791  12.298342 
       204        205        206        207        208        209        210 
 46.635458  97.088592   8.863234  10.452103  12.784462  14.067662  10.842172 
       211        212        213        214        215        216        217 
  9.546941  11.762262   8.973412  15.439253   8.788553   9.241661   9.508242 
       218        219        220        221        222        223        224 
  7.482875   9.363647  16.219079  28.420411  46.784940  57.098625   9.309624 
       225        226        227        228        229        230        231 
 11.380442  22.737046   9.658775  12.327023  17.985555   9.510663  11.673792 
       232        233        234        235        236        237        238 
 16.197459  26.034428  36.924243  10.777448  15.131933  54.644818  93.735290 
       239        240        241        242        243        244        245 
  9.946879  11.738965  16.454198  30.408907   9.784800  10.634290  13.446794 
       246        247        248        249        250        251        252 
 39.543782   9.173339  10.138338  11.996459  15.425196   9.066062  10.446956 
       253        254        255        256        257        258        259 
 15.929162  16.914295  10.088128  14.269057  23.299460   9.848249  10.850226 
       260        261        262        263        264        265        266 
 25.166817  42.620479   9.879266  21.267206   8.679327  10.938629  14.061540 
       267        268        269        270        271        272        273 
 14.724598   7.943970  12.874612  22.403533 109.535512 196.155360   9.319229 
       274        275        276        277        278        279        280 
  9.846023  12.850566  18.486140  11.557316  16.120018  28.561203  66.706694 
       281        282        283        284        285        286        287 
122.536347  10.542735  19.081239  71.679521 108.047192  11.987365  17.383216 
       288        289        290        291        292        293        294 
 32.045666 142.305417  10.324534  13.566102  42.812639  71.640924   8.627624 
       295        296        297        298        299        300        301 
 18.879554  52.885235  49.359591   9.323848  10.358239  12.617105  17.895176 
       302        303        304        305        306        307        308 
 24.187033   8.974839  10.452840  15.109307  14.202632   9.249247  10.233207 
       309        310        311        312        313        314        315 
 12.266257   9.391514   9.589576  10.558014   8.801750  10.643243  13.288186 
       316        317        318        319        320        321        322 
 14.425899   9.024984  10.423305  15.432000   9.600511  12.834794  12.976064 
       323        324        325        326        327        328        329 
 16.228751  29.117984  80.431878 165.793013   9.124003  10.018363  14.382501 
       330        331        332        333        334        335        336 
 16.337619   9.398701  10.691067  13.528045  20.210982  28.239226   9.387462 
       337        338        339        340        341        342        343 
 11.359653  23.359869  31.519122   9.082187  10.024664  11.673147  14.024218 
       344        345        346        347        348        349        350 
  9.008839  10.724108  13.544624  16.745577  16.693090  10.670133  17.637212 
       351        352        353        354        355        356        357 
 32.485366  65.837659 104.064600   9.385313   9.666184  15.099252  22.290668 
       358        359        360        361        362        363        364 
  8.549260  18.490214  50.261778  44.896004   9.636706  11.776664  16.498147 
       365        366        367        368        369        370        371 
  9.175527  10.869210  19.002063   8.927391  10.628135  13.270822  15.520996 
       372        373        374        375        376        377        378 
 13.724235   9.707307  12.955068   9.658230  12.140647   9.799907  13.052686 
       379        380        381        382        383        384        385 
 19.967567  35.434621  53.084734  10.526255  15.286603  53.061066   8.490054 
       386        387        388        389        390        391        392 
 11.855571  16.497665  17.426083   9.066235   9.890038  11.307342  13.220742 
       393        394        395        396        397        398        399 
 13.905866  22.580534 164.298198   9.596018  12.576684   8.777818  10.734808 
       400        401        402        403        404        405        406 
 14.648869   9.803123   9.511384  11.735515  16.363946  26.341487  10.736915 
       407        408        409        410        411        412        413 
  9.456753  26.651682  61.806303   9.774011  12.777141   9.772482   8.967104 
       414        415        416        417        418        419        420 
 15.298580  30.151702  12.150547  16.758810  30.393123  75.332905 143.834228 
       421        422        423        424        425        426        427 
  7.950103   7.743019   7.753710   9.474538  13.461292   8.878659   7.835014 
       428        429        430        431        432        433        434 
 18.558896  41.885056   8.319251  10.380780  14.931520   8.519414   9.044830 
       435        436        437        438        439        440        441 
 21.104604  37.627575   8.131068   9.655584  12.942021   8.690439  12.612237 
       442        443        444        445        446        447        448 
 21.014656   9.631713  12.873242  21.893077  50.079863   8.110661   9.737559 
       449        450        451        452        453        454        455 
 13.159163   7.756369   7.626380   7.403338   7.104996   7.003642   8.910275 
       456        457        458        459        460        461        462 
 14.933917  27.312822   7.867558   8.398595   9.505249  11.896877  14.526264 
       463        464        465        466        467        468        469 
  7.822006   8.907238  13.948313  15.908728   9.108414   8.160644  22.280460 
       470        471        472        473        474        475        476 
 50.556945   8.278063  10.513856  15.282527  26.008208   7.402012  10.358043 
       477        478        479        480        481        482        483 
 14.699736  17.101654  11.128277   7.737870   8.802123  10.568715  12.654241 
       484        485        486        487        488        489        490 
 12.809556   7.583098   8.221749   8.390500   8.796311  12.593755  40.949588 
       491        492        493        494        495        496        497 
 10.018678   7.920314   8.616073  29.577545  76.632290   9.549987  18.360377 
       498        499        500        501        502        503        504 
 76.020802 119.030685   7.897566   8.973225  11.059548  14.972210   8.135320 
       505        506        508        509        510        511        512 
  9.897384  13.594502   8.248076  10.935928   7.784617   8.816855  10.617110 
       513        514        515        516        517        518        519 
 13.160734   8.133265   9.919524  13.653791  21.769312   7.800100   7.565070 
       520        521        522        523        524        525        526 
  7.246226   7.213400   7.987058   7.672886   9.091652  11.336963  13.458702 
       527        528        529        530        531        532        533 
 12.421929   8.014459   9.007845  11.174583  16.227927   8.263066   7.693886 
       534        535        536        537        538        539        540 
  8.934786  12.890696  12.204648   8.279086  97.049843 117.339002   7.701847 
       541        542        543        544        545        546        547 
 10.702548  21.566891  22.009918   8.506604   8.265251  17.191919  33.023782 
       548        549        550        551        552        554        555 
  8.668426   9.253363  23.505340  43.237478   7.987193  14.988224  22.869013 
       556        557        558        559        560        561        562 
 29.088181   9.333139  17.822941  35.177812   8.896548  14.622649  26.471353 
       563        564        565        566        567        568        569 
 79.152863   8.087710   9.743122   7.647100   8.791028  10.521940  11.755987 
       570        571        572        573        574        575        576 
 10.019664   8.524305  11.157592  17.063273  31.431060  49.207413   7.862572 
       577        578        579        580        581        582        583 
  8.428136  11.994262  14.536197   7.704075   7.924851   8.198044   7.046037 
       584        585        586        587        588        589        590 
  7.753380   9.475242  12.385761  16.073983   8.569591   9.220894  22.428053 
       591        592        593        594        595        596        597 
 40.089343   7.719017  10.848544  16.080643  22.437024  10.349085  14.826560 
       598        599        600        601        602        603        604 
 66.257393 123.940789   7.549049   9.072484  12.213593   8.593856   8.336900 
       605        606        607        608        609        610        611 
 10.023762   7.862503   7.979278   8.374183  12.105195  11.566102  24.507304 
       612 
124.684849 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ranef</span>(autism_lmer_quad_id_slope2)<span class="sc">$</span>childid <span class="sc">%&gt;%</span> <span class="fu">colMeans</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  (Intercept)           age      I(age^2) 
 3.224847e-13 -1.754406e-13  1.440551e-14 </code></pre>
</div>
</div>
</section>
</section>
<section id="sas-modeling" class="level1" data-number="19">
<h1 data-number="19"><span class="header-section-number">19</span> SAS Modeling</h1>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-41_dae02b57dcc2d9f2c6561bceb09465ae">
<details>
<summary>Code</summary>
<pre class="sas cell-code"><code>data autism;
INFILE "~/cals/training/autism.csv" DLM="," FIRSTOBS=2;
INPUT age vsae sicdegp childid;
agef = age;

/* Basic plotting */
proc sgpanel data=autism;
panelby sicdegp;
SERIES x=age y=vsae / group=childid;

/* R Side Modeling */
proc mixed data=autism IC plots=all method=REML;
    class sicdegp childid;
    model vsae=age|sicdegp / ddfm=kr2 solution OutPM=RanPAFit OutP=RanSSFit;
    repeated / type=un subject=childid rcorr R;
    ods output covparms = cov;
    
/* Visualize UN Covariance Matrix */
data times;
    do time1=1 to 5;
        do time2=1 to time1;
            output;
        end;
    end;

data covplot;
    merge times cov;
run;

proc sgplot data=covplot;
    title "Unstructured Covariance Estimates Line Plot";
    series x=time1 y=estimate / group=time2;

    
/* helper for modeling many R matrices */
%MACRO IC_cov (Rtype=UN);
    %let tablename=IC_&amp;Rtype;
    %let modelname=Model_&amp;Rtype;
    
    * convert types to usable string in repeated statement;
    %if &amp;Rtype=ANTE %then %let Rtypename=%str(ANTE(1));
    %else %if &amp;Rtype=AR %then %let Rtypename=%str(AR(1));
    %else %if &amp;Rtype=ARH %then %let Rtypename=%str(ARH(1));
    %else %if &amp;Rtype=SPPOW %then %let Rtypename=%str(SP(POW)(age));
    %else %let Rtypename=&amp;Rtype;    
    /* %put &amp;tablename; */
    /* %put &amp;modelname; */
    
    proc mixed data=autism IC plots=all method=REML;
    class sicdegp childid;
    model vsae=age|sicdegp / ddfm=kr2;
    repeated / type=&amp;Rtypename subject=childid rcorr R;
    ods output InfoCrit=&amp;tablename;
    
    data &amp;modelname;
        length Name $ 10;
        set &amp;tablename;
        Name="&amp;Rtype";
        keep Name Parms Neg2LogLike AIC AICC BIC CAIC HQIC;
%MEND IC_cov;

/* test different covariance structures */
%IC_cov(Rtype=UN)
%IC_cov(Rtype=CS)
%IC_cov(Rtype=ANTE);
%IC_cov(Rtype=AR);
%IC_cov(Rtype=ARH);
%IC_cov(Rtype=TOEP);
%IC_cov(Rtype=TOEPH);
%IC_cov(Rtype=SPPOW); /* not sure how to combine power + diagonal */

/* combine IC results and show table */
data model_combine;
    set Model_UN Model_CS Model_ANTE Model_AR Model_ARH Model_TOEP Model_TOEPH Model_SPPOW;
    keep Name Parms Neg2LogLike AIC AICC BIC CAIC HQIC;
    
proc print data=model_combine;

proc mixed data=autism;
class sicdegp childid;
model vsae=age|sicdegp age*age|sicdegp / ddfm=kr2;
repeated / type=UN subject=childid R;

/* G Side Modeling */
proc mixed data=autism;
class sicdegp childid;
model vsae=age|sicdegp / ddfm=kr2;
random age age*age / type=UN subject=childid G;
repeated / subject=childid R;

/* helper for modeling many G and R matrices */
%MACRO IC_G_cov (Rtype=VC, Gtype=VC, id=VCVC);
    %let tablename=IC_&amp;id;
    %let modelname=Model_&amp;id;
    
    * convert types to usable string in repeated statement;
    %if &amp;Rtype=ANTE %then %let Rtypename=%str(ANTE(1));
    %else %if &amp;Rtype=AR %then %let Rtypename=%str(AR(1));
    %else %if &amp;Rtype=ARH %then %let Rtypename=%str(ARH(1));
    %else %if &amp;Rtype=SPPOW %then %let Rtypename=%str(SP(POW)(age));
    %else %let Rtypename=&amp;Rtype;

    proc mixed data=autism IC plots=all method=REML;
    class sicdegp childid;
    model vsae=age|sicdegp age*age|sicdegp / ddfm=kr2;
    random int age age*age / type=&amp;Gtype G;
    repeated / type=&amp;Rtypename subject=childid rcorr R;
    ods output InfoCrit=&amp;tablename;
    
    data &amp;modelname;
        length Name $ 10;
        set &amp;tablename;
        Name="&amp;id";
        keep Name Parms Neg2LogLike AIC AICC BIC CAIC HQIC;
%MEND IC_G_cov;

%IC_G_cov(Rtype=VC, Gtype=UN, id=VC_UN);
%IC_G_cov(Rtype=VC, Gtype=VC, id=VC_VC);
/* %IC_G_cov(Rtype=CSH, Gtype=UN, id=CSH_UN); * optimizer issues; */

data model_G_combine;
    set Model_VC_UN Model_VC_VC;
    keep Name Parms Neg2LogLike AIC AICC BIC CAIC HQIC;
    
/* final model from R, no int, no correlation, SAS has trouble fitting */
/* proc mixed data=autism IC plots=all method=REML; */
/*  class sicdegp childid; */
/*  model vsae=age|sicdegp age*age|sicdegp / ddfm=kr2; */
/*  random age age*age / type=UN(1) G; */
/*  repeated / type=UN(1) subject=childid R; */</code></pre>
</details>
</div>
<p><a href="sas_results.html">HTML SAS Output</a></p>
</section>
<section id="other-thoughts-mixed-modeling-is-smart-averaging-to-the-pooled-model." class="level1" data-number="20">
<h1 data-number="20"><span class="header-section-number">20</span> Other thoughts: Mixed modeling is smart averaging to the pooled model.</h1>
<p>Here we’ll compare the</p>
<ol type="1">
<li>individual fixed model (lm fit for each child separately)</li>
<li>pooled fixed model</li>
<li>mixed model (with various assumptions on random effects)</li>
</ol>
<p>This idea has come up a number of times, and I’ve mentioned this plot a few times so I thought I’d actually just show the effect that’s happening with this dataset.</p>
<p>This will also offer some extra intuition as to how the structure of the G matrix is affecting the effects of the individuals</p>
<p><span class="math display">
\begin{aligned}
E[u | y] &amp;= GZ'V^{-1}(y - X\beta) \\
eBLUP(u) &amp;= \hat GZ'\hat V^{-1}(y - X\hat\beta)
\end{aligned}
</span></p>
<section id="g-effect-on-blups" class="level2" data-number="20.1">
<h2 data-number="20.1" class="anchored" data-anchor-id="g-effect-on-blups"><span class="header-section-number">20.1</span> G effect on BLUPs</h2>
<p>Let’s just look at panel 1 for simplicity of visualization.</p>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-42_ebda5011c20a1c43b0c5c79a48e45d63">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the pooled model</span></span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>autism_lm_1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(vsae <span class="sc">~</span> age, <span class="at">data =</span> autism_complete <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sicdegp <span class="sc">==</span> <span class="dv">1</span>)) <span class="co"># the pooled model</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>pooled_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">as.list</span>(<span class="fu">coef</span>(autism_lm_1)[<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span> )])) <span class="sc">%&gt;%</span> </span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"intercept"</span> <span class="ot">=</span> <span class="dv">1</span>,</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>         <span class="st">"slope"</span> <span class="ot">=</span> <span class="st">"age"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_column</span>(<span class="at">model =</span> <span class="st">"pooled"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-43_61000cebd775aeabc59a100ef47bbf37">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the individual model</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>autism_lm_id_slope_1 <span class="ot">&lt;-</span> <span class="fu">lmList</span>(vsae<span class="sc">~</span>age <span class="sc">|</span> childid, <span class="at">data =</span> autism_complete <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sicdegp <span class="sc">==</span> <span class="dv">1</span>)) <span class="co"># individual slopes model, just easier to extract coefs with this function</span></span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="co"># sig1_children &lt;- autism_complete %&gt;% filter(sicdegp == 1) %&gt;% distinct(childid) %&gt;% pull(childid) </span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>indiv_data <span class="ot">&lt;-</span> <span class="fu">coef</span>(autism_lm_id_slope_1) <span class="sc">%&gt;%</span> </span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"child_id"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"intercept"</span> <span class="ot">=</span> <span class="dv">2</span>,</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>         <span class="st">"slope"</span> <span class="ot">=</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_column</span>(<span class="at">model =</span> <span class="st">"indiv"</span>, <span class="at">.after =</span> <span class="st">"child_id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-44_466b8d524265fd24b9341b137d147dd0">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the mixed models</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a><span class="co"># G matrix affect shape of pull for "BLUPs"</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a><span class="co"># G symm</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>autism_lme_id_slope_1_un <span class="ot">&lt;-</span>  <span class="fu">lme</span>(vsae <span class="sc">~</span> age,</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>                              <span class="at">random =</span> <span class="fu">list</span>(<span class="at">childid =</span> <span class="fu">pdSymm</span>(<span class="at">form =</span> <span class="sc">~</span>age)),</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>                              <span class="at">data =</span>  autism_complete <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sicdegp <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>                              <span class="at">control =</span> <span class="fu">lmeControl</span>(<span class="at">opt =</span> <span class="st">"optim"</span>))</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a><span class="co"># G diag, het</span></span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a>autism_lme_id_slope_1_diag <span class="ot">&lt;-</span>  <span class="fu">lme</span>(vsae <span class="sc">~</span> age,</span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>                              <span class="at">random =</span> <span class="fu">list</span>(<span class="at">childid =</span> <span class="fu">pdDiag</span>(<span class="at">form =</span> <span class="sc">~</span>age)),</span>
<span id="cb84-12"><a href="#cb84-12" aria-hidden="true" tabindex="-1"></a>                              <span class="at">data =</span>  autism_complete <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sicdegp <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb84-13"><a href="#cb84-13" aria-hidden="true" tabindex="-1"></a>                              <span class="at">control =</span> <span class="fu">lmeControl</span>(<span class="at">opt =</span> <span class="st">"optim"</span>))</span>
<span id="cb84-14"><a href="#cb84-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-15"><a href="#cb84-15" aria-hidden="true" tabindex="-1"></a><span class="co"># G diag, homo</span></span>
<span id="cb84-16"><a href="#cb84-16" aria-hidden="true" tabindex="-1"></a>autism_lme_id_slope_1_ident <span class="ot">&lt;-</span> <span class="fu">lme</span>(vsae <span class="sc">~</span> age,</span>
<span id="cb84-17"><a href="#cb84-17" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">random =</span> <span class="fu">list</span>(<span class="at">childid =</span> <span class="fu">pdIdent</span>(<span class="at">form =</span> <span class="sc">~</span>age)),</span>
<span id="cb84-18"><a href="#cb84-18" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">data =</span>  autism_complete <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sicdegp <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb84-19"><a href="#cb84-19" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">control =</span> <span class="fu">lmeControl</span>(<span class="at">opt =</span> <span class="st">"optim"</span>))</span>
<span id="cb84-20"><a href="#cb84-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-21"><a href="#cb84-21" aria-hidden="true" tabindex="-1"></a><span class="co"># G CS, homo</span></span>
<span id="cb84-22"><a href="#cb84-22" aria-hidden="true" tabindex="-1"></a>autism_lme_id_slope_1_cs <span class="ot">&lt;-</span> <span class="fu">lme</span>(vsae <span class="sc">~</span> age,</span>
<span id="cb84-23"><a href="#cb84-23" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">random =</span> <span class="fu">list</span>(<span class="at">childid =</span> <span class="fu">pdCompSymm</span>(<span class="at">form =</span> <span class="sc">~</span>age)),</span>
<span id="cb84-24"><a href="#cb84-24" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">data =</span>  autism_complete <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sicdegp <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb84-25"><a href="#cb84-25" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">control =</span> <span class="fu">lmeControl</span>(<span class="at">opt =</span> <span class="st">"optim"</span>))</span>
<span id="cb84-26"><a href="#cb84-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-27"><a href="#cb84-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-28"><a href="#cb84-28" aria-hidden="true" tabindex="-1"></a><span class="co"># list of lme models</span></span>
<span id="cb84-29"><a href="#cb84-29" aria-hidden="true" tabindex="-1"></a>lme_models <span class="ot">&lt;-</span>  <span class="fu">list</span>(<span class="at">mixed_un =</span> autism_lme_id_slope_1_un, </span>
<span id="cb84-30"><a href="#cb84-30" aria-hidden="true" tabindex="-1"></a>                   <span class="at">mixed_diag =</span> autism_lme_id_slope_1_diag,</span>
<span id="cb84-31"><a href="#cb84-31" aria-hidden="true" tabindex="-1"></a>                   <span class="at">mixed_ident =</span> autism_lme_id_slope_1_ident,</span>
<span id="cb84-32"><a href="#cb84-32" aria-hidden="true" tabindex="-1"></a>                   <span class="at">mixed_cs =</span> autism_lme_id_slope_1_cs)</span>
<span id="cb84-33"><a href="#cb84-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-34"><a href="#cb84-34" aria-hidden="true" tabindex="-1"></a><span class="co"># mixed, fixed effects</span></span>
<span id="cb84-35"><a href="#cb84-35" aria-hidden="true" tabindex="-1"></a>mixed_data <span class="ot">&lt;-</span> lme_models <span class="sc">%&gt;%</span>  </span>
<span id="cb84-36"><a href="#cb84-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(<span class="sc">~</span><span class="fu">data.frame</span>(<span class="fu">as.list</span>(<span class="fu">fixed.effects</span>(.x))), <span class="co"># extract fixed effects as data frame</span></span>
<span id="cb84-37"><a href="#cb84-37" aria-hidden="true" tabindex="-1"></a>          <span class="at">.id =</span> <span class="st">"model"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb84-38"><a href="#cb84-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"intercept"</span> <span class="ot">=</span> <span class="dv">2</span>,</span>
<span id="cb84-39"><a href="#cb84-39" aria-hidden="true" tabindex="-1"></a>         <span class="st">"slope"</span> <span class="ot">=</span> <span class="dv">3</span>)</span>
<span id="cb84-40"><a href="#cb84-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-41"><a href="#cb84-41" aria-hidden="true" tabindex="-1"></a><span class="co"># helper function for extracting individual lines</span></span>
<span id="cb84-42"><a href="#cb84-42" aria-hidden="true" tabindex="-1"></a>get_indiv_lines <span class="ot">&lt;-</span> <span class="cf">function</span>(lme_object) {</span>
<span id="cb84-43"><a href="#cb84-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coef</span>(lme_object) <span class="sc">%&gt;%</span> <span class="fu">as.matrix</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb84-44"><a href="#cb84-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb84-45"><a href="#cb84-45" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames_to_column</span>(<span class="st">"child_id"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb84-46"><a href="#cb84-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(<span class="st">"child_id"</span>, <span class="st">`</span><span class="at">(Intercept)</span><span class="st">`</span>, <span class="st">`</span><span class="at">age</span><span class="st">`</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb84-47"><a href="#cb84-47" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="st">"intercept"</span> <span class="ot">=</span> <span class="dv">2</span>,</span>
<span id="cb84-48"><a href="#cb84-48" aria-hidden="true" tabindex="-1"></a>           <span class="st">"slope"</span> <span class="ot">=</span> <span class="dv">3</span>)</span>
<span id="cb84-49"><a href="#cb84-49" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb84-50"><a href="#cb84-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-51"><a href="#cb84-51" aria-hidden="true" tabindex="-1"></a><span class="co"># mixed model individuals</span></span>
<span id="cb84-52"><a href="#cb84-52" aria-hidden="true" tabindex="-1"></a>mixed_indiv_data <span class="ot">&lt;-</span> lme_models <span class="sc">%&gt;%</span> <span class="fu">map_dfr</span>(<span class="sc">~</span><span class="fu">get_indiv_lines</span>(.x),</span>
<span id="cb84-53"><a href="#cb84-53" aria-hidden="true" tabindex="-1"></a>                       <span class="at">.id =</span> <span class="st">"model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-45_5650b5c0d4f76bbef726b7aab14d5566">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>combined_indiv_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(indiv_data, mixed_indiv_data)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>combined_avg_data <span class="ot">&lt;-</span> combined_indiv_data <span class="sc">%&gt;%</span></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(model) <span class="sc">%&gt;%</span></span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(intercept<span class="sc">:</span>slope, mean, <span class="at">na.rm =</span> T))</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>indiv_avg_data <span class="ot">&lt;-</span> indiv_data <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(model) <span class="sc">%&gt;%</span></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(intercept<span class="sc">:</span>slope, mean, <span class="at">na.rm =</span> T))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We’ve done all the fitting, and data extraction so now we’re ready to plot and create dataframes for plotting</p>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-46_1493475cd9d08462734d8f4505cc96e8">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># hack for each specifying what data goes to which "facet" of ggplot</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="co"># needs to duplicate data that will appear in multiple facets.</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>mixed_data_facet <span class="ot">&lt;-</span> mixed_data <span class="sc">%&gt;%</span> </span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">facet_id =</span> <span class="fu">c</span>(<span class="st">"mixed_un"</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"mixed_ident"</span> <span class="ot">=</span> <span class="dv">2</span>, <span class="st">"mixed_diag"</span> <span class="ot">=</span> <span class="dv">3</span>, <span class="st">"mixed_cs"</span> <span class="ot">=</span> <span class="dv">4</span>)[model])</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>mixed_indiv_data_facet <span class="ot">&lt;-</span> mixed_indiv_data <span class="sc">%&gt;%</span></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">facet_id =</span> <span class="fu">c</span>(<span class="st">"mixed_un"</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"mixed_ident"</span> <span class="ot">=</span> <span class="dv">2</span>, <span class="st">"mixed_diag"</span> <span class="ot">=</span> <span class="dv">3</span>, <span class="st">"mixed_cs"</span> <span class="ot">=</span> <span class="dv">4</span>)[model])</span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>indiv_data_facet <span class="ot">&lt;-</span>  <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span> <span class="sc">%&gt;%</span> <span class="fu">map_dfr</span>(<span class="sc">~</span><span class="fu">add_column</span>(indiv_data, <span class="at">facet_id =</span> .)) <span class="co"># 4 copies of individual data, one for each facet</span></span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>combined_indiv_data_facet <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(mixed_indiv_data_facet, indiv_data_facet) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(model)</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a><span class="co"># ellipse level curves of G</span></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>mixed_ellipses <span class="ot">&lt;-</span> lme_models <span class="sc">%&gt;%</span> </span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">map_dfr</span>(</span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">function</span>(lme_obj) {</span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>      G_hat <span class="ot">&lt;-</span> <span class="fu">getVarCov</span>(lme_obj)</span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>      mu <span class="ot">&lt;-</span> <span class="fu">fixed.effects</span>(lme_obj) </span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ellipse</span>(G_hat, <span class="at">centre =</span> mu) <span class="sc">%&gt;%</span> </span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">as_tibble</span>(<span class="at">.name_repair =</span> <span class="sc">~</span><span class="fu">c</span>(<span class="st">"intercept"</span>, <span class="st">"slope"</span>))</span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a>    },</span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">.id =</span> <span class="st">"model"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">facet_id =</span> <span class="fu">c</span>(<span class="st">"mixed_un"</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"mixed_ident"</span> <span class="ot">=</span> <span class="dv">2</span>, <span class="st">"mixed_diag"</span> <span class="ot">=</span> <span class="dv">3</span>, <span class="st">"mixed_cs"</span> <span class="ot">=</span> <span class="dv">4</span>)[model]) <span class="co"># specify which facet for each ellipse </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-47_9e9903bbe53ed8a4676fcf4ce5e65887">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r fold-hide code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> combined_indiv_data_facet) <span class="sc">+</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(intercept, slope, <span class="at">group =</span> child_id), <span class="co"># fixed -&gt; mixed</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">ends =</span> <span class="st">"last"</span>, <span class="at">length =</span> <span class="fu">unit</span>(.<span class="dv">1</span>, <span class="st">"cm"</span>)),</span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span>.<span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(intercept, slope, <span class="at">color =</span> model, <span class="at">alpha =</span> model), <span class="co"># mixed estimates</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">pch =</span> <span class="dv">16</span>) <span class="sc">+</span> </span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(intercept, slope, <span class="at">color =</span> model, <span class="at">alpha =</span> model), <span class="co"># mixed center</span></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>             <span class="at">data =</span> mixed_data_facet, <span class="at">size =</span> <span class="dv">8</span>, <span class="at">shape =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(intercept, slope, <span class="at">color =</span> model), <span class="co"># G level ellipses</span></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">data =</span> mixed_ellipses,</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">linetype =</span> <span class="dv">2</span>,</span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> .<span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>facet_id) <span class="sc">+</span></span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#000000"</span>, <span class="st">"#E69F00"</span>, <span class="st">"#009E73"</span>, <span class="st">"#0072B2"</span>, <span class="st">"#CC79A7"</span>)) <span class="sc">+</span></span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(.<span class="dv">4</span>, <span class="fu">rep</span>(.<span class="dv">6</span>, <span class="dv">4</span>))) <span class="sc">+</span></span>
<span id="cb87-16"><a href="#cb87-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"G structure effect on mixed effect estimation"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 4 row(s) containing missing values (geom_path).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 4 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="randomcoef_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid" width="768"></p>
</div>
</div>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-48_2a1ed76884c3ae0b1871e2e00d3fb73a">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># show G hats for each of the models</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>lme_models <span class="sc">%&gt;%</span> <span class="fu">map</span>(getVarCov)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$mixed_un
Random effects variance covariance matrix
            (Intercept)     age
(Intercept)      47.664 -24.470
age             -24.470  12.565
  Standard Deviations: 6.9039 3.5447 

$mixed_diag
Random effects variance covariance matrix
            (Intercept)    age
(Intercept)    0.013694 0.0000
age            0.000000 6.4369
  Standard Deviations: 0.11702 2.5371 

$mixed_ident
Random effects variance covariance matrix
            (Intercept)    age
(Intercept)      6.4617 0.0000
age              0.0000 6.4617
  Standard Deviations: 2.542 2.542 

$mixed_cs
Random effects variance covariance matrix
            (Intercept)     age
(Intercept)      8.9804 -8.9780
age             -8.9780  8.9804
  Standard Deviations: 2.9967 2.9967 </code></pre>
</div>
</div>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-49_2cc465d23603eeb5c972eac6323db936">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>g_mu <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(intercept, slope, <span class="at">color =</span> model, <span class="at">alpha =</span> model)) <span class="sc">+</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> indiv_data, <span class="at">pch =</span> <span class="dv">16</span>) <span class="sc">+</span> </span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> mixed_data_facet, <span class="at">shape =</span> <span class="dv">4</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> pooled_data, <span class="at">shape =</span> <span class="dv">4</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#000000"</span>, <span class="st">"#E69F00"</span>, <span class="st">"#009E73"</span>, <span class="st">"#0072B2"</span>, <span class="st">"#CC79A7"</span>, <span class="st">"347827"</span>)) <span class="sc">+</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(.<span class="dv">4</span>, <span class="fu">rep</span>(.<span class="dv">6</span>, <span class="dv">5</span>)))</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>g_mu_zoom <span class="ot">&lt;-</span> g_mu <span class="sc">+</span> <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="fl">3.5</span>)) <span class="sc">+</span></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>vp_zoom <span class="ot">&lt;-</span> <span class="fu">viewport</span>(<span class="at">width =</span> .<span class="dv">3</span>, <span class="at">height =</span> .<span class="dv">3</span>, <span class="at">x =</span> .<span class="dv">67</span>, <span class="at">y =</span> .<span class="dv">85</span>)</span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(g_mu)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 rows containing missing values (geom_point).</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(g_mu_zoom, <span class="at">vp =</span> vp_zoom)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="randomcoef_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="r-effect-on-blups" class="level2" data-number="20.2">
<h2 data-number="20.2" class="anchored" data-anchor-id="r-effect-on-blups"><span class="header-section-number">20.2</span> R effect on BLUPs</h2>
<p>This section we’ll play with the estimates through “R” a little, and see how that affects the BLUPs. This should affect the BLUPs by changing the estimate of “V” in the equation:</p>
<p><span class="math display">
\begin{aligned}
E[u | y] &amp;= GZ'V^{-1}(y - X\beta) \\
eBLUP(u) &amp;= \hat GZ'\hat V^{-1}(y - X\hat\beta)
\end{aligned}
</span></p>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-50_3c05ba8e41775bfef2c8fae48a42df18">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># heterogenous</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>autism_lme_id_slope_1_ident_het <span class="ot">&lt;-</span> <span class="fu">lme</span>(vsae <span class="sc">~</span> age,</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">random =</span> <span class="fu">list</span>(<span class="at">childid =</span> <span class="fu">pdIdent</span>(<span class="at">form =</span> <span class="sc">~</span>age)),</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">data =</span>  autism_complete <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sicdegp <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">weights =</span> <span class="fu">varIdent</span>(<span class="at">form =</span> <span class="sc">~</span> age),</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">control =</span> <span class="fu">lmeControl</span>(<span class="at">opt =</span> <span class="st">"optim"</span>))</span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a>autism_lme_id_slope_1_ident_cs <span class="ot">&lt;-</span> <span class="fu">lme</span>(vsae <span class="sc">~</span> age,</span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">random =</span> <span class="fu">list</span>(<span class="at">childid =</span> <span class="fu">pdIdent</span>(<span class="at">form =</span> <span class="sc">~</span>age)),</span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">data =</span>  autism_complete <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sicdegp <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">correlation =</span> <span class="fu">corCompSymm</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> childid),</span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">control =</span> <span class="fu">lmeControl</span>(<span class="at">opt =</span> <span class="st">"optim"</span>))</span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>autism_lme_id_slope_1_ident_car <span class="ot">&lt;-</span> <span class="fu">lme</span>(vsae <span class="sc">~</span> age,</span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">random =</span> <span class="fu">list</span>(<span class="at">childid =</span> <span class="fu">pdIdent</span>(<span class="at">form =</span> <span class="sc">~</span>age)),</span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">data =</span>  autism_complete <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sicdegp <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb96-17"><a href="#cb96-17" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">correlation =</span> <span class="fu">corCAR1</span>(<span class="at">form =</span> <span class="sc">~</span> age <span class="sc">|</span> childid),</span>
<span id="cb96-18"><a href="#cb96-18" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">weights =</span> <span class="fu">varIdent</span>(<span class="at">form =</span> <span class="sc">~</span> age),</span>
<span id="cb96-19"><a href="#cb96-19" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">control =</span> <span class="fu">lmeControl</span>(<span class="at">opt =</span> <span class="st">"optim"</span>))</span>
<span id="cb96-20"><a href="#cb96-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-21"><a href="#cb96-21" aria-hidden="true" tabindex="-1"></a>autism_lme_id_slope_1_ident_un <span class="ot">&lt;-</span> <span class="fu">lme</span>(vsae <span class="sc">~</span> age,</span>
<span id="cb96-22"><a href="#cb96-22" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">random =</span> <span class="fu">list</span>(<span class="at">childid =</span> <span class="fu">pdIdent</span>(<span class="at">form =</span> <span class="sc">~</span>age)),</span>
<span id="cb96-23"><a href="#cb96-23" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">data =</span>  autism_complete <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sicdegp <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb96-24"><a href="#cb96-24" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">correlation =</span> <span class="fu">corSymm</span>(<span class="at">form =</span> <span class="sc">~</span> <span class="dv">1</span> <span class="sc">|</span> childid),</span>
<span id="cb96-25"><a href="#cb96-25" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">weights =</span> <span class="fu">varIdent</span>(<span class="at">form =</span> <span class="sc">~</span> age),</span>
<span id="cb96-26"><a href="#cb96-26" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">control =</span> <span class="fu">lmeControl</span>(<span class="at">opt =</span> <span class="st">"optim"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-51_2a67c6c0b9411db54f6d81583c82ae61">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>lme_r_models <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">mixed_r_ident =</span> autism_lme_id_slope_1_ident,</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">mixed_r_un =</span> autism_lme_id_slope_1_ident_un,</span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">mixed_r_cs =</span> autism_lme_id_slope_1_ident_cs,</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">mixed_r_car =</span> autism_lme_id_slope_1_ident_car)</span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>mixed_r_indiv_data <span class="ot">&lt;-</span> lme_r_models <span class="sc">%&gt;%</span> <span class="fu">map_dfr</span>(<span class="sc">~</span><span class="fu">get_indiv_lines</span>(.x),</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">.id =</span> <span class="st">"model"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-52_66b1f561bda4efe83634a6fbdee0ee90">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plotting dfs</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="co"># for faceting</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="co"># can use same one</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="co"># indiv_data_facet &lt;-  1:4 %&gt;% map_dfr(~add_column(indiv_data, facet_id = .)) # 4 copies of individual data, one for each facet</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>mixed_r_indiv_data_facet <span class="ot">&lt;-</span> mixed_r_indiv_data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">facet_id =</span> <span class="fu">c</span>(<span class="st">"mixed_r_ident"</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"mixed_r_un"</span> <span class="ot">=</span> <span class="dv">2</span>, <span class="st">"mixed_r_cs"</span> <span class="ot">=</span> <span class="dv">3</span>, <span class="st">"mixed_r_car"</span> <span class="ot">=</span> <span class="dv">4</span>)[model])</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>combined_r_indiv_data_facet <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(mixed_r_indiv_data_facet, indiv_data_facet) <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-53_94a4353113be291e0ac2145775c04383">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>combined_r_indiv_data_facet <span class="sc">%&gt;%</span> </span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(intercept, slope, <span class="at">color =</span> model, <span class="at">alpha =</span> model)) <span class="sc">+</span></span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_path</span>(<span class="fu">aes</span>(intercept, slope, <span class="at">group =</span> child_id),</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">ends =</span> <span class="st">"last"</span>, <span class="at">length =</span> <span class="fu">unit</span>(.<span class="dv">1</span>, <span class="st">"cm"</span>)),</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"black"</span>,</span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span>.<span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb99-7"><a href="#cb99-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">pch =</span> <span class="dv">16</span>) <span class="sc">+</span></span>
<span id="cb99-8"><a href="#cb99-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#000000"</span>, <span class="st">"#E69F00"</span>, <span class="st">"#009E73"</span>, <span class="st">"#0072B2"</span>, <span class="st">"#CC79A7"</span>)) <span class="sc">+</span></span>
<span id="cb99-9"><a href="#cb99-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_alpha_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(.<span class="dv">4</span>, <span class="fu">rep</span>(.<span class="dv">7</span>, <span class="dv">4</span>))) <span class="sc">+</span></span>
<span id="cb99-10"><a href="#cb99-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>facet_id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 4 row(s) containing missing values (geom_path).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 4 rows containing missing values (geom_point).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="randomcoef_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-54_2016d929c5d7a2e23b0fdabed8a414ea">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>lme_r_models <span class="sc">%&gt;%</span> <span class="fu">map</span>(getVarCov, <span class="at">type =</span> <span class="st">"marginal"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$mixed_r_ident
childid 2 
Marginal variance covariance matrix
        1       2       3      4       5
1  85.996  45.232  71.079 122.77  174.47
2  45.232 118.300 103.390 180.93  258.47
3  71.079 103.390 221.690 297.24  426.47
4 122.770 180.930 297.240 583.55  762.48
5 174.470 258.470 426.470 762.48 1152.20
  Standard Deviations: 9.2734 10.877 14.889 24.157 33.944 

$mixed_r_un
childid 2 
Marginal variance covariance matrix
        1      2      3      4       5
1  87.144  75.38 103.39 124.70  202.00
2  75.380 124.58 116.16 202.06  296.72
3 103.390 116.16 244.38 329.34  465.61
4 124.700 202.06 329.34 663.67  856.77
5 202.000 296.72 465.61 856.77 1322.50
  Standard Deviations: 9.3351 11.162 15.633 25.762 36.367 

$mixed_r_cs
childid 2 
Marginal variance covariance matrix
        1       2       3      4       5
1  76.107  28.296  51.154  96.87  142.59
2  28.296 104.680  79.726 148.30  216.88
3  51.154  79.726 196.110 251.16  365.45
4  96.870 148.300 251.160 516.13  662.61
5 142.590 216.880 365.450 662.61 1019.00
  Standard Deviations: 8.724 10.231 14.004 22.718 31.922 

$mixed_r_car
childid 2 
Marginal variance covariance matrix
        1       2       3      4       5
1  99.642  92.726  96.156 134.07  184.84
2  92.726 133.680 139.880 197.49  273.81
3  96.156 139.880 242.580 327.73  452.51
4 134.070 197.490 327.730 623.76  817.82
5 184.840 273.810 452.510 817.82 1222.80
  Standard Deviations: 9.9821 11.562 15.575 24.975 34.968 </code></pre>
</div>
</div>
</section>
</section>
<section id="other-thoughts-fixed-vs-random" class="level1" data-number="21">
<h1 data-number="21"><span class="header-section-number">21</span> Other thoughts: Fixed vs Random</h1>
<p>Random effects represent this “middle ground” between fixed effects and error, so there are more decisions into which level effects fall under for modeling. Can you explain the differences between the following models? All of them loosely fall under the category of “fitting line to each child”.</p>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-55_d359b9b0c417c8257954948bd174460e">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>autism_complete_3 <span class="ot">&lt;-</span> autism_complete <span class="sc">%&gt;%</span> <span class="fu">filter</span>(sicdegp <span class="sc">==</span> <span class="dv">3</span>) <span class="co"># just worry about one panel of sicdegp for now</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>mod0 <span class="ot">&lt;-</span> <span class="fu">lm</span>(vsae <span class="sc">~</span> age<span class="sc">*</span>childid, <span class="at">data =</span> autism_complete_3)</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(vsae <span class="sc">~</span> (age <span class="sc">|</span> childid), <span class="at">data =</span> autism_complete_3)</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a><span class="do">## boundary (singular) fit: see help('isSingular')</span></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>mod2 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(vsae <span class="sc">~</span> age <span class="sc">+</span> age<span class="sc">:</span>childid <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> childid), <span class="at">data =</span> autism_complete_3)</span>
<span id="cb104-7"><a href="#cb104-7" aria-hidden="true" tabindex="-1"></a>mod3 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(vsae <span class="sc">~</span> childid <span class="sc">+</span> age <span class="sc">+</span> age<span class="sc">:</span>childid <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> childid), <span class="at">data =</span> autism_complete_3)</span>
<span id="cb104-8"><a href="#cb104-8" aria-hidden="true" tabindex="-1"></a><span class="do">## fixed-effect model matrix is rank deficient so dropping 1 column / coefficient</span></span>
<span id="cb104-9"><a href="#cb104-9" aria-hidden="true" tabindex="-1"></a>mod4 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(vsae <span class="sc">~</span> age <span class="sc">+</span> (age <span class="sc">|</span> childid), <span class="at">data =</span> autism_complete_3) <span class="co"># the one I would choose</span></span>
<span id="cb104-10"><a href="#cb104-10" aria-hidden="true" tabindex="-1"></a><span class="do">## boundary (singular) fit: see help('isSingular')</span></span>
<span id="cb104-11"><a href="#cb104-11" aria-hidden="true" tabindex="-1"></a>mod5 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(vsae <span class="sc">~</span> childid <span class="sc">+</span> age <span class="sc">+</span>  (age <span class="sc">|</span> childid), <span class="at">data =</span> autism_complete_3)</span>
<span id="cb104-12"><a href="#cb104-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning in checkConv(attr(opt, "derivs"), opt$par, ctrl = control$checkConv, :</span></span>
<span id="cb104-13"><a href="#cb104-13" aria-hidden="true" tabindex="-1"></a><span class="do">## unable to evaluate scaled gradient</span></span>
<span id="cb104-14"><a href="#cb104-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning in checkConv(attr(opt, "derivs"), opt$par, ctrl = control$checkConv, :</span></span>
<span id="cb104-15"><a href="#cb104-15" aria-hidden="true" tabindex="-1"></a><span class="do">## Model failed to converge: degenerate Hessian with 1 negative eigenvalues</span></span>
<span id="cb104-16"><a href="#cb104-16" aria-hidden="true" tabindex="-1"></a>mod6 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(vsae <span class="sc">~</span> age <span class="sc">+</span> age<span class="sc">:</span>childid <span class="sc">+</span> (age <span class="sc">|</span> childid), <span class="at">data =</span> autism_complete_3)</span>
<span id="cb104-17"><a href="#cb104-17" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning in checkConv(attr(opt, "derivs"), opt$par, ctrl = control$checkConv, :</span></span>
<span id="cb104-18"><a href="#cb104-18" aria-hidden="true" tabindex="-1"></a><span class="do">## unable to evaluate scaled gradient</span></span>
<span id="cb104-19"><a href="#cb104-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb104-20"><a href="#cb104-20" aria-hidden="true" tabindex="-1"></a><span class="do">## Warning in checkConv(attr(opt, "derivs"), opt$par, ctrl = control$checkConv, :</span></span>
<span id="cb104-21"><a href="#cb104-21" aria-hidden="true" tabindex="-1"></a><span class="do">## Model failed to converge: degenerate Hessian with 1 negative eigenvalues</span></span>
<span id="cb104-22"><a href="#cb104-22" aria-hidden="true" tabindex="-1"></a>mod7 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(vsae <span class="sc">~</span> childid<span class="sc">*</span>age <span class="sc">+</span>  (age <span class="sc">|</span> childid), <span class="at">data =</span> autism_complete_3)</span>
<span id="cb104-23"><a href="#cb104-23" aria-hidden="true" tabindex="-1"></a><span class="do">## fixed-effect model matrix is rank deficient so dropping 1 column / coefficient</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>All give slightly different predictions, but similar enough in terms of functional form and information that is modeled.</p>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-56_c2918764670dd412df4168ffd915ff72">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>mod_yhat <span class="ot">&lt;-</span> autism_complete_3 <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">yhat_mod0 =</span> <span class="fu">predict</span>(mod0),</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">yhat_mod1 =</span> <span class="fu">predict</span>(mod1),</span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">yhat_mod2 =</span> <span class="fu">predict</span>(mod2),</span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">yhat_mod3 =</span> <span class="fu">predict</span>(mod3),</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">yhat_mod4 =</span> <span class="fu">predict</span>(mod4),</span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">yhat_mod5 =</span> <span class="fu">predict</span>(mod5),</span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">yhat_mod6 =</span> <span class="fu">predict</span>(mod6),</span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">yhat_mod7 =</span> <span class="fu">predict</span>(mod7), <span class="co"># mostly same as 3</span></span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a>mod_yhat <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"yhat"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a><span class="do">##   yhat_mod0 yhat_mod1 yhat_mod2 yhat_mod3 yhat_mod4 yhat_mod5 yhat_mod6</span></span>
<span id="cb105-15"><a href="#cb105-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 1  7.725962  15.58255  4.839585  7.725962  13.63232  6.220948  4.839452</span></span>
<span id="cb105-16"><a href="#cb105-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 2  9.742788  16.67122  7.268751  9.742788  15.08613  8.579824  7.268638</span></span>
<span id="cb105-17"><a href="#cb105-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 13.776442  18.84857 12.127084 13.776442  17.99374 13.297574 12.127008</span></span>
<span id="cb105-18"><a href="#cb105-18" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 21.843750  23.20327 21.843750 21.843750  23.80898 22.733076 21.843750</span></span>
<span id="cb105-19"><a href="#cb105-19" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 29.911058  27.55797 31.560416 29.911058  29.62421 32.168578 31.560492</span></span>
<span id="cb105-20"><a href="#cb105-20" aria-hidden="true" tabindex="-1"></a><span class="do">## 6 15.028846  15.79317  6.937472 15.028846  13.72317 13.134900  6.937088</span></span>
<span id="cb105-21"><a href="#cb105-21" aria-hidden="true" tabindex="-1"></a><span class="do">##   yhat_mod7</span></span>
<span id="cb105-22"><a href="#cb105-22" aria-hidden="true" tabindex="-1"></a><span class="do">## 1  7.725962</span></span>
<span id="cb105-23"><a href="#cb105-23" aria-hidden="true" tabindex="-1"></a><span class="do">## 2  9.742788</span></span>
<span id="cb105-24"><a href="#cb105-24" aria-hidden="true" tabindex="-1"></a><span class="do">## 3 13.776442</span></span>
<span id="cb105-25"><a href="#cb105-25" aria-hidden="true" tabindex="-1"></a><span class="do">## 4 21.843750</span></span>
<span id="cb105-26"><a href="#cb105-26" aria-hidden="true" tabindex="-1"></a><span class="do">## 5 29.911058</span></span>
<span id="cb105-27"><a href="#cb105-27" aria-hidden="true" tabindex="-1"></a><span class="do">## 6 15.028846</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Note that the predictions are similar between some models, but enough differences that it’s probably not “rounding” error. The closest ones are 2,6 and 3,7.</p>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-57_397ee0de08544831965051601ca9be6e">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>mod_yhat <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(vsae, <span class="fu">starts_with</span>(<span class="st">"yhat"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, value, <span class="at">group_id =</span> childid, <span class="at">color =</span> name)) <span class="sc">+</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(name<span class="sc">~</span>.)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="randomcoef_files/figure-html/unnamed-chunk-57-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>When looking at the predictions at a whole glance though, they are mostly the same, capturing all of the main trends.</p>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-58_47be63990486cef0259091a87cbd9a83">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(mod1,</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>      mod2,</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>      mod3,</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>      mod4,</span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>      mod5,</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>      mod6,</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>      mod7) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(rowname) <span class="sc">%&gt;%</span> </span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">last_col</span>(), <span class="sc">-</span>Chisq) <span class="co"># get rid of test columns</span></span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a><span class="do">## refitting model(s) with ML (instead of REML)</span></span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a><span class="do">##   rowname npar      AIC      BIC    logLik deviance Df</span></span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 1    mod1    5 1399.561 1415.091 -694.7805 1389.561 NA</span></span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a><span class="do">## 2    mod2   44 1312.159 1448.821 -612.0796 1224.159 38</span></span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 3    mod3   83 1309.771 1567.564 -571.8854 1143.771 37</span></span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a><span class="do">## 4    mod4    6 1355.623 1374.258 -671.8114 1343.623  1</span></span>
<span id="cb107-17"><a href="#cb107-17" aria-hidden="true" tabindex="-1"></a><span class="do">## 5    mod5   46 1436.483 1579.357 -672.2417 1344.483  2</span></span>
<span id="cb107-18"><a href="#cb107-18" aria-hidden="true" tabindex="-1"></a><span class="do">## 6    mod6   46 1311.218 1454.092 -609.6090 1219.218  0</span></span>
<span id="cb107-19"><a href="#cb107-19" aria-hidden="true" tabindex="-1"></a><span class="do">## 7    mod7   85 1313.771 1577.776 -571.8854 1143.771  2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The number of parameters for each of these models is wildly different, and thus the information criteria. What’s going on?</p>
<p>I think the differences in modeling are quite a little nuanced, but largely I think of this as a reframing of the fixed vs random debate. The random coefficients just make this even more confusing to me in terms of separation of the two effects… Definitionally, treating something as fixed implies that you’re interested in making inferences on those topics, whereas treating something as random is accounting for population randomness <em>in the population you want to make inferences about</em>. In experimental designs, the split is somewhat easier, because you have “experimental” components of your design like treatments you wish to distinguish, which really should be fixed effects, and everything else about your experiment, like blocks and the units you randomize your treatments to. Walter Stroup advocates an ANOVA-esque approach to this, and apparently IMS bulletins discuss this approach as “What would Fisher Do?”, Stroup calls the blocks and units the “topographical features” and the treatments “treatment features”. I think Miliken and Johnson describe a similar split with “experiemental” and “design” components of your study.</p>
<p>At the end of the day, I consider these things:</p>
<ol type="1">
<li>“inference spaces” - a matter of what population you are trying to make inferences about. What parts of the design do I truly wish to assign a probability distribution to?</li>
<li>“borrow strength” - due to the shrinkage effect, if you have blocks with complete information, and blocks with very little information, you can recover a lot by making the assumption that blocks with little information are similar to blocks with complete information. I.e, missing data situations are something you’d naturally want to attach a probability distribution to in order to make better inferences.</li>
<li>“variance implications” - modeling random effects carry forward implications about the covariance matrix of observations. Am I willing to accept that, do random effect assumptions capture population well? <a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></li>
<li>computation…</li>
</ol>
<p>The models in which <code>childid</code> appears as a fixed effect AND a random effect grouping is a little unreasonable, as those fits will be fighting for the same information. Using <code>age</code> as both a fixed and random covariate seems appropriate because there will be populational growth rate I’m interested in studying, as well as variation in that among the children I’ve measured. That leaves model 4.</p>
<p>The “randomness I’m assuming in the population” can be more clearly visualized by just showing random effect components of the estimates. We can also plot the fitted values alongside them to show the split of fixed and random among all these models!</p>
<div class="cell" data-hash="randomcoef_cache/html/unnamed-chunk-59_610bca3f96974366a1024b1ab75e7a44">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>mod_random <span class="ot">&lt;-</span> autism_complete_3 <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(</span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># yhat_mod0 = predict(mod0), # not a random effect model</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">yhat_mod1 =</span> <span class="fu">predict</span>(mod1, <span class="at">random.only =</span> T),</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">yhat_mod2 =</span> <span class="fu">predict</span>(mod2, <span class="at">random.only =</span> T),</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">yhat_mod3 =</span> <span class="fu">predict</span>(mod3, <span class="at">random.only =</span> T),</span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">yhat_mod4 =</span> <span class="fu">predict</span>(mod4, <span class="at">random.only =</span> T),</span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">yhat_mod5 =</span> <span class="fu">predict</span>(mod5, <span class="at">random.only =</span> T),</span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">yhat_mod6 =</span> <span class="fu">predict</span>(mod6, <span class="at">random.only =</span> T),</span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">yhat_mod7 =</span> <span class="fu">predict</span>(mod7, <span class="at">random.only =</span> T), <span class="co"># mostly same as 3</span></span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a>mod_fixed <span class="ot">&lt;-</span> autism_complete_3 <span class="sc">%&gt;%</span> <span class="fu">bind_cols</span>(</span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># yhat_mod0 = predict(mod0), # not a random effect model</span></span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">yhat_mod1 =</span> <span class="fu">predict</span>(mod1, <span class="at">re.form =</span> <span class="cn">NA</span>),</span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">yhat_mod2 =</span> <span class="fu">predict</span>(mod2, <span class="at">re.form =</span> <span class="cn">NA</span>),</span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">yhat_mod3 =</span> <span class="fu">predict</span>(mod3, <span class="at">re.form =</span> <span class="cn">NA</span>),</span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">yhat_mod4 =</span> <span class="fu">predict</span>(mod4, <span class="at">re.form =</span> <span class="cn">NA</span>),</span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">yhat_mod5 =</span> <span class="fu">predict</span>(mod5, <span class="at">re.form =</span> <span class="cn">NA</span>),</span>
<span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">yhat_mod6 =</span> <span class="fu">predict</span>(mod6, <span class="at">re.form =</span> <span class="cn">NA</span>),</span>
<span id="cb108-20"><a href="#cb108-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">yhat_mod7 =</span> <span class="fu">predict</span>(mod7, <span class="at">re.form =</span> <span class="cn">NA</span>), <span class="co"># mostly same as 3</span></span>
<span id="cb108-21"><a href="#cb108-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb108-22"><a href="#cb108-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-23"><a href="#cb108-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-24"><a href="#cb108-24" aria-hidden="true" tabindex="-1"></a>mod_fixed_plot <span class="ot">&lt;-</span> mod_fixed <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">"yhat"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb108-25"><a href="#cb108-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, value, <span class="at">group_id =</span> childid, <span class="at">color =</span> name)) <span class="sc">+</span></span>
<span id="cb108-26"><a href="#cb108-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb108-27"><a href="#cb108-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(name<span class="sc">~</span>.) <span class="sc">+</span> </span>
<span id="cb108-28"><a href="#cb108-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Fixed"</span>)</span>
<span id="cb108-29"><a href="#cb108-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-30"><a href="#cb108-30" aria-hidden="true" tabindex="-1"></a>mod_random_plot <span class="ot">&lt;-</span> mod_random <span class="sc">%&gt;%</span> <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">"yhat"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb108-31"><a href="#cb108-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(age, value, <span class="at">group_id =</span> childid, <span class="at">color =</span> name)) <span class="sc">+</span></span>
<span id="cb108-32"><a href="#cb108-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb108-33"><a href="#cb108-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(name<span class="sc">~</span>.) <span class="sc">+</span></span>
<span id="cb108-34"><a href="#cb108-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Random"</span>)</span>
<span id="cb108-35"><a href="#cb108-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-36"><a href="#cb108-36" aria-hidden="true" tabindex="-1"></a><span class="fu">ggarrange</span>(mod_fixed_plot, mod_random_plot, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">common.legend =</span> <span class="cn">TRUE</span>, <span class="at">legend =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="randomcoef_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>Models in which we overparameterize the fixed effects, we see no random variability. Since the whole point of using a random model is to capture the variability of the population, 2, 3, 6, 7 simply don’t reflect that distribution. The difference between 1 and 4 is simply whether or not the population randomness is centered around a population trend. In 4, they fan out around 0, because the fixed <code>age</code> accounts for the population level trend, whereas model 1 fans out above 0.</p>


</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p><a href="https://stackoverflow.com/questions/49375840/algorithm-name-in-nlminbs-port-routines">Stack Overflow</a> for more details and link to the original paper for nlminb<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>https://stats.stackexchange.com/questions/366483/why-are-random-effects-assumed-to-follow-a-normal-distribution-in-glmms<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../longitudinal/longitudinal.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Longitudinal Data Analysis</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../longitudinal/within_between.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">The Within-Between Model</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>