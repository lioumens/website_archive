<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Michael Liou">
<meta name="dcterms.date" content="2023-02-04">

<title>Personal Documentation - 35&nbsp; Time Series</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../bootstrap/bootstrap.html" rel="next">
<link href="../stochastic/ctmc.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script src="../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

</head>

<body class="nav-sidebar floating slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Time Series</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Personal Documentation</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Front Page</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../advanced/advanced.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Advanced R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../approximation/approximation.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Approximation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../bayesian/bayesian.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Bayesian</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../categorical/categorical.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Categorical Data Analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../changepoint/changepoint.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Changepoint Analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chaos/chaos.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Chaos</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../crossover/crossover.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Crossover Designs</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../diffeq/diffeq.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Differential Equations</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../epidemiology/epidemiology.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Epidemiology</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../experimentaldesign/experimentaldesign.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Experimental Design</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../exponential/exponential.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Exponential Modeling</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../gam/gam.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Generalized Additive Models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../longitudinal/longitudinal.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Longitudinal Data Analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../longitudinal/randomcoef.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Random Coefficient Models (CALS)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../longitudinal/within_between.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">The Within-Between Model</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../matrix/matrix.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Matrix Math</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../meta/meta.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Meta Analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../mixed/mixed.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Mixed Models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../mixed/mixed_variance.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Mixed Models (Variance)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../network/network_centrality.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Network Centrality</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../network/network_gnar.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">GNAR</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../next_gen_sequencing/next_gen_sequencing.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Next Generation Sequencing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../nonlinear/nonlinear.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Nonlinear</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../observable/observable.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Observable Testing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../optimization/optimization.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Optimization</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ordination/ordination.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Ordination</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallel/parallel.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Parallel Computing in R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plant_breeding/plant_breeding.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Plant Breeding</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../social_network/social_network.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Social Network Analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../spatial/carbayes.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">CARBayes</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../spatial/spatial.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Spatial Statistics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stochastic/stochastic.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Stochastic</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stochastic/ctmc.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">CTMC</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../timeseries/timeseries.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Time Series</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Draft</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../bootstrap/bootstrap.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Bootstrap</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../causal/causal.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Causal Statistics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../sensitivity/sensitivity.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title">Sensitivity Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../signal/signal.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title">Signal Processing</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Appendices</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../color/color.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Colors in R</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="toc-section-number">35.1</span>  Introduction</a>
  <ul class="collapse">
  <li><a href="#types-of-models" id="toc-types-of-models" class="nav-link" data-scroll-target="#types-of-models"><span class="toc-section-number">35.1.1</span>  Types of Models</a></li>
  <li><a href="#software" id="toc-software" class="nav-link" data-scroll-target="#software"><span class="toc-section-number">35.1.2</span>  Software</a></li>
  <li><a href="#theory" id="toc-theory" class="nav-link" data-scroll-target="#theory"><span class="toc-section-number">35.1.3</span>  Theory</a></li>
  </ul></li>
  <li><a href="#arimax" id="toc-arimax" class="nav-link" data-scroll-target="#arimax"><span class="toc-section-number">35.2</span>  ARIMAX</a>
  <ul class="collapse">
  <li><a href="#base-tools" id="toc-base-tools" class="nav-link" data-scroll-target="#base-tools"><span class="toc-section-number">35.2.1</span>  base tools</a></li>
  <li><a href="#ar1-and-ma1" id="toc-ar1-and-ma1" class="nav-link" data-scroll-target="#ar1-and-ma1"><span class="toc-section-number">35.2.2</span>  AR(1) and MA(1)</a></li>
  <li><a href="#simulated-examples" id="toc-simulated-examples" class="nav-link" data-scroll-target="#simulated-examples"><span class="toc-section-number">35.2.3</span>  Simulated Examples</a></li>
  <li><a href="#analyzing-simulations" id="toc-analyzing-simulations" class="nav-link" data-scroll-target="#analyzing-simulations"><span class="toc-section-number">35.2.4</span>  Analyzing simulations</a></li>
  <li><a href="#diagnostics" id="toc-diagnostics" class="nav-link" data-scroll-target="#diagnostics"><span class="toc-section-number">35.2.5</span>  Diagnostics</a></li>
  <li><a href="#examples-la-county" id="toc-examples-la-county" class="nav-link" data-scroll-target="#examples-la-county"><span class="toc-section-number">35.2.6</span>  Examples: LA County</a></li>
  <li><a href="#example-airpassengers" id="toc-example-airpassengers" class="nav-link" data-scroll-target="#example-airpassengers"><span class="toc-section-number">35.2.7</span>  Example: AirPassengers</a></li>
  </ul></li>
  <li><a href="#exponential-smoothing" id="toc-exponential-smoothing" class="nav-link" data-scroll-target="#exponential-smoothing"><span class="toc-section-number">35.3</span>  Exponential smoothing</a></li>
  <li><a href="#tsrepr" id="toc-tsrepr" class="nav-link" data-scroll-target="#tsrepr"><span class="toc-section-number">35.4</span>  TSrepr</a></li>
  <li><a href="#arch" id="toc-arch" class="nav-link" data-scroll-target="#arch"><span class="toc-section-number">35.5</span>  ARCH</a></li>
  <li><a href="#garch" id="toc-garch" class="nav-link" data-scroll-target="#garch"><span class="toc-section-number">35.6</span>  GARCH</a></li>
  <li><a href="#vector-autoregression" id="toc-vector-autoregression" class="nav-link" data-scroll-target="#vector-autoregression"><span class="toc-section-number">35.7</span>  Vector Autoregression</a>
  <ul class="collapse">
  <li><a href="#simulation" id="toc-simulation" class="nav-link" data-scroll-target="#simulation"><span class="toc-section-number">35.7.1</span>  Simulation</a></li>
  <li><a href="#moving-average-representations" id="toc-moving-average-representations" class="nav-link" data-scroll-target="#moving-average-representations"><span class="toc-section-number">35.7.2</span>  Moving Average Representations</a></li>
  <li><a href="#impulse-response-analysis" id="toc-impulse-response-analysis" class="nav-link" data-scroll-target="#impulse-response-analysis"><span class="toc-section-number">35.7.3</span>  Impulse Response Analysis</a></li>
  <li><a href="#example-la-county-var" id="toc-example-la-county-var" class="nav-link" data-scroll-target="#example-la-county-var"><span class="toc-section-number">35.7.4</span>  Example: LA County (VAR)</a></li>
  <li><a href="#sparsevar" id="toc-sparsevar" class="nav-link" data-scroll-target="#sparsevar"><span class="toc-section-number">35.7.5</span>  sparsevar</a></li>
  </ul></li>
  <li><a href="#state-space-model" id="toc-state-space-model" class="nav-link" data-scroll-target="#state-space-model"><span class="toc-section-number">35.8</span>  State Space Model</a>
  <ul class="collapse">
  <li><a href="#example-ar1-with-observational-noise" id="toc-example-ar1-with-observational-noise" class="nav-link" data-scroll-target="#example-ar1-with-observational-noise"><span class="toc-section-number">35.8.1</span>  Example: AR(1) with observational noise</a></li>
  </ul></li>
  <li><a href="#kalman-filter" id="toc-kalman-filter" class="nav-link" data-scroll-target="#kalman-filter"><span class="toc-section-number">35.9</span>  Kalman Filter</a>
  <ul class="collapse">
  <li><a href="#example-local-level-model" id="toc-example-local-level-model" class="nav-link" data-scroll-target="#example-local-level-model"><span class="toc-section-number">35.9.1</span>  Example: Local level Model</a></li>
  <li><a href="#estimation-of-state-parameters" id="toc-estimation-of-state-parameters" class="nav-link" data-scroll-target="#estimation-of-state-parameters"><span class="toc-section-number">35.9.2</span>  Estimation of State Parameters</a></li>
  <li><a href="#example-nile" id="toc-example-nile" class="nav-link" data-scroll-target="#example-nile"><span class="toc-section-number">35.9.3</span>  Example: Nile</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Time Series</span></h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Michael Liou </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 4, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-1_9f9cd05643ffaefe4da690725ed23b05">
<details>
<summary>Libraries and Setup</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)  <span class="co"># general data science</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glue)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)   <span class="co"># for melt function</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(astsa)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra) <span class="co"># kableExtra</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tseries)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)   <span class="co"># time series forecasting, common package</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vars)       <span class="co"># vector autoregression</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)      <span class="co"># tidy results</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sparsevar)  <span class="co"># sparse vector autoregression</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(marima)     <span class="co"># multivariate arima</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dlm)        <span class="co"># dynamic linear models</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggfortify)  <span class="co"># adds some autoplot models, overwrites many functions from forecast</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(KFAS)       <span class="co"># kalman filter, sequential univariate (fast), exponential family</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fGarch)    <span class="co"># garch models</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra) <span class="co"># Kable extra</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(TSrepr)   <span class="co"># lower dimensional representation of time series</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here) <span class="co"># for relative file finding</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co"># detach("package:forecast", unload = T)</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="fu">here</span>(<span class="st">"scripts/knit_latex.R"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="introduction" class="level2" data-number="35.1">
<h2 data-number="35.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">35.1</span> Introduction</h2>
<section id="types-of-models" class="level3" data-number="35.1.1">
<h3 data-number="35.1.1" class="anchored" data-anchor-id="types-of-models"><span class="header-section-number">35.1.1</span> Types of Models</h3>
<ul>
<li><p>Autoregression (AR)</p></li>
<li><p>Moving Average (AM)</p></li>
<li><p>Vector Autoregression (VAR)</p></li>
<li><p>HMM</p>
<ul>
<li>related to bayesian inference, special</li>
</ul></li>
<li><p>State Space Models</p>
<ul>
<li>very broad space of models that includes arima models, and dynamic linear models. Can also account for linear/nonlinear gaussian/non-gaussian errors</li>
</ul></li>
<li><p>Multivariate autoregression (MAR)</p></li>
</ul>
</section>
<section id="software" class="level3" data-number="35.1.2">
<h3 data-number="35.1.2" class="anchored" data-anchor-id="software"><span class="header-section-number">35.1.2</span> Software</h3>
<ul>
<li><code>stats</code>
<ul>
<li><code>KalmanLike</code>, <code>KalmanRun</code>, <code>KalmanSmooth</code>, <code>KalmanForecast</code></li>
</ul></li>
<li><code>dlm</code></li>
<li><code>KFAS</code></li>
</ul>
<p>See also <a href="https://www.google.com/url?sa=t&amp;rct=j&amp;q=&amp;esrc=s&amp;source=web&amp;cd=&amp;ved=2ahUKEwjng_vXx4P6AhWdk4kEHZ4KBUAQFnoECBoQAQ&amp;url=https%3A%2F%2Fwww.jstatsoft.org%2Farticle%2Fdownload%2Fv041i04%2F488&amp;usg=AOvVaw0bbJoxE4fWu74zhZs0qggz">State Space Models in R</a>.</p>
</section>
<section id="theory" class="level3" data-number="35.1.3">
<h3 data-number="35.1.3" class="anchored" data-anchor-id="theory"><span class="header-section-number">35.1.3</span> Theory</h3>
<p>Courses</p>
<ul>
<li>Kevin Kotzé’s <a href="https://www.economodel.com/time-series-analysis">Time Series Analysis Course</a>
<ul>
<li>has a great overview and description, and packaged R commands for univariate and multivariate from an economics perspective.</li>
</ul></li>
</ul>
</section>
</section>
<section id="arimax" class="level2 page-columns page-full" data-number="35.2">
<h2 data-number="35.2" class="anchored" data-anchor-id="arimax"><span class="header-section-number">35.2</span> ARIMAX</h2>
<p>The general pattern for univariate time series analysis is as follows</p>
<ol type="1">
<li>figure out how to make stationary</li>
</ol>
<ul>
<li>by trend modeling (exogenous), or differencing</li>
<li><a href="https://stats.stackexchange.com/questions/518737/durbin-vs-breusch-godfrey-test-for-autocorrelation-which-is-better">“Breusch-Godfrey”</a> : up to p order ar</li>
<li>“Durbin-Watson” : first order ar testing</li>
</ul>
<ol start="2" type="1">
<li></li>
</ol>
<section id="base-tools" class="level3" data-number="35.2.1">
<h3 data-number="35.2.1" class="anchored" data-anchor-id="base-tools"><span class="header-section-number">35.2.1</span> base tools</h3>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-2_afbf375d0dfdb3a05859f0917563e291">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># acf, ccf, pacf, arima, arima.sim</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="ar1-and-ma1" class="level3" data-number="35.2.2">
<h3 data-number="35.2.2" class="anchored" data-anchor-id="ar1-and-ma1"><span class="header-section-number">35.2.2</span> AR(1) and MA(1)</h3>
<p>Autoregressive of order 1 is the simplest time series you can have.</p>
<p><span class="math display">
\begin{aligned}
Y_t = \alpha Y_{t-1} + \varepsilon_t
\end{aligned}
</span></p>
</section>
<section id="simulated-examples" class="level3 page-columns page-full" data-number="35.2.3">
<h3 data-number="35.2.3" class="anchored" data-anchor-id="simulated-examples"><span class="header-section-number">35.2.3</span> Simulated Examples</h3>
<p>this section we’ll simulate a number of AR and MA models so that you get a better sense of what they look like.</p>
<div class="cell page-columns page-full" data-hash="timeseries_cache/html/unnamed-chunk-3_16049c08522e4ea7482dbfa065412672">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># AR models</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>sim_ar <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">p =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ar =</span> <span class="fu">list</span>(.<span class="dv">7</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">c</span>(.<span class="dv">7</span>,<span class="sc">-</span>.<span class="dv">3</span>),</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">c</span>(.<span class="dv">7</span>, <span class="sc">-</span>.<span class="dv">3</span>, .<span class="dv">5</span>)),</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">n =</span> <span class="dv">200</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">list</span>(<span class="fu">arima.sim</span>(<span class="fu">list</span>(<span class="at">ar =</span> ar), <span class="at">n =</span> <span class="dv">200</span>)),</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="fu">list</span>(<span class="fu">time</span>(y)))</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>sim_ar <span class="sc">%&gt;%</span> <span class="fu">unnest</span>(<span class="fu">c</span>(x, y)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(p<span class="sc">~</span>.)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display page-columns page-full">
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="timeseries_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption margin-caption">AR Model Simulations</figcaption><p></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-4_43e4e76543ad21b46f62dc5639d4aae8">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># MA processes</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>sim_ma <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">q =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ma =</span> <span class="fu">list</span>(.<span class="dv">7</span>,</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">c</span>(.<span class="dv">7</span>,<span class="sc">-</span>.<span class="dv">3</span>),</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>                           <span class="fu">c</span>(.<span class="dv">7</span>, <span class="sc">-</span>.<span class="dv">3</span>, .<span class="dv">5</span>)),</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">n =</span> <span class="dv">200</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">y =</span> <span class="fu">list</span>(<span class="fu">arima.sim</span>(<span class="fu">list</span>(<span class="at">ma =</span> ma), <span class="at">n =</span> <span class="dv">200</span>)),</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="fu">list</span>(<span class="fu">time</span>(y))) <span class="sc">%&gt;%</span> </span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>sim_ma <span class="sc">%&gt;%</span> <span class="fu">unnest</span>(<span class="fu">c</span>(x, y)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(q<span class="sc">~</span>.)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="timeseries_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">MA Model Simulations</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="analyzing-simulations" class="level3" data-number="35.2.4">
<h3 data-number="35.2.4" class="anchored" data-anchor-id="analyzing-simulations"><span class="header-section-number">35.2.4</span> Analyzing simulations</h3>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-5_327d5ed1feedbbed1b36f904ed2549cf">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ar1</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>ar1 <span class="ot">&lt;-</span> <span class="fu">arima.sim</span>(<span class="fu">list</span>(<span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">ar =</span> .<span class="dv">2</span>), <span class="dv">100</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">capture.output</span>(</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  mod_sar1 <span class="ot">&lt;-</span> <span class="fu">sarima</span>(ar1, <span class="at">p =</span> <span class="dv">1</span>, <span class="at">d =</span> <span class="dv">0</span>, <span class="at">q =</span> <span class="dv">0</span>) <span class="co"># asta</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="timeseries_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>mod_Ar1 <span class="ot">&lt;-</span> <span class="fu">Arima</span>(ar1, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>)) <span class="co"># forecast</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>mod_ar1 <span class="ot">&lt;-</span> <span class="fu">arima</span>(ar1, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>)) <span class="co"># base</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>(mod_Ar1) <span class="sc">|&gt;</span> <span class="fu">add_column</span>(<span class="at">model =</span> <span class="st">"forecast::Arima"</span>, <span class="at">.before =</span> <span class="dv">1</span>),</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tidy</span>(mod_ar1) <span class="sc">|&gt;</span> <span class="fu">add_column</span>(<span class="at">model =</span> <span class="st">"stats::arima"</span>, <span class="at">.before =</span> <span class="dv">1</span>),</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  mod_sar1<span class="sc">$</span>ttable[, <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="sc">|&gt;</span> </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">"term"</span>, <span class="at">.name_repair =</span> <span class="sc">~</span><span class="fu">c</span>(<span class="st">"estimate"</span>, <span class="st">"std.error"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_column</span>(<span class="at">model =</span> <span class="st">"astsa::sarima"</span>, <span class="at">.before =</span> <span class="dv">1</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(term), model) <span class="sc">|&gt;</span> </span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>() <span class="sc">|&gt;</span> <span class="fu">kable_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<table class=" lightable-minimal" style="font-family: &quot;Trebuchet MS&quot;, verdana, sans-serif; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> model </th>
   <th style="text-align:left;"> term </th>
   <th style="text-align:right;"> estimate </th>
   <th style="text-align:right;"> std.error </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> astsa::sarima </td>
   <td style="text-align:left;"> xmean </td>
   <td style="text-align:right;"> 0.1021000 </td>
   <td style="text-align:right;"> 0.1125000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> forecast::Arima </td>
   <td style="text-align:left;"> intercept </td>
   <td style="text-align:right;"> 0.1020681 </td>
   <td style="text-align:right;"> 0.1125445 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> stats::arima </td>
   <td style="text-align:left;"> intercept </td>
   <td style="text-align:right;"> 0.1020681 </td>
   <td style="text-align:right;"> 0.1125445 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> astsa::sarima </td>
   <td style="text-align:left;"> ar1 </td>
   <td style="text-align:right;"> 0.2171000 </td>
   <td style="text-align:right;"> 0.0978000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> forecast::Arima </td>
   <td style="text-align:left;"> ar1 </td>
   <td style="text-align:right;"> 0.2170632 </td>
   <td style="text-align:right;"> 0.0977980 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> stats::arima </td>
   <td style="text-align:left;"> ar1 </td>
   <td style="text-align:right;"> 0.2170632 </td>
   <td style="text-align:right;"> 0.0977980 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-6_739096b7ac30f6d84d251efaab3bc6b2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># arx1</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">sort</span>(<span class="fu">runif</span>(<span class="dv">400</span>))</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>arx1 <span class="ot">&lt;-</span> <span class="fu">arima.sim</span>(<span class="fu">list</span>(<span class="at">ar=</span>.<span class="dv">3</span>), <span class="dv">400</span>) <span class="sc">+</span> x <span class="sc">*</span> beta</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>mod_Arx1 <span class="ot">&lt;-</span> <span class="fu">Arima</span>(arx1, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">xreg =</span> x)</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>mod_arx1 <span class="ot">&lt;-</span> <span class="fu">arima</span>(arx1, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">xreg =</span> x)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">capture.output</span>(</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  mod_sarx1 <span class="ot">&lt;-</span> <span class="fu">sarima</span>(arx1, <span class="at">p =</span> <span class="dv">1</span>, <span class="at">d =</span> <span class="dv">0</span>, <span class="at">q =</span> <span class="dv">0</span>, <span class="at">xreg =</span> x)</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="timeseries_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  mod_Arx1 <span class="sc">|&gt;</span> <span class="fu">tidy</span>()<span class="sc">|&gt;</span> <span class="fu">add_column</span>(<span class="at">model =</span> <span class="st">"forecast::Arima"</span>, <span class="at">.before =</span> <span class="dv">1</span>),</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  mod_arx1 <span class="sc">|&gt;</span> <span class="fu">tidy</span>() <span class="sc">|&gt;</span> <span class="fu">add_column</span>(<span class="at">model =</span> <span class="st">"stats::arima"</span>, <span class="at">.before =</span> <span class="dv">1</span>),</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  mod_sarx1<span class="sc">$</span>ttable[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>] <span class="sc">|&gt;</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">as_tibble</span>(<span class="at">rownames =</span> <span class="st">"term"</span>, <span class="at">.name_repair =</span> <span class="sc">~</span><span class="fu">c</span>(<span class="st">"estimate"</span>, <span class="st">"std.error"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">add_column</span>(<span class="at">model =</span> <span class="st">"astsa::sarima"</span>, <span class="at">.before =</span> <span class="dv">1</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(term)) <span class="sc">|&gt;</span> </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>() <span class="sc">|&gt;</span> <span class="fu">kable_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<table class=" lightable-minimal" style="font-family: &quot;Trebuchet MS&quot;, verdana, sans-serif; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;"> model </th>
   <th style="text-align:left;"> term </th>
   <th style="text-align:right;"> estimate </th>
   <th style="text-align:right;"> std.error </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> forecast::Arima </td>
   <td style="text-align:left;"> xreg </td>
   <td style="text-align:right;"> 1.9302542 </td>
   <td style="text-align:right;"> 0.2520409 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> astsa::sarima </td>
   <td style="text-align:left;"> xreg </td>
   <td style="text-align:right;"> 1.9303000 </td>
   <td style="text-align:right;"> 0.2520000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> stats::arima </td>
   <td style="text-align:left;"> x </td>
   <td style="text-align:right;"> 1.9302542 </td>
   <td style="text-align:right;"> 0.2520409 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> forecast::Arima </td>
   <td style="text-align:left;"> intercept </td>
   <td style="text-align:right;"> 0.0275105 </td>
   <td style="text-align:right;"> 0.1427769 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> stats::arima </td>
   <td style="text-align:left;"> intercept </td>
   <td style="text-align:right;"> 0.0275105 </td>
   <td style="text-align:right;"> 0.1427769 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> astsa::sarima </td>
   <td style="text-align:left;"> intercept </td>
   <td style="text-align:right;"> 0.0275000 </td>
   <td style="text-align:right;"> 0.1428000 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> forecast::Arima </td>
   <td style="text-align:left;"> ar1 </td>
   <td style="text-align:right;"> 0.2709738 </td>
   <td style="text-align:right;"> 0.0481873 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> stats::arima </td>
   <td style="text-align:left;"> ar1 </td>
   <td style="text-align:right;"> 0.2709738 </td>
   <td style="text-align:right;"> 0.0481873 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> astsa::sarima </td>
   <td style="text-align:left;"> ar1 </td>
   <td style="text-align:right;"> 0.2710000 </td>
   <td style="text-align:right;"> 0.0482000 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>It’s pretty clear from both of these tests, of the AR1 model and the AR1X model that they estimate very similarly,</p>
</section>
<section id="diagnostics" class="level3" data-number="35.2.5">
<h3 data-number="35.2.5" class="anchored" data-anchor-id="diagnostics"><span class="header-section-number">35.2.5</span> Diagnostics</h3>
<p>There are hypothesis tests, and graphical checks for stationarity</p>
<p>unit root tests are for stability/stationarity:</p>
<ul>
<li>Augmented Dickey Fulley Test
<ul>
<li>want low p value</li>
</ul></li>
<li>KPSS Test
<ul>
<li>want high p value for stationarity</li>
</ul></li>
</ul>
</section>
<section id="examples-la-county" class="level3" data-number="35.2.6">
<h3 data-number="35.2.6" class="anchored" data-anchor-id="examples-la-county"><span class="header-section-number">35.2.6</span> Examples: LA County</h3>
<p>We just examine the cardiovascular mortality from the LA Pollution study. These are average weekly cv mortality rates from <code>astsa</code> package.</p>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-7_c1facb0a089cdd5d4f298eb344bb1482">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ?cmort</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> cmort <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>()</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>x1 <span class="ot">&lt;-</span> x <span class="sc">%&gt;%</span> <span class="fu">lag</span>()</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># yt = u + beta * yt-1</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>cmort_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(x<span class="sc">~</span>x1)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="fu">coef</span>(cmort_lm)[<span class="dv">1</span>] <span class="sc">+</span> <span class="fu">coef</span>(cmort_lm)[<span class="dv">2</span>] <span class="sc">*</span> x1,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="cn">NA</span>, <span class="fu">fitted</span>(cmort_lm)),</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="cn">NA</span>, <span class="fu">predict</span>(cmort_lm))) <span class="sc">%&gt;%</span> </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>() <span class="co"># fitted/predicted values match up</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><span class="math display">\begin{bmatrix} NA &amp;NA &amp;NA \\95.7381108162687 &amp;95.7381108162684 &amp;95.7381108162687 \\100.978136273105 &amp;100.978136273105 &amp;100.978136273105 \\93.0447840350672 &amp;93.0447840350672 &amp;93.0447840350672 \\95.8924561905496 &amp;95.8924561905496 &amp;95.8924561905496 \\94.1946570734599 &amp;94.1946570734598 &amp;94.1946570734599 \\ \end{bmatrix}</span></p>
</div>
</div>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-8_937d0f3534fb3a6d0314b48aa1a16c38">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(<span class="fu">time</span>(cmort), x, <span class="at">geom =</span> <span class="st">"line"</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span>  <span class="fu">c</span>(<span class="cn">NA</span>, <span class="fu">fitted</span>(cmort_lm)), <span class="at">color =</span> <span class="st">"red"</span>)) <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"black"</span>, <span class="st">"red"</span>),</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>                     <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"raw"</span>, <span class="st">"fitted"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Don't know how to automatically pick scale for object of type ts. Defaulting to continuous.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 row(s) containing missing values (geom_path).</code></pre>
</div>
<div class="cell-output-display">
<p><img src="timeseries_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="example-airpassengers" class="level3" data-number="35.2.7">
<h3 data-number="35.2.7" class="anchored" data-anchor-id="example-airpassengers"><span class="header-section-number">35.2.7</span> Example: AirPassengers</h3>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-9_d3d12122cd402d72302bfe7015a0fa81">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>AirPassengers <span class="sc">%&gt;%</span> <span class="fu">plot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="timeseries_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-10_f51c48c1f8ad224a81091d436042b3c9">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sarima</span>(AirPassengers, <span class="at">d =</span> <span class="dv">1</span>, <span class="at">p =</span> <span class="dv">2</span>, <span class="at">q =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>initial  value 3.522169 
iter   2 value 3.456359
iter   3 value 3.447683
iter   4 value 3.447001
iter   5 value 3.447000
iter   6 value 3.447000
iter   6 value 3.447000
iter   6 value 3.447000
final  value 3.447000 
converged
initial  value 3.441124 
iter   2 value 3.441115
iter   3 value 3.441115
iter   4 value 3.441114
iter   4 value 3.441114
iter   4 value 3.441114
final  value 3.441114 
converged</code></pre>
</div>
<div class="cell-output-display">
<p><img src="timeseries_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>$fit

Call:
arima(x = xdata, order = c(p, d, q), seasonal = list(order = c(P, D, Q), period = S), 
    xreg = constant, transform.pars = trans, fixed = fixed, optim.control = list(trace = trc, 
        REPORT = 1, reltol = tol))

Coefficients:
         ar1      ar2  constant
      0.3792  -0.2314    2.4075
s.e.  0.0823   0.0834    3.0636

sigma^2 estimated as 973.4:  log likelihood = -694.99,  aic = 1397.98

$degrees_of_freedom
[1] 140

$ttable
         Estimate     SE t.value p.value
ar1        0.3792 0.0823  4.6065  0.0000
ar2       -0.2314 0.0834 -2.7767  0.0062
constant   2.4075 3.0636  0.7858  0.4333

$AIC
[1] 9.77605

$AICc
[1] 9.777257

$BIC
[1] 9.858927</code></pre>
</div>
</div>
</section>
</section>
<section id="exponential-smoothing" class="level2" data-number="35.3">
<h2 data-number="35.3" class="anchored" data-anchor-id="exponential-smoothing"><span class="header-section-number">35.3</span> Exponential smoothing</h2>
<ul>
<li><code>ets()</code> is probably the function you want</li>
</ul>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-11_62a04487333068198d1767abedeca62e">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(oil)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>fc <span class="ot">&lt;-</span> <span class="fu">ses</span>(oil, <span class="at">h =</span> <span class="dv">5</span>, <span class="at">alpha =</span> .<span class="dv">1</span>) <span class="co"># can leave out the alpha to estimate alpha instead</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># oil |&gt; autoplot() +</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_line(data = data.frame(time = index(fitted(fc)),</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co">#                        fitted = fitted(fc)),</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co">#             mapping = aes(time, fitted),</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co">#             color = "red")</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(fc) <span class="sc">+</span> </span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autolayer</span>(<span class="fu">fitted</span>(fc)) <span class="sc">+</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span><span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="timeseries_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="tsrepr" class="level2" data-number="35.4">
<h2 data-number="35.4" class="anchored" data-anchor-id="tsrepr"><span class="header-section-number">35.4</span> TSrepr</h2>
<p>This R package is designed to give smaller dimension representations of time series. If there are <span class="math inline">n</span> observations of the time series, this package would like to represent that as <span class="math inline">p</span>. parameters. This roughly equates to nonparametric regression of the signals. We’ll investigate how these work by following along in the <a href="https://petolau.github.io/TSrepr-time-series-representations/">tutorial given</a>:</p>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-12_8a08f48fd5c5610d3f7340818e545655">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"elec_load"</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>elec <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(elec_load[<span class="dv">1</span>,])</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(<span class="at">Time =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(elec), <span class="at">Value =</span> elec), <span class="fu">aes</span>(Time, Value)) <span class="sc">+</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="timeseries_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-13_6e9a5a21e565be2e45173c15de1d56ee">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># DWT with level of 2^3</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>data_dwt <span class="ot">&lt;-</span> <span class="fu">repr_dwt</span>(elec, <span class="at">level =</span> <span class="dv">3</span>) <span class="co"># discrete wavelet transform</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="co"># first 84 DFT coefficients are extracted and then inverted</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>data_dft <span class="ot">&lt;-</span> <span class="fu">repr_dft</span>(elec, <span class="at">coef =</span> <span class="dv">84</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co"># first 84 DCT coefficients are extracted and then inverted</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>data_dct <span class="ot">&lt;-</span> <span class="fu">repr_dct</span>(elec, <span class="at">coef =</span> <span class="dv">84</span>)</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Classical PAA</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>data_paa <span class="ot">&lt;-</span> <span class="fu">repr_paa</span>(elec, <span class="at">q =</span> <span class="dv">8</span>, <span class="at">func =</span> mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-14_17c1c6100a4c35c789deae467e7e9e45">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>data_plot <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Value =</span> <span class="fu">c</span>(data_dwt, data_dft, data_dct, data_paa),</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Time =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(data_dwt), <span class="dv">4</span>),</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                        <span class="at">Method =</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"DWT"</span>, <span class="st">"DFT"</span>, <span class="st">"DCT"</span>, <span class="st">"PAA"</span>),</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">each =</span> <span class="fu">length</span>(data_dwt))))</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_plot, <span class="fu">aes</span>(Time, Value)) <span class="sc">+</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color =</span> Method), <span class="at">alpha =</span> <span class="fl">0.80</span>, <span class="at">size =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(Time, Value), <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">Time =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(elec), <span class="at">Value =</span> elec)) <span class="sc">+</span> </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="timeseries_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="arch" class="level2" data-number="35.5">
<h2 data-number="35.5" class="anchored" data-anchor-id="arch"><span class="header-section-number">35.5</span> ARCH</h2>
<p>Arch models have variance that depend on the previous timepoint as well. That is, an ARCH(1) model has dependence on the previous error term.</p>
<p><span class="math display">
\begin{aligned}
y_t &amp;= b'x_t + \varepsilon_t \\
\varepsilon_t &amp;\overset{i.i.d.}{\sim} N(0, \sigma^2_t) \\
\text{Var}(\varepsilon_t) = \sigma^2_t &amp;= \omega + \alpha_1\varepsilon_{t-1}^2
\end{aligned}
</span></p>
<p>We can write the zero centered process a little easier,</p>
<p><span class="math display">
\begin{aligned}
y_t &amp;= \sigma_t\epsilon_t \\
\sigma_t^2 &amp;= \omega + \alpha_1y^2_{t-1} \\
\varepsilon_t &amp;\overset{i.i.d}{\sim} N(0, 1)
\end{aligned}
</span></p>
<p>Let’s simulate the ARCH model and see the basic characteristics, we’re simulating a zero mean</p>
<p><span class="math display">
\begin{aligned}
\sigma^2_t = 5 + .5 y^2_{t-1}
\end{aligned}
</span></p>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-15_82457f973b177a65d2fff6e96f5c3336">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># helper functions to simulate arch/garch models</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>sim_arch <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">y0 =</span> <span class="dv">2</span>, <span class="at">omega =</span> <span class="dv">5</span>, <span class="at">alpha1 =</span> .<span class="dv">5</span>, <span class="at">n =</span> <span class="dv">100</span>) {</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"numeric"</span>, n)</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  y[<span class="dv">1</span>] <span class="ot">&lt;-</span> y0</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  inn <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>n) {</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    y[i] <span class="ot">&lt;-</span> inn[i] <span class="sc">*</span> <span class="fu">sqrt</span>(omega <span class="sc">+</span> alpha1 <span class="sc">*</span> y[i<span class="dv">-1</span>]<span class="sc">^</span><span class="dv">2</span>) <span class="co"># arch</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  y</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">sim_arch</span>(<span class="at">n=</span><span class="dv">1000</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(y, <span class="at">type =</span> <span class="st">"l"</span>, <span class="at">main =</span> <span class="st">"Time Series Plot"</span>)</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="fu">Acf</span>(y, <span class="at">main =</span> <span class="st">"ACF y"</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">Pacf</span>(y, <span class="at">main =</span> <span class="st">"PACF y"</span>)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="fu">Acf</span>(y<span class="sc">^</span><span class="dv">2</span>, <span class="at">main =</span> <span class="st">"ACF y^2"</span>)</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="fu">Pacf</span>(y<span class="sc">^</span><span class="dv">2</span>, <span class="at">main =</span> <span class="st">"PACF y^2"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell quarto-layout-panel" data-hash="timeseries_cache/html/unnamed-chunk-16_f5d49385becdc32ee3dbb0cea7203b35">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<p><img src="timeseries_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="timeseries_files/figure-html/unnamed-chunk-16-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="timeseries_files/figure-html/unnamed-chunk-16-3.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="timeseries_files/figure-html/unnamed-chunk-16-4.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="timeseries_files/figure-html/unnamed-chunk-16-5.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
<p>In the time series plot, we can see why this is stochastically volatile plot, since there are regions of the time series that go way more wild when the values start to get high. The characteristics of an ARCH(1) model, are that the series <span class="math inline">y</span> look like white noise, and <span class="math inline">y^2</span> look like an AR(1) process. There’s a spike in the PACF model for lag 1, and a geometric decay in the acf plot of <span class="math inline">y^2</span> indicating AR(1).</p>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-17_fba7015e87048c53b3f1e0290811d98d">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">capture.output</span>(</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>  mod_arch <span class="ot">&lt;-</span> <span class="fu">garch</span>(y, <span class="at">order =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_arch)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
garch(x = y, order = c(0, 1))

Model:
GARCH(0,1)

Residuals:
     Min       1Q   Median       3Q      Max 
-2.88500 -0.66301 -0.03251  0.65554  3.55454 

Coefficient(s):
    Estimate  Std. Error  t value Pr(&gt;|t|)    
a0   5.77142     0.38941   14.821  &lt; 2e-16 ***
a1   0.44892     0.05722    7.846 4.22e-15 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Diagnostic Tests:
    Jarque Bera Test

data:  Residuals
X-squared = 0.0090504, df = 2, p-value = 0.9955


    Box-Ljung test

data:  Squared.Residuals
X-squared = 0.076017, df = 1, p-value = 0.7828</code></pre>
</div>
</div>
<p>The above is the output for fitting an ARCH(1) model, and we can see that the estimates are quite close to one another for the parameters that are controlling the variance of the function. Also notice that we have almost 1000 values that we had to feed in too though, it seems that estimating the variance coefficients is quite inefficient.</p>
</section>
<section id="garch" class="level2" data-number="35.6">
<h2 data-number="35.6" class="anchored" data-anchor-id="garch"><span class="header-section-number">35.6</span> GARCH</h2>
<p>A garch model will use the last error value, as well as the last variance for the error model.</p>
<p><span class="math display">
\begin{aligned}
y_t &amp;= b'x_t + \varepsilon_t \\
\varepsilon_t &amp;\overset{i.i.d.}{\sim} N(0, \sigma^2_t) \\
\text{Var}(\varepsilon_t) = \sigma^2_t &amp;= \omega + \alpha_1\varepsilon_{t-1}^2 + \beta_1\sigma_{t-1}^2
\end{aligned}
</span></p>
<p>The following we are simulating</p>
<p><span class="math display">
\begin{aligned}
Var(\varepsilon_t) = \sigma^2 = .1 + .1\varepsilon_{t-1}^2 + .8 \sigma^2_{t-1}
\end{aligned}
</span></p>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-18_4d3b31ad6c5a578fceeb30994b7a6608">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># see also fGarch::garchSim</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>sim_garch <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">y0 =</span> <span class="dv">2</span>, <span class="at">omega =</span> .<span class="dv">1</span>, <span class="at">alpha1 =</span> .<span class="dv">1</span>, <span class="at">beta1 =</span> .<span class="dv">8</span>, <span class="at">n =</span> <span class="dv">100</span>, <span class="at">xt =</span> <span class="dv">0</span>, <span class="at">b =</span> .<span class="dv">4</span>) {</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (xt <span class="sc">!=</span> <span class="dv">0</span> <span class="sc">&amp;</span> <span class="fu">length</span>(xt) <span class="sc">!=</span> n) rlang<span class="sc">::</span><span class="fu">abort</span>(<span class="st">"length of xt should be length of simulation"</span>)</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"numeric"</span>, n)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>  err <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"numeric"</span>, n)</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>  sds <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"numeric"</span>, n)</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>  y[<span class="dv">1</span>] <span class="ot">&lt;-</span> y0</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  inn <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n)</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>n) {</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    sds[i] <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(omega <span class="sc">+</span> alpha1 <span class="sc">*</span> err[i<span class="dv">-1</span>]<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> beta1 <span class="sc">*</span> sds[i<span class="dv">-1</span>]<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    err[i] <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> sds[i])</span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>    y[i] <span class="ot">&lt;-</span> xt <span class="sc">*</span> b <span class="sc">+</span> err[i]</span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># y[i] &lt;- inn[i] * (sqrt(a + b * y[i-1]^2 + c * inn[i-1]^2)) # garch</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>  y</span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a><span class="co"># spec &lt;- garchSpec(model = list())</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a><span class="co"># y &lt;- garchSim(spec, n = 100)</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">capture.output</span>(</span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>  mod_garch <span class="ot">&lt;-</span> fGarch<span class="sc">::</span><span class="fu">garchFit</span>(<span class="at">formula =</span> <span class="sc">~</span><span class="fu">garch</span>(<span class="dv">1</span>, <span class="dv">1</span>), y, <span class="at">include.mean =</span> <span class="cn">FALSE</span>)</span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># garch</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">sim_garch</span>(<span class="at">n=</span><span class="dv">500</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(y, <span class="at">type =</span> <span class="st">"l"</span>)</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="fu">Acf</span>(y) <span class="co"># supposed to be white noise</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="fu">Pacf</span>(y)</span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="fu">Acf</span>(y<span class="sc">^</span><span class="dv">2</span>) <span class="co"># supposed to be arma pattern</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="fu">Pacf</span>(y<span class="sc">^</span><span class="dv">2</span>) <span class="co"># MA(2) maybe</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell quarto-layout-panel" data-hash="timeseries_cache/html/unnamed-chunk-19_fdbe1d31d4de21ff9973985e7832e691">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 100.0%;justify-content: center;">
<p><img src="timeseries_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="timeseries_files/figure-html/unnamed-chunk-19-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="timeseries_files/figure-html/unnamed-chunk-19-3.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="timeseries_files/figure-html/unnamed-chunk-19-4.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="timeseries_files/figure-html/unnamed-chunk-19-5.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-20_b5a7073535ecacb0bdba0ae4a3bee2b9">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># fitting the garch model</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">invisible</span>(<span class="fu">capture.output</span>(</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  mod_garch <span class="ot">&lt;-</span> fGarch<span class="sc">::</span><span class="fu">garchFit</span>(<span class="sc">~</span><span class="fu">garch</span>(<span class="dv">1</span>, <span class="dv">1</span>), y,  <span class="at">include.mean =</span> <span class="cn">FALSE</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_garch)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Title:
 GARCH Modelling 

Call:
 fGarch::garchFit(formula = ~garch(1, 1), data = y, include.mean = FALSE) 

Mean and Variance Equation:
 data ~ garch(1, 1)
&lt;environment: 0x7ff80af103d0&gt;
 [data = y]

Conditional Distribution:
 norm 

Coefficient(s):
  omega   alpha1    beta1  
0.14254  0.11326  0.77157  

Std. Errors:
 based on Hessian 

Error Analysis:
        Estimate  Std. Error  t value Pr(&gt;|t|)    
omega    0.14254     0.07242    1.968  0.04904 *  
alpha1   0.11326     0.04074    2.780  0.00544 ** 
beta1    0.77157     0.08115    9.508  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Log Likelihood:
 -751.9354    normalized:  -1.503871 

Description:
 Tue Jan 31 12:37:01 2023 by user:  


Standardised Residuals Tests:
                                Statistic p-Value   
 Jarque-Bera Test   R    Chi^2  0.9215242 0.6308027 
 Shapiro-Wilk Test  R    W      0.9976149 0.7017248 
 Ljung-Box Test     R    Q(10)  16.02394  0.09894901
 Ljung-Box Test     R    Q(15)  27.95652  0.0218428 
 Ljung-Box Test     R    Q(20)  38.01825  0.00881023
 Ljung-Box Test     R^2  Q(10)  8.714543  0.5593918 
 Ljung-Box Test     R^2  Q(15)  22.62514  0.09242972
 Ljung-Box Test     R^2  Q(20)  29.21913  0.08353343
 LM Arch Test       R    TR^2   13.13471  0.3593258 

Information Criterion Statistics:
     AIC      BIC      SIC     HQIC 
3.019742 3.045029 3.019670 3.029665 </code></pre>
</div>
</div>
<ul>
<li>Jarque-Bera Test - null is normally distributed residuals</li>
<li>Ljung-Box - is portmanteau test for autocorrelation, testing for a set of lags.</li>
<li>LM arch test - fit the model, and examine the square of the residuals for length of ARCH lags. Null is that there is no AR trend in the squared residuals. See <a href="https://en.wikipedia.org/wiki/Autoregressive_conditional_heteroskedasticity">ARCH wiki</a></li>
</ul>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-21_fb355797f690b3c9f857119c5386505b">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(mod_garch) <span class="sc">|&gt;</span> <span class="fu">kbl</span>() <span class="sc">|&gt;</span> <span class="fu">kable_minimal</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<table class=" lightable-minimal" style="font-family: &quot;Trebuchet MS&quot;, verdana, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> x </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> omega </td>
   <td style="text-align:right;"> 0.1425396 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> alpha1 </td>
   <td style="text-align:right;"> 0.1132581 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> beta1 </td>
   <td style="text-align:right;"> 0.7715676 </td>
  </tr>
</tbody>
</table>

</div>
</div>
</section>
<section id="vector-autoregression" class="level2" data-number="35.7">
<h2 data-number="35.7" class="anchored" data-anchor-id="vector-autoregression"><span class="header-section-number">35.7</span> Vector Autoregression</h2>
<p>The simplest vector autoregressive model we can make is VAR(1), which takes the form</p>
<p>We assume that the process is stable, which implies that the function is stationary.</p>
<section id="simulation" class="level3" data-number="35.7.1">
<h3 data-number="35.7.1" class="anchored" data-anchor-id="simulation"><span class="header-section-number">35.7.1</span> Simulation</h3>
<p>https://www.r-econometrics.com/timeseries/svarintro/</p>
<p>This is an example of a “B”-model structural, VAR(1) model in which the coefficients are given. Let’s see what we can do with given coefficients.</p>
<p><span class="math display">
y_t = A_1y_{t-1} + B\epsilon_t
</span> <span class="math display">
A_1 = \begin{bmatrix} 0.3 &amp; 0.12 &amp; 0.69 \\ 0 &amp; 0.3 &amp; 0.48 \\ 0.24 &amp; 0.24 &amp; 0.3 \end{bmatrix} \text{, }
B = \begin{bmatrix} 1 &amp; 0 &amp; 0 \\ -0.14 &amp; 1 &amp; 0 \\ -0.06 &amp; 0.39 &amp; 1 \end{bmatrix} \text{ and } \epsilon_t \sim N(0, I_3)
</span></p>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-22_ae99508433b625f46250b973099b3f20">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reset random number generator for reproducibility</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">24579</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>tt <span class="ot">&lt;-</span> <span class="dv">500</span> <span class="co"># Number of time series observations</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Coefficient matrix</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>A_1 <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="fl">0.3</span>, <span class="dv">0</span>, <span class="fl">0.24</span>,</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>                <span class="fl">0.12</span>, <span class="fl">0.3</span>, <span class="fl">0.24</span>,</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>                <span class="fl">0.69</span>, <span class="fl">0.48</span>, <span class="fl">0.3</span>), <span class="dv">3</span>)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Structural coefficients</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>B <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>B[<span class="fu">lower.tri</span>(B)] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.14</span>, <span class="sc">-</span><span class="fl">0.06</span>, <span class="fl">0.39</span>)</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate series</span></span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>series <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="dv">3</span>, tt <span class="sc">+</span> <span class="dv">1</span>) <span class="co"># Raw series with zeros</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>(tt <span class="sc">+</span> <span class="dv">1</span>)){</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a>  series[, i] <span class="ot">&lt;-</span> A_1 <span class="sc">%*%</span> series[, i <span class="sc">-</span> <span class="dv">1</span>] <span class="sc">+</span>  B <span class="sc">%*%</span> <span class="fu">rnorm</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>series <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="fu">t</span>(series)) <span class="co"># Convert to time series object</span></span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a><span class="fu">dimnames</span>(series)[[<span class="dv">2</span>]] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"S1"</span>, <span class="st">"S2"</span>, <span class="st">"S3"</span>) <span class="co"># Rename variables</span></span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the series</span></span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a><span class="fu">plot.ts</span>(series, <span class="at">main =</span> <span class="st">"Artificial time series"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="timeseries_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>I this case, we’ve been handed the correct model, and we can quickly note some properties of the model. We can check for stability (which implies stationarity) by looking at the eigenvalues and checking that they’re magnitude is less than 1. It’s also clear that the innovations are correlated with one another,</p>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-23_d6ee8037177e0701625e45c755cc3980">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">eigen</span>(A_1)<span class="sc">$</span>values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  0.8529906  0.2503329 -0.2033235</code></pre>
</div>
</div>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-24_70d39cfec959e5c3c5b7599cbdca2a0a">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>var_est <span class="ot">&lt;-</span> <span class="fu">VAR</span>(series, <span class="at">p =</span> <span class="dv">1</span>, <span class="at">type =</span> <span class="st">"none"</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="co"># estimated A_1 matrix</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="fu">as_latex</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">hat A_1 = "</span>) <span class="sc">+</span> <span class="fu">as_latex</span>(<span class="fu">round</span>(<span class="fu">Bcoef</span>(var_est), <span class="at">digits =</span> <span class="dv">3</span>))</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate structural equation for A Model</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>a[<span class="fu">lower.tri</span>(a)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>svar_est_a <span class="ot">&lt;-</span> <span class="fu">SVAR</span>(var_est, <span class="at">Amat =</span> a, <span class="at">max.iter =</span> <span class="dv">1000</span>)</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="fu">as_latex</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">hat A^{-1} = "</span>) <span class="sc">+</span> <span class="fu">as_latex</span>(<span class="fu">round</span>(<span class="fu">solve</span>(svar_est_a<span class="sc">$</span>A), <span class="at">digits =</span> <span class="dv">33</span>)) <span class="co"># pretty close to B</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="co"># estimate structural equation for B Model</span></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">diag</span>(<span class="dv">1</span>, <span class="dv">3</span>)</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>b[<span class="fu">lower.tri</span>(b)] <span class="ot">&lt;-</span> <span class="cn">NA</span> <span class="co"># specify restriction with NA</span></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>svar_est_b <span class="ot">&lt;-</span> <span class="fu">SVAR</span>(var_est, <span class="at">Bmat =</span> b)</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a><span class="fu">as_latex</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">hat B = "</span>) <span class="sc">+</span> <span class="fu">as_latex</span>(<span class="fu">round</span>(svar_est_b<span class="sc">$</span>B, <span class="at">digits =</span> <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><span class="math display">\hat A_1 = \begin{bmatrix} 0.329 &amp;0.112 &amp;0.681 \\-0.002 &amp;0.29 &amp;0.513 \\0.24 &amp;0.252 &amp;0.319 \\ \end{bmatrix}</span><span class="math display">\hat A^{-1} = \begin{bmatrix} 1 &amp;0 &amp;0 \\-0.181774697458286 &amp;1 &amp;0 \\-0.107710324655258 &amp;0.313198839004628 &amp;1 \\ \end{bmatrix}</span><span class="math display">\hat B = \begin{bmatrix} 1 &amp;0 &amp;0 \\-0.182 &amp;1 &amp;0 \\-0.108 &amp;0.313 &amp;1 \\ \end{bmatrix}</span></p>
</div>
</div>
<p>The estimated <span class="math inline">A_1</span> is given directly by the function <code>Bcoef</code> on the fitted VAR model. We invert the matrix A because we need to translate this into a “B” model from the estimated “A” model, we estimated and find that it’s quite correct.</p>
</section>
<section id="moving-average-representations" class="level3" data-number="35.7.2">
<h3 data-number="35.7.2" class="anchored" data-anchor-id="moving-average-representations"><span class="header-section-number">35.7.2</span> Moving Average Representations</h3>
<p>We can get the basic moving average representation</p>
<p><span class="math display">
\begin{aligned}
y_t = \Phi_0 u_t + \Phi_1 u_{t-1} + ...
\end{aligned}
</span></p>
<p>Phi is normally calculated recursively from the last observations, starting with</p>
<ol type="1">
<li><span class="math inline">\Phi_0 = I_K</span></li>
<li><span class="math inline">\Phi_i = \sum_{j=1}^{i}\Phi_{i-j}A_j</span></li>
</ol>
<ul>
<li>for the VAR(1) case, the sequence is simply <span class="math inline">\Phi = I, A_1, A_1^2, A_1^3, \dots</span>.</li>
</ul>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-25_b39aa679a6bde9cc49a9146cba543d73">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bcoef(var_est) # A_1</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Bcoef(var_est) %^% 2 #A_1^2</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="fu">Phi</span>(var_est, <span class="at">nstep =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>, , 1

     [,1] [,2] [,3]
[1,]    1    0    0
[2,]    0    1    0
[3,]    0    0    1

, , 2

             [,1]      [,2]      [,3]
[1,]  0.328807868 0.1124078 0.6809865
[2,] -0.001530688 0.2895784 0.5127013
[3,]  0.240186093 0.2519319 0.3186145

, , 3

          [,1]      [,2]      [,3]
[1,] 0.2715060 0.2410736 0.4985175
[2,] 0.1221972 0.2128494 0.3107789
[3,] 0.1551162 0.1802220 0.3942445</code></pre>
</div>
</div>
<p>For the other MA representation with orthogonal coefficients,</p>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-26_b582aec5aabad35bceeae74487b3fea0">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sigmahat &lt;- crossprod(resid(var_est))/497 # estimated covariance, 500 total obs</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(var_est)$covres # i don't know how to get them to match exactly</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co"># P &lt;- t(chol(Sigmahat))</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># apply(Phi(var_est, nstep = 2), 3, {\(x) x %*% P}, simplify = FALSE) # multiply all Phi by P</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="fu">Psi</span>(var_est, <span class="at">nstep =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>, , 1

           [,1]     [,2]      [,3]
[1,]  0.9972189 0.000000 0.0000000
[2,] -0.1812692 1.021112 0.0000000
[3,] -0.1074108 0.319811 0.9953141

, , 2

           [,1]      [,2]      [,3]
[1,]  0.2343721 0.3325679 0.6777954
[2,] -0.1090877 0.4596596 0.5102988
[3,]  0.1596280 0.3591471 0.3171215

, , 3

           [,1]      [,2]      [,3]
[1,] 0.17350558 0.4055946 0.4961815
[2,] 0.04989328 0.3167336 0.3093226
[3,] 0.07967004 0.3101106 0.3923971</code></pre>
</div>
</div>
</section>
<section id="impulse-response-analysis" class="level3" data-number="35.7.3">
<h3 data-number="35.7.3" class="anchored" data-anchor-id="impulse-response-analysis"><span class="header-section-number">35.7.3</span> Impulse Response Analysis</h3>
<p>There are two types of basic impulse responses:</p>
<ol type="1">
<li>(forecast error impulse responses) These are on the scale of the original error, <code>Sigma.u</code> and let <code>c(0, 0, 1)</code> reverberate in the system</li>
</ol>
<ul>
<li>these have the disadvantage that</li>
</ul>
<ol start="2" type="1">
<li>(orthogonal error impulse responses) These are on the scale of <code>Sigma.eps</code> and let <code>P^{-1}c(0, 0, 1)</code> reverberate in the system where <span class="math inline">Sigma.u = PP'</span> by cholesky decomposition</li>
</ol>
<p><span class="math display">
\begin{aligned}
y_t &amp;= \Phi_0 u_t + \Phi_1 u_{t-1} + \dots \\
&amp;= \underbrace{\Phi_0 P}_{\Psi_0}\underbrace{P^{-1}u_t}_{\epsilon_{t}} +  \dots
\end{aligned}
</span></p>
<ol start="3" type="1">
<li>(accumulated error impulse response)</li>
</ol>
<div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First three rows of irf1</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Phi(var_est, nstep = 2) # First columns of this</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="do">## even more manually, with A matrix and unit impulse</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Ahat &lt;- Bcoef(var_est)</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Ahat %*% cbind(c(1, 0, 0)) # A e_1</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="co"># (Ahat %^% 2) %*% cbind(c(1, 0, 0)) #A_1^2 e_1</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>irf1 <span class="ot">&lt;-</span> <span class="fu">irf</span>(var_est, <span class="at">orth =</span> <span class="cn">FALSE</span>, <span class="at">boot =</span> <span class="cn">FALSE</span>)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a><span class="co"># First three rows of irf2</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Psi(var_est, nstep= 2 )</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a><span class="do">## more manually for VAR(1)</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Sigmahat &lt;- crossprod(resid(var_est))/497 # estimated covariance, 500 total obs</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="co"># P &lt;- t(chol(Sigmahat))</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="co"># P  %*% cbind(c(1, 0, 0)) # P e_1</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Ahat %*% P %*%cbind(c(1, 0, 0)) # A_1 P e_1</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="co"># (Ahat %^% 2) %*% P %*% cbind(c(1, 0, 0)) # A_1 P e_1</span></span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>irf2 <span class="ot">&lt;-</span> <span class="fu">irf</span>(var_est, <span class="at">orth =</span> <span class="cn">TRUE</span>, <span class="at">boot =</span> <span class="cn">FALSE</span>)</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a><span class="co"># row 2 </span></span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a><span class="co"># P  %*% cbind(c(1, 0, 0)) + Ahat %*% P %*%cbind(c(1, 0, 0)) </span></span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>irf3 <span class="ot">&lt;-</span> <span class="fu">irf</span>(var_est, <span class="at">cumulative =</span> <span class="cn">TRUE</span>, <span class="at">boot =</span> <span class="cn">FALSE</span>) <span class="co"># accumulates rowwise of regular irf</span></span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(irf1)</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(irf2)</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(irf3) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell quarto-layout-panel" data-hash="timeseries_cache/html/unnamed-chunk-27_a3a78cb245cbdc91a7731b843d712888">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<p><img src="timeseries_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<p><img src="timeseries_files/figure-html/unnamed-chunk-27-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<p><img src="timeseries_files/figure-html/unnamed-chunk-27-3.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<p><img src="timeseries_files/figure-html/unnamed-chunk-27-4.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<p><img src="timeseries_files/figure-html/unnamed-chunk-27-5.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<p><img src="timeseries_files/figure-html/unnamed-chunk-27-6.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<p><img src="timeseries_files/figure-html/unnamed-chunk-27-7.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<p><img src="timeseries_files/figure-html/unnamed-chunk-27-8.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 33.3%;justify-content: center;">
<p><img src="timeseries_files/figure-html/unnamed-chunk-27-9.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
<p>The impulse response functions are simply ways of answering the question, “what would happen if I send a shock through the system”. For non orthogonal</p>
<p>We assume the process is mean 0, and <span class="math inline">irf_1(0) = c(1, 0, 0)</span> <span class="math inline">irf_1(1) = A \begin{bmatrix}1, 0, 0\end{bmatrix}</span></p>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-28_81b1d76d1935075f3944b9c596957d7e">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># varsim_orthirf &lt;- irf(var_est, orth = TRUE, boot = FALSE)</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="co"># varsim_orthirf$irf$S1</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Bcoef(var_est) # gives as large matrix</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-29_f547aad452bca937f33cc66dd69ded34">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="co"># # ?Psi # MA orthogonal representation</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Psi(var_est) # W = PD^{-1} =</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co"># D &lt;- diag(P)</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="co"># W &lt;- P %*% diag((1 / D)) # matches with Psi(1)</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Psi(var_est)[,,1] # I don't know why these are slightly off... but using d</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Psi(var_est)</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="co"># P%*% t(P) # Sigmahat</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-30_39a0928a26525a27fd57a8a29cabe4f9">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># P %*% diag(1/D)</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="co"># svar_est_b$B</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co"># solve(svar_est_a$A) # This is estimate of B matrix</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-31_597a448cc09ebbbadf59500f5e1f3b3d">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># svar_est_a$Sigma.U / 100</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="co"># tcrossprod(svar_est_b$B) # is Sigma.U</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="co"># tcrossprod(W) # Sigma U = PD^{-1}</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Sigmahat</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co"># solve(W) %*% (svar_est_b$Sigma.U / 100) %*% t(solve(W)) # Identity, Sigma_epsilon</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Psi(var_est)[,,2]</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Acoef(var_est) # gives as list</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="example-la-county-var" class="level3" data-number="35.7.4">
<h3 data-number="35.7.4" class="anchored" data-anchor-id="example-la-county-var"><span class="header-section-number">35.7.4</span> Example: LA County (VAR)</h3>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-32_cb4b01202c440152d5f4a62da44417b7">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># cardiovascular mortality, temperature and particulates in LA county, weekly.</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>la <span class="ot">&lt;-</span> <span class="fu">cbind</span>(cmort, tempr, part)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co"># visualization</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co"># ts.plot(cmort, tempr, part, col = 1:3) # base r of autoplot </span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(la, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> <span class="fu">facet_grid</span>(series<span class="sc">~</span>., <span class="at">scales =</span> <span class="st">"free_y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="timeseries_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-33_3b75c14613d031ed9ae13a0137fb59aa">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>la_var1 <span class="ot">&lt;-</span> <span class="fu">VAR</span>(la, <span class="at">p =</span> <span class="dv">1</span>, <span class="at">type =</span> <span class="st">"both"</span>) <span class="co"># w/ trend</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>la_var2 <span class="ot">&lt;-</span> <span class="fu">VAR</span>(la, <span class="at">p =</span> <span class="dv">2</span>, <span class="at">type =</span> <span class="st">"both"</span>) <span class="co"># w/ trend</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># coefficient matrix</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(<span class="fu">coef</span>(la_var1),rlang<span class="sc">::</span><span class="fu">as_function</span>(<span class="sc">~</span>.x[,<span class="st">"Estimate"</span>])) <span class="sc">|&gt;</span> <span class="fu">as.data.frame</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>               cmort        tempr         part
cmort.l1  0.46482370 -0.244046444 -0.124774858
tempr.l1 -0.36088790  0.486595619 -0.476526201
part.l1   0.09941503 -0.127660994  0.581308364
const    73.22729188 67.585597743 67.463501275
trend    -0.01445884 -0.006912455 -0.004650001</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># vcov of coef estimates</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(<span class="fu">coef</span>(la_var1), rlang<span class="sc">::</span><span class="fu">as_function</span>(<span class="sc">~</span><span class="fu">round</span>(.x[,<span class="st">"Std. Error"</span>], <span class="dv">3</span>))) <span class="sc">|&gt;</span> <span class="fu">as.data.frame</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         cmort tempr   part
cmort.l1 0.037 0.042  0.079
tempr.l1 0.032 0.037  0.069
part.l1  0.019 0.022  0.041
const    4.834 5.542 10.399
trend    0.002 0.002  0.004</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># estimated covariance of errors</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(la_var1)<span class="sc">$</span>covres <span class="sc">|&gt;</span> <span class="fu">as.data.frame</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          cmort     tempr      part
cmort 31.171944  5.974621  16.65448
tempr  5.974621 40.964945  42.32335
part  16.654476 42.323345 144.26025</code></pre>
</div>
</div>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-34_35812632f08463e5e39c86f07eb66aa4">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>la_var1_const <span class="ot">&lt;-</span> <span class="fu">VAR</span>(la, <span class="at">p =</span> <span class="dv">1</span>, <span class="at">type =</span> <span class="st">"const"</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="co"># matching manaully with ar.ols</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co"># la_ols &lt;- ar.ols(la, order.max = 1, demean = FALSE, intercept = TRUE)</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="co"># # matches constant VAR coefficients</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="co"># rbind(t(la_ols$ar[1,,]),</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a><span class="co">#       const = la_ols$x.intercept)</span></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(<span class="fu">coef</span>(la_var1_const),rlang<span class="sc">::</span><span class="fu">as_function</span>(<span class="sc">~</span>.x[,<span class="st">"Estimate"</span>])) <span class="sc">|&gt;</span> <span class="fu">as.data.frame</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>               cmort      tempr        part
cmort.l1  0.60149346 -0.1787076 -0.08082151
tempr.l1 -0.30946101  0.5111817 -0.45998718
part.l1   0.07096225 -0.1412636  0.57215788
const    54.94579126 58.8456142 61.58412402</code></pre>
</div>
</div>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-35_6b45448ffd231090a4be940cb42a89aa">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>la <span class="sc">%&gt;%</span> <span class="fu">melt</span>(<span class="fu">c</span>(<span class="st">"time"</span>, <span class="st">"series"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(time, value)) <span class="sc">+</span> </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span> </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> <span class="fu">fitted</span>(la_var1) <span class="sc">%&gt;%</span> <span class="fu">melt</span>(<span class="fu">c</span>(<span class="st">"time"</span>, <span class="st">"series"</span>)),</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">mapping =</span> <span class="fu">aes</span>(time, value, <span class="at">color =</span> <span class="st">"red"</span>), <span class="at">alpha=</span> .<span class="dv">6</span>) <span class="sc">+</span>  <span class="co"># var1</span></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> <span class="fu">fitted</span>(la_var1_const) <span class="sc">%&gt;%</span> <span class="fu">melt</span>(<span class="fu">c</span>(<span class="st">"time"</span>, <span class="st">"series"</span>)),</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">mapping =</span> <span class="fu">aes</span>(time, value, <span class="at">color =</span> <span class="st">"blue"</span>), <span class="at">alpha =</span> .<span class="dv">6</span>) <span class="sc">+</span> <span class="co"># var1 const</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> <span class="fu">fitted</span>(la_var2) <span class="sc">%&gt;%</span> <span class="fu">melt</span>(<span class="fu">c</span>(<span class="st">"time"</span>, <span class="st">"series"</span>)),</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">mapping =</span> <span class="fu">aes</span>(time, value, <span class="at">color =</span> <span class="st">"green"</span>), <span class="at">alpha =</span> .<span class="dv">6</span>) <span class="sc">+</span> <span class="co"># var2</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>, <span class="st">"green"</span>),</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"var1"</span>, <span class="st">"var1_const"</span>, <span class="st">"var2"</span>)) <span class="sc">+</span> </span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(series<span class="sc">~</span>.)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="timeseries_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>From looking at the models, they’re quite difficult to tell which model is fitting better than the others.</p>
<p>We can try to do some automatic VAR order selection with the function <code>VARselect()</code>, which uses a number of other criteria.</p>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-38_be836240fbb1cb9c170e27ad98274b38">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># order selection</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">VARselect</span>(la) <span class="co"># selects 2 by BIC</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$selection
AIC(n)  HQ(n)  SC(n) FPE(n) 
     9      5      2      9 

$criteria
                  1           2           3           4           5           6
AIC(n)     11.84541    11.35895    11.32363    11.28376    11.23095    11.20946
HQ(n)      11.88523    11.42864    11.42318    11.41318    11.39023    11.39861
SC(n)      11.94687    11.53651    11.57728    11.61351    11.63679    11.69140
FPE(n) 139442.85952 85730.12941 82755.88760 79522.85813 75434.43083 73833.93231
                 7           8           9          10
AIC(n)    11.21508    11.19717    11.17261    11.17843
HQ(n)     11.43409    11.44604    11.45134    11.48703
SC(n)     11.77311    11.83130    11.88283    11.96475
FPE(n) 74254.62493 72942.17171 71179.59211 71604.50745</code></pre>
</div>
</div>
<p>The CCF plots should all be non significant. The second part of “x &amp; y” are the ones that lead.</p>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-39_dadaca500ffcd81a9e1dab4634a7d57b">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># serial test, BG test for </span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">serial.test</span>(la_var2, <span class="at">lags.pt =</span> <span class="dv">12</span>, <span class="at">type =</span> <span class="st">"PT.adjusted"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">serial.test</span>(la_var2, <span class="at">lags.pt =</span> <span class="dv">12</span>, <span class="at">type =</span> <span class="st">"BG"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">serial.test</span>(la_var2, <span class="at">lags.pt =</span> <span class="dv">12</span>, <span class="at">type =</span> <span class="st">"ES"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Portmanteau Test (adjusted)

data:  Residuals of VAR object la_var2
Chi-squared = 162.35, df = 90, p-value = 4.602e-06


    Breusch-Godfrey LM test

data:  Residuals of VAR object la_var2
Chi-squared = 151.85, df = 45, p-value = 1.656e-13


    Edgerton-Shukur F test

data:  Residuals of VAR object la_var2
F statistic = 3.6803, df1 = 45, df2 = 1429, p-value = 1.221e-14</code></pre>
</div>
</div>
<p><code>serial.test</code> will check for portmanteau, and BG</p>
</section>
<section id="sparsevar" class="level3" data-number="35.7.5">
<h3 data-number="35.7.5" class="anchored" data-anchor-id="sparsevar"><span class="header-section-number">35.7.5</span> sparsevar</h3>
<p>Since VAR models can grow <span class="math inline">O(np^2)</span>, this is a high dimensional problem when we’re tracking many states. We can use sparsity constraints during fitting.</p>
<p>The theoretical properties of this estimator are studied by VAR</p>
<p>The <a href="https://statisticaloddsandends.wordpress.com/2018/07/31/the-scad-penalty/">SCAD penalty</a>, and <a href="https://statisticaloddsandends.wordpress.com/2019/12/09/the-minimax-concave-penalty-mcp/">MCP penalty</a> are used in this package</p>
<p><span class="math display">
\begin{aligned}
\min_\beta \frac{1}{2} \|y - X\beta\|^2_2 + p(\beta)
\end{aligned}
</span></p>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-40_40d06433ccc25b7b12cd96baebdcbe52">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 5% of non-zero entries and a Toeplitz variance-covariance matrix with rho = 0.5.</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="fu">simulateVAR</span>(<span class="at">N =</span> <span class="dv">20</span>, <span class="at">p =</span> <span class="dv">2</span>)</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">fitVAR</span>(sim<span class="sc">$</span>series, <span class="at">p =</span> <span class="dv">2</span>, <span class="at">threshold =</span> <span class="cn">TRUE</span>)</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plotVAR</span>(sim, fit) <span class="co"># recovered quite well</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="timeseries_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The top image is the true generating values of <span class="math inline">A</span> in the vector autoregression model.</p>
</section>
</section>
<section id="state-space-model" class="level2" data-number="35.8">
<h2 data-number="35.8" class="anchored" data-anchor-id="state-space-model"><span class="header-section-number">35.8</span> State Space Model</h2>
<p>These models have a hierarchical form, in which there is some underlying time series process, but then we also observe data on top of that. Thus, the general form of the equations look like this:</p>
<p><span class="math display">
\begin{aligned}
\textbf{State Equation:}&amp; \\
x_t &amp;= \Phi x_{t-1} + \Upsilon u_t +   w_t \\
\textbf{Observation Equation:}&amp; \\
y_t &amp;= A_t x_t + \Gamma u_t  + v_t
\end{aligned}
</span> where:</p>
<ul>
<li><span class="math inline">\Upsilon u_t</span> - is time varying exogenous variables</li>
<li><span class="math inline">\Upsilon u_t</span> - is time varying exogenous variables</li>
<li><span class="math inline">x_t</span> is state at time <span class="math inline">t</span></li>
<li><span class="math inline">\Phi x_t</span> is state at time <span class="math inline">t</span> describes how <span class="math inline">x</span> evolves</li>
<li><span class="math inline">w_t</span> is state noise with <span class="math inline">w_t \sim N(0, Q)</span></li>
<li><span class="math inline">v_t</span> is measurement noise with <span class="math inline">v_t \sim N(0, R)</span></li>
</ul>
<p>There are more general forms of the state space model: with correlated errors, see Durbin Koopman for more state space methods.</p>
<p>It seems now that state space models are now also being superseded by recurrent neural networks, which can model dynamical properties.</p>
<section id="example-ar1-with-observational-noise" class="level3" data-number="35.8.1">
<h3 data-number="35.8.1" class="anchored" data-anchor-id="example-ar1-with-observational-noise"><span class="header-section-number">35.8.1</span> Example: AR(1) with observational noise</h3>
<p>The state equation:</p>
<p><span class="math display">
\begin{aligned}
\textbf{State Equation:}&amp; \\
x_t &amp;= \phi x_{t-1} + w_t \\
\textbf{Observation Equation:}&amp; \\
y_t &amp;= x_t + v_t
\end{aligned}
</span></p>
<p>What is interesting about this case with a hierarchical data structure, is that we can show it has the same error structure as an ARMA model. Shumway Stoffer notes that even though it has the same parameterization as an ARMA model, it is often easier to think about the state model form. See example 6.3 for more details.</p>
</section>
</section>
<section id="kalman-filter" class="level2" data-number="35.9">
<h2 data-number="35.9" class="anchored" data-anchor-id="kalman-filter"><span class="header-section-number">35.9</span> Kalman Filter</h2>
<p>Kalman filter is a recursive, markovian updating algorithm for estimating a hidden state variable given noisy and partial observations. The common example is that we are tracking a truck by gps observations. Since the gps observations are imprecise, they will jump back and forth.</p>
<p>An excellent resource explanation with pictures is found <a href="https://www.bzarg.com/p/how-a-kalman-filter-works-in-pictures/">from bzarg</a></p>
<section id="example-local-level-model" class="level3" data-number="35.9.1">
<h3 data-number="35.9.1" class="anchored" data-anchor-id="example-local-level-model"><span class="header-section-number">35.9.1</span> Example: Local level Model</h3>
<p>Consider the equations:</p>
<p><span class="math display">
\begin{aligned}
\textbf{State Equation:}&amp; \\
x_t &amp;= x_{t-1} + w_t \\
\textbf{Observation Equation:}&amp; \\
y_t &amp;= x_t + v_t
\end{aligned}
</span> where both <span class="math inline">w_t, v_t \sim N(0, 1)</span>. We can make the Kalman filter here based on our observation equation. We assume that <span class="math inline">A = 1</span> (in this case) and <span class="math inline">Phi = 1</span> are known here. In reality, we can use maximum likelihood of the <em>innnovations</em> (prediction errors) in order to estimate the</p>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-41_481cf80002d3fed9cc2b3327231fa1b5">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># generate the data</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span>  <span class="dv">50</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>x0 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1</span>) <span class="co"># random initial state</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>w <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">1</span>) <span class="co"># state level noise</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>v <span class="ot">=</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">1</span>) <span class="co"># observation level noise</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">cumsum</span>(<span class="fu">c</span>(x0, w)) <span class="co"># true state variables</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> x[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">+</span> v <span class="co"># remove initial state</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>ks <span class="ot">&lt;-</span> <span class="fu">Ksmooth0</span>(<span class="at">num =</span> <span class="dv">50</span>, </span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">y =</span> y, </span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">A =</span> <span class="dv">1</span>, </span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">mu0 =</span> <span class="dv">10</span>, <span class="co"># set initial values</span></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">Sigma0 =</span> <span class="dv">20</span>, <span class="co"># set initial values</span></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">Phi =</span> <span class="dv">1</span>,</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>               <span class="at">cQ =</span> <span class="dv">1</span>,</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>               <span class="at">cR =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-42_198cba5fd25d6423983d221c48f3b137">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot all the predictions</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">1</span>),</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">2</span>, <span class="dv">4</span>))</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="co"># predictions</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x[<span class="sc">-</span><span class="dv">1</span>], <span class="at">main =</span> <span class="st">"Prediction"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">10</span>))</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(ks<span class="sc">$</span>xp[<span class="dv">1</span>,,])</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(ks<span class="sc">$</span>xp <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">sqrt</span>(ks<span class="sc">$</span>Pp[<span class="dv">1</span>,,]), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="dv">4</span>)</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(ks<span class="sc">$</span>xp <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">sqrt</span>(ks<span class="sc">$</span>Pp[<span class="dv">1</span>,,]), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="dv">4</span>) <span class="co"># variance matrices</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a><span class="co"># filters</span></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x[<span class="sc">-</span><span class="dv">1</span>], <span class="at">main =</span> <span class="st">"Filters"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">10</span>), <span class="at">xlab =</span> <span class="st">""</span>)</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(ks<span class="sc">$</span>xf[<span class="dv">1</span>,,])</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(ks<span class="sc">$</span>xf <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">sqrt</span>(ks<span class="sc">$</span>Pf[<span class="dv">1</span>,,]), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="dv">4</span>)</span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(ks<span class="sc">$</span>xf <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">sqrt</span>(ks<span class="sc">$</span>Pf[<span class="dv">1</span>,,]), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="dv">4</span>) <span class="co"># variance matrices</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a><span class="co"># ks$xs[1,,] # smooth values</span></span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x[<span class="sc">-</span><span class="dv">1</span>], <span class="at">main =</span> <span class="st">"Smooth"</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="dv">10</span>), <span class="at">xlab =</span> <span class="st">""</span>)</span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(ks<span class="sc">$</span>xs[<span class="dv">1</span>,,])</span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(ks<span class="sc">$</span>xs <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">sqrt</span>(ks<span class="sc">$</span>Ps[<span class="dv">1</span>,,]), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="dv">4</span>)</span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(ks<span class="sc">$</span>xs <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">sqrt</span>(ks<span class="sc">$</span>Ps[<span class="dv">1</span>,,]), <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="dv">4</span>) <span class="co"># variance matrices</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="timeseries_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-43_8bca2f3ec5c6237afde8848ba658532e">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># creating table for comparison</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">predict =</span> ks<span class="sc">$</span>xp[<span class="dv">1</span>,,],</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>       <span class="at">filter =</span> ks<span class="sc">$</span>xf[<span class="dv">1</span>,,],</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">smooth =</span> ks<span class="sc">$</span>xs[<span class="dv">1</span>,,],</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">predict_sd =</span> <span class="fu">sqrt</span>(ks<span class="sc">$</span>Pp[<span class="dv">1</span>,,]),</span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">filter_sd =</span> <span class="fu">sqrt</span>(ks<span class="sc">$</span>Pf[<span class="dv">1</span>,,]),</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">smooth_sd =</span> <span class="fu">sqrt</span>(ks<span class="sc">$</span>Ps[<span class="dv">1</span>,,])) <span class="sc">%&gt;%</span></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(predict<span class="sc">:</span>smooth, <span class="sc">~</span>scales<span class="sc">::</span><span class="fu">number</span>(.x, <span class="at">accuracy =</span> .<span class="dv">001</span>)),</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>         <span class="fu">across</span>(predict_sd<span class="sc">:</span>smooth_sd, <span class="sc">~</span>scales<span class="sc">::</span><span class="fu">number</span>(.x,<span class="at">accuracy =</span> .<span class="dv">01</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(<span class="at">predict =</span> <span class="fu">glue</span>(<span class="st">"{predict} ({predict_sd})"</span>),</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">filter =</span> <span class="fu">glue</span>(<span class="st">"{filter} ({filter_sd})"</span>),</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">smooth =</span> <span class="fu">glue</span>(<span class="st">"{smooth} ({smooth_sd})"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 50 × 3
   predict       filter        smooth       
   &lt;glue&gt;        &lt;glue&gt;        &lt;glue&gt;       
 1 10.000 (4.58) -0.552 (0.98) -0.538 (0.77)
 2 -0.552 (1.40) -0.807 (0.81) -0.524 (0.69)
 3 -0.807 (1.29) -0.810 (0.79) -0.096 (0.67)
 4 -0.810 (1.27) 0.978 (0.79)  1.048 (0.67) 
 5 0.978 (1.27)  1.490 (0.79)  1.161 (0.67) 
 6 1.490 (1.27)  0.536 (0.79)  0.628 (0.67) 
 7 0.536 (1.27)  0.209 (0.79)  0.778 (0.67) 
 8 0.209 (1.27)  1.438 (0.79)  1.699 (0.67) 
 9 1.438 (1.27)  1.283 (0.79)  2.123 (0.67) 
10 1.283 (1.27)  3.726 (0.79)  3.481 (0.67) 
# … with 40 more rows
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</div>
</div>
</section>
<section id="estimation-of-state-parameters" class="level3" data-number="35.9.2">
<h3 data-number="35.9.2" class="anchored" data-anchor-id="estimation-of-state-parameters"><span class="header-section-number">35.9.2</span> Estimation of State Parameters</h3>
<p>There are bayesian methods for estimating the state parameters but also maximum likelihood w/ Newton Raphson or EM algorithmss</p>
</section>
<section id="example-nile" class="level3 tabset" data-number="35.9.3">
<h3 class="tabset anchored" data-number="35.9.3" data-anchor-id="example-nile"><span class="header-section-number">35.9.3</span> Example: Nile</h3>
<p>Annual flow of the river Nile from 1871 - 1970. There’s an apparent changepoint near 1898.</p>
<p>I found this example going through all the state space model libraries. The orginal paper is called “JSS Journal of Statistical Software, State Space Models in R”.Specifically, we walk through the Nile example with 3 functions:</p>
<ol type="1">
<li><code>stats::StructTS</code></li>
<li><code>dlm:dlmMLE</code></li>
<li><code>KFAS:kf</code></li>
</ol>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-44_a5654c38820660a60193b9c44df970ea">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># change point analyses</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ts.plot</span>(Nile)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="timeseries_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<section id="statsstructts" class="level4">
<h4 class="anchored" data-anchor-id="statsstructts">stats::StructTS</h4>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-45_70e41dc30534ff3647ce4a5af6a1ef80">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>nile_sts <span class="ot">&lt;-</span> <span class="fu">StructTS</span>(Nile, <span class="st">"level"</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="co"># nile_sts %&gt;% tsdiag() # diagnostics of structural model</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="co"># values from model.</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">times =</span> <span class="fu">time</span>(Nile),</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">filtered =</span> <span class="fu">fitted</span>(nile_sts)[,<span class="st">"level"</span>], <span class="co"># filtered values</span></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">smoothed =</span> <span class="fu">tsSmooth</span>(nile_sts)[,<span class="st">"level"</span>]) <span class="co"># smoothed valuees</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 100 × 3
   times filtered smoothed
   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
 1  1871    1120     1112.
 2  1872    1141.    1111.
 3  1873    1073.    1105.
 4  1874    1117.    1114.
 5  1875    1130.    1112.
 6  1876    1138.    1107.
 7  1877    1049.    1096.
 8  1878    1098.    1112.
 9  1879    1171.    1117.
10  1880    1163.    1098.
# … with 90 more rows
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># forecast values</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(nile_sts,<span class="at">n.ahead =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$pred
Time Series:
Start = 1971 
End = 1975 
Frequency = 1 
[1] 798.3682 798.3682 798.3682 798.3682 798.3682

$se
Time Series:
Start = 1971 
End = 1975 
Frequency = 1 
[1] 143.5266 148.5564 153.4215 158.1370 162.7159</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plotting forecast values, with package forecast</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(forecast<span class="sc">::</span><span class="fu">forecast</span>(nile_sts, <span class="co"># StructST object</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">level =</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">90</span>), <span class="co"># CI levels</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">h =</span> <span class="dv">10</span>), <span class="co"># periods of forecasting</span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">1950</span>, <span class="dv">1980</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="timeseries_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="dlmdlm" class="level4">
<h4 class="anchored" data-anchor-id="dlmdlm">dlm::dlm</h4>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-46_29987bcfcf009f9295b57608262bdd3c">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set up the dlm object</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>nile_dlm_ll <span class="ot">&lt;-</span> <span class="cf">function</span>(theta){</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dlmModPoly</span>(<span class="at">order =</span> <span class="dv">1</span>, <span class="at">dV =</span> theta[<span class="dv">1</span>], <span class="at">dW =</span> theta[<span class="dv">2</span>]) <span class="co"># fits local level model</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="co"># calls optim internally to optimize model (default BFGS)</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a><span class="co"># could use numDeriv::hessian for numerically accurate evaluation of Hessians</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>nile_dlm_mle <span class="ot">&lt;-</span> <span class="fu">dlmMLE</span>(Nile, <span class="co"># data</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">parm =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">2</span>), <span class="co"># initial parameters</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>                   nile_dlm_ll, <span class="co"># model</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">lower =</span> <span class="fu">rep</span>(<span class="fl">1e-4</span>, <span class="dv">2</span>)) </span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>nile_dlm_mle<span class="sc">$</span>par <span class="co"># similar variance parameters of local linear model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 15099.787  1468.438</code></pre>
</div>
</div>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-47_b93411e88613f5d4947dce54f20797d2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>nile_dlm_ll_best <span class="ot">&lt;-</span> <span class="fu">nile_dlm_ll</span>(nile_dlm_mle<span class="sc">$</span>par) <span class="co"># build model with best fit by optim</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">W</span>(nile_dlm_ll_best) <span class="co"># state randomnesss</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><span class="math display">\begin{bmatrix} 1468.43775833941 \\ \end{bmatrix}</span></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">V</span>(nile_dlm_ll_best) <span class="co"># observation error variance</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><span class="math display">\begin{bmatrix} 15099.7867214723 \\ \end{bmatrix}</span></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># can use fitted model to create smooth estimates now</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="co"># $s has time series of smooth estimates</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="co"># $U.S and $D.S have SVD of smoothing varriances (for std err)</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>nile_dlm_ll_smooth <span class="ot">&lt;-</span> <span class="fu">dlmSmooth</span>(Nile , nile_dlm_ll_best)</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a><span class="co"># conf ints can be calculated by</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-48_979c6af85dfcfe99e440a9241d30ce8c">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate standard errors</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>hwidth <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">unlist</span>(<span class="fu">dlmSvd2var</span>(nile_dlm_ll_smooth<span class="sc">$</span>U.S, nile_dlm_ll_smooth<span class="sc">$</span>D.S))) <span class="sc">*</span> <span class="fu">qnorm</span>(<span class="fl">0.025</span>, <span class="at">lower =</span> <span class="cn">FALSE</span>)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>nile_dlm_ll_smooth_ci <span class="ot">&lt;-</span> <span class="fu">cbind</span>(nile_dlm_ll_smooth<span class="sc">$</span>s, <span class="fu">as.vector</span>(nile_dlm_ll_smooth<span class="sc">$</span>s) <span class="sc">+</span> hwidth <span class="sc">%o%</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(nile_dlm_ll_smooth_ci) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"smoothed kalman with CI"</span>) <span class="sc">+</span></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> <span class="fu">tibble</span>(<span class="at">time =</span> <span class="fu">time</span>(Nile),</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>                           <span class="at">flow =</span> Nile,</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>                           <span class="at">series =</span> <span class="st">"real"</span>),</span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a>             <span class="at">mapping =</span> <span class="fu">aes</span>(time, flow))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="timeseries_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="kfaskfs" class="level4">
<h4 class="anchored" data-anchor-id="kfaskfs">KFAS::KFS</h4>
<p>Kalman filtering/smoothing/simulation for linear state space models in the exponential family. KFAS uses the sequential processing method. This package uses a slightly different parameterization of their state space models.</p>
<p><span class="math display">
\begin{aligned}
y_t &amp;= Z_t\alpha_t + \varepsilon_t &amp;\text{observation}\\
\alpha_{t+1} &amp;= T_t \alpha_t + R_t\eta_t &amp;\text{transition}
\end{aligned}
</span></p>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-49_900232b2f571dd12fed14a95c45f2123">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># build the local linear model</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="co"># can initialize a specific model with values</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="co"># nile_kfas_ll_model &lt;- SSModel(Nile ~ SSMtrend(1, Q = 15000), # Q = Transition error</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="co">#                               H = 30) # Observation error</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="co"># add NA for values you want to optimize</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>nile_kfas_ll_model <span class="ot">&lt;-</span> <span class="fu">SSModel</span>(Nile <span class="sc">~</span> <span class="fu">SSMtrend</span>(<span class="dv">1</span>, <span class="at">Q =</span> <span class="fu">list</span>(<span class="fu">matrix</span>(<span class="cn">NA</span>))), <span class="co"># Q = Transition error</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>                              <span class="at">H =</span> <span class="fu">matrix</span>(<span class="cn">NA</span>)) <span class="co"># Observation error</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a><span class="co"># fit the model with wrapper to `optim`</span></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a><span class="co"># -logLik(nile_kfas_ll_model) # is the objective that is optimized</span></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a>nile_kfas_ll_fit <span class="ot">&lt;-</span> <span class="fu">fitSSM</span>(nile_kfas_ll_model,</span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a>       <span class="fu">c</span>(<span class="fu">log</span>(<span class="fu">var</span>(Nile)), <span class="fu">log</span>(<span class="fu">var</span>(Nile))), <span class="co"># initial parameters for optim</span></span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">method =</span> <span class="st">"BFGS"</span>)</span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a><span class="co"># extract just the optimal model</span></span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a>nile_kfas_ll <span class="ot">&lt;-</span> nile_kfas_ll_fit<span class="sc">$</span>model</span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter/smooth</span></span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a>nile_kfas_ll_smooth <span class="ot">&lt;-</span> <span class="fu">KFS</span>(nile_kfas_ll,</span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">filtering =</span> <span class="st">"state"</span>,</span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">smoothing =</span> <span class="st">"state"</span>)</span>
<span id="cb76-24"><a href="#cb76-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-25"><a href="#cb76-25" aria-hidden="true" tabindex="-1"></a><span class="co"># autoplot calls fortify, grabbing some components of the model</span></span>
<span id="cb76-26"><a href="#cb76-26" aria-hidden="true" tabindex="-1"></a><span class="co"># ggfortify:::autoplot.KFS</span></span>
<span id="cb76-27"><a href="#cb76-27" aria-hidden="true" tabindex="-1"></a><span class="co"># fortify(nile_kfas_ll_smooth)  # create df with: time, raw y, alphahat (smoothed values), raw residual = raw y - alphahat</span></span>
<span id="cb76-28"><a href="#cb76-28" aria-hidden="true" tabindex="-1"></a><span class="co"># nile_kfas_ll_smooth$alphahat # contains smoothed state variable estimates. for some reason "fitted" doesn't return these.</span></span>
<span id="cb76-29"><a href="#cb76-29" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(nile_kfas_ll_smooth)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="timeseries_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-50_ddaf5bdc5746c8fa8966d1139d85b7b4">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="co"># these give same values</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="co"># cbind(predict(nile_kfas_ll),</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>      <span class="co"># nile_kfas_ll_smooth$alphahat)</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>nile_kfas_ll_ci <span class="ot">&lt;-</span> <span class="fu">predict</span>(nile_kfas_ll, <span class="at">interval =</span> <span class="st">"confidence"</span>, <span class="at">level =</span> .<span class="dv">9</span>)</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>nile_kfas_ll_pi <span class="ot">&lt;-</span> <span class="fu">predict</span>(nile_kfas_ll, <span class="at">interval =</span> <span class="st">"prediction"</span>, <span class="at">level =</span> .<span class="dv">9</span>)</span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>                                                                              </span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>legend_labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"lower_ci"</span>, <span class="st">"upper_ci"</span>, <span class="st">"fit"</span>, <span class="st">"lower_pi"</span>, <span class="st">"upper_pi"</span>)</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a><span class="co"># forecast:::autoplot.mts</span></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a><span class="fu">autoplot</span>(<span class="fu">cbind</span>(nile_kfas_ll_ci[,<span class="sc">-</span><span class="dv">1</span>], nile_kfas_ll_pi),</span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">mapping =</span> <span class="fu">aes</span>(x, y, <span class="at">group =</span> series, <span class="at">linetype =</span> series)) <span class="sc">+</span></span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span>), <span class="at">labels =</span> legend_labels) <span class="sc">+</span></span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span>), <span class="at">labels =</span> legend_labels) <span class="sc">+</span></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Predicted Annual flow"</span>, <span class="at">main =</span> <span class="st">"River Nile"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="timeseries_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="timeseries_cache/html/unnamed-chunk-51_a49870058075f5b74579ad451492eed9">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># forecasting</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a>nile_kfs_mean <span class="ot">&lt;-</span> <span class="fu">KFS</span>(nile_kfas_ll,</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">filtering =</span> <span class="fu">c</span>(<span class="st">'state'</span>)) <span class="co"># specifying "mean" only estimates the smooths (alphahat)</span></span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="at">predict =</span> nile_kfs_mean<span class="sc">$</span>a, <span class="co"># one step ahead prediction</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">filter =</span> nile_kfs_mean<span class="sc">$</span>att, <span class="co"># filter estimates</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">smooth =</span> nile_kfs_mean<span class="sc">$</span>alphahat) <span class="sc">%&gt;%</span>  <span class="co"># smoothed</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">autoplot</span>() <span class="sc">+</span> </span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">700</span>, <span class="dv">1250</span>)) <span class="sc">+</span></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"predict/filter/smooth estiamtes of Nile with KFS"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="timeseries_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../stochastic/ctmc.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">CTMC</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../bootstrap/bootstrap.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Bootstrap</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>