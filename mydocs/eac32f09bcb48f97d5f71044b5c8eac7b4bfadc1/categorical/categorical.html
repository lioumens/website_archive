<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.203">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Michael Liou">
<meta name="dcterms.date" content="2023-03-18">

<title>Personal Documentation - 5&nbsp; Categorical Data Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../changepoint/changepoint.html" rel="next">
<link href="../bayesian/bayesian.html" rel="prev">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script src="../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Categorical Data Analysis</span></h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Personal Documentation</a> 
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Front Page</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../advanced/advanced.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Advanced R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../approximation/approximation.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Approximation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../bayesian/bayesian.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Bayesian</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../categorical/categorical.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Categorical Data Analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../changepoint/changepoint.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Changepoint Analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../chaos/chaos.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Chaos</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../crossover/crossover.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Crossover Designs</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../diffeq/diffeq.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Differential Equations</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../epidemiology/epidemiology.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Epidemiology</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../experimentaldesign/experimentaldesign.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Experimental Design</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../exponential/exponential.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Exponential Modeling</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../gam/gam.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Generalized Additive Models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../longitudinal/longitudinal.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Longitudinal Data Analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../longitudinal/randomcoef.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Random Coefficient Models (CALS)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../longitudinal/within_between.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">The Within-Between Model</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../matrix/matrix.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Matrix Math</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../meta/meta.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Meta Analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../mixed/mixed.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Mixed Models</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../mixed/mixed_variance.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Mixed Models (Variance)</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../network/network_centrality.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Network Centrality</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../network/network_gnar.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">GNAR</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../next_gen_sequencing/next_gen_sequencing.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Next Generation Sequencing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../nonlinear/nonlinear.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Nonlinear</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../observable/observable.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Observable Testing</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../optimization/optimization.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Optimization</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../ordination/ordination.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Ordination</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../parallel/parallel.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Parallel Computing in R</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../plant_breeding/plant_breeding.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Plant Breeding</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../social_network/social_network.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Social Network Analysis</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../spatial/carbayes.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">CARBayes</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../spatial/spatial.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">Spatial Statistics</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stochastic/stochastic.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">Stochastic</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stochastic/ctmc.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">CTMC</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../timeseries/timeseries.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">Time Series</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">Draft</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../bootstrap/bootstrap.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">Bootstrap</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../causal/causal.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">Causal Statistics</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../sensitivity/sensitivity.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title">Sensitivity Analysis</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../signal/signal.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title">Signal Processing</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">Appendices</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../color/color.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Colors in R</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview"><span class="toc-section-number">5.1</span>  Overview</a></li>
  <li><a href="#x2-sampling-mechanisms" id="toc-x2-sampling-mechanisms" class="nav-link" data-scroll-target="#x2-sampling-mechanisms"><span class="toc-section-number">5.2</span>  2x2 sampling mechanisms</a></li>
  <li><a href="#chi-squared-distribution" id="toc-chi-squared-distribution" class="nav-link" data-scroll-target="#chi-squared-distribution"><span class="toc-section-number">5.3</span>  Chi Squared Distribution</a></li>
  <li><a href="#measures-of-association" id="toc-measures-of-association" class="nav-link" data-scroll-target="#measures-of-association"><span class="toc-section-number">5.4</span>  Measures of Association</a></li>
  <li><a href="#goodness-of-fit" id="toc-goodness-of-fit" class="nav-link" data-scroll-target="#goodness-of-fit"><span class="toc-section-number">5.5</span>  Goodness of Fit</a>
  <ul class="collapse">
  <li><a href="#hosmer-lemeshow" id="toc-hosmer-lemeshow" class="nav-link" data-scroll-target="#hosmer-lemeshow"><span class="toc-section-number">5.5.1</span>  Hosmer Lemeshow</a></li>
  <li><a href="#osius-rojek" id="toc-osius-rojek" class="nav-link" data-scroll-target="#osius-rojek"><span class="toc-section-number">5.5.2</span>  Osius-Rojek</a></li>
  <li><a href="#stukel" id="toc-stukel" class="nav-link" data-scroll-target="#stukel"><span class="toc-section-number">5.5.3</span>  Stukel</a></li>
  </ul></li>
  <li><a href="#residuals" id="toc-residuals" class="nav-link" data-scroll-target="#residuals"><span class="toc-section-number">5.6</span>  Residuals</a></li>
  <li><a href="#pseudo-r2" id="toc-pseudo-r2" class="nav-link" data-scroll-target="#pseudo-r2"><span class="toc-section-number">5.7</span>  Pseudo R2</a></li>
  <li><a href="#testing" id="toc-testing" class="nav-link" data-scroll-target="#testing"><span class="toc-section-number">5.8</span>  Testing</a>
  <ul class="collapse">
  <li><a href="#pearson" id="toc-pearson" class="nav-link" data-scroll-target="#pearson"><span class="toc-section-number">5.8.1</span>  Pearson</a></li>
  <li><a href="#likelihood-ratio-test-g-test" id="toc-likelihood-ratio-test-g-test" class="nav-link" data-scroll-target="#likelihood-ratio-test-g-test"><span class="toc-section-number">5.8.2</span>  Likelihood Ratio Test (G Test)</a></li>
  <li><a href="#barnard-exact-test" id="toc-barnard-exact-test" class="nav-link" data-scroll-target="#barnard-exact-test"><span class="toc-section-number">5.8.3</span>  Barnard Exact Test</a></li>
  <li><a href="#mcnemar" id="toc-mcnemar" class="nav-link" data-scroll-target="#mcnemar"><span class="toc-section-number">5.8.4</span>  McNemar</a></li>
  <li><a href="#breslow-day-test" id="toc-breslow-day-test" class="nav-link" data-scroll-target="#breslow-day-test"><span class="toc-section-number">5.8.5</span>  Breslow-Day Test</a></li>
  <li><a href="#wilcox-test" id="toc-wilcox-test" class="nav-link" data-scroll-target="#wilcox-test"><span class="toc-section-number">5.8.6</span>  Wilcox Test</a></li>
  <li><a href="#krustkal-wallis" id="toc-krustkal-wallis" class="nav-link" data-scroll-target="#krustkal-wallis"><span class="toc-section-number">5.8.7</span>  Krustkal Wallis</a></li>
  <li><a href="#cochran-armitrage-trend-test-ordinal" id="toc-cochran-armitrage-trend-test-ordinal" class="nav-link" data-scroll-target="#cochran-armitrage-trend-test-ordinal"><span class="toc-section-number">5.8.8</span>  Cochran-Armitrage Trend Test (ordinal)</a></li>
  <li><a href="#cmh-testing" id="toc-cmh-testing" class="nav-link" data-scroll-target="#cmh-testing"><span class="toc-section-number">5.8.9</span>  CMH testing</a></li>
  <li><a href="#x2-tables-comparison" id="toc-x2-tables-comparison" class="nav-link" data-scroll-target="#x2-tables-comparison"><span class="toc-section-number">5.8.10</span>  2x2 tables Comparison</a></li>
  </ul></li>
  <li><a href="#more-than-two-categories" id="toc-more-than-two-categories" class="nav-link" data-scroll-target="#more-than-two-categories"><span class="toc-section-number">5.9</span>  More than two categories</a>
  <ul class="collapse">
  <li><a href="#poisson-glm-modeling" id="toc-poisson-glm-modeling" class="nav-link" data-scroll-target="#poisson-glm-modeling"><span class="toc-section-number">5.9.1</span>  Poisson GLM Modeling</a></li>
  <li><a href="#log-linear-models" id="toc-log-linear-models" class="nav-link" data-scroll-target="#log-linear-models"><span class="toc-section-number">5.9.2</span>  Log Linear Models</a></li>
  <li><a href="#multinomial-models" id="toc-multinomial-models" class="nav-link" data-scroll-target="#multinomial-models"><span class="toc-section-number">5.9.3</span>  Multinomial Models</a></li>
  </ul></li>
  <li><a href="#evaluating-results" id="toc-evaluating-results" class="nav-link" data-scroll-target="#evaluating-results"><span class="toc-section-number">5.10</span>  Evaluating Results</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Categorical Data Analysis</span></h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Michael Liou </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 18, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-1_3cb4b59915b3cae135dea5deb27063d6">
<details>
<summary>Libraries</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(AMR)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DescTools)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(VGAM)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nnet)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcd) <span class="co"># visualizing categorical data</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vcdExtra) <span class="co"># additional companion code</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(coin)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rlang)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmtoolbox)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmulti) <span class="co"># model averaging and model selection</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rms) <span class="co"># regression modeling strategies, residuals implements gof tests</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ResourceSelection)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># devtools::install_github("https://github.com/cran/LogisticDx")</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(LogisticDx)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="overview" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="overview"><span class="header-section-number">5.1</span> Overview</h2>
<p>This is a very broad area, but I feel like it’s also super confusing because it’s all very confouded in terms of all the chisq tests that are scattered throughout the place. I’m trying to organize everything for myself here.</p>
<ul>
<li>CMH test</li>
<li>score test for table</li>
<li>Pearson</li>
<li>Yates (continuity correction of Pearson)</li>
<li>Barnard test (based on fixing 1 margin)</li>
<li>fisher exact (based on fixing all margins)</li>
<li>McNemar Test</li>
<li>Generalized CMH test</li>
</ul>
</section>
<section id="x2-sampling-mechanisms" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="x2-sampling-mechanisms"><span class="header-section-number">5.2</span> 2x2 sampling mechanisms</h2>
<p>The many different sampling mechanisms arise from different study designs, and are critical to the assumptions of the population you are studying.</p>
<p>In an epidemiological context, the data is given as</p>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th style="text-align: left;">disease</th>
<th style="text-align: left;">no disease</th>
<th></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>exposure</td>
<td style="text-align: left;">a</td>
<td style="text-align: left;">b</td>
<td>n1</td>
</tr>
<tr class="even">
<td>no exposure</td>
<td style="text-align: left;">c</td>
<td style="text-align: left;">d</td>
<td>n0</td>
</tr>
<tr class="odd">
<td></td>
<td style="text-align: left;">m1</td>
<td style="text-align: left;">m0</td>
<td>N</td>
</tr>
</tbody>
</table>
<ul>
<li>Poisson (nothing fixed)</li>
<li>Multinomial (N) total is fixed
<ul>
<li>“Cross Sectional” studies</li>
</ul></li>
<li>Two-sample Binomial (1 margin fixed)
<ul>
<li>“Cohort Study” = n1, n0 fixed</li>
<li>“Case Control Study” = m1, m0 fixed
<ul>
<li>a type of “retrospective” study.</li>
</ul></li>
</ul></li>
<li>Hypergeometric (2 margins fixed)
<ul>
<li>very rarely the case in real experiments, but unfortunately many methods are based on this assumption for the 2x2 table.</li>
</ul></li>
</ul>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true" aria-current="page">Poisson</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">Multinomial</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false">Binomial</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-4" role="tab" aria-controls="tabset-1-4" aria-selected="false">Hypergeometric</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-2_6464c5598f4e82a9ab99298c49d5fc23">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r fold-hide code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Independent Poisson</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' When specifying the mean, they can be specified cellwise, or by table, grouped by the nrow*ncol, in order of the columns</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param mean means of the cells. If 1 number, all cells will have same </span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>rpoisson_table <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">num_tables =</span> <span class="dv">1</span>, <span class="at">mean =</span> <span class="dv">5</span>, <span class="at">nrow =</span> <span class="dv">2</span>,  <span class="at">ncol =</span> <span class="dv">2</span>) {</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  cells <span class="ot">&lt;-</span> <span class="fu">rpois</span>(ncol <span class="sc">*</span> nrow <span class="sc">*</span> num_tables, <span class="at">lambda =</span> mean)</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  vec_table <span class="ot">&lt;-</span> <span class="fu">split</span>(cells, <span class="fu">gl</span>(num_tables, ncol<span class="sc">*</span>nrow))</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">vapply</span>(vec_table, matrix, <span class="at">nrow =</span> nrow, <span class="at">ncol =</span> ncol, <span class="at">byrow =</span> <span class="cn">FALSE</span>, <span class="at">FUN.VALUE =</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span>(ncol<span class="sc">*</span>nrow), <span class="at">nrow =</span> nrow))</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 2x2 examples</span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>poisson_table_examples <span class="ot">&lt;-</span> <span class="fu">rpoisson_table</span>(<span class="dv">5</span>, <span class="at">mean =</span> <span class="dv">5</span>, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(poisson_table_examples,</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">MARGIN =</span> <span class="dv">3</span>,</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">FUN =</span> addmargins,</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">simplify =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>$`1`
         Sum
     8 1   9
     7 5  12
Sum 15 6  21

$`2`
         Sum
    4  6  10
    2  9  11
Sum 6 15  21

$`3`
         Sum
    4  7  11
    2  4   6
Sum 6 11  17

$`4`
         Sum
    2  7   9
    5  4   9
Sum 7 11  18

$`5`
        Sum
    4 4   8
    0 3   3
Sum 4 7  11</code></pre>
</div>
</div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-3_1d938f58de3f5601081bc4322e49906b">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># grand total fixed</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>rmultinom_table <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">num_tables =</span> <span class="dv">1</span>, <span class="at">N =</span> <span class="dv">20</span>, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">p =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>)) {</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stopifnot</span>(<span class="fu">length</span>(p) <span class="sc">==</span> nrow <span class="sc">*</span> ncol)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># p is internally standardized by rmultinom</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  cells <span class="ot">&lt;-</span> <span class="fu">rmultinom</span>(num_tables, N, p)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dim</span>(cells) <span class="ot">&lt;-</span> <span class="fu">c</span>(nrow, ncol, num_tables)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  cells</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-4_c3e403f007d80a03ecaa00f44ead5472">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># examples</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>multinom_table_examples <span class="ot">&lt;-</span> <span class="fu">rmultinom_table</span>(<span class="dv">5</span>, <span class="at">N =</span> <span class="dv">20</span>, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">p =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(multinom_table_examples,</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">MARGIN =</span> <span class="dv">3</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">FUN =</span> addmargins,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">simplify =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
         Sum
     4 7  11
     7 2   9
Sum 11 9  20

[[2]]
         Sum
    5  8  13
    3  4   7
Sum 8 12  20

[[3]]
         Sum
    1  7   8
    8  4  12
Sum 9 11  20

[[4]]
         Sum
    7  6  13
    2  5   7
Sum 9 11  20

[[5]]
         Sum
    4  5   9
    4  7  11
Sum 8 12  20</code></pre>
</div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<p>When not in the 2x2 case, this can also be called an independent multinomial. This is still a case in which one of the margins is fixed.</p>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-5_e570d4e772e2886765a5f14ed36bf53f">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sample a 2x2 table</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>rbinom_table <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">num_tables =</span> <span class="dv">1</span>, <span class="at">row_n =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">10</span>), <span class="at">p =</span> <span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">5</span>)) {</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">vapply</span>(<span class="dv">1</span><span class="sc">:</span>num_tables, </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">FUN =</span> <span class="cf">function</span>(x) {</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>         a <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="fu">length</span>(row_n), row_n, p) <span class="co"># fix margins</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>         binom_table <span class="ot">&lt;-</span> <span class="fu">cbind</span>(a, <span class="at">b =</span> row_n<span class="sc">-</span>a) <span class="co"># make other column by subtraction and combine</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>         <span class="fu">colnames</span>(binom_table) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>         binom_table}, </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">FUN.VALUE =</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="fl">1.1</span>, <span class="dv">4</span>), <span class="at">nrow =</span><span class="dv">2</span>)) <span class="co"># expected 2x2 table</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>binom_table_examples <span class="ot">&lt;-</span> <span class="fu">rbinom_table</span>(<span class="dv">5</span>, <span class="at">row_n =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">10</span>), <span class="at">p =</span> <span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">5</span>))</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(binom_table_examples,</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">MARGIN =</span> <span class="dv">3</span>,</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">FUN =</span> addmargins,</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">simplify =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
         Sum
     7 3  10
     6 4  10
Sum 13 7  20

[[2]]
          Sum
     5  5  10
     5  5  10
Sum 10 10  20

[[3]]
         Sum
     4 6  10
     7 3  10
Sum 11 9  20

[[4]]
          Sum
     5  5  10
     5  5  10
Sum 10 10  20

[[5]]
         Sum
     4 6  10
     7 3  10
Sum 11 9  20</code></pre>
</div>
</div>
</div>
<div id="tabset-1-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-4-tab">
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-6_e9a54325aef3b98ec998ef3298ecc665">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fixed margins</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="co"># one hypergeometrical deviate will determine the entire table.</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># only doing 2x2 tables with sampling method</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>rhyper_table <span class="ot">&lt;-</span> <span class="cf">function</span>(num_tables, <span class="at">row_n =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">10</span>), <span class="at">col_n =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">10</span>))  {</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> <span class="fu">rhyper</span>(num_tables, row_n[<span class="dv">1</span>], row_n[<span class="dv">2</span>], col_n[<span class="dv">1</span>])</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">vapply</span>(a, </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>       <span class="at">FUN =</span> <span class="cf">function</span>(x) {</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>         col1 <span class="ot">&lt;-</span> <span class="fu">c</span>(x, col_n[<span class="dv">1</span>] <span class="sc">-</span> x)</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>         col2 <span class="ot">&lt;-</span> row_n <span class="sc">-</span> col1</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>         contingency_table <span class="ot">&lt;-</span> <span class="fu">cbind</span>(col1, col2)</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>         <span class="fu">colnames</span>(contingency_table) <span class="ot">&lt;-</span> <span class="cn">NULL</span> <span class="co"># get rid of column names</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>         contingency_table</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>       },</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">FUN.VALUE =</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="fl">1.1</span>), <span class="at">nrow =</span> <span class="dv">2</span>))}</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co"># examples</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>hyper_table_examples <span class="ot">&lt;-</span> <span class="fu">rhyper_table</span>(<span class="at">num_tables =</span> <span class="dv">5</span>, <span class="at">row_n =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">10</span>), <span class="at">col_n =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">10</span>))</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(hyper_table_examples,</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">MARGIN =</span> <span class="dv">3</span>,</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">FUN =</span> addmargins,</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">simplify =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[[1]]
          Sum
     4  6  10
     6  4  10
Sum 10 10  20

[[2]]
          Sum
     4  6  10
     6  4  10
Sum 10 10  20

[[3]]
          Sum
     3  7  10
     7  3  10
Sum 10 10  20

[[4]]
          Sum
     5  5  10
     5  5  10
Sum 10 10  20

[[5]]
          Sum
     5  5  10
     5  5  10
Sum 10 10  20</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="chi-squared-distribution" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="chi-squared-distribution"><span class="header-section-number">5.3</span> Chi Squared Distribution</h2>
<p>For testing, the lower the degree of freedom, the more power we have, so 1-df tests are generally good and powerful, but quite specific in the alternative that’s tested.</p>
<div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">8</span>, .<span class="dv">05</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>c1 <span class="ot">&lt;-</span> <span class="fu">dchisq</span>(x, <span class="dv">1</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>c2 <span class="ot">&lt;-</span> <span class="fu">dchisq</span>(x, <span class="dv">2</span>)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>c3 <span class="ot">&lt;-</span> <span class="fu">dchisq</span>(x, <span class="dv">3</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>c5 <span class="ot">&lt;-</span> <span class="fu">dchisq</span>(x, <span class="dv">5</span>)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>c7 <span class="ot">&lt;-</span> <span class="fu">dchisq</span>(x, <span class="dv">7</span>)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>c8 <span class="ot">&lt;-</span> <span class="fu">dchisq</span>(x, <span class="dv">8</span>)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> c1, <span class="at">color =</span> <span class="st">"df = 1"</span>)) <span class="sc">+</span> </span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> c2, <span class="at">color =</span> <span class="st">"df = 2"</span>)) <span class="sc">+</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> c3, <span class="at">color =</span> <span class="st">"df = 3"</span>)) <span class="sc">+</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> c5, <span class="at">color =</span> <span class="st">"df = 5"</span>)) <span class="sc">+</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> c7, <span class="at">color =</span> <span class="st">"df = 7"</span>)) <span class="sc">+</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> c8, <span class="at">color =</span> <span class="st">"df = 8"</span>)) <span class="sc">+</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>)) <span class="sc">+</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"density"</span>,</span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"df"</span>,</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Density"</span>) <span class="sc">+</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_test</span>()</span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="co"># chisq 3, increasing ncf</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>ncp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">8</span>)</span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">x =</span> <span class="fu">list</span>(x), <span class="at">ncp =</span> ncp) <span class="sc">|&gt;</span> <span class="fu">rowwise</span>() <span class="sc">|&gt;</span> </span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">density =</span> <span class="fu">list</span>(<span class="fu">dchisq</span>(x, <span class="at">df =</span> <span class="dv">3</span>, ncp))) <span class="sc">|&gt;</span> </span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="fu">c</span>(x, density)) <span class="sc">|&gt;</span> </span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y =</span> density, <span class="at">color =</span> <span class="fu">factor</span>(ncp))) <span class="sc">+</span></span>
<span id="cb11-27"><a href="#cb11-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb11-28"><a href="#cb11-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">"Noncentrality Parameter"</span>,</span>
<span id="cb11-29"><a href="#cb11-29" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"chisq(df=3) with varying ncp"</span>) <span class="sc">+</span></span>
<span id="cb11-30"><a href="#cb11-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_test</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell quarto-layout-panel" data-hash="categorical_cache/html/unnamed-chunk-7_ce2ec69e11ef129344624c6434675fa1">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="categorical_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="categorical_files/figure-html/unnamed-chunk-7-2.png" class="img-fluid" width="672"></p>
</div>
</div>
</div>
</div>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-8_1384faddda1eaea78eeb94cad3f7f095">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>ncp <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">20</span>, .<span class="dv">1</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qplot</span>(ncp, <span class="fu">pchisq</span>(<span class="dv">3</span>,ncp,<span class="at">lower.tail =</span> <span class="cn">FALSE</span>), <span class="at">geom =</span> <span class="st">"line"</span>, <span class="at">color =</span> <span class="st">"df = 3"</span>) <span class="sc">+</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> ncp , <span class="at">y =</span> <span class="fu">pchisq</span>(<span class="dv">7</span>, ncp, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>), <span class="at">color =</span> <span class="st">"df = 7"</span>)) <span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Power"</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Noncentrality"</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Power and Noncentrality"</span>) <span class="sc">+</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_test</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="categorical_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>For the same noncentrality parameter, the distribution with lower df will have more power. We can compensate for different degrees of freedom with different noncentrality patterns. That is, a lower degree of freedom test will have more power as long as the noncentrality is the same. If the “model is not true” (the ncp is larger) we could still potentially have higher power. The motivation for this figure comes from the Cochran Trend Test.</p>
</section>
<section id="measures-of-association" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="measures-of-association"><span class="header-section-number">5.4</span> Measures of Association</h2>
<p>Given tables, it’s important to distinguish the properties of how to make comparisons, and summarize the information given. When dealing with percentages and ratios, it’s sometimes difficult to have an intuitive understanding of meaning on the percentage scale. The example Professor Guanhua Chen gives to stimulate you for this thinking is from <a href="https://www.cartalk.com/radio/puzzler/porch-potatoes">cartalk</a>:</p>
<blockquote class="blockquote">
<p>RAY: Potatoes are 99 percent water and one percent what? Potato. So say you take a bunch of potatoes, like 100 pounds of potatoes and you set them out on your back porch to dry out. TOM: Yeah, when they are dry they should weigh about a pound. RAY: Well, we’re not drying out completely. And as the potatoes dry out the water begins to evaporate. And after a while, enough water has evaporated so that they are now 98 percent water. If you were to weigh those potatoes at that moment… TOM: They’d be lighter. RAY: Yes, how much lighter? That’s the question. Now you can solve this puzzler algebraically, and if you don’t solve it algebraically, you are going to get the wrong answer. TOM: Really? RAY: Really.What’s your answer, off the top of your head? TOM: 99 pounds. RAY: You are wrong. Answer: RAY: Now, unencumbered by the thought process as usual, my brother guessed 99 pounds. TOM: Yeah. RAY: Now, when I guessed, off the top of my head, I guessed about 90 pounds. TOM: ’Cause it just feels right. RAY: But if you do the math, 1 percent of 100 –which is what the potato is– is one pound. As we told you, that’s 1 percent. So 2 percent, when it’s 98 percent water, two percent of the new weight of the mass is still going to be equal to that one pound, and 2 percent of 50 pounds is a pound. So the potato weight is now 50 pounds, not 100.</p>
</blockquote>
<ul>
<li>Risk Ratio: <span class="math inline">p1 / p2</span>
<ul>
<li>not symmetric</li>
</ul></li>
<li>Odds Ratio (<span class="math inline">[p1/(1 -p1)] / [p2 / (1 - p2)]</span>)
<ul>
<li>symmetric, exposure gives information about disease and vice versa, meaning this is useful for</li>
<li>when the condition is RARE, odds ratio is similar to risk ratio and may permit interpretation as risk ratio. Should definitely be below p &lt; .1</li>
</ul></li>
<li>Risk Difference (<span class="math inline">p1 - p2</span>)</li>
</ul>
</section>
<section id="goodness-of-fit" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="goodness-of-fit"><span class="header-section-number">5.5</span> Goodness of Fit</h2>
<p>The following three tests are provided by this R file, from <a href="http://www.chrisbilder.com/categorical/programs_and_data.html">Analysis of Categorical Data in R</a>.</p>
<p>Low p-values tend to indicate lack of fit.</p>
<p>We’ll use the “Placekicking” Dataset from the textbook, as well as borrowing some of the code from placekicking.R for the analysis.</p>
<p>For all of the goodness of fits, we should work on the “aggregated data”. The textbooks refer to this as the exploratory variable pattern (EVP). The reason for this is so the approximation is closer to correct.</p>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-9_ed0406bad7e0d0463fde266b915956a8">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"AllGOFTests.R"</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>placekick <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"Placekick.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>placekick_search_aicc <span class="ot">&lt;-</span> <span class="fu">glmulti</span>(<span class="at">y =</span> good <span class="sc">~</span> .,</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">data =</span> placekick,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">fitfunction =</span> <span class="st">"glm"</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">level =</span> <span class="dv">1</span>, </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">method =</span> <span class="st">"h"</span>, <span class="co"># h|g|l|d, exhuastive|genetic(large)|branchbound(fast)|summary</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">crit =</span> <span class="st">"aicc"</span>, <span class="co"># aic|bic|aicc|qaic|qaicc</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">weightable</span>(placekick_search_aicc) <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell quarto-layout-panel" data-hash="categorical_cache/html/unnamed-chunk-10_16143de8dd13d27a6fce830451095c73">
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output cell-output-stdout quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<pre><code>Initialization...
TASK: Exhaustive screening of candidate set.
Fitting...

After 50 models:
Best model: good~1+week+distance+change+PAT
Crit= 767.299644897567
Mean crit= 861.376317807727</code></pre>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="categorical_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output cell-output-stdout quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<pre><code>
After 100 models:
Best model: good~1+week+distance+change+PAT
Crit= 767.299644897567
Mean crit= 849.706367688597</code></pre>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="categorical_files/figure-html/unnamed-chunk-10-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output cell-output-stdout quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<pre><code>
After 150 models:
Best model: good~1+week+distance+change+PAT
Crit= 767.299644897567
Mean crit= 793.693748713112</code></pre>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="categorical_files/figure-html/unnamed-chunk-10-3.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output cell-output-stdout quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<pre><code>
After 200 models:
Best model: good~1+distance+change+PAT+wind
Crit= 766.728784139471
Mean crit= 777.754038353278</code></pre>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="categorical_files/figure-html/unnamed-chunk-10-4.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output cell-output-stdout quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<pre><code>
After 250 models:
Best model: good~1+distance+change+PAT+wind
Crit= 766.728784139471
Mean crit= 774.167191225549</code></pre>
</div>
<div class="cell-output-display quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<p><img src="categorical_files/figure-html/unnamed-chunk-10-5.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div class="cell-output cell-output-stdout quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<pre><code>Completed.</code></pre>
</div>
<div class="cell-output cell-output-stdout quarto-layout-cell" style="flex-basis: 50.0%;justify-content: center;">
<pre><code>                                             model     aicc    weights
1        good ~ 1 + distance + change + PAT + wind 766.7288 0.06695515
2 good ~ 1 + week + distance + change + PAT + wind 767.1329 0.05470419
3        good ~ 1 + week + distance + change + PAT 767.2996 0.05032956
4               good ~ 1 + distance + change + PAT 767.3607 0.04881733
5                 good ~ 1 + distance + PAT + wind 767.6899 0.04140743
6 good ~ 1 + distance + change + PAT + type + wind 768.1182 0.03342523</code></pre>
</div>
</div>
</div>
</div>
<p>We can look at the top models for model selection here, and find that df</p>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-11_2e1d7af95af80c0babe16e06737c02a0">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>placekick_bin_data <span class="ot">&lt;-</span> placekick <span class="sc">|&gt;</span> <span class="fu">group_by</span>(distance) <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="at">y =</span> <span class="fu">sum</span>(good),<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">p =</span> y<span class="sc">/</span>n)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>placekick_bin_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 43 × 4
   distance     y     n     p
      &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
 1       18     2     3 0.667
 2       19     7     7 1    
 3       20   776   789 0.984
 4       21    19    20 0.95 
 5       22    12    14 0.857
 6       23    26    27 0.963
 7       24     7     7 1    
 8       25    12    13 0.923
 9       26     8     9 0.889
10       27    24    29 0.828
# … with 33 more rows
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># unweighted logistic function by distance</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>placekick_l <span class="ot">&lt;-</span> <span class="fu">glm</span>(good <span class="sc">~</span> distance, <span class="at">data =</span> placekick, <span class="at">family =</span> <span class="fu">binomial</span>())</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(placekick_l)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = good ~ distance, family = binomial(), data = placekick)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.7441   0.2425   0.2425   0.3801   1.6092  

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  5.812080   0.326277   17.81   &lt;2e-16 ***
distance    -0.115027   0.008339  -13.79   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 1013.43  on 1424  degrees of freedom
Residual deviance:  775.75  on 1423  degrees of freedom
AIC: 779.75

Number of Fisher Scoring iterations: 6</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># weighted logistic function by distance</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>placekick_wl <span class="ot">&lt;-</span> <span class="fu">glm</span>(y<span class="sc">/</span>n <span class="sc">~</span> distance, <span class="at">weights =</span> n, <span class="at">family =</span> binomial, <span class="at">data =</span> placekick_bin_data)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(placekick_wl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = y/n ~ distance, family = binomial, data = placekick_bin_data, 
    weights = n)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-2.0373  -0.6449  -0.1424   0.5004   2.2758  

Coefficients:
             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)  5.812080   0.326277   17.81   &lt;2e-16 ***
distance    -0.115027   0.008339  -13.79   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 282.181  on 42  degrees of freedom
Residual deviance:  44.499  on 41  degrees of freedom
AIC: 148.46

Number of Fisher Scoring iterations: 5</code></pre>
</div>
</div>
<section id="hosmer-lemeshow" class="level3" data-number="5.5.1">
<h3 data-number="5.5.1" class="anchored" data-anchor-id="hosmer-lemeshow"><span class="header-section-number">5.5.1</span> Hosmer Lemeshow</h3>
<p>Why is Hosmer Lemeshow different than just taking the pearson residuals, summing and testing on the error residual degrees of freedom?</p>
<p>The motivation for grouping the fitted values into groups, is so that the chisq approximation is “more correct”. The approximation/large sample deviation is only true when there are a <em>fixed</em> number of categories, and if we were to sample more values for x, we don’t get any new values. That is, assuming that every single residual in the sum has a standard normal error is not quite correct.</p>
<p>One downside of HL test, is that the cuts are done by predicted values. It’s possible we have very different covariate values that have similar predicted values, but they’re grouped together.</p>
<p>There are many ways to do a HLtest, but we’ll walk through them individually. Ultimately I recommend Desctools, or the one created by Prof.&nbsp;Bilder.</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true">Manually</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false"><code>vcdExtra::HLtest</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false">HLTest</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-4" role="tab" aria-controls="tabset-2-4" aria-selected="false"><code>glmtoolbox::hltest</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-5" role="tab" aria-controls="tabset-2-5" aria-selected="false"><code>ResourceSelection::hoslem.test</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-6-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-6" role="tab" aria-controls="tabset-2-6" aria-selected="false"><code>LogisticDx::gof</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-7-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-7" role="tab" aria-controls="tabset-2-7" aria-selected="false"><code>DescTools::HosmerLemeshowTest</code></a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-16_83285e56e58d5d2eb78375015a4a5e89">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Hosmer-Lemeshow Goodness of Fit Test</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' This method implements a few varieties of the popular Hosmer-Lemeshow Goodness of Fit Test, in which the null hypothesis is that the model is a good fit. The most widely used and implemented is splitting into 10 groups dependent on the quantiles of the data, and then summing pearson statistics across each of the groups. Here is a list of the different methods to calculate the Hosmer-Lemeshow (and related) statistics.</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' 1. "deciles_unweighted"</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' 2. "deciles_weighted"</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' 3. "fixed"</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co">#' 4. "fixed_minmax"</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param mod (glm-object) weighted, binomial glm model</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param g (integer) number of groups</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param fixed (logical) whether the categories used should be equally spaced between the min and max of predicted values</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param adjust (logical) use Pigeon and Heyse correction to denominator of HL Statistic</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param breaks (numeric) manual specification of the category groupings. Will include 0 and 1 as min/max.</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param deciles (logical) calculate the statistic with the deciles of risk</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return Hypothesis test for Goodness of Fit of Logistic Regression</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>gof_hl <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, <span class="at">g =</span> <span class="dv">10</span>, <span class="at">fixed =</span> <span class="cn">FALSE</span>, <span class="at">adjust =</span> <span class="cn">FALSE</span>, <span class="at">breaks =</span> <span class="cn">NULL</span>) {</span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># model object checking</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">inherits</span>(mod, <span class="st">"glm"</span>) <span class="sc">|</span> <span class="co"># glm</span></span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>      mod<span class="sc">$</span>family<span class="sc">$</span>family <span class="sc">!=</span> <span class="st">"binomial"</span> <span class="sc">|</span> <span class="co"># binomial glm</span></span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span>(<span class="st">"(weights)"</span> <span class="sc">%in%</span> <span class="fu">names</span>(mod<span class="sc">$</span>model))) <span class="co"># weighted regression</span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>    rlang<span class="sc">::</span><span class="fu">abort</span>(<span class="at">message =</span> <span class="st">"Hosmer Lemeshow Test only implemented for weighted, binomial, glm objects."</span>)</span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>  y_hat <span class="ot">&lt;-</span> <span class="fu">fitted</span>(mod)</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">missing</span>(breaks)) { <span class="co"># manually specified groups</span></span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>    breaks <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">sort</span>(<span class="fu">c</span>(<span class="dv">0</span>, breaks, <span class="dv">1</span>)))</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">max</span>(breaks) <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">|</span> <span class="fu">min</span>(breaks) <span class="sc">&lt;</span> <span class="dv">0</span>) {</span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>        rlang<span class="sc">::</span><span class="fu">abort</span>(<span class="at">message =</span> <span class="st">"breaks should be between 0, 1"</span>)</span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>    method <span class="ot">&lt;-</span> <span class="st">"Hosmer-Lemeshow GOF Test"</span></span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (fixed) { <span class="co"># equally separated groups</span></span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a>    breaks <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(y_hat), <span class="fu">max</span>(y_hat), <span class="at">length.out =</span> g <span class="sc">+</span> <span class="dv">1</span>)</span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a>    method <span class="ot">&lt;-</span> <span class="st">"Hosmer-Lemeshow GOF fixed H Test"</span></span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a>   breaks <span class="ot">&lt;-</span> <span class="fu">quantile</span>(y_hat, <span class="dv">0</span><span class="sc">:</span>g<span class="sc">/</span>g)</span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a>   method <span class="ot">&lt;-</span> <span class="st">"Hosmer-Lemeshow GOF C Test"</span></span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a>  y_cut <span class="ot">&lt;-</span> <span class="fu">cut</span>(y_hat, <span class="fu">unique</span>(breaks), <span class="at">include.lowest =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a>  Mj <span class="ot">&lt;-</span> mod<span class="sc">$</span>prior.weights</span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a>  y0 <span class="ot">&lt;-</span> mod<span class="sc">$</span>y <span class="sc">*</span> Mj</span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a>  y1 <span class="ot">&lt;-</span> Mj <span class="sc">-</span> y0</span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true" tabindex="-1"></a>  y0_exp <span class="ot">&lt;-</span> y_hat <span class="sc">*</span> Mj</span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true" tabindex="-1"></a>  y1_exp <span class="ot">&lt;-</span> Mj <span class="sc">-</span> y0_exp</span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true" tabindex="-1"></a>  <span class="co"># aggregate table</span></span>
<span id="cb28-59"><a href="#cb28-59" aria-hidden="true" tabindex="-1"></a>  cut_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(y_cut, y0, y0_exp, y1, y1_exp, Mj) <span class="sc">|&gt;</span> </span>
<span id="cb28-60"><a href="#cb28-60" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(y_cut) <span class="sc">|&gt;</span> </span>
<span id="cb28-61"><a href="#cb28-61" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">Y0 =</span> <span class="fu">sum</span>(y0),</span>
<span id="cb28-62"><a href="#cb28-62" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Y0_exp =</span> <span class="fu">sum</span>(y0_exp),</span>
<span id="cb28-63"><a href="#cb28-63" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Y1 =</span> <span class="fu">sum</span>(y1),</span>
<span id="cb28-64"><a href="#cb28-64" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Y1_exp =</span> <span class="fu">sum</span>(y1_exp),</span>
<span id="cb28-65"><a href="#cb28-65" aria-hidden="true" tabindex="-1"></a>                     <span class="at">Ni =</span> <span class="fu">sum</span>(Mj),</span>
<span id="cb28-66"><a href="#cb28-66" aria-hidden="true" tabindex="-1"></a>                     <span class="at">pbar =</span> <span class="fu">weighted.mean</span>(y1_exp<span class="sc">/</span>Mj, Mj),</span>
<span id="cb28-67"><a href="#cb28-67" aria-hidden="true" tabindex="-1"></a>                     <span class="at">pbar_var =</span> <span class="fu">sum</span>(Mj <span class="sc">*</span> y1_exp <span class="sc">/</span> Mj <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> y1_exp<span class="sc">/</span>Mj)))</span>
<span id="cb28-68"><a href="#cb28-68" aria-hidden="true" tabindex="-1"></a>                     </span>
<span id="cb28-69"><a href="#cb28-69" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (adjust) {</span>
<span id="cb28-70"><a href="#cb28-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Pigeon Heyse adjustment</span></span>
<span id="cb28-71"><a href="#cb28-71" aria-hidden="true" tabindex="-1"></a>    statistic_col <span class="ot">&lt;-</span> <span class="fu">with</span>(cut_df, </span>
<span id="cb28-72"><a href="#cb28-72" aria-hidden="true" tabindex="-1"></a>         (Y1 <span class="sc">-</span> Ni <span class="sc">*</span> pbar)<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> pbar_var)</span>
<span id="cb28-73"><a href="#cb28-73" aria-hidden="true" tabindex="-1"></a>    hl_table <span class="ot">&lt;-</span> cut_df <span class="sc">|&gt;</span></span>
<span id="cb28-74"><a href="#cb28-74" aria-hidden="true" tabindex="-1"></a>      <span class="fu">add_column</span>(<span class="at">adj_pearson =</span> statistic_col)</span>
<span id="cb28-75"><a href="#cb28-75" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-76"><a href="#cb28-76" aria-hidden="true" tabindex="-1"></a>    method <span class="ot">&lt;-</span> <span class="fu">paste</span>(method, <span class="st">" (Pigeon-Heyse Adjusted)"</span>)</span>
<span id="cb28-77"><a href="#cb28-77" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb28-78"><a href="#cb28-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># pearson statistic, unadjusted</span></span>
<span id="cb28-79"><a href="#cb28-79" aria-hidden="true" tabindex="-1"></a>    statistic_col <span class="ot">&lt;-</span> <span class="fu">with</span>(cut_df,</span>
<span id="cb28-80"><a href="#cb28-80" aria-hidden="true" tabindex="-1"></a>                        (Y0 <span class="sc">-</span> Y0_exp)<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> Y0_exp <span class="sc">+</span> (Y1 <span class="sc">-</span> Y1_exp)<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> Y1_exp)</span>
<span id="cb28-81"><a href="#cb28-81" aria-hidden="true" tabindex="-1"></a>    hl_table <span class="ot">&lt;-</span> cut_df <span class="sc">|&gt;</span> <span class="fu">add_column</span>(<span class="at">pearson =</span> statistic_col)  </span>
<span id="cb28-82"><a href="#cb28-82" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-83"><a href="#cb28-83" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-84"><a href="#cb28-84" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-85"><a href="#cb28-85" aria-hidden="true" tabindex="-1"></a>  nc <span class="ot">&lt;-</span> <span class="fu">length</span>(breaks) <span class="sc">-</span> <span class="dv">1</span> <span class="co"># expected number of categories</span></span>
<span id="cb28-86"><a href="#cb28-86" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">nrow</span>(cut_df) <span class="sc">&lt;</span> nc) {</span>
<span id="cb28-87"><a href="#cb28-87" aria-hidden="true" tabindex="-1"></a>      rlang<span class="sc">::</span><span class="fu">inform</span>(<span class="at">message =</span> glue<span class="sc">::</span><span class="fu">glue</span>(<span class="st">"Empty categories detected, setting g = {num_cat}. </span><span class="sc">\n</span><span class="st">"</span>, <span class="at">num_cat =</span> <span class="fu">nrow</span>(cut_df)), <span class="at">use_cli_format =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-88"><a href="#cb28-88" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-89"><a href="#cb28-89" aria-hidden="true" tabindex="-1"></a>  <span class="co"># expected count warning</span></span>
<span id="cb28-90"><a href="#cb28-90" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(hl_table<span class="sc">$</span>Y0_exp <span class="sc">&lt;</span> <span class="dv">5</span> <span class="sc">|</span> hl_table<span class="sc">$</span>Y1_exp <span class="sc">&lt;</span> <span class="dv">5</span>)) {</span>
<span id="cb28-91"><a href="#cb28-91" aria-hidden="true" tabindex="-1"></a>    <span class="co"># cat(hl_table$Y0_exp, Y1_exp)</span></span>
<span id="cb28-92"><a href="#cb28-92" aria-hidden="true" tabindex="-1"></a>    rlang<span class="sc">::</span><span class="fu">inform</span>(<span class="at">message =</span> <span class="st">"Groups with expected count &lt; 5 detected, chi-squared approximation may not be valid. Consider decreasing number of groups `g`. </span><span class="sc">\n</span><span class="st">"</span>, <span class="at">use_cli_format =</span> <span class="cn">TRUE</span>)</span>
<span id="cb28-93"><a href="#cb28-93" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb28-94"><a href="#cb28-94" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-95"><a href="#cb28-95" aria-hidden="true" tabindex="-1"></a>  <span class="co"># (adjusted) pearson statistic</span></span>
<span id="cb28-96"><a href="#cb28-96" aria-hidden="true" tabindex="-1"></a>  statistic <span class="ot">&lt;-</span> <span class="fu">sum</span>(statistic_col)</span>
<span id="cb28-97"><a href="#cb28-97" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(statistic) <span class="ot">&lt;-</span> <span class="st">"X-squared"</span></span>
<span id="cb28-98"><a href="#cb28-98" aria-hidden="true" tabindex="-1"></a>  df <span class="ot">&lt;-</span> <span class="fu">nrow</span>(cut_df) <span class="sc">-</span> <span class="dv">2</span></span>
<span id="cb28-99"><a href="#cb28-99" aria-hidden="true" tabindex="-1"></a>  p.value <span class="ot">&lt;-</span> <span class="fu">pchisq</span>(statistic, df, <span class="at">lower.tail =</span> <span class="cn">FALSE</span>)</span>
<span id="cb28-100"><a href="#cb28-100" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-101"><a href="#cb28-101" aria-hidden="true" tabindex="-1"></a>  <span class="fu">structure</span>(<span class="fu">list</span>(<span class="at">statistic =</span> statistic,</span>
<span id="cb28-102"><a href="#cb28-102" aria-hidden="true" tabindex="-1"></a>                 <span class="at">parameter =</span> <span class="fu">c</span>(<span class="at">df =</span> df),</span>
<span id="cb28-103"><a href="#cb28-103" aria-hidden="true" tabindex="-1"></a>                 <span class="at">p.value =</span> p.value,</span>
<span id="cb28-104"><a href="#cb28-104" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data.name =</span> mod<span class="sc">$</span>call<span class="sc">$</span>data,</span>
<span id="cb28-105"><a href="#cb28-105" aria-hidden="true" tabindex="-1"></a>                 <span class="at">method =</span> method,</span>
<span id="cb28-106"><a href="#cb28-106" aria-hidden="true" tabindex="-1"></a>                 <span class="at">alternative =</span> <span class="st">"Population is not a good fit for the assumed model."</span>,</span>
<span id="cb28-107"><a href="#cb28-107" aria-hidden="true" tabindex="-1"></a>                 <span class="at">table =</span> hl_table <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>pbar_var)),</span>
<span id="cb28-108"><a href="#cb28-108" aria-hidden="true" tabindex="-1"></a>            <span class="at">class =</span> <span class="st">"htest"</span>)</span>
<span id="cb28-109"><a href="#cb28-109" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb28-110"><a href="#cb28-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-111"><a href="#cb28-111" aria-hidden="true" tabindex="-1"></a><span class="co"># placekick_wl_hl0 &lt;- gof_hl(placekick_wl, breaks = c(.48, .5, .7))</span></span>
<span id="cb28-112"><a href="#cb28-112" aria-hidden="true" tabindex="-1"></a><span class="co"># placekick_wl_hl0 &lt;- gof_hl(placekick_wl, breaks = c(.1, .3, .6, .8))</span></span>
<span id="cb28-113"><a href="#cb28-113" aria-hidden="true" tabindex="-1"></a><span class="co"># placekick_wl_hl0 &lt;- gof_hl(placekick_wl, fixed = TRUE, g = 5)</span></span>
<span id="cb28-114"><a href="#cb28-114" aria-hidden="true" tabindex="-1"></a><span class="co"># placekick_wl_hl0 &lt;- gof_hl(placekick_wl, fixed = TRUE)</span></span>
<span id="cb28-115"><a href="#cb28-115" aria-hidden="true" tabindex="-1"></a><span class="co"># placekick_wl_hl0 &lt;- gof_hl(placekick_wl, g = 50)</span></span>
<span id="cb28-116"><a href="#cb28-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-117"><a href="#cb28-117" aria-hidden="true" tabindex="-1"></a>placekick_wl_hl0 <span class="ot">&lt;-</span> <span class="fu">gof_hl</span>(placekick_wl, <span class="at">fixed =</span> <span class="cn">FALSE</span>, <span class="at">adjust =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Groups with expected count &lt; 5 detected, chi-squared approximation may not be
valid. Consider decreasing number of groups `g`.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>placekick_wl_hl0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Hosmer-Lemeshow GOF C Test

data:  placekick_bin_data
X-squared = 11.028, df = 8, p-value = 0.2001
alternative hypothesis: Population is not a good fit for the assumed model.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>placekick_wl_hl0<span class="sc">$</span>table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 8
   y_cut            Y0 Y0_exp    Y1 Y1_exp    Ni   pbar pearson
   &lt;fct&gt;         &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;int&gt;  &lt;dbl&gt;   &lt;dbl&gt;
 1 [0.144,0.353]     2   1.17     3   3.83     5 0.766   0.770 
 2 (0.353,0.469]    13  13.7     19  18.3     32 0.570   0.0714
 3 (0.469,0.589]    39  33.9     25  30.1     64 0.470   1.62  
 4 (0.589,0.699]    49  46.6     24  26.4     73 0.362   0.347 
 5 (0.699,0.79]     74  79.4     32  26.6    106 0.251   1.45  
 6 (0.79,0.859]     75  77.1     18  15.9     93 0.171   0.334 
 7 (0.859,0.908]    69  71.8     12   9.17    81 0.113   0.983 
 8 (0.908,0.941]    72  76.1     10   5.87    82 0.0716  3.12  
 9 (0.941,0.963]    53  53.4      3   2.57    56 0.0459  0.0759
10 (0.963,0.977]   816 809.      17  24.3    833 0.0291  2.25  </code></pre>
</div>
</div>
<p>These results match the implementation in Bilder’s HLTest,</p>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<p>This is the version in <code>vcdExtra</code>, but I think it’s incorrect for the aggregated model. The totals are not correct, and I don’t think the code accounts for the prior weights.</p>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-17_22b9023ee47cb577fd746a579d34a68d">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>placekick_wl_hl <span class="ot">&lt;-</span> vcdExtra<span class="sc">::</span><span class="fu">HLtest</span>(placekick_wl)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>placekick_wl_hl<span class="sc">$</span>table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>             cut total       obs       exp         chi
1  [0.144,0.353]     5 3.0000000 3.8307555 -0.42445439
2  (0.353,0.469]     4 2.2503053 2.3372021 -0.05684024
3  (0.469,0.589]     4 1.5181287 1.8823620 -0.26547777
4  (0.589,0.699]     4 1.2722567 1.4393681 -0.13929004
5   (0.699,0.79]     5 1.5438799 1.2586321  0.25425704
6   (0.79,0.859]     4 0.7446261 0.6674089  0.09451877
7  (0.859,0.908]     4 0.5297562 0.4492600  0.12009552
8  (0.908,0.941]     4 0.4650036 0.2960067  0.31061890
9  (0.941,0.963]     4 0.2250712 0.1921646  0.07506648
10 (0.963,0.977]     5 0.5426670 0.1466858  1.03390508</code></pre>
</div>
</div>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-18_300cc3d7acf8bc0f24d2b78c494fb212">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">try</span>(placekick_wl_hl <span class="ot">&lt;-</span> vcdExtra<span class="sc">::</span><span class="fu">HLtest</span>(placekick_l))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Error in cut.default(yhat, breaks = quantile(yhat, probs = seq(0, 1, 1/g)),  : 
  'breaks' are not unique</code></pre>
</div>
</div>
<p>Well, unfortunately the unaggregated version errors out because of the cut command is not unique. In this case, I think it would have worked for other datasets, but the deciles of risk overlap in this case.</p>
<p>Overall do not recommend this function, although there is fairly convenient table output.</p>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<p>I think this is the best one available I’ve found. This is the function provided by Dr.&nbsp;Bilder:</p>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-19_45092b546cb1c852fa5c44ff9e0d7d78">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>placekick_wl_hl2 <span class="ot">&lt;-</span> <span class="fu">HLTest</span>(placekick_wl, <span class="at">g =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in HLTest(placekick_wl, g = 10): Some expected counts are less than 5.
Use smaller number of groups</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(placekick_wl_hl2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Hosmer and Lemeshow goodness-of-fit test with 10 bins

data:  placekick_wl
X2 = 11.028, df = 8, p-value = 0.2001</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(placekick_wl_hl2<span class="sc">$</span>observed, <span class="fu">round</span>(placekick_wl_hl2<span class="sc">$</span>expect, <span class="at">digits =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>              Y0  Y1 Y0hat Y1hat
[0.144,0.353]  3   2   3.8   1.2
(0.353,0.469] 19  13  18.3  13.7
(0.469,0.589] 25  39  30.1  33.9
(0.589,0.699] 24  49  26.4  46.6
(0.699,0.79]  32  74  26.6  79.4
(0.79,0.859]  18  75  15.9  77.1
(0.859,0.908] 12  69   9.2  71.8
(0.908,0.941] 10  72   5.9  76.1
(0.941,0.963]  3  53   2.6  53.4
(0.963,0.977] 17 816  24.3 808.7</code></pre>
</div>
</div>
<p>This table is useful because it breaks down the statistic into the 10 groups used for the cuts. We should look at the table for large deviations. Although I would still like a function in which I can specify the cuts manually and evaluate the robustness of the HLtest.</p>
</div>
<div id="tabset-2-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-4-tab">
<p>This function seems like it’s doing as it should, but has an automatic way of calculating the number of groups without a way of modifying the number of groups used. Though it does look like the statistic is being calculated correctly from the code.</p>
<p>I don’t like this version becaues the group cuts are not displayed, and so diagnosing where the model fits and doesn’t fit is not very useful. It’s also an automatic selection, which makes it hard to test sensitivity.</p>
<p>The results of this test are also dramatically different than the HLTest. We would conclude that the logistic regression is not a good fit from this test, but from the other cuts, with 10 groups, we would conclude it’s an okay fit.</p>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-20_5f677a87916371cd9150b3cd9deb08e2">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>placekick_wl_hl3 <span class="ot">&lt;-</span> glmtoolbox<span class="sc">::</span><span class="fu">hltest</span>(placekick_wl) <span class="co"># different, but I think it's because of the different cuts</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
   The Hosmer-Lemeshow goodness-of-fit test

 Group Size Observed   Expected
     1  138       79  71.412836
     2  142       98 103.379735
     3  133      111 112.160333
     4  145      125 133.730775
     5   68       64  65.436785
     6  789      776 766.130460
     7   10        9   9.749077

         Statistic =  17.62778 
degrees of freedom =  5 
           p-value =  0.003451 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>placekick_wl_hl3<span class="sc">$</span>hm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>  Group Size Observed   Expected
1     1  138       79  71.412836
2     2  142       98 103.379735
3     3  133      111 112.160333
4     4  145      125 133.730775
5     5   68       64  65.436785
6     6  789      776 766.130460
7     7   10        9   9.749077</code></pre>
</div>
</div>
</div>
<div id="tabset-2-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-5-tab">
<p>Does not implement the weighted glm version. This version fixes the problem in <code>vcdExtra</code> in which for the raw model, we need to use “unique” quantiles, otherwise the <code>cut</code> function will not work with repeated values. Hence if you request <code>g = 10</code> 10 groups, you may only end up with 6 groups. This is fine, but now the df in the test is incorrect, and doesn’t adjust for the fact that <code>g</code> is lower now, and instead uses the df as you requested.</p>
<p>The conclusion from this test would be similar to the version by Dr.&nbsp;Bilder, and also gives the table of cuts, but also not recommended.</p>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-21_e95729370412fed92737b7c700424a30">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># aggregated (incorrect results)</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>placekick_wl_hl4 <span class="ot">&lt;-</span> ResourceSelection<span class="sc">::</span><span class="fu">hoslem.test</span>(placekick_bin_data<span class="sc">$</span>p, <span class="fu">fitted</span>(placekick_wl))</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(placekick_wl_hl4<span class="sc">$</span>observed, placekick_wl_hl4<span class="sc">$</span>expected)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>                     y0       y1     yhat0    yhat1
[0.144,0.353] 3.0000000 2.000000 3.8307555 1.169244
(0.353,0.469] 2.2503053 1.749695 2.3372021 1.662798
(0.469,0.589] 1.5181287 2.481871 1.8823620 2.117638
(0.589,0.699] 1.2722567 2.727743 1.4393681 2.560632
(0.699,0.79]  1.5438799 3.456120 1.2586321 3.741368
(0.79,0.859]  0.7446261 3.255374 0.6674089 3.332591
(0.859,0.908] 0.5297562 3.470244 0.4492600 3.550740
(0.908,0.941] 0.4650036 3.534996 0.2960067 3.703993
(0.941,0.963] 0.2250712 3.774929 0.1921646 3.807835
(0.963,0.977] 0.5426670 4.457333 0.1466858 4.853314</code></pre>
</div>
</div>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-22_52128b7cd3c9c35ec67760400bb714c8">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># not aggregated (still incorrect)</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>placekick_wl_hl4 <span class="ot">&lt;-</span> ResourceSelection<span class="sc">::</span><span class="fu">hoslem.test</span>(placekick<span class="sc">$</span>good, <span class="fu">fitted</span>(placekick_l), <span class="at">g =</span> <span class="dv">10</span>)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(placekick_wl_hl4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Hosmer and Lemeshow goodness of fit (GOF) test

data:  placekick$good, fitted(placekick_l)
X-squared = 10.943, df = 8, p-value = 0.2049</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(placekick_wl_hl4<span class="sc">$</span>observed, placekick_wl_hl4<span class="sc">$</span>expected)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>              y0  y1      yhat0      yhat1
[0.144,0.654] 66  90 72.8183761  83.181624
(0.654,0.809] 42 110 37.7476996 114.252300
(0.809,0.894] 24 111 18.6639785 116.336021
(0.894,0.96]  14 135  9.4944324 139.505568
(0.96,0.971]  16 807 24.0245900 798.975410
(0.971,0.977]  1   9  0.2509234   9.749077</code></pre>
</div>
</div>
</div>
<div id="tabset-2-6" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-6-tab">
<p>This package was taken off of CRAN, but has many of the binomial diagnostics implemented. There certainly are a lot of tests, but most are automatic unfortunatly. it would be helpful to review the source code for this package to understand the statistics <a href="https://github.com/cran/LogisticDx/blob/master/R/gof.R">gof.R</a></p>
<p>I see the same problem here with the number of groups in which we’re using the df from the groups requested rather than the actual number of groups formed. I also kind of have a problem in which most of the tests are somewhat meaningless in the binomial context, but there’s no discrimination for what is reported since they’re calculated for all glm. ie, i’m not sure I trust a lot of these statistics.</p>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-23_7edf9c0011d81145b22a978add935a26">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LogisticDx::gof(placekick_wl) </span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>placekick_wl_hl5 <span class="ot">&lt;-</span> LogisticDx<span class="sc">::</span><span class="fu">gof</span>(placekick_l) <span class="co"># note this is on the unweighted version of the binomial</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output-display">
<p><img src="categorical_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>placekick_wl_hl5<span class="sc">$</span>chiSq <span class="co"># many "chisq" statistics. for logisitc regression, these are rarely chisq</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>   test      chiSq   df       pVal
1:  PrI 1285.23292 1423 0.99607219
2:  drI  775.74504 1423 1.00000000
3:  PrG   56.11361   41 0.05810763
4:  drG   44.49945   41 0.32665475
5: PrCT   56.11361   41 0.05810763
6: drCT   44.49945   41 0.32665475</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>placekick_wl_hl5<span class="sc">$</span>ct <span class="co"># contingency table by fitted values</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>      n       y1hat  y1       y0hat y0
 1:  14  11.9903588  12  2.00964122  2
 2:  11   9.9475955  10  1.05240450  1
 3:  28  22.1251760  22  5.87482397  6
 4:  27  25.9079221  26  1.09207789  1
 5:  23  13.8019963  14  9.19800367  9
 6:  28  22.6413539  23  5.35864608  5
 7:  19   9.7884586  10  9.21154141  9
 8:  27  19.6370642  20  7.36293580  7
 9:  17  15.6818888  16  1.31811123  1
10:  18  10.2994561  10  7.70054394  8
11:  22  18.5179520  18  3.48204796  4
12:  19  16.5304611  16  2.46953892  3
13:  22  20.4666378  20  1.53336219  2
14:   7   6.8185767   7  0.18142327  0
15:  20  19.3519119  19  0.64808806  1
16:  13  12.3450262  12  0.65497381  1
17:  10   7.4950738   7  2.50492615  3
18:   7   6.6839126   7  0.31608744  0
19:  18  12.2287724  13  5.77122761  5
20:  18  11.7687880  11  6.23121197  7
21:   9   8.4943857   8  0.50561429  1
22:  14  12.7935732  12  1.20642684  2
23:  21  18.5322377  20  2.46776230  1
24:  29  23.9479698  22  5.05203021  7
25:  19  14.6390859  13  4.36091406  6
26:   1   0.1443427   0  0.85565732  1
27:  13   5.9510644   5  7.04893556  8
28:   1   0.1923830   0  0.80761700  1
29:   1   0.2108893   0  0.78911067  1
30:  12   6.5259669   8  5.47403313  4
31:   9   3.8645259   5  5.13547415  4
32: 789 766.1304600 776 22.86954002 13
33:  14  13.4930381  12  0.50696191  2
34:  14   8.7828623  11  5.21713771  3
35:  30  26.8170421  23  3.18295790  7
36:  29  27.1846258  24  1.81537422  5
37:  22  15.4857741  12  6.51422592 10
38:   3   1.1224974   2  1.87750262  1
39:   3   2.9304999   2  0.06950011  1
40:   7   2.8102631   1  4.18973691  6
41:   1   0.3476436   1  0.65235639  0
42:  15   7.2965005  11  7.70349952  4
43:   1   0.2739858   1  0.72601417  0
      n       y1hat  y1       y0hat y0</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>placekick_wl_hl5<span class="sc">$</span>ctHL</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>       P  y1     y1hat y0     y0hat   n      Pbar
1: 0.627  79  71.41284 59 66.587164 138 0.5174843
2:  0.79  98 103.37973 44 38.620265 142 0.7280263
3: 0.882 111 112.16033 22 20.839667 133 0.8433108
4: 0.955 132 140.41469 20 11.585312 152 0.9237808
5: 0.968  57  58.75287  4  2.247128  61 0.9631618
6: 0.977 785 775.87954 14 23.120463 799 0.9710632</code></pre>
</div>
</div>
<p>The <code>dx</code> function in this package is incredibly useful though, see the help file for all the residual help we get.</p>
</div>
<div id="tabset-2-7" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-7-tab">
<p>The two gof tests implemented here are <code>C</code> statistic, which is the 10 deciles or risk, and <code>H</code> are fixed cutpoints (equally separated by number of groups between min and max). The notation comes from 1997 paper by hosmer and lemeshow.</p>
<p>There is also another test based on smooth residuals based on the X space, smoothed residuals that is only calculated when the covariate space is specified.</p>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-25_27163b1bcded26e5978e79521239541c">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># DescTools::HosmerLemeshowTest(fit = fitted(placekick_wl), obs = placekick_bin_data$p, X = cbind(placekick_bin_data$distance), verbose = TRUE) # incorrect, doesn't count weights</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>placekick_wl_hl6 <span class="ot">&lt;-</span> DescTools<span class="sc">::</span><span class="fu">HosmerLemeshowTest</span>(<span class="at">fit =</span> <span class="fu">fitted</span>(placekick_l),</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">obs =</span> placekick<span class="sc">$</span>good,</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">X =</span> <span class="fu">cbind</span>(placekick<span class="sc">$</span>distance),</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">verbose =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in DescTools::HosmerLemeshowTest(fit = fitted(placekick_l), obs =
placekick$good, : Found only 6 different groups for Hosmer-Lemesho C statistic.</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(placekick_wl_hl6)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(placekick_wl_hl6<span class="sc">$</span>C<span class="sc">$</span>observed, placekick_wl_hl6<span class="sc">$</span>C<span class="sc">$</span>expected)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Groups for Hosmer-Lemeshow C statistic:
cutfit
[0.144,0.654] (0.654,0.809] (0.809,0.894]  (0.894,0.96]  (0.96,0.971] 
          156           152           135           149           823 
(0.971,0.977] 
           10 
Groups for Hosmer-Lemeshow H statistic:
cutfit1
[0.144,0.228] (0.228,0.311] (0.311,0.394] (0.394,0.477] (0.477,0.561] 
            3             1             4            29            46 
(0.561,0.644] (0.644,0.727]  (0.727,0.81]  (0.81,0.894] (0.894,0.978] 
           55            58           112           105          1012 
$C

    Hosmer-Lemeshow C statistic

data:  fitted(placekick_l) and placekick$good
X-squared = 10.943, df = 4, p-value = 0.02721


$H

    Hosmer-Lemeshow H statistic

data:  fitted(placekick_l) and placekick$good
X-squared = 10.362, df = 8, p-value = 0.2405


$gof

    le Cessie-van Houwelingen-Copas-Hosmer global goodness of fit test

data:  fitted(placekick_l) and placekick$good
z = 0.51185, p-value = 0.6088

              0s  1s         Os         1s
[0.144,0.654] 66  90 72.8183761  83.181624
(0.654,0.809] 42 110 37.7476996 114.252300
(0.809,0.894] 24 111 18.6639785 116.336021
(0.894,0.96]  14 135  9.4944324 139.505568
(0.96,0.971]  16 807 24.0245900 798.975410
(0.971,0.977]  1   9  0.2509234   9.749077</code></pre>
</div>
</div>
<p>I like this function, as it seems to print out mose of the important aspects of the test I want. This function <em>does</em> adjust for the fact that only 6 unique cuts were formed, and does testing on the righ</p>
</div>
</div>
</div>
<p>overall I recommend the one by dr. bilder, or the manual one you’ve made.</p>
</section>
<section id="osius-rojek" class="level3" data-number="5.5.2">
<h3 data-number="5.5.2" class="anchored" data-anchor-id="osius-rojek"><span class="header-section-number">5.5.2</span> Osius-Rojek</h3>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Manually</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false"><code>sjstats::chisq_gof</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false"><code>o.r.test</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-4" role="tab" aria-controls="tabset-3-4" aria-selected="false"><code>LogisticDx:gof</code></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-5" role="tab" aria-controls="tabset-3-5" aria-selected="false"><code>or.test</code></a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-27_ab24a0d35396603e066e5609d8f2f6b3">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Osius and Rojek</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' Implements the goodness of fit tests examined by osius and rojek</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param mod weighted, binomial, glm</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param ss standardize the sum of squares instead of pearson statistic</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return htest</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export</span></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a>gof_or <span class="ot">&lt;-</span> <span class="cf">function</span>(mod, <span class="at">ss =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># type checking for weighted binomial glm</span></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">inherits</span>(mod, <span class="st">"glm"</span>) <span class="sc">|</span> <span class="co"># glm</span></span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>      mod<span class="sc">$</span>family<span class="sc">$</span>family <span class="sc">!=</span> <span class="st">"binomial"</span> <span class="sc">|</span> <span class="co"># binomial glm</span></span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>      <span class="sc">!</span>(<span class="st">"(weights)"</span> <span class="sc">%in%</span> <span class="fu">names</span>(mod<span class="sc">$</span>model))) <span class="co"># weighted regression</span></span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>    rlang<span class="sc">::</span><span class="fu">abort</span>(<span class="at">message =</span> <span class="st">"Osius Rojek Test only implemented for weighted, binomial, glm objects."</span>)</span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb67-20"><a href="#cb67-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb67-21"><a href="#cb67-21" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> mod<span class="sc">$</span>y</span>
<span id="cb67-22"><a href="#cb67-22" aria-hidden="true" tabindex="-1"></a>  J <span class="ot">&lt;-</span> <span class="fu">length</span>(y)</span>
<span id="cb67-23"><a href="#cb67-23" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> mod<span class="sc">$</span>rank <span class="sc">-</span> <span class="dv">1</span> <span class="co"># num independent parameters?</span></span>
<span id="cb67-24"><a href="#cb67-24" aria-hidden="true" tabindex="-1"></a>  phat <span class="ot">&lt;-</span> <span class="fu">fitted</span>(mod)</span>
<span id="cb67-25"><a href="#cb67-25" aria-hidden="true" tabindex="-1"></a>  mj <span class="ot">&lt;-</span> mod<span class="sc">$</span>prior.weights</span>
<span id="cb67-26"><a href="#cb67-26" aria-hidden="true" tabindex="-1"></a>  vj <span class="ot">&lt;-</span> mj <span class="sc">*</span> phat <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> phat)</span>
<span id="cb67-27"><a href="#cb67-27" aria-hidden="true" tabindex="-1"></a>  cj <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> phat) <span class="sc">/</span> vj</span>
<span id="cb67-28"><a href="#cb67-28" aria-hidden="true" tabindex="-1"></a>  A <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (J <span class="sc">-</span> <span class="fu">sum</span>(<span class="dv">1</span><span class="sc">/</span>mj))</span>
<span id="cb67-29"><a href="#cb67-29" aria-hidden="true" tabindex="-1"></a>  X2 <span class="ot">&lt;-</span> <span class="fu">sum</span>((mj<span class="sc">*</span>y <span class="sc">-</span> mj<span class="sc">*</span>phat)<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> vj) <span class="co"># pearson statistic</span></span>
<span id="cb67-30"><a href="#cb67-30" aria-hidden="true" tabindex="-1"></a>  S <span class="ot">&lt;-</span> <span class="fu">sum</span>((mj<span class="sc">*</span>y <span class="sc">-</span> mj <span class="sc">*</span> phat)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb67-31"><a href="#cb67-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (ss) {</span>
<span id="cb67-32"><a href="#cb67-32" aria-hidden="true" tabindex="-1"></a>    dj <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> phat)</span>
<span id="cb67-33"><a href="#cb67-33" aria-hidden="true" tabindex="-1"></a>    new_form <span class="ot">&lt;-</span> <span class="fu">update</span>(mod<span class="sc">$</span>formula, dj<span class="sc">~</span>.)</span>
<span id="cb67-34"><a href="#cb67-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">environment</span>(new_form) <span class="ot">&lt;-</span> <span class="fu">environment</span>()</span>
<span id="cb67-35"><a href="#cb67-35" aria-hidden="true" tabindex="-1"></a>    wlm <span class="ot">&lt;-</span> <span class="fu">lm</span>(new_form, <span class="at">data =</span> <span class="fu">cbind</span>(mod<span class="sc">$</span>data, dj), <span class="at">weights =</span> vj)</span>
<span id="cb67-36"><a href="#cb67-36" aria-hidden="true" tabindex="-1"></a>    RSS <span class="ot">&lt;-</span> <span class="fu">sum</span>(vj <span class="sc">*</span> <span class="fu">residuals</span>(wlm)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb67-37"><a href="#cb67-37" aria-hidden="true" tabindex="-1"></a>    zstat <span class="ot">&lt;-</span> (S <span class="sc">-</span> <span class="fu">sum</span>(vj)) <span class="sc">/</span> <span class="fu">sqrt</span>(A <span class="sc">+</span> RSS)</span>
<span id="cb67-38"><a href="#cb67-38" aria-hidden="true" tabindex="-1"></a>    method <span class="ot">&lt;-</span> <span class="st">"Osius Rojek Goodness of Fit Test, Normalized Sum. Sq"</span></span>
<span id="cb67-39"><a href="#cb67-39" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb67-40"><a href="#cb67-40" aria-hidden="true" tabindex="-1"></a>    new_form <span class="ot">&lt;-</span> <span class="fu">update</span>(mod<span class="sc">$</span>formula, cj<span class="sc">~</span>.)</span>
<span id="cb67-41"><a href="#cb67-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">environment</span>(new_form) <span class="ot">&lt;-</span> <span class="fu">environment</span>() <span class="co"># need to update formula environment because model was created outside function</span></span>
<span id="cb67-42"><a href="#cb67-42" aria-hidden="true" tabindex="-1"></a>    wlm <span class="ot">&lt;-</span> <span class="fu">lm</span>(new_form, <span class="at">data =</span> <span class="fu">cbind</span>(mod<span class="sc">$</span>data, cj), <span class="at">weights =</span> vj)</span>
<span id="cb67-43"><a href="#cb67-43" aria-hidden="true" tabindex="-1"></a>    RSS <span class="ot">&lt;-</span> <span class="fu">sum</span>(vj <span class="sc">*</span> <span class="fu">residuals</span>(wlm)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb67-44"><a href="#cb67-44" aria-hidden="true" tabindex="-1"></a>    zstat <span class="ot">&lt;-</span> <span class="fu">sum</span>(X2 <span class="sc">-</span> (J <span class="sc">-</span> p <span class="sc">-</span> <span class="dv">1</span>)) <span class="sc">/</span> (<span class="fu">sqrt</span>(A <span class="sc">+</span> RSS)) <span class="co"># not sure what the mean of the pearson chisq should be, could check against</span></span>
<span id="cb67-45"><a href="#cb67-45" aria-hidden="true" tabindex="-1"></a>    method <span class="ot">&lt;-</span> <span class="st">"Osius Rojek Goodness of Fit Test, Normalized Pearson"</span></span>
<span id="cb67-46"><a href="#cb67-46" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb67-47"><a href="#cb67-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(zstat) <span class="ot">&lt;-</span> <span class="st">"z"</span></span>
<span id="cb67-48"><a href="#cb67-48" aria-hidden="true" tabindex="-1"></a>  p.value <span class="ot">&lt;-</span> <span class="fu">pnorm</span>(<span class="fu">abs</span>(zstat), <span class="at">lower.tail =</span> <span class="cn">FALSE</span>) <span class="sc">*</span> <span class="dv">2</span> <span class="co"># two sided</span></span>
<span id="cb67-49"><a href="#cb67-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">structure</span>(<span class="fu">list</span>(<span class="at">p.value =</span> p.value,</span>
<span id="cb67-50"><a href="#cb67-50" aria-hidden="true" tabindex="-1"></a>                 <span class="at">statistic =</span> zstat,</span>
<span id="cb67-51"><a href="#cb67-51" aria-hidden="true" tabindex="-1"></a>                 <span class="at">method =</span> method,</span>
<span id="cb67-52"><a href="#cb67-52" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data.name =</span> mod<span class="sc">$</span>call<span class="sc">$</span>data,</span>
<span id="cb67-53"><a href="#cb67-53" aria-hidden="true" tabindex="-1"></a>                 <span class="at">alternative =</span> <span class="st">"Model is not a good fit."</span>),</span>
<span id="cb67-54"><a href="#cb67-54" aria-hidden="true" tabindex="-1"></a>            <span class="at">class =</span> <span class="st">"htest"</span>)</span>
<span id="cb67-55"><a href="#cb67-55" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb67-56"><a href="#cb67-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb67-57"><a href="#cb67-57" aria-hidden="true" tabindex="-1"></a>placekick_wl_or0 <span class="ot">&lt;-</span> <span class="fu">gof_or</span>(placekick_wl, <span class="at">ss =</span> <span class="cn">FALSE</span>)</span>
<span id="cb67-58"><a href="#cb67-58" aria-hidden="true" tabindex="-1"></a>placekick_wl_or0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Osius Rojek Goodness of Fit Test, Normalized Pearson

data:  placekick_bin_data
z = 1.466, p-value = 0.1426
alternative hypothesis: Model is not a good fit.</code></pre>
</div>
</div>
<p>There’s a little bit of controversy as to what the approriate mean for the pearson statistic is, i’ve seen n - p - 1 and n - p.&nbsp;I should look back in the original paper and look at the asymptotic results, or do some more simlations as to the better mean under various situations.</p>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<p>I don’t think this version is implementing the RSS correctly, it should be with weights, so I’ve submitted a bug report. It looks like the implementation is the nearly the same as mine though.</p>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-29_5bea0137b58806d75d051a25e45ed122">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>placekick_wl_or <span class="ot">&lt;-</span> sjstats<span class="sc">::</span><span class="fu">chisq_gof</span>(placekick_wl)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>placekick_wl_or</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
# Chi-squared Goodness-of-Fit Test

  Chi-squared: 56.114
      z-score:  0.804
      p-value:  0.421</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Summary: model seems to fit well.</code></pre>
</div>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<p>unfortunately gives different value than the oj test above</p>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-31_2df2ea91911fe7527850bee48c85be6d">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># seems that it just prints the value and no test object</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>placekick_wl_or2 <span class="ot">&lt;-</span> <span class="fu">o.r.test</span>(placekick_wl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>z =  1.563042 with p-value =  0.1180426 </code></pre>
</div>
</div>
</div>
<div id="tabset-3-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-4-tab">
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-32_9b78376b3136f47872dad876ab6e1d8b">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>placekick_wl_or3 <span class="ot">&lt;-</span> <span class="fu">gof</span>(placekick_l)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output-display">
<p><img src="categorical_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>placekick_wl_or3<span class="sc">$</span>gof</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         test  stat         val df       pVal
1:         HL chiSq 14.51724214  8 0.06924066
2:        mHL     F  1.32331386  5 0.27569976
3:       OsRo     Z  1.46604106 NA 0.14263710
4: SstPgeq0.5     Z  2.35457205 NA 0.01854405
5:   SstPl0.5     Z  0.15861448 NA 0.87397262
6:    SstBoth chiSq  5.56916807  2 0.06175477
7: SllPgeq0.5 chiSq  5.40780780  1 0.02004688
8:   SllPl0.5 chiSq  0.02650009  1 0.87068497
9:    SllBoth chiSq  6.97716365  2 0.03054416</code></pre>
</div>
</div>
<p>This statistic matches my implementation</p>
</div>
<div id="tabset-3-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-5-tab">
<p>Found on <a href="https://stat.ethz.ch/pipermail/r-help/2002-January/017858.html">Rstat Help Mailing List</a></p>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-33_9fcdf830e8049b236574ede1dc439456">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>or.test <span class="ot">&lt;-</span> <span class="cf">function</span>(object) {</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>  <span class="do">### ancillary function</span></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">## ags adapted from agg.sum provided by Bill Dunlap   </span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>  ags <span class="ot">&lt;-</span> <span class="cf">function</span>(x, by){</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>    by <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(by)</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>    ord <span class="ot">&lt;-</span> <span class="fu">do.call</span>(<span class="st">"order"</span>, <span class="fu">unname</span>(by))</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> x[ord]</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>    by <span class="ot">&lt;-</span> by[ord,  ]</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>    logical.diff <span class="ot">&lt;-</span> <span class="cf">function</span>(group) group[<span class="sc">-</span><span class="dv">1</span>] <span class="sc">!=</span> group[ <span class="sc">-</span> <span class="fu">length</span>(group)]</span>
<span id="cb79-10"><a href="#cb79-10" aria-hidden="true" tabindex="-1"></a>    change <span class="ot">&lt;-</span> <span class="fu">logical.diff</span>(by[[<span class="dv">1</span>]])</span>
<span id="cb79-11"><a href="#cb79-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(i <span class="cf">in</span> <span class="fu">seq</span>(<span class="at">along =</span> by)[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb79-12"><a href="#cb79-12" aria-hidden="true" tabindex="-1"></a>      change <span class="ot">&lt;-</span> change <span class="sc">|</span> <span class="fu">logical.diff</span>(by[[i]])</span>
<span id="cb79-13"><a href="#cb79-13" aria-hidden="true" tabindex="-1"></a>    by <span class="ot">&lt;-</span> by[<span class="fu">c</span>(T, change),  , drop <span class="ot">=</span> F]</span>
<span id="cb79-14"><a href="#cb79-14" aria-hidden="true" tabindex="-1"></a>    by<span class="sc">$</span>x <span class="ot">&lt;-</span> <span class="fu">diff</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">cumsum</span>(x)[<span class="fu">c</span>(change, T)]))</span>
<span id="cb79-15"><a href="#cb79-15" aria-hidden="true" tabindex="-1"></a>    by</span>
<span id="cb79-16"><a href="#cb79-16" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb79-17"><a href="#cb79-17" aria-hidden="true" tabindex="-1"></a>  <span class="do">###</span></span>
<span id="cb79-18"><a href="#cb79-18" aria-hidden="true" tabindex="-1"></a>  <span class="do">### computations</span></span>
<span id="cb79-19"><a href="#cb79-19" aria-hidden="true" tabindex="-1"></a>  <span class="do">###</span></span>
<span id="cb79-20"><a href="#cb79-20" aria-hidden="true" tabindex="-1"></a>  mf <span class="ot">&lt;-</span> <span class="fu">model.frame</span>(object)</span>
<span id="cb79-21"><a href="#cb79-21" aria-hidden="true" tabindex="-1"></a>  <span class="do">## collapse the original data by covariate pattern</span></span>
<span id="cb79-22"><a href="#cb79-22" aria-hidden="true" tabindex="-1"></a>  xx <span class="ot">&lt;-</span> <span class="fu">ags</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(mf)), mf[<span class="sc">-</span><span class="dv">1</span>])</span>
<span id="cb79-23"><a href="#cb79-23" aria-hidden="true" tabindex="-1"></a>  <span class="do">## observed number of cases by covariate pattern</span></span>
<span id="cb79-24"><a href="#cb79-24" aria-hidden="true" tabindex="-1"></a>  yy <span class="ot">&lt;-</span> <span class="fu">unname</span>(<span class="fu">unlist</span>(<span class="fu">ags</span>(mf[ , <span class="dv">1</span>], mf[<span class="sc">-</span><span class="dv">1</span>])[<span class="fu">ncol</span>(xx)]))</span>
<span id="cb79-25"><a href="#cb79-25" aria-hidden="true" tabindex="-1"></a>  <span class="do">## fitted proba</span></span>
<span id="cb79-26"><a href="#cb79-26" aria-hidden="true" tabindex="-1"></a>  pp <span class="ot">&lt;-</span> <span class="fu">predict</span>(object, <span class="at">newdata =</span> xx, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb79-27"><a href="#cb79-27" aria-hidden="true" tabindex="-1"></a>  <span class="do">## number of rows with the same covariate pattern</span></span>
<span id="cb79-28"><a href="#cb79-28" aria-hidden="true" tabindex="-1"></a>  mm <span class="ot">&lt;-</span> <span class="fu">unname</span>(<span class="fu">unlist</span>(xx[<span class="fu">ncol</span>(xx)]))</span>
<span id="cb79-29"><a href="#cb79-29" aria-hidden="true" tabindex="-1"></a>  <span class="do">## new model frame</span></span>
<span id="cb79-30"><a href="#cb79-30" aria-hidden="true" tabindex="-1"></a>  xx <span class="ot">&lt;-</span> xx[ , <span class="sc">-</span> <span class="fu">ncol</span>(xx)]</span>
<span id="cb79-31"><a href="#cb79-31" aria-hidden="true" tabindex="-1"></a>  <span class="do">## weights</span></span>
<span id="cb79-32"><a href="#cb79-32" aria-hidden="true" tabindex="-1"></a>  nu <span class="ot">&lt;-</span> mm <span class="sc">*</span> pp <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> pp)</span>
<span id="cb79-33"><a href="#cb79-33" aria-hidden="true" tabindex="-1"></a>  <span class="do">## new response</span></span>
<span id="cb79-34"><a href="#cb79-34" aria-hidden="true" tabindex="-1"></a>  cc <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="dv">2</span> <span class="sc">*</span> pp) <span class="sc">/</span> nu</span>
<span id="cb79-35"><a href="#cb79-35" aria-hidden="true" tabindex="-1"></a>  <span class="do">### Pearson's X2</span></span>
<span id="cb79-36"><a href="#cb79-36" aria-hidden="true" tabindex="-1"></a>  X2 <span class="ot">&lt;-</span> <span class="fu">sum</span>( (yy <span class="sc">-</span> mm <span class="sc">*</span> pp)<span class="sc">^</span><span class="dv">2</span> <span class="sc">/</span> nu)</span>
<span id="cb79-37"><a href="#cb79-37" aria-hidden="true" tabindex="-1"></a>  <span class="do">### weighted regression</span></span>
<span id="cb79-38"><a href="#cb79-38" aria-hidden="true" tabindex="-1"></a>  mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(cc <span class="sc">~</span> . , <span class="at">weights =</span> nu, <span class="at">data =</span> xx)</span>
<span id="cb79-39"><a href="#cb79-39" aria-hidden="true" tabindex="-1"></a>  rss <span class="ot">&lt;-</span> <span class="fu">sum</span>( nu <span class="sc">*</span> <span class="fu">resid</span>(mod)<span class="sc">^</span><span class="dv">2</span> )</span>
<span id="cb79-40"><a href="#cb79-40" aria-hidden="true" tabindex="-1"></a>  <span class="do">### compute the stat.</span></span>
<span id="cb79-41"><a href="#cb79-41" aria-hidden="true" tabindex="-1"></a>  J <span class="ot">&lt;-</span> <span class="fu">nrow</span>(xx)</span>
<span id="cb79-42"><a href="#cb79-42" aria-hidden="true" tabindex="-1"></a>  A <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (J <span class="sc">-</span> <span class="fu">sum</span>( <span class="dv">1</span> <span class="sc">/</span> mm))</span>
<span id="cb79-43"><a href="#cb79-43" aria-hidden="true" tabindex="-1"></a>  z <span class="ot">&lt;-</span> <span class="fu">abs</span>( (X2 <span class="sc">-</span> (J <span class="sc">-</span> <span class="fu">length</span>( <span class="fu">coef</span>(object) ) ) ) <span class="sc">/</span> <span class="fu">sqrt</span>(A <span class="sc">+</span> rss) )</span>
<span id="cb79-44"><a href="#cb79-44" aria-hidden="true" tabindex="-1"></a>  <span class="do">### report results</span></span>
<span id="cb79-45"><a href="#cb79-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(object<span class="sc">$</span>call)</span>
<span id="cb79-46"><a href="#cb79-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Osius &amp; Rojek's goodness-of-fit test for logistic models.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb79-47"><a href="#cb79-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Null hypothesis: model fits the data well.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb79-48"><a href="#cb79-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"z ="</span>, <span class="fu">round</span>(z, <span class="dv">3</span>), <span class="st">"; P ="</span>, <span class="fu">round</span>(<span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pnorm</span>(z)), <span class="dv">3</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb79-49"><a href="#cb79-49" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb79-50"><a href="#cb79-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-51"><a href="#cb79-51" aria-hidden="true" tabindex="-1"></a><span class="fu">or.test</span>(placekick_wl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>glm(formula = y/n ~ distance, family = binomial, data = placekick_bin_data, 
    weights = n)
Osius &amp; Rojek's goodness-of-fit test for logistic models.
Null hypothesis: model fits the data well.
z = 3.639 ; P = 0 </code></pre>
</div>
</div>
<p>I don’t really get the right version, and I think he was asking for help in the R help channel. It makes sense that these values don’t match, there must be an error somewhere.</p>
</div>
</div>
</div>
</section>
<section id="stukel" class="level3" data-number="5.5.3">
<h3 data-number="5.5.3" class="anchored" data-anchor-id="stukel"><span class="header-section-number">5.5.3</span> Stukel</h3>
<p>the stukel test checks a better fit with more parameters in the tails of the logistic regression. The implementation is taken from hosmer’s book.</p>
<p>There are two “created variables” <span class="math inline">z1, z2</span>, which are defined as coefficients for the upper and lower tail respectivly. Ie. do we need more information for those parts of the model, it could indicate that a logistic model is not the perfect fit.</p>
<div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">stukel.test</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false"><code>LogisticDx::gof</code></a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<p>This is Prof Bilder’s version of the GOF test. He uses the LRT version for testing both tails at once.</p>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-36_13b9d88bf91f7347df011b1c64667772">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">stukel.test</span>(placekick_l) <span class="co"># LRT of both z1 and z2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Stukel Test Stat =  6.977164 with p-value =  0.03054416 </code></pre>
</div>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-37_ef7481b64e0d09501ffc34590dc84b6a">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gof</span>(placekick_l)<span class="sc">$</span>gof</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Setting levels: control = 0, case = 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Setting direction: controls &lt; cases</code></pre>
</div>
<div class="cell-output-display">
<p><img src="categorical_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>         test  stat         val df       pVal
1:         HL chiSq 14.51724214  8 0.06924066
2:        mHL     F  1.32331386  5 0.27569976
3:       OsRo     Z  1.46604106 NA 0.14263710
4: SstPgeq0.5     Z  2.35457205 NA 0.01854405
5:   SstPl0.5     Z  0.15861448 NA 0.87397262
6:    SstBoth chiSq  5.56916807  2 0.06175477
7: SllPgeq0.5 chiSq  5.40780780  1 0.02004688
8:   SllPl0.5 chiSq  0.02650009  1 0.87068497
9:    SllBoth chiSq  6.97716365  2 0.03054416</code></pre>
</div>
</div>
<p>The Stukel tests are provided those starting with S. <code>st</code> stands for the score test, and “ll” stands for likelihood. I get matching values for all except <code>sstBoth</code> (score test for both tails). I’m not sure what’s going on there.</p>
</div>
</div>
</div>
</section>
</section>
<section id="residuals" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="residuals"><span class="header-section-number">5.6</span> Residuals</h2>
<p>Hosmer recommends 7 different logistic regression plots that all tell you slightly different things.</p>
</section>
<section id="pseudo-r2" class="level2" data-number="5.7">
<h2 data-number="5.7" class="anchored" data-anchor-id="pseudo-r2"><span class="header-section-number">5.7</span> Pseudo R2</h2>
<p>Here we implement some Pseudo R2 values for</p>
</section>
<section id="testing" class="level2" data-number="5.8">
<h2 data-number="5.8" class="anchored" data-anchor-id="testing"><span class="header-section-number">5.8</span> Testing</h2>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-38_4903702cbc933e92ac9eb7975b91f4c3">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tribble</span>(<span class="sc">~</span>test, <span class="sc">~</span>parameter, <span class="sc">~</span>sampling, <span class="sc">~</span>pvalue, <span class="sc">~</span>hypothesis,</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>        <span class="st">"pearson"</span>, <span class="st">"parameter"</span>,<span class="st">"two sample z proportion"</span>, <span class="st">"approximate"</span>, <span class="st">"association"</span>,</span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"cochran"</span>, <span class="st">"cell"</span>, <span class="st">"unconditional two sample"</span>, <span class="st">"approximate"</span>, <span class="st">"association"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 5
  test    parameter sampling                 pvalue      hypothesis 
  &lt;chr&gt;   &lt;chr&gt;     &lt;chr&gt;                    &lt;chr&gt;       &lt;chr&gt;      
1 pearson parameter two sample z proportion  approximate association
2 cochran cell      unconditional two sample approximate association</code></pre>
</div>
</div>
<p>We should be careful to distinguish three types of testing that can happen, in relation to all the assumed sampling distributions that we assume for the table:</p>
<ol type="1">
<li>Independence</li>
<li>Homogeneity</li>
</ol>
<ul>
<li>This is identical to a test for independence when we are fixing one of the columns.</li>
</ul>
<ol start="3" type="1">
<li>Goodness of Fit</li>
</ol>
<ul>
<li>The idea is that you provide the probability vector that you want to test. In this case, there is normally a model behind the predicted probabilities, and you’re using the chisq statistic to tell you how well the model fits.</li>
</ul>
<p>A list of tests:</p>
<ul>
<li>Cochran summary test</li>
<li>(Cochran)-Mantel-Haenszel summary test</li>
<li>Generalized CMH Test</li>
<li>Cochran’s Q test</li>
<li>Pearson Chi Squared</li>
<li>Cochran-Armitrage Trend Test</li>
<li>Cochran-Q Test</li>
<li>Mann-Whitney U test (Wilcoxon Rank Sum)</li>
<li>Wilcoson Signed Rank Test (paired samples)</li>
<li>Krustkal Wallis</li>
</ul>
<p>Exact tests</p>
<ul>
<li>Fisher Exact Test</li>
<li>Barnard Exact Test</li>
</ul>
<p>Dependent “Matched pairs” tests</p>
<ul>
<li>McNemar Test</li>
</ul>
<section id="pearson" class="level3" data-number="5.8.1">
<h3 data-number="5.8.1" class="anchored" data-anchor-id="pearson"><span class="header-section-number">5.8.1</span> Pearson</h3>
<p>Given the following table,</p>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-39_03d41124caf4ba10521076dd5d3a5ded">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tribble</span>(<span class="sc">~</span><span class="st">""</span>, <span class="sc">~</span><span class="st">"Disease"</span>, <span class="sc">~</span><span class="st">"No Disease"</span>, <span class="sc">~</span><span class="st">""</span>,</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Exposed"</span>, <span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">$n_1</span><span class="sc">\\</span><span class="st">$"</span>,</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"Not Exposed"</span> , <span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">$n_2</span><span class="sc">\\</span><span class="st">$"</span>,</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">""</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">$m_1</span><span class="sc">\\</span><span class="st">$"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">$m_2</span><span class="sc">\\</span><span class="st">$"</span>, <span class="st">"N"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="st">"html"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<table>
 <thead>
  <tr>
   <th style="text-align:left;">  </th>
   <th style="text-align:left;"> Disease </th>
   <th style="text-align:left;"> No Disease </th>
   <th style="text-align:left;">  </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Exposed </td>
   <td style="text-align:left;"> a </td>
   <td style="text-align:left;"> b </td>
   <td style="text-align:left;"> \$n_1\$ </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Not Exposed </td>
   <td style="text-align:left;"> c </td>
   <td style="text-align:left;"> d </td>
   <td style="text-align:left;"> \$n_2\$ </td>
  </tr>
  <tr>
   <td style="text-align:left;">  </td>
   <td style="text-align:left;"> \$m_1\$ </td>
   <td style="text-align:left;"> \$m_2\$ </td>
   <td style="text-align:left;"> N </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>Assume two sample proportional sampling model: A derivation from 2 sample proportion (pooled) z-test:</p>
<p><span class="math display">
\begin{aligned}
z^2 &amp;= \frac{(\hat p_1 - \hat p_2)^2}{\hat p(1 - \hat p)(\frac{1}{n_1} + \frac{1}{n_2})}
&amp;=
\end{aligned}
</span></p>
<p><span class="math display">
\begin{aligned}
X^2 = \sum_i^c \frac{|O_i - E_i|^2}{E_i} \sim \chi^2_{c-1}
\end{aligned}
</span></p>
<p>When the pearson table is generalized to Ix2, we have a column proportions, so we have the Brandt-Snedecor formula of the pearson independence statistic:</p>
<p><span class="math display">
\begin{aligned}
\chi^2(I) = \sum\frac{n_i (p_i - p)^2}{p(1-p)}
\end{aligned}
</span> where <span class="math inline">\chi^2(I)</span> represents the independence chisq statistic, <span class="math inline">n_i</span> is the number in each group, <span class="math inline">p_i</span> is the proportion by row, and <span class="math inline">p</span> is the proportion by total row.</p>
<p>Resources:</p>
<ul>
<li><a href="https://projecteuclid.org/download/pdf_1/euclid.lnms/1215091138">Pearson as Score Test</a></li>
<li><a href="https://arxiv.org/pdf/1808.09171.pdf">7 proofs of independence test</a></li>
</ul>
</section>
<section id="likelihood-ratio-test-g-test" class="level3" data-number="5.8.2">
<h3 data-number="5.8.2" class="anchored" data-anchor-id="likelihood-ratio-test-g-test"><span class="header-section-number">5.8.2</span> Likelihood Ratio Test (G Test)</h3>
<ul>
<li><code>AMR::g.test()</code></li>
<li><code>DescTools::GTest()</code></li>
<li><code>RVAideMemoire::G.test()</code></li>
</ul>
<p>These are the likelihood ratio test statistics, and the statistic can be calculated by the formula</p>
<p><span class="math display">
\begin{aligned}
2\sum O \log \left(\frac{O}{E}\right)
\end{aligned}
</span></p>
<ul>
<li>This is an alternative to pearson chisq tests, but are asymptotically equivalent.</li>
<li>Consider using this when both variables are “nominal”</li>
</ul>
</section>
<section id="barnard-exact-test" class="level3" data-number="5.8.3">
<h3 data-number="5.8.3" class="anchored" data-anchor-id="barnard-exact-test"><span class="header-section-number">5.8.3</span> Barnard Exact Test</h3>
<p>Barnard is considered an “unconditional” approach to exact testing. contrast to Fisher exact test which is a “conditional” approach to testing the p-value</p>
<p>Barnard is effectively a 2 stage test, given some observed table X, a “p-value” is the probability of observing a table more extreme than the observed.</p>
<p>The two stages are thus:</p>
<ol type="1">
<li>determine which tables are more “extreme”</li>
<li>calculated probability of those tables</li>
</ol>
<p>Thus, the “exactness” part of the description refers to how a probability is calculated.</p>
<p>Many methods have been proposed for stage 1</p>
<ul>
<li>Suissa and Shuster (1985) use pooled and unpooled z statistic for two proportions.</li>
<li>Booschloo (1970) used the p-value from fisher’s exact test to determine extremeness…</li>
<li>Santner Snell - difference in proportion</li>
</ul>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-40_f8c99557c9daf9984c92ef7011f0bed3">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">3</span>), <span class="at">nrow =</span> <span class="dv">2</span>)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a><span class="co"># row is fixed</span></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="fu">BarnardTest</span>(X, <span class="at">method =</span> <span class="st">"z-pooled"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Z-pooled Exact Test

data:  3 out of 3 vs. 0 out of 3
test statistic = 2.4495, first sample size = 3, second sample size = 3,
p-value = 0.03125
alternative hypothesis: true difference in proportion is not equal to 0
sample estimates:
difference in proportion 
                       1 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># z-pooled observed is...</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">/</span> <span class="fu">sqrt</span>(.<span class="dv">25</span> <span class="sc">*</span> (<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span> <span class="sc">+</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>)) <span class="co"># observed test statistic</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.44949</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># how to calculate p-value from this test statistic, sum of binomial products from extreme tables,</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a><span class="co"># the null is that pi_1 = pi_2 = pi, since we don't know the actual value of pi, we take the supremum of these values</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a>true_pi <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, .<span class="dv">01</span>)</span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>possible_p <span class="ot">&lt;-</span> <span class="fu">dbinom</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="at">prob =</span> true_pi) <span class="sc">*</span> <span class="fu">dbinom</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="at">prob =</span> true_pi) <span class="sc">+</span> <span class="fu">dbinom</span>(<span class="dv">0</span>, <span class="dv">3</span>, <span class="at">prob =</span> true_pi) <span class="sc">*</span> <span class="fu">dbinom</span>(<span class="dv">3</span>, <span class="dv">3</span>, <span class="at">prob =</span> true_pi)</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a><span class="co"># maximum occurs at .5</span></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>true_pi[<span class="fu">which.max</span>(possible_p)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.5</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># thus, overall p-value is</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a><span class="fu">max</span>(possible_p) <span class="co"># .03125</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.03125</code></pre>
</div>
</div>
<p>Now we compare the methods for choosing “extremeness” with the assumed sampling mechanism.</p>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-41_1630d9d392afbcb1d7267a3d2d1ad43f">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1</span>)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>foo <span class="ot">&lt;-</span> <span class="fu">rbinom_table</span>(<span class="dv">1000</span>, <span class="at">row_n =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">10</span>), <span class="at">p =</span> <span class="fu">c</span>(.<span class="dv">5</span>, .<span class="dv">5</span>)) <span class="co"># null is no association</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a><span class="co"># z pooled (score)</span></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>barnard_pooled <span class="ot">&lt;-</span> <span class="fu">apply</span>(foo, <span class="at">MARGIN =</span> <span class="dv">3</span>,</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>                        <span class="at">FUN =</span> <span class="cf">function</span> (x) {<span class="fu">BarnardTest</span>(x, <span class="at">method =</span> <span class="st">"z-pooled"</span>)<span class="sc">$</span>p.value})</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>barnard_unpooled <span class="ot">&lt;-</span> <span class="fu">apply</span>(foo, <span class="at">MARGIN =</span> <span class="dv">3</span>,</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>                        <span class="at">FUN =</span> <span class="cf">function</span> (x) {<span class="fu">BarnardTest</span>(x, <span class="at">method =</span> <span class="st">"z-unpooled"</span>)<span class="sc">$</span>p.value})</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a>barnard_boschloo <span class="ot">&lt;-</span> <span class="fu">apply</span>(foo, </span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>                          <span class="at">MARGIN =</span> <span class="dv">3</span>,</span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a>                          <span class="at">FUN =</span> <span class="cf">function</span> (x) {<span class="fu">BarnardTest</span>(x, <span class="at">method =</span> <span class="st">"boschloo"</span>)<span class="sc">$</span>p.value})</span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a>barnard_csm <span class="ot">&lt;-</span> <span class="fu">apply</span>(foo, </span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a>                          <span class="at">MARGIN =</span> <span class="dv">3</span>,</span>
<span id="cb98-18"><a href="#cb98-18" aria-hidden="true" tabindex="-1"></a>                          <span class="at">FUN =</span> <span class="cf">function</span> (x) {<span class="fu">BarnardTest</span>(x, <span class="at">method =</span> <span class="st">"csm"</span>)<span class="sc">$</span>p.value})</span>
<span id="cb98-19"><a href="#cb98-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-20"><a href="#cb98-20" aria-hidden="true" tabindex="-1"></a>barnard_santner_snell <span class="ot">&lt;-</span> <span class="fu">apply</span>(foo, </span>
<span id="cb98-21"><a href="#cb98-21" aria-hidden="true" tabindex="-1"></a>                               <span class="at">MARGIN =</span> <span class="dv">3</span>,</span>
<span id="cb98-22"><a href="#cb98-22" aria-hidden="true" tabindex="-1"></a>                               <span class="at">FUN =</span> <span class="cf">function</span> (x) {<span class="fu">BarnardTest</span>(x, <span class="at">method =</span> <span class="st">"santner and snell"</span>)<span class="sc">$</span>p.value})</span>
<span id="cb98-23"><a href="#cb98-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-24"><a href="#cb98-24" aria-hidden="true" tabindex="-1"></a><span class="co"># for reference</span></span>
<span id="cb98-25"><a href="#cb98-25" aria-hidden="true" tabindex="-1"></a>fisher_exact <span class="ot">&lt;-</span>  <span class="fu">apply</span>(foo, </span>
<span id="cb98-26"><a href="#cb98-26" aria-hidden="true" tabindex="-1"></a>                               <span class="at">MARGIN =</span> <span class="dv">3</span>,</span>
<span id="cb98-27"><a href="#cb98-27" aria-hidden="true" tabindex="-1"></a>                               <span class="at">FUN =</span> <span class="cf">function</span> (x) {<span class="fu">fisher.test</span>(x)<span class="sc">$</span>p.value})</span>
<span id="cb98-28"><a href="#cb98-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-29"><a href="#cb98-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-30"><a href="#cb98-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-31"><a href="#cb98-31" aria-hidden="true" tabindex="-1"></a><span class="co"># comment out any that you don't want to appear in the plot</span></span>
<span id="cb98-32"><a href="#cb98-32" aria-hidden="true" tabindex="-1"></a>barnard <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(<span class="at">pooled =</span> barnard_pooled,</span>
<span id="cb98-33"><a href="#cb98-33" aria-hidden="true" tabindex="-1"></a>                     <span class="at">unpooled =</span> barnard_unpooled,</span>
<span id="cb98-34"><a href="#cb98-34" aria-hidden="true" tabindex="-1"></a>                     <span class="at">boschloo =</span> barnard_boschloo,</span>
<span id="cb98-35"><a href="#cb98-35" aria-hidden="true" tabindex="-1"></a>                     <span class="at">csm =</span> barnard_csm,</span>
<span id="cb98-36"><a href="#cb98-36" aria-hidden="true" tabindex="-1"></a>                     <span class="at">santner_snell =</span> barnard_santner_snell,</span>
<span id="cb98-37"><a href="#cb98-37" aria-hidden="true" tabindex="-1"></a>                     <span class="at">fisher_exact =</span> fisher_exact) <span class="sc">%&gt;%</span> </span>
<span id="cb98-38"><a href="#cb98-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"type"</span>, <span class="at">values_to =</span> <span class="st">"p"</span>)</span>
<span id="cb98-39"><a href="#cb98-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-40"><a href="#cb98-40" aria-hidden="true" tabindex="-1"></a><span class="co"># there's some overplotting happening, dodge doesn't seem to work well for ecdf's</span></span>
<span id="cb98-41"><a href="#cb98-41" aria-hidden="true" tabindex="-1"></a>barnard <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> p, <span class="at">color =</span> type)) <span class="sc">+</span></span>
<span id="cb98-42"><a href="#cb98-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ecdf</span>()  <span class="sc">+</span></span>
<span id="cb98-43"><a href="#cb98-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">alpha =</span> .<span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb98-44"><a href="#cb98-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Barnard extremeness method comparison"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="categorical_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>For accuracy of the size of the test, it seems that csm is the most accurate, but also the most computationally intensive. We not that all the tests have more approriate “size” than the fisher_exact test.</p>
<p>Resources</p>
<ul>
<li><a href="https://www.researchgate.net/publication/242179503_Conditional_versus_Unconditional_Exact_Tests_for_Comparing_Two_Binomials">Explanation of difference between unconditional and conditional</a></li>
<li><a href="https://cran.r-project.org/web/packages/Exact/Exact.pdf">Exact Test Package Documentation</a> - <code>exact.test</code> function documentation has more information about barnard implmenetation.</li>
</ul>
</section>
<section id="mcnemar" class="level3" data-number="5.8.4">
<h3 data-number="5.8.4" class="anchored" data-anchor-id="mcnemar"><span class="header-section-number">5.8.4</span> McNemar</h3>
<p>McNemar tests are used when there is some “dichotomous trait”, for matched pairs. This means that the responses are statistically dependent. This is common for some longitudinal studies in which a single individual is asked two questions, and their answers are coded as locations in the table. Thus, the grand total, should be the number of pairs of data, not the total number of observations.</p>
<p>For example, suppose a person is asked if they voted democrat</p>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-42_3fb4e880c751b0161bd09e7e7f77870f">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tribble</span>(<span class="sc">~</span><span class="st">""</span>, <span class="sc">~</span><span class="st">"2008 democrat"</span>, <span class="sc">~</span><span class="st">"2008 republican"</span>,</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>        <span class="st">"2004 democrat"</span>, <span class="dv">175</span>, <span class="dv">16</span>,</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">"2004 republican"</span>, <span class="dv">54</span>, <span class="dv">188</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<table>
 <thead>
  <tr>
   <th style="text-align:left;">  </th>
   <th style="text-align:right;"> 2008 democrat </th>
   <th style="text-align:right;"> 2008 republican </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 2004 democrat </td>
   <td style="text-align:right;"> 175 </td>
   <td style="text-align:right;"> 16 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 2004 republican </td>
   <td style="text-align:right;"> 54 </td>
   <td style="text-align:right;"> 188 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>McNemar tests “Marginal Homogeneity”, meaning that the probabilities of the margins are the same. <span class="math inline">p_a + p_b = p_a + p_c</span> and <span class="math inline">p_c + p_d = p_b + p_d</span>. Thus, this means that we are testing <span class="math inline">H_0: p_b = p_c</span>, <span class="math inline">H_A: p_b \neq p_c</span>. The score statistic is:</p>
<p><span class="math display">
\begin{aligned}
z_0^2 = \frac{(b-c)^2}{b+c} \sim \chi^2_1
\end{aligned}
</span></p>
<!-- This section needs clarification... -->
<p>Variance is</p>
<p><span class="math display">
\begin{aligned}
\hat\sigma_0 (d) = \frac{b + c}{N^2}
\end{aligned}
</span></p>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-43_86ed9590e76b87b1e338101ba6e0f0e0">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Presidential election, dependent table</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>pres <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">175</span>, <span class="dv">16</span>,</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>                      <span class="dv">54</span>, <span class="dv">188</span>),</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ncol =</span> <span class="dv">2</span>,</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">byrow =</span> <span class="cn">TRUE</span>)</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>pres_mcnemar <span class="ot">&lt;-</span> <span class="fu">mcnemar.test</span>(pres, <span class="at">correct =</span> <span class="cn">FALSE</span>)</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a><span class="co"># (54 - 16)^2 / (54 + 16) # 20.629</span></span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>pres_mcnemar</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    McNemar's Chi-squared test

data:  pres
McNemar's chi-squared = 20.629, df = 1, p-value = 5.576e-06</code></pre>
</div>
</div>
<p>Notes</p>
<ul>
<li>only the off diagonal matters for significance, where as the main diagonal</li>
</ul>
<p>A good reference is 11.1 in Categorical Data Analysis, 3rd edition by Agresti</p>
</section>
<section id="breslow-day-test" class="level3" data-number="5.8.5">
<h3 data-number="5.8.5" class="anchored" data-anchor-id="breslow-day-test"><span class="header-section-number">5.8.5</span> Breslow-Day Test</h3>
<p>a test of homogeneity.</p>
</section>
<section id="wilcox-test" class="level3" data-number="5.8.6">
<h3 data-number="5.8.6" class="anchored" data-anchor-id="wilcox-test"><span class="header-section-number">5.8.6</span> Wilcox Test</h3>
<p>Is a test of location for two samples. This somewhat analogous to a nonparametric t-test, it wouldn’t normally be considered a categorical test, but there’s an equivalence to the trend test with average ranks as the scores.</p>
</section>
<section id="krustkal-wallis" class="level3" data-number="5.8.7">
<h3 data-number="5.8.7" class="anchored" data-anchor-id="krustkal-wallis"><span class="header-section-number">5.8.7</span> Krustkal Wallis</h3>
<p>Also a test of location for K samples. This is an extension of the Wilcox test that is also nonparametric. this can be thought of a nonparameteric anova.</p>
</section>
<section id="cochran-armitrage-trend-test-ordinal" class="level3" data-number="5.8.8">
<h3 data-number="5.8.8" class="anchored" data-anchor-id="cochran-armitrage-trend-test-ordinal"><span class="header-section-number">5.8.8</span> Cochran-Armitrage Trend Test (ordinal)</h3>
<ul>
<li><code>CochranArmitageTest</code></li>
</ul>
<p>Appropriate for IxJ tables in which <em>both</em> directions are ordinal.</p>
<p>These tests are more powerful for testing specific hypotheses, like a specific trend. We can kind of think of fitting some weighted regression to a surface that is determined by the scores along X and Y. This means that we must assign scores of separation to X and Y. If one of them is a binary variable, we’d generally assign 0-1, or if the ordinal categories carry some numeric meaning, ie. number of drinks is 0-1, 1-4, 5-7. You may consider using .5, 2.5, 6 for the scores of separation for them.</p>
<p>In the 2xJ case, this reduces to a Wilcoxon test, (also known as Mann-Whitney). The Wilcoxon test would use the midranks for each of the categories of separation. Misassigning the scores when there’s a linear trend means it’ll be inefficient, but by a factor the correlation of false and true scores squared (Agresti)</p>
<p>If we don’t know what the trend is, then we may be better off testing with a pearson test which just looks for general association.</p>
<p>I think the terminology is a little confusing here, but although it generalizes to IxJ, it seems most common for case-control studies in which we have 2xJ or Ix2. In either case, it’s a proprotional trend test that the probabilities are increasing based on score.</p>
<p>First we consider testing Ix2 tables, so that we have a column of proportions we can test. The trend test is testing a linear trend in the column of proportions.</p>
<p>It is useful to think about the trend test as a breakdown of the chisq from the independence pearson test. That is, we can first calculate the pearson chisq:</p>
<p><span class="math display">
\begin{aligned}
\chi^2(I) = \chi^2(T) + \chi^2(L)
\end{aligned}
</span> where <span class="math inline">\chi^2(I)</span> is the pearson chisq statistic, <span class="math inline">\chi^2(T)</span> is the trend chisq statistic, and <span class="math inline">X^2(L)</span> is the component leftover, deviance from the regression.</p>
<p>The model behind the test is a linear logistic model, which we weight the scores of the coefficients:</p>
<p><span class="math display">
\begin{aligned}
\operatorname{logit}(\pi_i) = \alpha + \beta x_i
\end{aligned}
</span></p>
<section id="example-infants-and-alcohol" class="level4">
<h4 class="anchored" data-anchor-id="example-infants-and-alcohol">Example: Infants and Alcohol</h4>
<p>This example is from <span class="citation" data-cites="agrestiCategoricalDataAnalysis2013">Agresti (<a href="#ref-agrestiCategoricalDataAnalysis2013" role="doc-biblioref">2013</a>)</span>, and looks at the if the number of drinks you have per week has an effect on the malformation of your child.</p>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-44_0f7fc9845dd1eb0e65f52eea9392f3ef">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Infant Alcohol data, Table 5.3 in Agresti</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>alcohol <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">48</span>, <span class="dv">17066</span>, </span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>                    <span class="dv">38</span>, <span class="dv">14464</span>,</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>                    <span class="dv">5</span>, <span class="dv">788</span>,</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>                    <span class="dv">1</span>, <span class="dv">126</span>,</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>                    <span class="dv">1</span>, <span class="dv">37</span>), <span class="at">byrow =</span> T, <span class="at">ncol =</span> <span class="dv">2</span>,</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="at">alcohol =</span> <span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"&lt;1"</span>, <span class="st">"1-2"</span>, <span class="st">"3-5"</span>, <span class="st">"&gt;5"</span>),</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">malformation =</span> <span class="fu">c</span>(<span class="st">"present"</span>, <span class="st">"absent"</span>)))</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a><span class="co"># in data frame form</span></span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>alcohol_df <span class="ot">&lt;-</span> alcohol <span class="sc">|&gt;</span> </span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span> </span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">"alcohol"</span>)</span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a>alcohol_ldf <span class="ot">&lt;-</span> alcohol_df <span class="sc">|&gt;</span> </span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(present<span class="sc">:</span>absent, <span class="at">names_to =</span> <span class="st">"malformation"</span>) <span class="co"># long format</span></span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a>alcohol_lldf <span class="ot">&lt;-</span> <span class="fu">Untable</span>(alcohol) <span class="co"># every observation listed</span></span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a><span class="co"># margins</span></span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a>alcohol_rsum <span class="ot">&lt;-</span> <span class="fu">marginSums</span>(alcohol, <span class="at">margin =</span> <span class="dv">1</span>)</span>
<span id="cb102-20"><a href="#cb102-20" aria-hidden="true" tabindex="-1"></a>alcohol_csum <span class="ot">&lt;-</span> <span class="fu">marginSums</span>(alcohol, <span class="at">margin =</span> <span class="dv">2</span>)</span>
<span id="cb102-21"><a href="#cb102-21" aria-hidden="true" tabindex="-1"></a>alcohol_sum <span class="ot">&lt;-</span> <span class="fu">marginSums</span>(alcohol)</span>
<span id="cb102-22"><a href="#cb102-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-23"><a href="#cb102-23" aria-hidden="true" tabindex="-1"></a><span class="co"># obs and expected proportions</span></span>
<span id="cb102-24"><a href="#cb102-24" aria-hidden="true" tabindex="-1"></a>alcohol_expected_prop <span class="ot">&lt;-</span> <span class="fu">outer</span>(alcohol_rsum, alcohol_csum) <span class="sc">/</span> alcohol_sum<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb102-25"><a href="#cb102-25" aria-hidden="true" tabindex="-1"></a>alcohol_expected_count <span class="ot">&lt;-</span> <span class="fu">outer</span>(alcohol_rsum, alcohol_csum) <span class="sc">/</span> alcohol_sum <span class="co"># expected counts</span></span>
<span id="cb102-26"><a href="#cb102-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-27"><a href="#cb102-27" aria-hidden="true" tabindex="-1"></a>alcohol <span class="sc">|&gt;</span> <span class="fu">kable</span>() <span class="sc">|&gt;</span> <span class="fu">kable_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">

<table class=" lightable-minimal" style="font-family: &quot;Trebuchet MS&quot;, verdana, sans-serif; margin-left: auto; margin-right: auto;">
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> present </th>
   <th style="text-align:right;"> absent </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> 0 </td>
   <td style="text-align:right;"> 48 </td>
   <td style="text-align:right;"> 17066 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> &lt;1 </td>
   <td style="text-align:right;"> 38 </td>
   <td style="text-align:right;"> 14464 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 1-2 </td>
   <td style="text-align:right;"> 5 </td>
   <td style="text-align:right;"> 788 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> 3-5 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 126 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> &gt;5 </td>
   <td style="text-align:right;"> 1 </td>
   <td style="text-align:right;"> 37 </td>
  </tr>
</tbody>
</table>

</div>
</div>
<p>After having so many drinks, we can show you the proportion of those that have malformations in their infants.</p>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-45_3b70395d5c6804e4a4bd0b7d2d8eb7df">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pearson statistic, and manually</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="co"># sum((alcohol - alcohol_expected_count)^2 / alcohol_expected_count) # pearson statistic</span></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a><span class="co"># chisq.test(alcohol, correct = FALSE)</span></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.test</span>(alcohol)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in prop.test(alcohol): Chi-squared approximation may be incorrect</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    5-sample test for equality of proportions without continuity correction

data:  alcohol
X-squared = 12.082, df = 4, p-value = 0.01675
alternative hypothesis: two.sided
sample estimates:
     prop 1      prop 2      prop 3      prop 4      prop 5 
0.002804721 0.002620328 0.006305170 0.007874016 0.026315789 </code></pre>
</div>
</div>
<p>The pearson statistic is 12.082, with 4 degrees of freedom</p>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-46_358c5ffaed2e6d0e6d50543a0802e5a7">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># LRT G^2, manually</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 2 * sum(alcohol * log(alcohol / alcohol_expected_count)) # LRT statistic</span></span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a><span class="co"># AMR::g.test(alcohol)</span></span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a><span class="co"># G.test(alcohol)</span></span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>DescTools<span class="sc">::</span><span class="fu">GTest</span>(alcohol)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Log likelihood ratio (G-test) test of independence without correction

data:  alcohol
G = 6.202, X-squared df = 4, p-value = 0.1846</code></pre>
</div>
</div>
<p>Similarly, the LRT G^2 statistic is 6.202, in this case giving contradictory results for the p-value. But both of these tests are treating the covariates as categorical, but we should want to do something ordinal.</p>
<p>We consider these models, because they seem related and I want to know what the difference between them is (the last one is the most correct I believe).</p>
<ol type="1">
<li>Poisson</li>
<li>Logistic</li>
</ol>
<ul>
<li>without the weights, and fully expanding the table so that every malformation is its own row with one variable of the alcohol level.</li>
</ul>
<ol start="3" type="1">
<li><p>Logistic against scores</p></li>
<li><p>Logistic w/ weights</p></li>
</ol>
<ul>
<li>the weights here will represent the number of observations in the binomial that went into that observation</li>
<li>If we have <span class="math inline">i\in I</span> binomial observations, the model <span class="math inline">Binom(n_i, \pi_i) / n_i \sim x_i\beta</span></li>
</ul>
<ol start="5" type="1">
<li>Logistic w/ weights against scores</li>
</ol>
<ul>
<li>This is the correct model, and how the model should be fit.</li>
</ul>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-47_695001e2c0f8a3b6df9300b27cd9c2f0">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># GLM Models</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Logistic modeling preparation</span></span>
<span id="cb108-3"><a href="#cb108-3" aria-hidden="true" tabindex="-1"></a>alcohol_logit <span class="ot">&lt;-</span> <span class="fu">logitlink</span>(alcohol[,<span class="dv">1</span>]<span class="sc">/</span>alcohol[,<span class="dv">2</span>])</span>
<span id="cb108-4"><a href="#cb108-4" aria-hidden="true" tabindex="-1"></a>alcohol_lldf_logistic <span class="ot">&lt;-</span> alcohol_lldf <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">malformation_num =</span> <span class="fu">recode</span>(malformation, <span class="st">"present"</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">"absent"</span> <span class="ot">=</span> <span class="dv">0</span>))</span>
<span id="cb108-5"><a href="#cb108-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-6"><a href="#cb108-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Poisson</span></span>
<span id="cb108-7"><a href="#cb108-7" aria-hidden="true" tabindex="-1"></a>alcohol_poisson <span class="ot">&lt;-</span> <span class="fu">glm</span>(value<span class="sc">~</span>alcohol <span class="sc">+</span> malformation, <span class="at">data =</span> alcohol <span class="sc">|&gt;</span> <span class="fu">melt</span>(), <span class="at">family =</span> <span class="fu">poisson</span>())</span>
<span id="cb108-8"><a href="#cb108-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-9"><a href="#cb108-9" aria-hidden="true" tabindex="-1"></a><span class="do">## Logit</span></span>
<span id="cb108-10"><a href="#cb108-10" aria-hidden="true" tabindex="-1"></a>alcohol_logistic <span class="ot">&lt;-</span> <span class="fu">glm</span>(malformation_num<span class="sc">~</span>alcohol, <span class="at">data =</span> alcohol_lldf_logistic, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link=</span><span class="st">"logit"</span>))</span>
<span id="cb108-11"><a href="#cb108-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-12"><a href="#cb108-12" aria-hidden="true" tabindex="-1"></a><span class="do">## Linear Logit</span></span>
<span id="cb108-13"><a href="#cb108-13" aria-hidden="true" tabindex="-1"></a>alcohol_lldf_linear_logistic <span class="ot">&lt;-</span> alcohol_lldf_logistic <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">alcohol_score =</span> <span class="fu">recode</span>(alcohol,</span>
<span id="cb108-14"><a href="#cb108-14" aria-hidden="true" tabindex="-1"></a>                                                       <span class="st">"0"</span> <span class="ot">=</span> <span class="dv">0</span>,</span>
<span id="cb108-15"><a href="#cb108-15" aria-hidden="true" tabindex="-1"></a>                                                       <span class="st">"&lt;1"</span> <span class="ot">=</span> .<span class="dv">5</span>,</span>
<span id="cb108-16"><a href="#cb108-16" aria-hidden="true" tabindex="-1"></a>                                                       <span class="st">"1-2"</span> <span class="ot">=</span> <span class="fl">1.5</span>,</span>
<span id="cb108-17"><a href="#cb108-17" aria-hidden="true" tabindex="-1"></a>                                                       <span class="st">"3-5"</span> <span class="ot">=</span> <span class="dv">4</span>,</span>
<span id="cb108-18"><a href="#cb108-18" aria-hidden="true" tabindex="-1"></a>                                                       <span class="st">"&gt;5"</span> <span class="ot">=</span> <span class="dv">7</span>))</span>
<span id="cb108-19"><a href="#cb108-19" aria-hidden="true" tabindex="-1"></a>alcohol_linear_logistic <span class="ot">&lt;-</span> <span class="fu">glm</span>(malformation_num<span class="sc">~</span>alcohol_score, <span class="at">data =</span> alcohol_lldf_linear_logistic, <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">"logit"</span>))</span>
<span id="cb108-20"><a href="#cb108-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-21"><a href="#cb108-21" aria-hidden="true" tabindex="-1"></a><span class="do">## weighted logistic</span></span>
<span id="cb108-22"><a href="#cb108-22" aria-hidden="true" tabindex="-1"></a>alcohol_wlogistic <span class="ot">&lt;-</span> <span class="fu">glm</span>(alcohol[,<span class="dv">1</span>]<span class="sc">/</span>alcohol_rsum<span class="sc">~</span><span class="dv">1</span>, <span class="at">family =</span> binomial, <span class="at">weights =</span> alcohol_rsum)</span>
<span id="cb108-23"><a href="#cb108-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-24"><a href="#cb108-24" aria-hidden="true" tabindex="-1"></a><span class="do">## weighted linear logistic regression</span></span>
<span id="cb108-25"><a href="#cb108-25" aria-hidden="true" tabindex="-1"></a>alcohol_scores <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">5</span>, <span class="fl">1.5</span>, <span class="dv">4</span>, <span class="dv">7</span>)</span>
<span id="cb108-26"><a href="#cb108-26" aria-hidden="true" tabindex="-1"></a>alcohol_wll <span class="ot">&lt;-</span> <span class="fu">glm</span>(alcohol[,<span class="dv">1</span>]<span class="sc">/</span>alcohol_rsum<span class="sc">~</span>alcohol_scores, <span class="at">family =</span> binomial, <span class="at">weights =</span> alcohol_rsum)</span>
<span id="cb108-27"><a href="#cb108-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb108-28"><a href="#cb108-28" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(alcohol_wll)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = alcohol[, 1]/alcohol_rsum ~ alcohol_scores, family = binomial, 
    weights = alcohol_rsum)

Deviance Residuals: 
      0       &lt;1      1-2      3-5       &gt;5  
 0.5921  -0.8801   0.8865  -0.1449   0.1291  

Coefficients:
               Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)     -5.9605     0.1154 -51.637   &lt;2e-16 ***
alcohol_scores   0.3166     0.1254   2.523   0.0116 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 6.2020  on 4  degrees of freedom
Residual deviance: 1.9487  on 3  degrees of freedom
AIC: 24.576

Number of Fisher Scoring iterations: 4</code></pre>
</div>
</div>
<p>The summary output here is the weighted linear logistic regression. It’s the “proper” model here, and it seems the trend is significant, with an estimate of odds increase of malformation 1.3724535 for each additional drink.</p>
<div class="callout-warning callout callout-style-simple no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<p>For some reason fitting the non-weighted version of the logistic regression and summing the pearson residuals does NOT give you the right independence pearson statistic, for the fully expanded dataset. You will get the correct pearson statistic if you use the poisson glm, or the weighted binomial, and I’m not sure the reason why.</p>
</div>
</div>
</div>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-48_ebf52926321989a77fac3f7a8686cfa4">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Statistics using logistic distribution</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(alcohol_logistic, <span class="at">test =</span> <span class="st">"Rao"</span>) <span class="co"># X^2 (score test)</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(alcohol_logistic, <span class="at">test =</span> <span class="st">"LRT"</span>) <span class="co"># G^2, LRT test</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Statistics using poisson distribution</span></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">residuals</span>(alcohol_poisson, <span class="at">type =</span> <span class="st">"pearson"</span>)<span class="sc">^</span><span class="dv">2</span>) <span class="co"># pearson statistic, X^2</span></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">residuals</span>(alcohol_poisson, <span class="at">type =</span> <span class="st">"deviance"</span>)<span class="sc">^</span><span class="dv">2</span>) <span class="co"># deviance statistic, G^2</span></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a><span class="co"># df.residual(alcohol_poisson) # for testing the statistics</span></span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a><span class="co"># linear logistic model</span></span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(alcohol_linear_logistic) # The estimates here are the same as the weighted logistic, and standard errors are correct, but residual degrees of freedom are incorrect.</span></span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(alcohol_linear_logistic, <span class="at">test =</span> <span class="st">"Rao"</span>) <span class="co"># Cochran Trend statistic, X^2(T), correct (score test)</span></span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(alcohol_linear_logistic, <span class="at">test =</span> <span class="st">"LRT"</span>) <span class="co"># Analogous to Cochran Trend test, but LRT test. 4.25</span></span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a><span class="co"># I'm not sure the significance of the sum of the pearson residuals in the fully expanded data</span></span>
<span id="cb110-16"><a href="#cb110-16" aria-hidden="true" tabindex="-1"></a><span class="co"># pearstat &lt;- sum(residuals(alcohol_linear_logistic, type = "pearson")^2)</span></span>
<span id="cb110-17"><a href="#cb110-17" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 - pchisq(pearstat, df.residual(alcohol_linear_logistic)) # goodness of fit? pearson test..</span></span>
<span id="cb110-18"><a href="#cb110-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-19"><a href="#cb110-19" aria-hidden="true" tabindex="-1"></a><span class="co"># logistic with weights</span></span>
<span id="cb110-20"><a href="#cb110-20" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(alcohol_wlogistic)</span></span>
<span id="cb110-21"><a href="#cb110-21" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">residuals</span>(alcohol_wlogistic, <span class="at">type =</span> <span class="st">"pearson"</span>)<span class="sc">^</span><span class="dv">2</span>) <span class="co"># pearson statistic, X^2, score</span></span>
<span id="cb110-22"><a href="#cb110-22" aria-hidden="true" tabindex="-1"></a><span class="fu">deviance</span>(alcohol_wlogistic) <span class="co"># deviance statistic, G^2, LRT</span></span>
<span id="cb110-23"><a href="#cb110-23" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(alcohol_wlogistic, <span class="at">test =</span> <span class="st">"Chisq"</span>) <span class="co"># not correct because there are no terms to drop! IT's only the</span></span>
<span id="cb110-24"><a href="#cb110-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-25"><a href="#cb110-25" aria-hidden="true" tabindex="-1"></a><span class="co"># linear logistic with weights</span></span>
<span id="cb110-26"><a href="#cb110-26" aria-hidden="true" tabindex="-1"></a><span class="co"># summary(alcohol_wll)</span></span>
<span id="cb110-27"><a href="#cb110-27" aria-hidden="true" tabindex="-1"></a><span class="fu">deviance</span>(alcohol_wll) <span class="co"># deviance gof statistic</span></span>
<span id="cb110-28"><a href="#cb110-28" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">residuals</span>(alcohol_wll, <span class="at">type =</span> <span class="st">"pearson"</span>)<span class="sc">^</span><span class="dv">2</span>) <span class="co"># pearson gof statistic</span></span>
<span id="cb110-29"><a href="#cb110-29" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(alcohol_wll, <span class="at">test =</span> <span class="st">"Rao"</span>) <span class="co"># Cochran Trend Test statistic (score)</span></span>
<span id="cb110-30"><a href="#cb110-30" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(alcohol_wll, <span class="at">test =</span> <span class="st">"LRT"</span>) <span class="co"># LRT analogue</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table

Model: binomial, link: logit

Response: malformation_num

Terms added sequentially (first to last)

        Df Deviance Resid. Df Resid. Dev    Rao Pr(&gt;Chi)  
NULL                    32573     1275.5                  
alcohol  4    6.202     32569     1269.2 12.084  0.01674 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
Analysis of Deviance Table

Model: binomial, link: logit

Response: malformation_num

Terms added sequentially (first to last)

        Df Deviance Resid. Df Resid. Dev Pr(&gt;Chi)
NULL                    32573     1275.5         
alcohol  4    6.202     32569     1269.2   0.1846
[1] 12.08205
[1] 6.201998
Analysis of Deviance Table

Model: binomial, link: logit

Response: malformation_num

Terms added sequentially (first to last)

              Df Deviance Resid. Df Resid. Dev   Rao Pr(&gt;Chi)  
NULL                          32573     1275.5                 
alcohol_score  1   4.2533     32572     1271.2 6.571  0.01037 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
Analysis of Deviance Table

Model: binomial, link: logit

Response: malformation_num

Terms added sequentially (first to last)

              Df Deviance Resid. Df Resid. Dev Pr(&gt;Chi)  
NULL                          32573     1275.5           
alcohol_score  1   4.2533     32572     1271.2  0.03917 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
[1] 12.08205
[1] 6.201998
Analysis of Deviance Table

Model: binomial, link: logit

Response: alcohol[, 1]/alcohol_rsum

Terms added sequentially (first to last)

     Df Deviance Resid. Df Resid. Dev Pr(&gt;Chi)
NULL                     4      6.202         
[1] 1.948721
[1] 2.05229
Analysis of Deviance Table

Model: binomial, link: logit

Response: alcohol[, 1]/alcohol_rsum

Terms added sequentially (first to last)

               Df Deviance Resid. Df Resid. Dev    Rao Pr(&gt;Chi)  
NULL                               4     6.2020                  
alcohol_scores  1   4.2533         3     1.9487 6.5701  0.01037 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
Analysis of Deviance Table

Model: binomial, link: logit

Response: alcohol[, 1]/alcohol_rsum

Terms added sequentially (first to last)

               Df Deviance Resid. Df Resid. Dev Pr(&gt;Chi)  
NULL                               4     6.2020           
alcohol_scores  1   4.2533         3     1.9487  0.03917 *
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Calculating the confidence interval by <code>profile</code> in the weighted regression seems to error out, so an example of how to estimate it with the package Bhat is given in CDA Thompson’s PDF.</p>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-49_7875ad6b61e141c1dde22787b26d3229">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># results: hold</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>alcohol_overall_prop <span class="ot">&lt;-</span> alcohol_csum <span class="sc">/</span> alcohol_sum</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>p_i <span class="ot">&lt;-</span> alcohol[,<span class="dv">1</span>] <span class="sc">/</span> alcohol_rsum</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> alcohol_overall_prop[<span class="dv">1</span>] <span class="co"># overall margin population</span></span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a><span class="co"># cochran armitage trend test (very manually)</span></span>
<span id="cb112-7"><a href="#cb112-7" aria-hidden="true" tabindex="-1"></a><span class="co"># xbar &lt;- sum(alcohol_rsum / alcohol_sum * alcohol_scores)</span></span>
<span id="cb112-8"><a href="#cb112-8" aria-hidden="true" tabindex="-1"></a><span class="co"># b &lt;- sum(alcohol_rsum * (p_i - p) * (alcohol_scores - xbar)) / sum(alcohol_rsum * (alcohol_scores - xbar)^2)</span></span>
<span id="cb112-9"><a href="#cb112-9" aria-hidden="true" tabindex="-1"></a><span class="co"># pi_i &lt;- p + b * (alcohol_scores - xbar)</span></span>
<span id="cb112-10"><a href="#cb112-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-11"><a href="#cb112-11" aria-hidden="true" tabindex="-1"></a><span class="co"># take the fitted values from this</span></span>
<span id="cb112-12"><a href="#cb112-12" aria-hidden="true" tabindex="-1"></a>alcohol_trend_lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(p_i <span class="sc">~</span> alcohol_scores, <span class="at">weights =</span> alcohol_rsum)</span>
<span id="cb112-13"><a href="#cb112-13" aria-hidden="true" tabindex="-1"></a>pi_i <span class="ot">&lt;-</span> <span class="fu">fitted</span>(alcohol_trend_lm)</span>
<span id="cb112-14"><a href="#cb112-14" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">coef</span>(alcohol_trend_lm)[<span class="dv">2</span>]</span>
<span id="cb112-15"><a href="#cb112-15" aria-hidden="true" tabindex="-1"></a><span class="co"># xbar &lt;- weighted.mean(alcohol_scores, alcohol_rsum)</span></span>
<span id="cb112-16"><a href="#cb112-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb112-17"><a href="#cb112-17" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">/</span> (alcohol_overall_prop[<span class="dv">1</span>] <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> alcohol_overall_prop[<span class="dv">1</span>])) <span class="sc">*</span> <span class="fu">sum</span>(alcohol_rsum <span class="sc">*</span> (p_i <span class="sc">-</span> p)<span class="sc">^</span><span class="dv">2</span>) <span class="co"># pearson independence from brandt Snecdor formula</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> present 
12.08205 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># decomposes into</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">/</span> (alcohol_overall_prop[<span class="dv">1</span>] <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> alcohol_overall_prop[<span class="dv">1</span>])) <span class="sc">*</span> <span class="fu">sum</span>(alcohol_rsum <span class="sc">*</span> (p_i <span class="sc">-</span> pi_i)<span class="sc">^</span><span class="dv">2</span>) <span class="co"># X^2(L)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> present 
5.511921 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">/</span> (alcohol_overall_prop[<span class="dv">1</span>] <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> alcohol_overall_prop[<span class="dv">1</span>])) <span class="sc">*</span> <span class="fu">sum</span>(alcohol_rsum <span class="sc">*</span> (pi_i <span class="sc">-</span> p)<span class="sc">^</span><span class="dv">2</span>) <span class="co"># Trend statistic,</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code> present 
6.570134 </code></pre>
</div>
</div>
<p>Notice in the above calculations, the only difference between the pearson independence statistic, and the “lack of fit” statistic, is the usage of the predicted probabilities. This decomposition is the classic anova move of decomposing a sum of squares into a middle ground of some model based probability, so that we get an SS for the model and SS for the</p>
<p>There’s also the relationship to the <span class="math inline">M^2</span> pearson correlation based statistic for ordinal models.</p>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-50_1bc89df742e4aa8abbd76845c5f3f88f">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Cochran relation to M^2, correlation based statistic</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a><span class="fu">with</span>(alcohol_lldf_linear_logistic,</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>     <span class="fu">cor</span>(alcohol_score, malformation_num)<span class="sc">^</span><span class="dv">2</span>) <span class="sc">*</span> alcohol_sum <span class="co"># Cochran trend statistic by pearson correlation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 6.570134</code></pre>
</div>
</div>
<p>These above section explores the two decompositions of the independence statistic.</p>
<p><span class="math display">
\begin{aligned}
\chi^2_{I - 2}(I) &amp;= \underbrace{\chi^2_1(T)}_{\text{Cochran Trend Statistic}} +  \chi^2_{I - 2}(L) \\
12.08 &amp;= 6.5701 + 5.512 \\
G^2(I) &amp;= \underbrace{G^2(I | L)}_{\text{LRT Trend Statistic}} + G^2(L) \\
6.202 &amp;= 4.2533 + 1.9487
\end{aligned}
</span> <span class="math inline">I</span> in paranthesis means independent, but in the subscript it means number of rows, as in a I x 2 table. The trend statistic is a one degree of freedom test that is similar to the ANOVA principle that we can decompose the Independence into two independent test statistics, and create tests from them individually. Both of these break down and are chi squared statistic.</p>
<div class="callout-note callout callout-style-simple no-icon callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Power in Chisq testing
</div>
</div>
<div class="callout-body-container callout-body">
<p>Power is the probability of rejecting when the null hypothesis is false, so we generally need to discuss the noncentrality parameter. In chisq testing, the power increases when the degrees of freedom for the test decrease. We can gain more power by testing for narrower alternative. In this case, <span class="math inline">G^2(I)</span> has I-1 degrees of freedom, while <span class="math inline">G^2(I|L)</span> only has 1 degree of freedom. Consider two scenarios</p>
<ol type="1">
<li><p>Linear logit function holds, then the goodness of fit <span class="math inline">G^2(L)</span> will be asymptotic chisq, and <span class="math inline">G^2(I) and G^2(I|L)</span> will have the same noncentrality parameter.</p></li>
<li><p>The linear logit model does NOT hold, then <span class="math inline">G^2(I)</span> will have a higher noncentrality parameter than <span class="math inline">G^2(I|L)</span> and thus, the higher noncentrality parameter will mean that we have more power (generally), but when the linear logit model holds approximately, the noncentrality parameter should be similar, thus the lower df statistic will still be more powerful. Mantel 1964 notes that although its a linear test, it does not mean we’re making an assumption of linearity, the test statistic is still useful for determining any sort of progressive trend.</p></li>
</ol>
</div>
</div>
<p>Okay, enough of messing with the raw models, this is the fastest way to run a Cochran test directly without the model.</p>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-51_17cb3f891ab239b612fa99c1fa2e2431">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># events, total number, scores</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>alcohol_tt <span class="ot">&lt;-</span> <span class="fu">prop.trend.test</span>(alcohol[,<span class="dv">1</span>], <span class="at">n =</span> alcohol_rsum, <span class="at">score =</span> alcohol_scores)</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>alcohol_cat <span class="ot">&lt;-</span> <span class="fu">CochranArmitageTest</span>(alcohol) <span class="co"># cannot adjust scores with this type of test</span></span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>alcohol_ct <span class="ot">&lt;-</span> coin<span class="sc">::</span><span class="fu">chisq_test</span>(<span class="fu">as.table</span>(alcohol), <span class="at">scores =</span> <span class="fu">list</span>(<span class="at">alcohol =</span> alcohol_scores))</span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a><span class="co"># independence_test(as.table(alcohol), teststat = "quadratic") # general pearson</span></span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a><span class="co"># independence_test(as.table(alcohol)) # idk what this is</span></span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>alcohol_it <span class="ot">&lt;-</span> <span class="fu">independence_test</span>(<span class="fu">as.table</span>(alcohol), <span class="at">scores =</span> <span class="fu">list</span>(<span class="at">alcohol =</span> alcohol_scores))</span>
<span id="cb120-8"><a href="#cb120-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-9"><a href="#cb120-9" aria-hidden="true" tabindex="-1"></a>alcohol_tt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Chi-squared Test for Trend in Proportions

data:  alcohol[, 1] out of alcohol_rsum ,
 using scores: 0 0.5 1.5 4 7
X-squared = 6.5701, df = 1, p-value = 0.01037</code></pre>
</div>
</div>
<p>There is a relationship to the wilcoxon two sample test (mann-whitney test) as well. Normally for wilcox_test, it’s a test of the median location, that the distribution of row 1 is different from row 2, we can test this with an asymptotic z score. (Now we’re considering a 2xJ table instead of a Ix2 table.) Naturally, wilcox will treat all of the same category as ties, and the ties will be replaced with the average of the ranked ties. If the table was [1, 2, 3] vs [6, 1, 1], then the wilcox test is equivalent to the trend test with scores 4, 6, 8.5.</p>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-52_aaad5cf02b5f395cd9af6d4b2a129111">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wilcox.test</span>(<span class="fu">as.numeric</span>(alcohol)<span class="sc">~</span>malformation, <span class="at">data =</span> <span class="fu">Untable</span>(alcohol), <span class="at">correct =</span> <span class="cn">FALSE</span>) <span class="co"># gives the same p-value, different rank statistic</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>coin<span class="sc">::</span><span class="fu">wilcox_test</span>(<span class="fu">as.numeric</span>(alcohol)<span class="sc">~</span>malformation, <span class="fu">Untable</span>(alcohol))</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a><span class="co"># alcohol_wilcox_scores &lt;- cumsum((1 + alcohol_rsum) / 2)</span></span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>alcohol_wilcox_scores <span class="ot">&lt;-</span> <span class="fu">c</span>(((alcohol_rsum <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">/</span> <span class="dv">2</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], <span class="dv">0</span>) <span class="sc">+</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">cumsum</span>(alcohol_rsum)[<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>]) <span class="co"># average of min/max rank</span></span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a><span class="fu">prop.trend.test</span>(alcohol[,<span class="dv">1</span>], <span class="at">n =</span> alcohol_rsum, alcohol_wilcox_scores)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Wilcoxon rank sum test

data:  as.numeric(alcohol) by malformation
W = 1557372, p-value = 0.5533
alternative hypothesis: true location shift is not equal to 0


    Asymptotic Wilcoxon-Mann-Whitney Test

data:  as.numeric(alcohol) by malformation (present, absent)
Z = 0.59281, p-value = 0.5533
alternative hypothesis: true mu is not equal to 0


    Chi-squared Test for Trend in Proportions

data:  alcohol[, 1] out of alcohol_rsum ,
 using scores: 8557.5 24365.5 32013 32473 32536
X-squared = 0.35118, df = 1, p-value = 0.5534</code></pre>
</div>
</div>
</section>
<section id="example-decomposing-total-chisq" class="level4">
<h4 class="anchored" data-anchor-id="example-decomposing-total-chisq">Example: Decomposing Total Chisq</h4>
<p>This example comes from Cochran 1954, Table 4. <span class="citation" data-cites="cochranMethodsStrengtheningCommon1954">Cochran (<a href="#ref-cochranMethodsStrengtheningCommon1954" role="doc-biblioref">1954</a>)</span></p>
</section>
</section>
<section id="cmh-testing" class="level3" data-number="5.8.9">
<h3 data-number="5.8.9" class="anchored" data-anchor-id="cmh-testing"><span class="header-section-number">5.8.9</span> CMH testing</h3>
<p>The CMH testing is technically supposed to be done on tables in strata. the data type is an I X J X K, in which we have K strata and an I X J contingency table in each.</p>
<ul>
<li>you are not penalized for adding tables with sparse data with the CMH test statistic</li>
<li>this reduces to the N-1 adjusted pearson chisquared statistic for 1 strata</li>
<li>the test assumes that there is a common odds ratio to estimate, but in order to test the hypothesis we can use a Breslow-Day Test of Homogeneity</li>
<li>Conditional logistic regression gives a similar answer, <code>clogit</code> in package <code>survival</code> because similar to cox model as well.</li>
</ul>
<section id="generalized-cmh-testing" class="level4">
<h4 class="anchored" data-anchor-id="generalized-cmh-testing">Generalized CMH Testing</h4>
<p>CMH is extended to IxJxK with possibly ordinal factors for I and J. An implementation of these statistics can be found:</p>
<ul>
<li><code>coin::cmh_test()</code></li>
<li><code>vcdExtra:CHMtest()</code></li>
</ul>
</section>
<section id="cmh---mcnemar-equivalence" class="level4">
<h4 class="anchored" data-anchor-id="cmh---mcnemar-equivalence">CMH - McNemar Equivalence</h4>
<p>If you express the “population averaged” table and run McNemar, you will get the same statistic as expressing the data as a “subject specific” table for an individual per stratum.</p>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-57_5fcdfb616a588050961a535032e17acf">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>test <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">3</span>, <span class="dv">4</span>), <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(test, <span class="at">correct =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in chisq.test(test, correct = FALSE): Chi-squared approximation may be
incorrect</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test

data:  test
X-squared = 0.0025703, df = 1, p-value = 0.9596</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fl">0.0025703</span> <span class="sc">/</span> <span class="dv">19</span> <span class="sc">*</span> <span class="dv">18</span> <span class="co"># the "N-1" chisq statistic in a 2 x 2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.002435021</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>foo <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">3</span>, <span class="dv">4</span>,</span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>               <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>), <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mantelhaen.test</span>(foo, <span class="at">correct =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Mantel-Haenszel chi-squared test without continuity correction

data:  foo
Mantel-Haenszel X-squared = 0.0024351, df = 1, p-value = 0.9606
alternative hypothesis: true common odds ratio is not equal to 1
95 percent confidence interval:
 0.1444191 6.2805369
sample estimates:
common odds ratio 
         0.952381 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>bar <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">3</span>, <span class="dv">4</span>,</span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a>               <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>,</span>
<span id="cb131-3"><a href="#cb131-3" aria-hidden="true" tabindex="-1"></a>               <span class="dv">1</span>, <span class="dv">6</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>))</span>
<span id="cb131-4"><a href="#cb131-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mantelhaen.test</span>(bar, <span class="at">correct =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
    Mantel-Haenszel chi-squared test without continuity correction

data:  bar
Mantel-Haenszel X-squared = 0.0024351, df = 1, p-value = 0.9606
alternative hypothesis: true common odds ratio is not equal to 1
95 percent confidence interval:
 0.1444191 6.2805369
sample estimates:
common odds ratio 
         0.952381 </code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>mantelhaen_2by2 <span class="ot">&lt;-</span>  <span class="cf">function</span>(x) {</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mantelhaen.test</span>(<span class="fu">array</span>(<span class="fu">c</span>(x, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>), <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">2</span>)), <span class="at">correct =</span> <span class="cn">FALSE</span>)</span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="x2-tables-comparison" class="level3 tabset" data-number="5.8.10">
<h3 class="tabset anchored" data-number="5.8.10" data-anchor-id="x2-tables-comparison"><span class="header-section-number">5.8.10</span> 2x2 tables Comparison</h3>
<section id="poisson-sampling" class="level4">
<h4 class="anchored" data-anchor-id="poisson-sampling">Poisson Sampling</h4>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-58_6651a0d806ae98dcd0b54e30b08dd930">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r fold-hide code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="co"># random poisson</span></span>
<span id="cb134-2"><a href="#cb134-2" aria-hidden="true" tabindex="-1"></a>foo <span class="ot">&lt;-</span> <span class="fu">rpoisson_table</span>(<span class="at">num_tables =</span> <span class="dv">1000</span>, <span class="at">mean =</span> <span class="dv">5</span>, <span class="at">nrow =</span> <span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">2</span>)</span>
<span id="cb134-3"><a href="#cb134-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-4"><a href="#cb134-4" aria-hidden="true" tabindex="-1"></a><span class="co"># pearson uncorrected</span></span>
<span id="cb134-5"><a href="#cb134-5" aria-hidden="true" tabindex="-1"></a>pearson_uncorrected_p <span class="ot">&lt;-</span> </span>
<span id="cb134-6"><a href="#cb134-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(foo, </span>
<span id="cb134-7"><a href="#cb134-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">MARGIN =</span> <span class="dv">3</span>,</span>
<span id="cb134-8"><a href="#cb134-8" aria-hidden="true" tabindex="-1"></a>      <span class="cf">function</span>(x) {</span>
<span id="cb134-9"><a href="#cb134-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">suppressWarnings</span>(<span class="fu">chisq.test</span>(x, <span class="at">correct =</span> <span class="cn">FALSE</span>))<span class="sc">$</span>p.value})</span>
<span id="cb134-10"><a href="#cb134-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-11"><a href="#cb134-11" aria-hidden="true" tabindex="-1"></a><span class="co"># pearson corrected</span></span>
<span id="cb134-12"><a href="#cb134-12" aria-hidden="true" tabindex="-1"></a>pearson_corrected_p <span class="ot">&lt;-</span> </span>
<span id="cb134-13"><a href="#cb134-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(foo,</span>
<span id="cb134-14"><a href="#cb134-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">MARGIN =</span> <span class="dv">3</span>,</span>
<span id="cb134-15"><a href="#cb134-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(x) {</span>
<span id="cb134-16"><a href="#cb134-16" aria-hidden="true" tabindex="-1"></a>          <span class="fu">suppressWarnings</span>(<span class="fu">chisq.test</span>(x, <span class="at">correct =</span> <span class="cn">TRUE</span>))<span class="sc">$</span>p.value})</span>
<span id="cb134-17"><a href="#cb134-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-18"><a href="#cb134-18" aria-hidden="true" tabindex="-1"></a>fisher_exact_p <span class="ot">&lt;-</span> </span>
<span id="cb134-19"><a href="#cb134-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(foo,</span>
<span id="cb134-20"><a href="#cb134-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">MARGIN =</span> <span class="dv">3</span>,</span>
<span id="cb134-21"><a href="#cb134-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(x) {</span>
<span id="cb134-22"><a href="#cb134-22" aria-hidden="true" tabindex="-1"></a>          <span class="fu">suppressWarnings</span>(<span class="fu">fisher.test</span>(x))<span class="sc">$</span>p.value})</span>
<span id="cb134-23"><a href="#cb134-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-24"><a href="#cb134-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Pearson N-1 correction equivalent</span></span>
<span id="cb134-25"><a href="#cb134-25" aria-hidden="true" tabindex="-1"></a>cmh_p <span class="ot">&lt;-</span> </span>
<span id="cb134-26"><a href="#cb134-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(foo,</span>
<span id="cb134-27"><a href="#cb134-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">MARGIN =</span> <span class="dv">3</span>,</span>
<span id="cb134-28"><a href="#cb134-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(x) {</span>
<span id="cb134-29"><a href="#cb134-29" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mantelhaen_2by2</span>(x)<span class="sc">$</span>p.value</span>
<span id="cb134-30"><a href="#cb134-30" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb134-31"><a href="#cb134-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-32"><a href="#cb134-32" aria-hidden="true" tabindex="-1"></a><span class="co"># G-test (LRT)</span></span>
<span id="cb134-33"><a href="#cb134-33" aria-hidden="true" tabindex="-1"></a>lrt_p <span class="ot">&lt;-</span> </span>
<span id="cb134-34"><a href="#cb134-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(foo,</span>
<span id="cb134-35"><a href="#cb134-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">MARGIN =</span> <span class="dv">3</span>,</span>
<span id="cb134-36"><a href="#cb134-36" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(x) {</span>
<span id="cb134-37"><a href="#cb134-37" aria-hidden="true" tabindex="-1"></a>          <span class="fu">suppressWarnings</span>(<span class="fu">g.test</span>(x))<span class="sc">$</span>p.value</span>
<span id="cb134-38"><a href="#cb134-38" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb134-39"><a href="#cb134-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-40"><a href="#cb134-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-41"><a href="#cb134-41" aria-hidden="true" tabindex="-1"></a>contingency_p <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(<span class="at">uncorrected =</span> pearson_uncorrected_p,</span>
<span id="cb134-42"><a href="#cb134-42" aria-hidden="true" tabindex="-1"></a>          <span class="at">corrected =</span> pearson_corrected_p,</span>
<span id="cb134-43"><a href="#cb134-43" aria-hidden="true" tabindex="-1"></a>          <span class="at">exact =</span> fisher_exact_p,</span>
<span id="cb134-44"><a href="#cb134-44" aria-hidden="true" tabindex="-1"></a>          <span class="at">cmh =</span> cmh_p,</span>
<span id="cb134-45"><a href="#cb134-45" aria-hidden="true" tabindex="-1"></a>          <span class="at">lrt =</span> lrt_p)</span>
<span id="cb134-46"><a href="#cb134-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb134-47"><a href="#cb134-47" aria-hidden="true" tabindex="-1"></a>contingency_p <span class="sc">%&gt;%</span> </span>
<span id="cb134-48"><a href="#cb134-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"test"</span>, <span class="at">values_to =</span> <span class="st">"p"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb134-49"><a href="#cb134-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(p, <span class="at">color =</span> test)) <span class="sc">+</span></span>
<span id="cb134-50"><a href="#cb134-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ecdf</span>(<span class="at">geom =</span> <span class="st">"step"</span>) <span class="sc">+</span></span>
<span id="cb134-51"><a href="#cb134-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">alpha =</span> .<span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb134-52"><a href="#cb134-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Tests of association"</span>) <span class="co">#+</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="categorical_files/figure-html/unnamed-chunk-58-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r fold-hide code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">1</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">1</span>)) <span class="co"># for zooming in</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;ggproto object: Class CoordCartesian, Coord, gg&gt;
    aspect: function
    backtransform_range: function
    clip: on
    default: FALSE
    distance: function
    expand: TRUE
    is_free: function
    is_linear: function
    labels: function
    limits: list
    modify_scales: function
    range: function
    render_axis_h: function
    render_axis_v: function
    render_bg: function
    render_fg: function
    setup_data: function
    setup_layout: function
    setup_panel_guides: function
    setup_panel_params: function
    setup_params: function
    train_panel_guides: function
    transform: function
    super:  &lt;ggproto object: Class CoordCartesian, Coord, gg&gt;</code></pre>
</div>
</div>
</section>
<section id="binomial-sampling" class="level4">
<h4 class="anchored" data-anchor-id="binomial-sampling">Binomial Sampling</h4>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-59_49892e16618ffa541a992b7c67dea952">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r fold-hide code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>foo <span class="ot">&lt;-</span> <span class="fu">rbinom_table</span>(<span class="at">num_tables =</span> <span class="dv">9000</span>)</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a><span class="co"># pearson uncorrected</span></span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>pearson_uncorrected_p <span class="ot">&lt;-</span> </span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(foo, </span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">MARGIN =</span> <span class="dv">3</span>,</span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a>      <span class="cf">function</span>(x) {</span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">suppressWarnings</span>(<span class="fu">chisq.test</span>(x, <span class="at">correct =</span> <span class="cn">FALSE</span>))<span class="sc">$</span>p.value})</span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a><span class="co"># pearson corrected</span></span>
<span id="cb137-11"><a href="#cb137-11" aria-hidden="true" tabindex="-1"></a>pearson_corrected_p <span class="ot">&lt;-</span> </span>
<span id="cb137-12"><a href="#cb137-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(foo,</span>
<span id="cb137-13"><a href="#cb137-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">MARGIN =</span> <span class="dv">3</span>,</span>
<span id="cb137-14"><a href="#cb137-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(x) {</span>
<span id="cb137-15"><a href="#cb137-15" aria-hidden="true" tabindex="-1"></a>          <span class="fu">suppressWarnings</span>(<span class="fu">chisq.test</span>(x, <span class="at">correct =</span> <span class="cn">TRUE</span>))<span class="sc">$</span>p.value})</span>
<span id="cb137-16"><a href="#cb137-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-17"><a href="#cb137-17" aria-hidden="true" tabindex="-1"></a>fisher_exact_p <span class="ot">&lt;-</span> </span>
<span id="cb137-18"><a href="#cb137-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(foo,</span>
<span id="cb137-19"><a href="#cb137-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">MARGIN =</span> <span class="dv">3</span>,</span>
<span id="cb137-20"><a href="#cb137-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(x) {</span>
<span id="cb137-21"><a href="#cb137-21" aria-hidden="true" tabindex="-1"></a>          <span class="fu">suppressWarnings</span>(<span class="fu">fisher.test</span>(x))<span class="sc">$</span>p.value})</span>
<span id="cb137-22"><a href="#cb137-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-23"><a href="#cb137-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Pearson N-1 correction equivalent</span></span>
<span id="cb137-24"><a href="#cb137-24" aria-hidden="true" tabindex="-1"></a>cmh_p <span class="ot">&lt;-</span> </span>
<span id="cb137-25"><a href="#cb137-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(foo,</span>
<span id="cb137-26"><a href="#cb137-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">MARGIN =</span> <span class="dv">3</span>,</span>
<span id="cb137-27"><a href="#cb137-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(x) {</span>
<span id="cb137-28"><a href="#cb137-28" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mantelhaen_2by2</span>(x)<span class="sc">$</span>p.value</span>
<span id="cb137-29"><a href="#cb137-29" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb137-30"><a href="#cb137-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-31"><a href="#cb137-31" aria-hidden="true" tabindex="-1"></a><span class="co"># G-test (LRT)</span></span>
<span id="cb137-32"><a href="#cb137-32" aria-hidden="true" tabindex="-1"></a>lrt_p <span class="ot">&lt;-</span> </span>
<span id="cb137-33"><a href="#cb137-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(foo,</span>
<span id="cb137-34"><a href="#cb137-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">MARGIN =</span> <span class="dv">3</span>,</span>
<span id="cb137-35"><a href="#cb137-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(x) {</span>
<span id="cb137-36"><a href="#cb137-36" aria-hidden="true" tabindex="-1"></a>          <span class="fu">suppressWarnings</span>(<span class="fu">g.test</span>(x))<span class="sc">$</span>p.value</span>
<span id="cb137-37"><a href="#cb137-37" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb137-38"><a href="#cb137-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-39"><a href="#cb137-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-40"><a href="#cb137-40" aria-hidden="true" tabindex="-1"></a>contingency_p <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(<span class="at">uncorrected =</span> pearson_uncorrected_p,</span>
<span id="cb137-41"><a href="#cb137-41" aria-hidden="true" tabindex="-1"></a>          <span class="at">corrected =</span> pearson_corrected_p,</span>
<span id="cb137-42"><a href="#cb137-42" aria-hidden="true" tabindex="-1"></a>          <span class="at">exact =</span> fisher_exact_p,</span>
<span id="cb137-43"><a href="#cb137-43" aria-hidden="true" tabindex="-1"></a>          <span class="at">cmh =</span> cmh_p,</span>
<span id="cb137-44"><a href="#cb137-44" aria-hidden="true" tabindex="-1"></a>          <span class="at">lrt =</span> lrt_p)</span>
<span id="cb137-45"><a href="#cb137-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-46"><a href="#cb137-46" aria-hidden="true" tabindex="-1"></a>contingency_p <span class="sc">%&gt;%</span> </span>
<span id="cb137-47"><a href="#cb137-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"test"</span>, <span class="at">values_to =</span> <span class="st">"p"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb137-48"><a href="#cb137-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(p, <span class="at">color =</span> test)) <span class="sc">+</span></span>
<span id="cb137-49"><a href="#cb137-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ecdf</span>(<span class="at">geom =</span> <span class="st">"step"</span>) <span class="sc">+</span></span>
<span id="cb137-50"><a href="#cb137-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">alpha =</span> .<span class="dv">4</span>) <span class="co">#+</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="categorical_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r fold-hide code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">1</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">1</span>)) <span class="co"># for zooming in</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;ggproto object: Class CoordCartesian, Coord, gg&gt;
    aspect: function
    backtransform_range: function
    clip: on
    default: FALSE
    distance: function
    expand: TRUE
    is_free: function
    is_linear: function
    labels: function
    limits: list
    modify_scales: function
    range: function
    render_axis_h: function
    render_axis_v: function
    render_bg: function
    render_fg: function
    setup_data: function
    setup_layout: function
    setup_panel_guides: function
    setup_panel_params: function
    setup_params: function
    train_panel_guides: function
    transform: function
    super:  &lt;ggproto object: Class CoordCartesian, Coord, gg&gt;</code></pre>
</div>
</div>
</section>
<section id="multinomial-sampling" class="level4">
<h4 class="anchored" data-anchor-id="multinomial-sampling">Multinomial Sampling</h4>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-60_4b18f74cfb3812b5b34193cfd124fe80">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r fold-hide code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>foo <span class="ot">&lt;-</span> <span class="fu">rmultinom_table</span>(<span class="at">num_tables =</span> <span class="dv">1000</span>)</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a><span class="co"># pearson uncorrected</span></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a>pearson_uncorrected_p <span class="ot">&lt;-</span> </span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(foo, </span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">MARGIN =</span> <span class="dv">3</span>,</span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a>      <span class="cf">function</span>(x) {</span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">suppressWarnings</span>(<span class="fu">chisq.test</span>(x, <span class="at">correct =</span> <span class="cn">FALSE</span>))<span class="sc">$</span>p.value})</span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a><span class="co"># pearson corrected</span></span>
<span id="cb140-11"><a href="#cb140-11" aria-hidden="true" tabindex="-1"></a>pearson_corrected_p <span class="ot">&lt;-</span> </span>
<span id="cb140-12"><a href="#cb140-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(foo,</span>
<span id="cb140-13"><a href="#cb140-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">MARGIN =</span> <span class="dv">3</span>,</span>
<span id="cb140-14"><a href="#cb140-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(x) {</span>
<span id="cb140-15"><a href="#cb140-15" aria-hidden="true" tabindex="-1"></a>          <span class="fu">suppressWarnings</span>(<span class="fu">chisq.test</span>(x, <span class="at">correct =</span> <span class="cn">TRUE</span>))<span class="sc">$</span>p.value})</span>
<span id="cb140-16"><a href="#cb140-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-17"><a href="#cb140-17" aria-hidden="true" tabindex="-1"></a>fisher_exact_p <span class="ot">&lt;-</span> </span>
<span id="cb140-18"><a href="#cb140-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(foo,</span>
<span id="cb140-19"><a href="#cb140-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">MARGIN =</span> <span class="dv">3</span>,</span>
<span id="cb140-20"><a href="#cb140-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(x) {</span>
<span id="cb140-21"><a href="#cb140-21" aria-hidden="true" tabindex="-1"></a>          <span class="fu">suppressWarnings</span>(<span class="fu">fisher.test</span>(x))<span class="sc">$</span>p.value})</span>
<span id="cb140-22"><a href="#cb140-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-23"><a href="#cb140-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Pearson N-1 correction equivalent</span></span>
<span id="cb140-24"><a href="#cb140-24" aria-hidden="true" tabindex="-1"></a>cmh_p <span class="ot">&lt;-</span> </span>
<span id="cb140-25"><a href="#cb140-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(foo,</span>
<span id="cb140-26"><a href="#cb140-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">MARGIN =</span> <span class="dv">3</span>,</span>
<span id="cb140-27"><a href="#cb140-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(x) {</span>
<span id="cb140-28"><a href="#cb140-28" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mantelhaen_2by2</span>(x)<span class="sc">$</span>p.value</span>
<span id="cb140-29"><a href="#cb140-29" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb140-30"><a href="#cb140-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-31"><a href="#cb140-31" aria-hidden="true" tabindex="-1"></a><span class="co"># G-test (LRT)</span></span>
<span id="cb140-32"><a href="#cb140-32" aria-hidden="true" tabindex="-1"></a>lrt_p <span class="ot">&lt;-</span> </span>
<span id="cb140-33"><a href="#cb140-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(foo,</span>
<span id="cb140-34"><a href="#cb140-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">MARGIN =</span> <span class="dv">3</span>,</span>
<span id="cb140-35"><a href="#cb140-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(x) {</span>
<span id="cb140-36"><a href="#cb140-36" aria-hidden="true" tabindex="-1"></a>          <span class="fu">suppressWarnings</span>(<span class="fu">g.test</span>(x))<span class="sc">$</span>p.value</span>
<span id="cb140-37"><a href="#cb140-37" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb140-38"><a href="#cb140-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-39"><a href="#cb140-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-40"><a href="#cb140-40" aria-hidden="true" tabindex="-1"></a>contingency_p <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(<span class="at">uncorrected =</span> pearson_uncorrected_p,</span>
<span id="cb140-41"><a href="#cb140-41" aria-hidden="true" tabindex="-1"></a>          <span class="at">corrected =</span> pearson_corrected_p,</span>
<span id="cb140-42"><a href="#cb140-42" aria-hidden="true" tabindex="-1"></a>          <span class="at">exact =</span> fisher_exact_p,</span>
<span id="cb140-43"><a href="#cb140-43" aria-hidden="true" tabindex="-1"></a>          <span class="at">cmh =</span> cmh_p,</span>
<span id="cb140-44"><a href="#cb140-44" aria-hidden="true" tabindex="-1"></a>          <span class="at">lrt =</span> lrt_p)</span>
<span id="cb140-45"><a href="#cb140-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-46"><a href="#cb140-46" aria-hidden="true" tabindex="-1"></a>contingency_p <span class="sc">%&gt;%</span> </span>
<span id="cb140-47"><a href="#cb140-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"test"</span>, <span class="at">values_to =</span> <span class="st">"p"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb140-48"><a href="#cb140-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(p, <span class="at">color =</span> test)) <span class="sc">+</span></span>
<span id="cb140-49"><a href="#cb140-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ecdf</span>(<span class="at">geom =</span> <span class="st">"step"</span>) <span class="sc">+</span></span>
<span id="cb140-50"><a href="#cb140-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">alpha =</span> .<span class="dv">4</span>) <span class="co">#+</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="categorical_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r fold-hide code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">1</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">1</span>)) <span class="co"># for zooming in</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;ggproto object: Class CoordCartesian, Coord, gg&gt;
    aspect: function
    backtransform_range: function
    clip: on
    default: FALSE
    distance: function
    expand: TRUE
    is_free: function
    is_linear: function
    labels: function
    limits: list
    modify_scales: function
    range: function
    render_axis_h: function
    render_axis_v: function
    render_bg: function
    render_fg: function
    setup_data: function
    setup_layout: function
    setup_panel_guides: function
    setup_panel_params: function
    setup_params: function
    train_panel_guides: function
    transform: function
    super:  &lt;ggproto object: Class CoordCartesian, Coord, gg&gt;</code></pre>
</div>
</div>
</section>
<section id="hypergeometric-sampling" class="level4">
<h4 class="anchored" data-anchor-id="hypergeometric-sampling">Hypergeometric Sampling</h4>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-61_dd02a9aac3ac0a254bc16602c787c65b">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r fold-hide code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a>foo <span class="ot">&lt;-</span> <span class="fu">rhyper_table</span>(<span class="at">num_tables =</span> <span class="dv">1000</span>)</span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a><span class="co"># pearson uncorrected</span></span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a>pearson_uncorrected_p <span class="ot">&lt;-</span> </span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(foo, </span>
<span id="cb143-6"><a href="#cb143-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">MARGIN =</span> <span class="dv">3</span>,</span>
<span id="cb143-7"><a href="#cb143-7" aria-hidden="true" tabindex="-1"></a>      <span class="cf">function</span>(x) {</span>
<span id="cb143-8"><a href="#cb143-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">suppressWarnings</span>(<span class="fu">chisq.test</span>(x, <span class="at">correct =</span> <span class="cn">FALSE</span>))<span class="sc">$</span>p.value})</span>
<span id="cb143-9"><a href="#cb143-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-10"><a href="#cb143-10" aria-hidden="true" tabindex="-1"></a><span class="co"># pearson corrected</span></span>
<span id="cb143-11"><a href="#cb143-11" aria-hidden="true" tabindex="-1"></a>pearson_corrected_p <span class="ot">&lt;-</span> </span>
<span id="cb143-12"><a href="#cb143-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(foo,</span>
<span id="cb143-13"><a href="#cb143-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">MARGIN =</span> <span class="dv">3</span>,</span>
<span id="cb143-14"><a href="#cb143-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(x) {</span>
<span id="cb143-15"><a href="#cb143-15" aria-hidden="true" tabindex="-1"></a>          <span class="fu">suppressWarnings</span>(<span class="fu">chisq.test</span>(x, <span class="at">correct =</span> <span class="cn">TRUE</span>))<span class="sc">$</span>p.value})</span>
<span id="cb143-16"><a href="#cb143-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-17"><a href="#cb143-17" aria-hidden="true" tabindex="-1"></a>fisher_exact_p <span class="ot">&lt;-</span> </span>
<span id="cb143-18"><a href="#cb143-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(foo,</span>
<span id="cb143-19"><a href="#cb143-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">MARGIN =</span> <span class="dv">3</span>,</span>
<span id="cb143-20"><a href="#cb143-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(x) {</span>
<span id="cb143-21"><a href="#cb143-21" aria-hidden="true" tabindex="-1"></a>          <span class="fu">suppressWarnings</span>(<span class="fu">fisher.test</span>(x))<span class="sc">$</span>p.value})</span>
<span id="cb143-22"><a href="#cb143-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-23"><a href="#cb143-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Pearson N-1 correction equivalent</span></span>
<span id="cb143-24"><a href="#cb143-24" aria-hidden="true" tabindex="-1"></a>cmh_p <span class="ot">&lt;-</span> </span>
<span id="cb143-25"><a href="#cb143-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(foo,</span>
<span id="cb143-26"><a href="#cb143-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">MARGIN =</span> <span class="dv">3</span>,</span>
<span id="cb143-27"><a href="#cb143-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(x) {</span>
<span id="cb143-28"><a href="#cb143-28" aria-hidden="true" tabindex="-1"></a>          <span class="fu">mantelhaen_2by2</span>(x)<span class="sc">$</span>p.value</span>
<span id="cb143-29"><a href="#cb143-29" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb143-30"><a href="#cb143-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-31"><a href="#cb143-31" aria-hidden="true" tabindex="-1"></a><span class="co"># G-test (LRT)</span></span>
<span id="cb143-32"><a href="#cb143-32" aria-hidden="true" tabindex="-1"></a>lrt_p <span class="ot">&lt;-</span> </span>
<span id="cb143-33"><a href="#cb143-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(foo,</span>
<span id="cb143-34"><a href="#cb143-34" aria-hidden="true" tabindex="-1"></a>        <span class="at">MARGIN =</span> <span class="dv">3</span>,</span>
<span id="cb143-35"><a href="#cb143-35" aria-hidden="true" tabindex="-1"></a>        <span class="cf">function</span>(x) {</span>
<span id="cb143-36"><a href="#cb143-36" aria-hidden="true" tabindex="-1"></a>          <span class="fu">suppressWarnings</span>(<span class="fu">g.test</span>(x))<span class="sc">$</span>p.value</span>
<span id="cb143-37"><a href="#cb143-37" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb143-38"><a href="#cb143-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-39"><a href="#cb143-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-40"><a href="#cb143-40" aria-hidden="true" tabindex="-1"></a>contingency_p <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(<span class="at">uncorrected =</span> pearson_uncorrected_p,</span>
<span id="cb143-41"><a href="#cb143-41" aria-hidden="true" tabindex="-1"></a>          <span class="at">corrected =</span> pearson_corrected_p,</span>
<span id="cb143-42"><a href="#cb143-42" aria-hidden="true" tabindex="-1"></a>          <span class="at">exact =</span> fisher_exact_p,</span>
<span id="cb143-43"><a href="#cb143-43" aria-hidden="true" tabindex="-1"></a>          <span class="at">cmh =</span> cmh_p,</span>
<span id="cb143-44"><a href="#cb143-44" aria-hidden="true" tabindex="-1"></a>          <span class="at">lrt =</span> lrt_p)</span>
<span id="cb143-45"><a href="#cb143-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-46"><a href="#cb143-46" aria-hidden="true" tabindex="-1"></a>contingency_p <span class="sc">%&gt;%</span> </span>
<span id="cb143-47"><a href="#cb143-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"test"</span>, <span class="at">values_to =</span> <span class="st">"p"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb143-48"><a href="#cb143-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(p, <span class="at">color =</span> test)) <span class="sc">+</span></span>
<span id="cb143-49"><a href="#cb143-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_ecdf</span>(<span class="at">geom =</span> <span class="st">"step"</span>) <span class="sc">+</span></span>
<span id="cb143-50"><a href="#cb143-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>, <span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linetype =</span> <span class="dv">2</span>, <span class="at">alpha =</span> .<span class="dv">4</span>) <span class="co">#+</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="categorical_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb144"><pre class="sourceCode r fold-hide code-with-copy"><code class="sourceCode r"><span id="cb144-1"><a href="#cb144-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">1</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">1</span>)) <span class="co"># for zooming in</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;ggproto object: Class CoordCartesian, Coord, gg&gt;
    aspect: function
    backtransform_range: function
    clip: on
    default: FALSE
    distance: function
    expand: TRUE
    is_free: function
    is_linear: function
    labels: function
    limits: list
    modify_scales: function
    range: function
    render_axis_h: function
    render_axis_v: function
    render_bg: function
    render_fg: function
    setup_data: function
    setup_layout: function
    setup_panel_guides: function
    setup_panel_params: function
    setup_params: function
    train_panel_guides: function
    transform: function
    super:  &lt;ggproto object: Class CoordCartesian, Coord, gg&gt;</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="more-than-two-categories" class="level2" data-number="5.9">
<h2 data-number="5.9" class="anchored" data-anchor-id="more-than-two-categories"><span class="header-section-number">5.9</span> More than two categories</h2>
<p>This section starts to get into 2 x I tables, and even more dimensions like, I X J X K tables, and how we analyze those tables. We’ll start with an overview of the multinomial theory, which is fundamental in extending the binomial (2 categories) into multiple categories. The binomial is a special case of the multinomial distribution</p>
<ul>
<li><code>nnet::multinom</code></li>
<li><code>VGAM::vglm(family = multinom)</code></li>
<li><code>mlogit::mlogit</code></li>
</ul>
<p>A common example we see in this exposition is housing data from library <code>MASS</code></p>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-62_7513debd475c9e7a985639e06ebe50f9">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb146-2"><a href="#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(housing)</span>
<span id="cb146-3"><a href="#cb146-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-4"><a href="#cb146-4" aria-hidden="true" tabindex="-1"></a><span class="co"># The array version</span></span>
<span id="cb146-5"><a href="#cb146-5" aria-hidden="true" tabindex="-1"></a>housing_arr <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(Freq<span class="sc">~</span>Sat <span class="sc">+</span> Infl <span class="sc">+</span> Type <span class="sc">+</span> Cont, <span class="at">data =</span> housing)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="poisson-glm-modeling" class="level3" data-number="5.9.1">
<h3 data-number="5.9.1" class="anchored" data-anchor-id="poisson-glm-modeling"><span class="header-section-number">5.9.1</span> Poisson GLM Modeling</h3>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-63_60f6f0c0b595ab40131efaa955294d73">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co"># simple glm model (satisfaction independent of Infl, Type, Cont)</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a>house_glm <span class="ot">&lt;-</span> <span class="fu">glm</span>(Freq <span class="sc">~</span> Infl<span class="sc">*</span>Type<span class="sc">*</span>Cont <span class="sc">+</span> Sat, <span class="at">data =</span> housing, <span class="at">family =</span> poisson)</span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(house_glm) <span class="co"># high residual deviance</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Freq ~ Infl * Type * Cont + Sat, family = poisson, 
    data = housing)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-4.5551  -1.0612  -0.0593   0.6483   4.1478  

Coefficients:
                                    Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                        3.136e+00  1.196e-01  26.225  &lt; 2e-16 ***
InflMedium                         2.733e-01  1.586e-01   1.723 0.084868 .  
InflHigh                          -2.054e-01  1.784e-01  -1.152 0.249511    
TypeApartment                      3.666e-01  1.555e-01   2.357 0.018403 *  
TypeAtrium                        -7.828e-01  2.134e-01  -3.668 0.000244 ***
TypeTerrace                       -8.145e-01  2.157e-01  -3.775 0.000160 ***
ContHigh                          -2.200e-16  1.690e-01   0.000 1.000000    
Sat.L                              1.159e-01  4.038e-02   2.871 0.004094 ** 
Sat.Q                              2.629e-01  4.515e-02   5.824 5.76e-09 ***
InflMedium:TypeApartment          -1.177e-01  2.086e-01  -0.564 0.572571    
InflHigh:TypeApartment             1.753e-01  2.279e-01   0.769 0.441783    
InflMedium:TypeAtrium             -4.068e-01  3.035e-01  -1.340 0.180118    
InflHigh:TypeAtrium               -1.692e-01  3.294e-01  -0.514 0.607433    
InflMedium:TypeTerrace             6.292e-03  2.860e-01   0.022 0.982450    
InflHigh:TypeTerrace              -9.305e-02  3.280e-01  -0.284 0.776633    
InflMedium:ContHigh               -1.398e-01  2.279e-01  -0.613 0.539715    
InflHigh:ContHigh                 -6.091e-01  2.800e-01  -2.176 0.029585 *  
TypeApartment:ContHigh             5.029e-01  2.109e-01   2.385 0.017083 *  
TypeAtrium:ContHigh                6.774e-01  2.751e-01   2.462 0.013811 *  
TypeTerrace:ContHigh               1.099e+00  2.675e-01   4.106 4.02e-05 ***
InflMedium:TypeApartment:ContHigh  5.359e-02  2.862e-01   0.187 0.851450    
InflHigh:TypeApartment:ContHigh    1.462e-01  3.380e-01   0.432 0.665390    
InflMedium:TypeAtrium:ContHigh     1.555e-01  3.907e-01   0.398 0.690597    
InflHigh:TypeAtrium:ContHigh       4.782e-01  4.441e-01   1.077 0.281619    
InflMedium:TypeTerrace:ContHigh   -4.980e-01  3.671e-01  -1.357 0.174827    
InflHigh:TypeTerrace:ContHigh     -4.470e-01  4.545e-01  -0.984 0.325326    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 833.66  on 71  degrees of freedom
Residual deviance: 217.46  on 46  degrees of freedom
AIC: 610.43

Number of Fisher Scoring iterations: 5</code></pre>
</div>
</div>
<p>Clearly there’s probably some correlation between satisfaction and the other variables, let’s check them out individually.</p>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-64_139f0ca7247bf49f3392acd59d489e55">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co"># addterm will check each term individually, and test marginality</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="fu">addterm</span>(house_glm, <span class="sc">~</span>. <span class="sc">+</span> Sat<span class="sc">:</span>(Infl<span class="sc">+</span>Type<span class="sc">+</span>Cont), <span class="at">test =</span> <span class="st">"Chisq"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Single term additions

Model:
Freq ~ Infl * Type * Cont + Sat
         Df Deviance    AIC     LRT   Pr(Chi)    
&lt;none&gt;        217.46 610.43                      
Infl:Sat  4   111.08 512.05 106.371 &lt; 2.2e-16 ***
Type:Sat  6   156.79 561.76  60.669 3.292e-11 ***
Cont:Sat  2   212.33 609.30   5.126   0.07708 .  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Influence seems to have the largest impact, so we add this to the model, and type probably has a large</p>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-65_34e062a901d63622322e25404c48f275">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a>house_glm1 <span class="ot">&lt;-</span> <span class="fu">update</span>(house_glm, .<span class="sc">~</span>. <span class="sc">+</span> Sat<span class="sc">:</span>(Infl <span class="sc">+</span> Type <span class="sc">+</span> Cont))</span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(house_glm1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = Freq ~ Infl + Type + Cont + Sat + Infl:Type + Infl:Cont + 
    Type:Cont + Infl:Sat + Type:Sat + Cont:Sat + Infl:Type:Cont, 
    family = poisson, data = housing)

Deviance Residuals: 
    Min       1Q   Median       3Q      Max  
-1.6022  -0.5282  -0.0641   0.5757   1.9322  

Coefficients:
                                   Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                        3.135074   0.120112  26.101  &lt; 2e-16 ***
InflMedium                         0.248327   0.159979   1.552 0.120602    
InflHigh                          -0.412645   0.184947  -2.231 0.025671 *  
TypeApartment                      0.292524   0.157477   1.858 0.063231 .  
TypeAtrium                        -0.792847   0.214413  -3.698 0.000218 ***
TypeTerrace                       -1.018074   0.221263  -4.601 4.20e-06 ***
ContHigh                          -0.001407   0.169711  -0.008 0.993385    
Sat.L                             -0.098106   0.112592  -0.871 0.383570    
Sat.Q                              0.285657   0.122283   2.336 0.019489 *  
InflMedium:TypeApartment          -0.017882   0.210496  -0.085 0.932302    
InflHigh:TypeApartment             0.386869   0.233297   1.658 0.097263 .  
InflMedium:TypeAtrium             -0.360311   0.304979  -1.181 0.237432    
InflHigh:TypeAtrium               -0.036788   0.334793  -0.110 0.912503    
InflMedium:TypeTerrace             0.185154   0.288892   0.641 0.521580    
InflHigh:TypeTerrace               0.310749   0.334815   0.928 0.353345    
InflMedium:ContHigh               -0.200060   0.228748  -0.875 0.381799    
InflHigh:ContHigh                 -0.725790   0.282352  -2.571 0.010155 *  
TypeApartment:ContHigh             0.569691   0.212152   2.685 0.007247 ** 
TypeAtrium:ContHigh                0.702115   0.276056   2.543 0.010979 *  
TypeTerrace:ContHigh               1.215930   0.269968   4.504 6.67e-06 ***
InflMedium:Sat.L                   0.519627   0.096830   5.366 8.03e-08 ***
InflHigh:Sat.L                     1.140302   0.118180   9.649  &lt; 2e-16 ***
InflMedium:Sat.Q                  -0.064474   0.102666  -0.628 0.530004    
InflHigh:Sat.Q                     0.115436   0.127798   0.903 0.366380    
TypeApartment:Sat.L               -0.520170   0.109793  -4.738 2.16e-06 ***
TypeAtrium:Sat.L                  -0.288484   0.149551  -1.929 0.053730 .  
TypeTerrace:Sat.L                 -0.998666   0.141527  -7.056 1.71e-12 ***
TypeApartment:Sat.Q                0.055418   0.118515   0.468 0.640068    
TypeAtrium:Sat.Q                  -0.273820   0.149713  -1.829 0.067405 .  
TypeTerrace:Sat.Q                 -0.032328   0.149251  -0.217 0.828520    
ContHigh:Sat.L                     0.340703   0.087778   3.881 0.000104 ***
ContHigh:Sat.Q                    -0.097929   0.094068  -1.041 0.297851    
InflMedium:TypeApartment:ContHigh  0.046900   0.286212   0.164 0.869837    
InflHigh:TypeApartment:ContHigh    0.126229   0.338208   0.373 0.708979    
InflMedium:TypeAtrium:ContHigh     0.157239   0.390719   0.402 0.687364    
InflHigh:TypeAtrium:ContHigh       0.478611   0.444244   1.077 0.281320    
InflMedium:TypeTerrace:ContHigh   -0.500162   0.367135  -1.362 0.173091    
InflHigh:TypeTerrace:ContHigh     -0.463099   0.454713  -1.018 0.308467    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for poisson family taken to be 1)

    Null deviance: 833.657  on 71  degrees of freedom
Residual deviance:  38.662  on 34  degrees of freedom
AIC: 455.63

Number of Fisher Scoring iterations: 4</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sum(residuals(house_glm1, type = "pearson")^2) / house_glm1$df.residual # dispersion estimate</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>house_glm1<span class="sc">$</span>df.residual <span class="co"># nrow(housing) - length(coef(house_glm1))</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 34</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="co"># sum(residuals(house_glm1, type = "deviance")^2) / house_glm1$df.residual</span></span>
<span id="cb155-2"><a href="#cb155-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 - pchisq(deviance(house_glm1), house_glm1$df.residual) # .267? what's the test here...</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>See 202 for rescaling the predictions from this model to the probability scale (by the margin of satisfaction)</p>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-66_a332b2b1d4c1e1f89ed26527cc7a3d27">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a>hnames <span class="ot">&lt;-</span> <span class="fu">lapply</span>(housing[, <span class="sc">-</span><span class="dv">5</span>], levels) <span class="co"># </span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a>house_pm <span class="ot">&lt;-</span> <span class="fu">predict</span>(house_glm1, <span class="fu">expand.grid</span>(hnames), <span class="at">type =</span> <span class="st">"response"</span>) <span class="co"># poisson means exp(\eta)</span></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>house_pm <span class="ot">&lt;-</span> <span class="fu">matrix</span>(house_pm, <span class="at">ncol =</span> <span class="dv">3</span>, <span class="at">byrow =</span> T, <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="cn">NULL</span>, hnames[[<span class="dv">1</span>]])) <span class="co"># list the predictions into matrix form, columns being satisfaction</span></span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a><span class="fu">cbind</span>(<span class="fu">expand.grid</span>(hnames[<span class="sc">-</span><span class="dv">1</span>]), house_pm <span class="sc">/</span> <span class="fu">rowSums</span>(house_pm)) <span class="co"># normalize by row, and attach the name</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>     Infl      Type Cont       Low    Medium      High
1     Low     Tower  Low 0.3955687 0.2601077 0.3443236
2  Medium     Tower  Low 0.2602403 0.2674072 0.4723526
3    High     Tower  Low 0.1504958 0.1924126 0.6570916
4     Low Apartment  Low 0.5427582 0.2308450 0.2263968
5  Medium Apartment  Low 0.3945683 0.2622428 0.3431889
6    High Apartment  Low 0.2551503 0.2110026 0.5338470
7     Low    Atrium  Low 0.4294218 0.3220096 0.2485686
8  Medium    Atrium  Low 0.2959630 0.3468082 0.3572289
9    High    Atrium  Low 0.1865151 0.2719420 0.5415429
10    Low   Terrace  Low 0.6453059 0.2178758 0.1368183
11 Medium   Terrace  Low 0.5076883 0.2678600 0.2244517
12   High   Terrace  Low 0.3676505 0.2413550 0.3909945
13    Low     Tower High 0.2982776 0.2813636 0.4203589
14 Medium     Tower High 0.1847507 0.2723332 0.5429161
15   High     Tower High 0.1009787 0.1852058 0.7138155
16    Low Apartment High 0.4375458 0.2669645 0.2954897
17 Medium Apartment High 0.2974727 0.2836249 0.4189024
18   High Apartment High 0.1794106 0.2128413 0.6077481
19    Low    Atrium High 0.3319072 0.3570404 0.3110524
20 Medium    Atrium High 0.2157414 0.3626615 0.4215970
21   High    Atrium High 0.1283298 0.2684145 0.6032556
22    Low   Terrace High 0.5471602 0.2650171 0.1878227
23 Medium   Terrace High 0.4044226 0.3060991 0.2894783
24   High   Terrace High 0.2729568 0.2570580 0.4699852</code></pre>
</div>
</div>
</section>
<section id="log-linear-models" class="level3" data-number="5.9.2">
<h3 data-number="5.9.2" class="anchored" data-anchor-id="log-linear-models"><span class="header-section-number">5.9.2</span> Log Linear Models</h3>
<p>log linear models with iterative proportional scaling is done with function <code>loglm</code>.</p>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-67_0dd1e26379d35376a15e9e5efdf39ddc">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="fu">loglm</span>(Freq <span class="sc">~</span> Infl<span class="sc">*</span>Type<span class="sc">*</span>Cont <span class="sc">+</span> Sat<span class="sc">*</span>(Infl <span class="sc">+</span> Type <span class="sc">+</span> Cont), <span class="at">data =</span> housing)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
loglm(formula = Freq ~ Infl * Type * Cont + Sat * (Infl + Type + 
    Cont), data = housing)

Statistics:
                      X^2 df  P(&gt; X^2)
Likelihood Ratio 38.66222 34 0.2671359
Pearson          38.90831 34 0.2582333</code></pre>
</div>
</div>
</section>
<section id="multinomial-models" class="level3" data-number="5.9.3">
<h3 data-number="5.9.3" class="anchored" data-anchor-id="multinomial-models"><span class="header-section-number">5.9.3</span> Multinomial Models</h3>
<p>The example data we’ll is use party affiliation:</p>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-68_a9e0ce2ecd7e8a07b6b8b41b6ffbd79d">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="co"># array version of data</span></span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>party <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">c</span>(<span class="dv">132</span>, <span class="dv">42</span>, <span class="dv">176</span>, <span class="dv">6</span>, <span class="dv">127</span>, <span class="dv">12</span>,</span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>                 <span class="dv">172</span>, <span class="dv">56</span>, <span class="dv">129</span>, <span class="dv">4</span>, <span class="dv">130</span>, <span class="dv">15</span>), </span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">2</span>),</span>
<span id="cb160-5"><a href="#cb160-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="at">race =</span> <span class="fu">c</span>(<span class="st">"white"</span>, <span class="st">"black"</span>),</span>
<span id="cb160-6"><a href="#cb160-6" aria-hidden="true" tabindex="-1"></a>                               <span class="at">party =</span> <span class="fu">c</span>(<span class="st">"democrat"</span>, <span class="st">"independent"</span>, <span class="st">"republican"</span>),</span>
<span id="cb160-7"><a href="#cb160-7" aria-hidden="true" tabindex="-1"></a>                               <span class="at">gender =</span> <span class="fu">c</span>(<span class="st">"male"</span>, <span class="st">"female"</span>)))</span>
<span id="cb160-8"><a href="#cb160-8" aria-hidden="true" tabindex="-1"></a>party_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame.table</span>(party) <span class="co"># data frame version of data</span></span>
<span id="cb160-9"><a href="#cb160-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb160-10"><a href="#cb160-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Marginal Tables</span></span>
<span id="cb160-11"><a href="#cb160-11" aria-hidden="true" tabindex="-1"></a>race_party <span class="ot">&lt;-</span> <span class="fu">margin.table</span>(party, <span class="at">margin =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb160-12"><a href="#cb160-12" aria-hidden="true" tabindex="-1"></a>gender_party <span class="ot">&lt;-</span> <span class="fu">margin.table</span>(party, <span class="at">margin =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">2</span>))</span>
<span id="cb160-13"><a href="#cb160-13" aria-hidden="true" tabindex="-1"></a>race_gender <span class="ot">&lt;-</span> <span class="fu">margin.table</span>(party, <span class="at">margin =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="nnet" class="level4">
<h4 class="anchored" data-anchor-id="nnet">nnet</h4>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-69_b117def923859ab0c9e7ea92f729c77f">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a>party_mod <span class="ot">&lt;-</span> <span class="fu">multinom</span>(party <span class="sc">~</span> race <span class="sc">+</span> gender, <span class="at">weights =</span> Freq, party_df) <span class="co"># democrat is the "reference"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># weights:  12 (6 variable)
initial  value 1099.710901 
iter  10 value 1042.893269
final  value 1042.891187 
converged</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(party_mod)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Call:
multinom(formula = party ~ race + gender, data = party_df, weights = Freq)

Coefficients:
            (Intercept) raceblack genderfemale
independent   0.2855582 -2.278140   -0.5727764
republican   -0.0497550 -1.118276   -0.2201972

Std. Errors:
            (Intercept) raceblack genderfemale
independent   0.1125979 0.3427945    0.1575210
republican    0.1198046 0.2335145    0.1582522

Residual Deviance: 2085.782 
AIC: 2097.782 </code></pre>
</div>
</div>
<p>Hypothesis testing with nnet</p>
</section>
<section id="vgam" class="level4">
<h4 class="anchored" data-anchor-id="vgam">VGAM</h4>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-70_ae087313e3784090b03c2a8118d302c6">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="co"># VGAM</span></span>
<span id="cb165-2"><a href="#cb165-2" aria-hidden="true" tabindex="-1"></a><span class="co"># needs version in which "stimulus factors" are separated from "response" factors.</span></span>
<span id="cb165-3"><a href="#cb165-3" aria-hidden="true" tabindex="-1"></a>housing_wide <span class="ot">&lt;-</span> housing <span class="sc">%&gt;%</span> <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">"Sat"</span>, <span class="at">values_from =</span> <span class="st">"Freq"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Our saturated dataset is one in which every cell is estimated with a parameter.</p>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-71_17a9697077790f1000383223f523e97e">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="co"># saturated model</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a>housing_vglm0 <span class="ot">&lt;-</span> <span class="fu">vglm</span>(<span class="fu">cbind</span>(Low, Medium, High) <span class="sc">~</span> Infl<span class="sc">*</span>Type<span class="sc">*</span>Cont, <span class="at">data =</span> housing_wide, <span class="at">family =</span> multinomial)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in vglm.fitter(x = x, y = y, w = w, offset = offset, Xm2 = Xm2, : some
quantities such as z, residuals, SEs may be inaccurate due to convergence at a
half-step</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb168"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb168-1"><a href="#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="fu">deviance</span>(housing_vglm0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -9.792167e-14</code></pre>
</div>
</div>
<p>In the saturated model, we see that our deviance is equal to 0 because it fits the data perfectly.</p>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-72_3433ab15d90469f65b4e2ff27f5dc004">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="co"># full two way interaction model</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>housing_vglm <span class="ot">&lt;-</span> <span class="fu">vglm</span>(<span class="fu">cbind</span>(Low, Medium, High) <span class="sc">~</span> (Infl <span class="sc">+</span> Type <span class="sc">+</span> Cont)<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> housing_wide, <span class="at">family =</span> multinomial)</span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(housing_vglm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
vglm(formula = cbind(Low, Medium, High) ~ (Infl + Type + Cont)^2, 
    family = multinomial, data = housing_wide)

Coefficients: 
                             Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept):1              -0.2728053  0.2532115  -1.077  0.28131    
(Intercept):2              -0.3780064  0.2576046  -1.467  0.14227    
InflMedium:1                0.1982869  0.3081018   0.644  0.51985    
InflMedium:2               -0.0083922  0.3171262  -0.026  0.97889    
InflHigh:1                 -0.9649735  0.3945466  -2.446  0.01445 *  
InflHigh:2                 -0.8646670  0.3794916  -2.278  0.02270 *  
TypeApartment:1             1.4992506  0.3153481   4.754 1.99e-06 ***
TypeApartment:2             0.6555399  0.3307945   1.982  0.04751 *  
TypeAtrium:1                0.6246612  0.4142176   1.508  0.13154    
TypeAtrium:2                0.3751106  0.4204712   0.892  0.37233    
TypeTerrace:1               1.2966645  0.4192741   3.093  0.00198 ** 
TypeTerrace:2               0.4378242  0.4595906   0.953  0.34077    
ContHigh:1                 -0.7397711  0.3116324  -2.374  0.01760 *  
ContHigh:2                 -0.2009809  0.3039959  -0.661  0.50853    
InflMedium:TypeApartment:1 -1.3982019  0.3535169  -3.955 7.65e-05 ***
InflMedium:TypeApartment:2 -0.5498060  0.3604313  -1.525  0.12716    
InflHigh:TypeApartment:1   -0.9211659  0.4576832  -2.013  0.04415 *  
InflHigh:TypeApartment:2   -0.3138506  0.4358689  -0.720  0.47149    
InflMedium:TypeAtrium:1    -0.9955454  0.4790778  -2.078  0.03771 *  
InflMedium:TypeAtrium:2    -0.1868591  0.4525047  -0.413  0.67965    
InflHigh:TypeAtrium:1       0.1416714  0.5758309   0.246  0.80566    
InflHigh:TypeAtrium:2       0.2132503  0.5362081   0.398  0.69085    
InflMedium:TypeTerrace:1   -0.9030966  0.4563464  -1.979  0.04782 *  
InflMedium:TypeTerrace:2    0.0081197  0.4836471   0.017  0.98661    
InflHigh:TypeTerrace:1     -0.8443360  0.5889810  -1.434  0.15170    
InflHigh:TypeTerrace:2     -0.2200667  0.5911664  -0.372  0.70970    
InflMedium:ContHigh:1       0.0119167  0.2883493   0.041  0.96703    
InflMedium:ContHigh:2      -0.0735225  0.3046628  -0.241  0.80930    
InflHigh:ContHigh:1        -0.2258679  0.3504496  -0.645  0.51925    
InflHigh:ContHigh:2         0.0318502  0.3496997   0.091  0.92743    
TypeApartment:ContHigh:1    0.1350432  0.3218707   0.420  0.67481    
TypeApartment:ContHigh:2   -0.0002221  0.3186735  -0.001  0.99944    
TypeAtrium:ContHigh:1       0.3409407  0.4320950   0.789  0.43009    
TypeAtrium:ContHigh:2       0.2975587  0.4139167   0.719  0.47221    
TypeTerrace:ContHigh:1      1.1520381  0.4173381   2.760  0.00577 ** 
TypeTerrace:ContHigh:2      0.6313710  0.4353792   1.450  0.14701    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Names of linear predictors: log(mu[,1]/mu[,3]), log(mu[,2]/mu[,3])

Residual deviance: 5.9443 on 12 degrees of freedom

Log-likelihood: -102.5404 on 12 degrees of freedom

Number of Fisher scoring iterations: 3 

No Hauck-Donner effect found in any of the estimates


Reference group is level  3  of the response</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="fu">deviance</span>(housing_vglm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.944319</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lack of fit tests</span></span>
<span id="cb174-2"><a href="#cb174-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(<span class="fu">deviance</span>(housing_vglm), <span class="fu">df.residual</span>(housing_vglm)) <span class="co"># deviance</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9188628</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">-</span> <span class="fu">pchisq</span>(<span class="fu">sum</span>(<span class="fu">residuals</span>(housing_vglm, <span class="at">type =</span> <span class="st">"pearson"</span>)<span class="sc">^</span><span class="dv">2</span>), <span class="fu">df.residual</span>(housing_vglm)) <span class="co"># pearson</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.917741</code></pre>
</div>
</div>
<p>The null hypothesis here is that the model is specified correctly. High p-values mean we fail to reject that the model is correct. In general, lack of fit tests are pretty bad tests for telling us any information. We would prefer to do some manual model searching.</p>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-73_7a39b1af3c72c115fe3d94f8097fab7b">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="fu">drop1</span>(housing_vglm, <span class="at">test =</span> <span class="st">"LRT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Single term deletions

Model:
cbind(Low, Medium, High) ~ (Infl + Type + Cont)^2
          Df Deviance    AIC     LRT Pr(&gt;Chi)  
&lt;none&gt;         5.9443 277.08                   
Infl:Type 12  27.0024 274.14 21.0581  0.04954 *
Infl:Cont  4   6.8284 269.96  0.8841  0.92684  
Type:Cont  6  15.2341 274.37  9.2898  0.15793  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>The results here say that we could probably drop <code>Infl:Cont</code> and <code>Type:Cont</code>. In fact, dropping <code>Infl:Cont</code>, we would get the biggest drop in AIC, indicating better model fit for number of parameters we estimate.</p>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-74_9f13b1096ff56cd3c94c1e9fe94e33eb">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>housing_vglm1 <span class="ot">&lt;-</span> <span class="fu">update</span>(housing_vglm, .<span class="sc">~</span>. <span class="sc">-</span> Infl<span class="sc">:</span>Cont)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in vglm.fitter(x = x, y = y, w = w, offset = offset, Xm2 = Xm2, : some
quantities such as z, residuals, SEs may be inaccurate due to convergence at a
half-step</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="fu">drop1</span>(housing_vglm1, <span class="at">test =</span> <span class="st">"LRT"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Single term deletions

Model:
cbind(Low, Medium, High) ~ Infl + Type + Cont + Infl:Type + Type:Cont
          Df Deviance    AIC     LRT Pr(&gt;Chi)  
&lt;none&gt;         6.8284 269.96                   
Infl:Type 12  28.2559 267.39 21.4275  0.04446 *
Type:Cont  6  16.1072 267.24  9.2788  0.15850  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Doing it again shows we could again get lower AIC by dropping either parameter…. an automated way of doing this can be done through <code>step4vglm</code></p>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-75_172d7a17a5da719ec925b341609c68fe">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Forward-Backward Step selection on 2-way interaction model</span></span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>housing_vglm_step <span class="ot">&lt;-</span> <span class="fu">step4vglm</span>(housing_vglm, <span class="at">direction =</span> <span class="st">"both"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Start:  AIC=277.08
cbind(Low, Medium, High) ~ (Infl + Type + Cont)^2

            Df Deviance    AIC
- Infl:Cont  4   6.8284 269.96
- Infl:Type 12  27.0024 274.14
- Type:Cont  6  15.2341 274.37
&lt;none&gt;           5.9443 277.08</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in vglm.fitter(x = x, y = y, w = w, offset = offset, Xm2 = Xm2, : some
quantities such as z, residuals, SEs may be inaccurate due to convergence at a
half-step</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Step:  AIC=269.96
cbind(Low, Medium, High) ~ Infl + Type + Cont + Infl:Type + Type:Cont

            Df Deviance    AIC
- Type:Cont  6  16.1072 267.24
- Infl:Type 12  28.2559 267.39
&lt;none&gt;           6.8284 269.96
+ Infl:Cont  4   5.9443 277.08

Step:  AIC=267.24
cbind(Low, Medium, High) ~ Infl + Type + Cont + Infl:Type

            Df Deviance    AIC
- Infl:Type 12   38.662 265.80
&lt;none&gt;           16.107 267.24
+ Type:Cont  6    6.828 269.96
+ Infl:Cont  4   15.234 274.37
- Cont       2   32.871 280.01

Step:  AIC=265.8
cbind(Low, Medium, High) ~ Infl + Type + Cont

            Df Deviance    AIC
&lt;none&gt;           38.662 265.80
+ Infl:Type 12   16.107 267.24
+ Type:Cont  6   28.256 267.39
+ Infl:Cont  4   37.472 272.61
- Cont       2   54.722 277.86
- Type       6  100.889 316.03
- Infl       4  147.780 366.92</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a>housing_vglm_step<span class="sc">@</span>post<span class="sc">$</span>anova <span class="co"># shows the steps that the algorithm took</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>         Step Df   Deviance Resid. Df Resid. Dev      AIC
1             NA         NA        12   5.944319 277.0807
2 - Infl:Cont  4  0.8840624        16   6.828381 269.9648
3 - Type:Cont  6  9.2787763        22  16.107157 267.2436
4 - Infl:Type 12 22.5550474        34  38.662205 265.7986</code></pre>
</div>
</div>
<p>The steps the algorithm is saved in the slot <code>@post$anova</code>. We can see that the additive model was selected, dropping all the interactions.</p>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-76_8a360ed7e01db730331af62704af8df9">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="co"># additive model</span></span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>housing_vglm2 <span class="ot">&lt;-</span> <span class="fu">vglm</span>(<span class="fu">cbind</span>(Low, Medium, High) <span class="sc">~</span> Infl <span class="sc">+</span> Type <span class="sc">+</span> Cont, <span class="at">data =</span> housing_wide, <span class="at">family =</span> multinomial)</span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(housing_vglm2, housing_vglm, <span class="at">type =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table

Model 1: cbind(Low, Medium, High) ~ Infl + Type + Cont
Model 2: cbind(Low, Medium, High) ~ (Infl + Type + Cont)^2
  Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)  
1        34     38.662                       
2        12      5.944 22   32.718  0.06595 .
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>there’s weak evidence that those dropped coefficients were not zero… so in favor of the more parsimonious and interpretable model, we choose the additive model. Now we do some diagnostics, show the mosaic plot of the pearson chisq values.</p>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-77_ee9e96f11b3a1362fd620ff0e372805e">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">residuals</span>(housing_vglm2, <span class="st">"pearson"</span>)<span class="sc">^</span><span class="dv">2</span>) <span class="co"># asymptotically the same</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 38.91043</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb194"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb194-1"><a href="#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="fu">deviance</span>(housing_vglm2) <span class="co"># pretty darn close</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 38.6622</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb196"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="co"># grab standardized residuals... I think theses are on the raw scale, need to derive</span></span>
<span id="cb196-2"><a href="#cb196-2" aria-hidden="true" tabindex="-1"></a>housing_vglm2_stdres <span class="ot">&lt;-</span> housing_wide <span class="sc">%&gt;%</span> </span>
<span id="cb196-3"><a href="#cb196-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Infl,Type, Cont) <span class="sc">%&gt;%</span> </span>
<span id="cb196-4"><a href="#cb196-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_cols</span>(<span class="fu">residuals</span>(housing_vglm2, <span class="st">"stdres"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb196-5"><a href="#cb196-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(Low<span class="sc">:</span>High, <span class="at">names_to =</span> <span class="st">"Sat"</span>, <span class="at">values_to =</span> <span class="st">"stdres"</span>)</span>
<span id="cb196-6"><a href="#cb196-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-7"><a href="#cb196-7" aria-hidden="true" tabindex="-1"></a>foo <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(stdres<span class="sc">~</span>Sat <span class="sc">+</span> Infl <span class="sc">+</span> Type, <span class="at">data=</span>housing_vglm2_stdres)</span>
<span id="cb196-8"><a href="#cb196-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb196-9"><a href="#cb196-9" aria-hidden="true" tabindex="-1"></a>foo</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>, , Type = Tower

        Infl
Sat             Low     Medium       High
  High    2.3368820  1.7993578  7.6329517
  Low    -3.1561606 -1.7459604 -5.4886972
  Medium  0.7896368 -0.1247062 -2.5826432

, , Type = Apartment

        Infl
Sat             Low     Medium       High
  High   -8.7451504  1.0581085  7.6844538
  Low     9.5841342 -1.4240255 -5.7464336
  Medium -0.5702533  0.3521384 -2.3637276

, , Type = Atrium

        Infl
Sat             Low     Medium       High
  High   -2.3120155  0.8251904  2.0911215
  Low     0.4934728 -3.1374902 -2.6638237
  Medium  2.0341706  2.4451851  0.5348104

, , Type = Terrace

        Infl
Sat             Low     Medium       High
  High   -7.1933577 -4.3805628  2.2529711
  Low     8.6764258  2.8198862 -1.6825344
  Medium -1.3182128  1.8356588 -0.6954066</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb198"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaicplot</span>(foo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="categorical_files/figure-html/unnamed-chunk-77-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-78_59279744f2b9f219b05ff87ffc687988">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a>housing_wide_matrix <span class="ot">&lt;-</span> housing_wide <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(Low<span class="sc">:</span>High) <span class="sc">%&gt;%</span> </span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.matrix</span>()</span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a>sat_margin <span class="ot">&lt;-</span> housing_wide_matrix <span class="sc">%&gt;%</span> <span class="fu">rowSums</span>()</span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-5"><a href="#cb199-5" aria-hidden="true" tabindex="-1"></a>housing_vglm2_predicted <span class="ot">&lt;-</span> <span class="fu">fitted</span>(housing_vglm2) <span class="sc">*</span> sat_margin</span>
<span id="cb199-6"><a href="#cb199-6" aria-hidden="true" tabindex="-1"></a>(housing_wide_matrix <span class="sc">-</span> housing_vglm2_predicted) <span class="sc">/</span> <span class="fu">sqrt</span>(housing_vglm2_predicted)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>              Low      Medium         High
 [1,] -1.27131702  0.65442726  0.793847557
 [2,]  2.05554037 -0.52448903 -1.131108776
 [3,]  0.48542299  0.00980894 -0.237618822
 [4,]  0.83488118 -0.06530752 -1.226738951
 [5,] -0.52159491  0.72901366 -0.077987991
 [6,]  0.19903520 -0.58897340  0.232680471
 [7,] -0.20002910 -0.40632189  0.725380811
 [8,] -0.09968461 -0.54894903  0.631617806
 [9,]  0.93631742  0.41590003 -0.844215602
[10,] -0.44816554 -0.29018330  1.339493961
[11,] -1.27460531  0.60886282  1.251820928
[12,] -0.50068951 -0.23393207  0.669307443
[13,] -1.50554299 -0.15670496  1.396421868
[14,]  0.57743627  0.25994911 -0.520953337
[15,] -0.07366774 -0.30940893  0.185311590
[16,]  0.57671852  0.21220772 -0.903490751
[17,] -0.71913615 -0.80963872  1.272211462
[18,] -0.77139003  0.70614331  0.001230827
[19,] -0.19903792  0.10678590  0.091194172
[20,] -0.59885245  0.37522109  0.080380548
[21,]  0.96158954 -0.06254569 -0.401788912
[22,]  0.85710435 -0.33167080 -1.068931434
[23,]  0.91913589  0.24740415 -1.340806857
[24,] -0.60596707 -0.06819771  0.512236271</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="fu">residuals</span>(housing_vglm2, <span class="at">type =</span> <span class="st">"response"</span>) <span class="sc">+</span> <span class="fu">fitted</span>(housing_vglm2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          Low    Medium      High
1  0.30000000 0.3000000 0.4000000
2  0.36956522 0.2391304 0.3913043
3  0.17543860 0.1929825 0.6315789
4  0.60396040 0.2277228 0.1683168
5  0.36440678 0.2966102 0.3389831
6  0.26530612 0.1836735 0.5510204
7  0.40625000 0.2812500 0.3125000
8  0.28571429 0.2857143 0.4285714
9  0.27272727 0.3181818 0.4090909
10 0.58064516 0.1935484 0.2258065
11 0.36585366 0.3170732 0.3170732
12 0.30434783 0.2173913 0.4782609
13 0.20000000 0.2714286 0.5285714
14 0.21250000 0.2875000 0.5000000
15 0.09677419 0.1612903 0.7419355
16 0.46706587 0.2754491 0.2574850
17 0.26815642 0.2513966 0.4804469
18 0.14705882 0.2450980 0.6078431
19 0.31746032 0.3650794 0.3174603
20 0.17857143 0.3928571 0.4285714
21 0.18421053 0.2631579 0.5526316
22 0.61290323 0.2473118 0.1397849
23 0.47692308 0.3230769 0.2000000
24 0.20833333 0.2500000 0.5416667</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a>obs_p <span class="ot">&lt;-</span> housing_wide_matrix <span class="sc">/</span> sat_margin</span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a>fit_p <span class="ot">&lt;-</span> <span class="fu">fitted</span>(housing_vglm2)</span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a><span class="fu">residuals</span>(housing_vglm2, <span class="at">type =</span> <span class="st">"response"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>           Low        Medium          High
1  -0.09556873  0.0398922904  5.567644e-02
2   0.10932496 -0.0282767182 -8.104824e-02
3   0.02494279  0.0005699035 -2.551270e-02
4   0.06120222 -0.0031222147 -5.808001e-02
5  -0.03016154  0.0343673813 -4.205846e-03
6   0.01015582 -0.0273291797  1.717336e-02
7  -0.02317183 -0.0407595729  6.393140e-02
8  -0.01024868 -0.0610938738  7.134255e-02
9   0.08621220  0.0462397822 -1.324520e-01
10 -0.06466070 -0.0243274212  8.898812e-02
11 -0.14183466  0.0492131823  9.262148e-02
12 -0.06330269 -0.0239637078  8.726640e-02
13 -0.09827758 -0.0099349949  1.082126e-01
14  0.02774930  0.0151667891 -4.291609e-02
15 -0.00420447 -0.0239154916  2.811996e-02
16  0.02952007  0.0084845677 -3.800464e-02
17 -0.02931623 -0.0322282664  6.154450e-02
18 -0.03235176  0.0322567566  9.500771e-05
19 -0.01444687  0.0080390048  6.407869e-03
20 -0.03717000  0.0301956212  6.974382e-03
21  0.05588069 -0.0052566447 -5.062404e-02
22  0.06574300 -0.0177052766 -4.803772e-02
23  0.07250046  0.0169777976 -8.947826e-02
24 -0.06462348 -0.0070579688  7.168145e-02</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="co"># varfun &lt;- object@family@charfun</span></span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a><span class="co"># vfun &lt;- varfun(x = NULL, eta = predict(object), </span></span>
<span id="cb205-3"><a href="#cb205-3" aria-hidden="true" tabindex="-1"></a><span class="co">#                   extra = object@extra, varfun = TRUE)</span></span>
<span id="cb205-4"><a href="#cb205-4" aria-hidden="true" tabindex="-1"></a><span class="co">#                 ans &lt;- (y - E1)/sqrt(vfun * (1 - c(hatvalues(object))))</span></span>
<span id="cb205-5"><a href="#cb205-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb205-6"><a href="#cb205-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 - hatvalues(housing_vglm2)</span></span>
<span id="cb205-7"><a href="#cb205-7" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb205-8"><a href="#cb205-8" aria-hidden="true" tabindex="-1"></a><span class="co"># varfun &lt;- housing_vglm2@family@charfun</span></span>
<span id="cb205-9"><a href="#cb205-9" aria-hidden="true" tabindex="-1"></a><span class="co"># vfun &lt;- varfun(x = NULL, eta = predict(housing_vglm2), extra = housing_vglm2@extra, varfun = TRUE)</span></span>
<span id="cb205-10"><a href="#cb205-10" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb205-11"><a href="#cb205-11" aria-hidden="true" tabindex="-1"></a><span class="co"># housing_vglm2@family@vfamily</span></span>
<span id="cb205-12"><a href="#cb205-12" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb205-13"><a href="#cb205-13" aria-hidden="true" tabindex="-1"></a><span class="co"># w &lt;- weights(object, type = "prior")</span></span>
<span id="cb205-14"><a href="#cb205-14" aria-hidden="true" tabindex="-1"></a><span class="co">#                 x &lt;- y * c(w)</span></span>
<span id="cb205-15"><a href="#cb205-15" aria-hidden="true" tabindex="-1"></a><span class="co">#                 E1 &lt;- E1 * c(w)</span></span>
<span id="cb205-16"><a href="#cb205-16" aria-hidden="true" tabindex="-1"></a><span class="co">#                 if (any(x &lt; 0) || anyNA(x)) stop("all entries of 'x' must be nonnegative and finite")</span></span>
<span id="cb205-17"><a href="#cb205-17" aria-hidden="true" tabindex="-1"></a><span class="co">#                 if ((n &lt;- sum(x)) == 0) stop("at least one entry of 'x' must be positive")</span></span>
<span id="cb205-18"><a href="#cb205-18" aria-hidden="true" tabindex="-1"></a><span class="co">#                 if (length(dim(x)) &gt; 2L) stop("invalid 'x'")</span></span>
<span id="cb205-19"><a href="#cb205-19" aria-hidden="true" tabindex="-1"></a><span class="co">#                 if (length(x) == 1L) stop("'x' must at least have 2 elements")</span></span>
<span id="cb205-20"><a href="#cb205-20" aria-hidden="true" tabindex="-1"></a><span class="co">#                 sr &lt;- rowSums(x)</span></span>
<span id="cb205-21"><a href="#cb205-21" aria-hidden="true" tabindex="-1"></a><span class="co">#                 sc &lt;- colSums(x)</span></span>
<span id="cb205-22"><a href="#cb205-22" aria-hidden="true" tabindex="-1"></a><span class="co">#                 E &lt;- outer(sr, sc, "*")/n</span></span>
<span id="cb205-23"><a href="#cb205-23" aria-hidden="true" tabindex="-1"></a><span class="co">#                 v &lt;- function(r, c, n) c * r * (n - r) * (n - </span></span>
<span id="cb205-24"><a href="#cb205-24" aria-hidden="true" tabindex="-1"></a><span class="co">#                   c)/n^3</span></span>
<span id="cb205-25"><a href="#cb205-25" aria-hidden="true" tabindex="-1"></a><span class="co">#                 V &lt;- outer(sr, sc, v, n)</span></span>
<span id="cb205-26"><a href="#cb205-26" aria-hidden="true" tabindex="-1"></a><span class="co">#                 dimnames(E) &lt;- dimnames(x)</span></span>
<span id="cb205-27"><a href="#cb205-27" aria-hidden="true" tabindex="-1"></a><span class="co">#                 ans &lt;- stdres &lt;- (x - E)/sqrt(V)</span></span>
<span id="cb205-28"><a href="#cb205-28" aria-hidden="true" tabindex="-1"></a><span class="co"># rowSums(fitted)</span></span>
<span id="cb205-29"><a href="#cb205-29" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb205-30"><a href="#cb205-30" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb205-31"><a href="#cb205-31" aria-hidden="true" tabindex="-1"></a><span class="co"># housing_vglm2@y # observed</span></span>
<span id="cb205-32"><a href="#cb205-32" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(housing_vglm2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<p><img src="categorical_files/figure-html/unnamed-chunk-78-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="categorical_files/figure-html/unnamed-chunk-78-2.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="categorical_files/figure-html/unnamed-chunk-78-3.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output-display">
<p><img src="categorical_files/figure-html/unnamed-chunk-78-4.png" class="img-fluid" width="672"></p>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb206"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb206-1"><a href="#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(housing_vglm2, <span class="at">matrix =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>              log(mu[,1]/mu[,3]) log(mu[,2]/mu[,3])
(Intercept)            0.1387428         -0.2804860
InflMedium            -0.7348632         -0.2884673
InflHigh              -1.6126311         -0.9476957
TypeApartment          0.7356317          0.2999430
TypeAtrium             0.4079781          0.5393484
TypeTerrace            1.4123277          0.7457572
ContHigh              -0.4818270         -0.1209751</code></pre>
</div>
</div>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-79_6309120173b2ee39a169c745f9d82bc6">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb208"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the predicted probabilities by each of the covariates.</span></span>
<span id="cb208-2"><a href="#cb208-2" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_cols</span>(housing_wide <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(Infl, Type, Cont),</span>
<span id="cb208-3"><a href="#cb208-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">fitted</span>(housing_vglm2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 24 × 6
   Infl   Type      Cont    Low Medium  High
   &lt;fct&gt;  &lt;fct&gt;     &lt;fct&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;
 1 Low    Tower     Low   0.396  0.260 0.344
 2 Medium Tower     Low   0.260  0.267 0.472
 3 High   Tower     Low   0.150  0.192 0.657
 4 Low    Apartment Low   0.543  0.231 0.226
 5 Medium Apartment Low   0.395  0.262 0.343
 6 High   Apartment Low   0.255  0.211 0.534
 7 Low    Atrium    Low   0.429  0.322 0.249
 8 Medium Atrium    Low   0.296  0.347 0.357
 9 High   Atrium    Low   0.187  0.272 0.542
10 Low    Terrace   Low   0.645  0.218 0.137
# … with 14 more rows
# ℹ Use `print(n = ...)` to see more rows</code></pre>
</div>
</div>
<div class="cell" data-hash="categorical_cache/html/unnamed-chunk-80_dd1d8da057bb8a83b16165e5c2598857">
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb210"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(housing_vglm1, housing_vglm, <span class="at">type =</span> <span class="dv">1</span>) <span class="co"># score tests not available in VGAM currently</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Deviance Table

Model 1: cbind(Low, Medium, High) ~ Infl + Type + Cont + Infl:Type + Type:Cont
Model 2: cbind(Low, Medium, High) ~ (Infl + Type + Cont)^2
  Resid. Df Resid. Dev Df Deviance Pr(&gt;Chi)
1        16     6.8284                     
2        12     5.9443  4  0.88406   0.9268</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="fu">deviance</span>(housing_vglm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.944319</code></pre>
</div>
<details>
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dropterm</span>(housing_vglm, <span class="at">test =</span> <span class="st">"Chisq"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Single term deletions

Model:
cbind(Low, Medium, High) ~ (Infl + Type + Cont)^2
          Df    AIC     LRT Pr(Chi)  
&lt;none&gt;       277.08                  
Infl:Type 12 274.14 21.0581 0.04954 *
Infl:Cont  4 269.96  0.8841 0.92684  
Type:Cont  6 274.37  9.2898 0.15793  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="evaluating-results" class="level2" data-number="5.10">
<h2 data-number="5.10" class="anchored" data-anchor-id="evaluating-results"><span class="header-section-number">5.10</span> Evaluating Results</h2>
<p>There are a lot of multiclass metrics that are difficult to keep straight, especially as it comes to confusion matrix.</p>
<figure class="figure">
<p><img src="../classification/classification_metrics.jpg" style="width:100%" class="figure-img"></p>
<figcaption class="figure-caption">
</figcaption>
</figure>


<div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-agrestiCategoricalDataAnalysis2013" class="csl-entry" role="doc-biblioentry">
Agresti, Alan. 2013. <em>Categorical Data Analysis</em>. 3rd ed. Wiley Series in Probability and Statistics 792. Hoboken, NJ: Wiley.
</div>
<div id="ref-cochranMethodsStrengtheningCommon1954" class="csl-entry" role="doc-biblioentry">
Cochran, William G. 1954. <span>“Some Methods for Strengthening the Common Χ2 Tests.”</span> <em>Biometrics</em> 10 (4): 417–51. <a href="https://doi.org/10.2307/3001616">https://doi.org/10.2307/3001616</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../bayesian/bayesian.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Bayesian</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../changepoint/changepoint.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Changepoint Analysis</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>