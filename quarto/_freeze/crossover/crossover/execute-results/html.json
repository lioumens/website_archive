{
  "hash": "2f6f60585a8421680b89d57ab6dc4562",
  "result": {
    "markdown": "---\ntitle: \"Crossover Designs\"\ndate: \"2022-12-18\"\nauthor: \"Michael Liou\"\nexecute: \n  cache: true\n---\n\n\n\n\n## Introduction \n\n- uniform in sequence\n- uniform in period\n- balanced\n  - carry over effects are all balanced\n- strongly balanced\n - including following self\n\nEffects of interest\n\n- \"period effect\"\n- \"treatment effect\"\n- \"carryover effect\"\n- \"treatment x period\"\n- \"subject x treatment\"\n- \"subject x period\" \n\n\n::: {.cell hash='crossover_cache/html/unnamed-chunk-1_92d4289a5499b91e4870cef6589cd845'}\n\n```{.r .cell-code}\ntribble(~Advantages, ~Disadvantages,\n        \"fewer samples\", \"\",\n        \"more precision per unit\", \"\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 2\n  Advantages              Disadvantages\n  <chr>                   <chr>        \n1 fewer samples           \"\"           \n2 more precision per unit \"\"           \n```\n:::\n:::\n\n\n\n## 2x2 Design\n\n### Example: PEF\n\n> The data in Table 3.1 are taken from those which were reported in\nSenn and Auclair 1990, p. 1290). They are measurements of peak expiratory\nflow PEF), a measure of lung function National Asthma Education Program,\n1991, pp. 6±9), made on 13 children aged 7 to 14 with moderate or severe\nasthma in a two-treatment two-period cross-over comparing the effects of a\nsingle inhaled dose of 200g salbutamol, a well-established bronchodilator,\nand 12g formoterol, a more recently developed bronchodilator Faulds et al.,\n1991). The children were randomized to one of two sequence groups. In one\ngroup they were given a dose of formoterol in the morning and observed for 8 h in\nthe clinic. They then travelled home where they or their parents took further\nmeasurements 10, 11 and 12 h after treatment. PEF is a measurement which\npatients may record themselves using a simple device.) On a subsequent occasion\nafter a wash-out of at least one day they presented at the clinic again and were\ngiven a single dose of salbutamol. Measurements in the clinic followed as before\nand were again succeeded by measurements at home. For the second sequence\ngroup, the procedure was as for the first except that they received salbutamol on\nthe first visit to the clinic and formoterol on the second visit to the clinic.\n\nPeak Exploratory Flow\n\n- `id` - patient id\n- `trt` - two levels, formoterol (for) and salbutamol (sal)\n- `pef` - peak exploratory flow\n- `period` - period of experiment\n\n\n::: {.cell hash='crossover_cache/html/unnamed-chunk-2_6bc09fa4e399613243dd9dcc8240da66'}\n\n```{.r .cell-code}\npef <- read.csv(\"data/pef.csv\") %>% \n  # create variable for treatment sequence\n  mutate(seq = ifelse((trt == \"for\" & period == 1) |\n                        (trt == \"sal\" & period == 2),\n                      \"FS\",\n                      \"SF\"),\n         trt = dplyr::recode(trt,\n                             \"for\" = \"formo\",\n                             \"sal\" = \"salbu\")) %>% \n  rename(\"trt_seq\" = \"seq\")\n\npef %>% ggplot(aes(id, pef, color = trt)) +\n  geom_point() +\n  facet_wrap(~trt_seq)\n```\n\n::: {.cell-output-display}\n![](crossover_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n### Analysis\n\nThe easiest analysis is probably the paired t-test. This throws away information about the periods in the study.\n\n\n::: {.cell hash='crossover_cache/html/unnamed-chunk-3_b38c3ef7d3602c764ebb9514c2d43850'}\n\n```{.r .cell-code}\npef_wide <- pef %>% pivot_wider(id_cols = c(id, trt_seq), names_from = trt, values_from = \"pef\") %>% \n  mutate(diff = formo - salbu)\npef_wide$diff %>% mean() # 45.385\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 45.38462\n```\n:::\n\n```{.r .cell-code}\npef_wide$diff %>% sd() # 40.593\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 40.59257\n```\n:::\n\n```{.r .cell-code}\npef_t <- t.test(pef_wide$formo, pef_wide$salbu, paired = TRUE)\n\n45.384462 / 4.0312 # the estimated standard error\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 11.2583\n```\n:::\n\n```{.r .cell-code}\npef_t\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tPaired t-test\n\ndata:  pef_wide$formo and pef_wide$salbu\nt = 4.0312, df = 12, p-value = 0.001666\nalternative hypothesis: true mean difference is not equal to 0\n95 percent confidence interval:\n 20.85477 69.91446\nsample estimates:\nmean difference \n       45.38462 \n```\n:::\n:::\n\n\nThe next analysis is to adjust for the period effect with just to do a sample t test of the differences by period.\n\n\n::: {.cell hash='crossover_cache/html/unnamed-chunk-4_e09f4dc2e811964b9a6c716174149f1b'}\n\n```{.r .cell-code}\npef_FS <- pef_wide %>% filter(trt_seq == \"FS\") %>% pull(diff)\npef_SF <- pef_wide %>% filter(trt_seq == \"SF\") %>% pull(diff)\n\npef_FS_SS <- sum((pef_FS - mean(pef_FS))^2) # FS sum squares\npef_SF_SS <- sum((pef_SF - mean(pef_SF))^2) # SF sum squares\n\n((length(pef_FS) - 1) * pef_FS_SS + (length(pef_SF) -1) * pef_SF_SS) / (length(pef_FS) + length(pef_SF) - 2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 8096.916\n```\n:::\n\n```{.r .cell-code}\n(pef_FS_SS + pef_SF_SS) / (length(pef_FS) + length(pef_SF) - 2) # 1500.81\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 1500.812\n```\n:::\n\n```{.r .cell-code}\nsd_pooled(pef_FS, pef_SF)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 38.74031\n```\n:::\n\n```{.r .cell-code}\n# pooled estimate of variance\n\nt.test(scale(pef_FS, scale = F), scale(pef_SF, scale = F), var.equal = FALSE)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tWelch Two Sample t-test\n\ndata:  scale(pef_FS, scale = F) and scale(pef_SF, scale = F)\nt = -9.1837e-17, df = 9.1017, p-value = 1\nalternative hypothesis: true difference in means is not equal to 0\n95 percent confidence interval:\n -49.89732  49.89732\nsample estimates:\n    mean of x     mean of y \n-2.029131e-15  0.000000e+00 \n```\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}